import{_ as s,c as n,o as a,a as l}from"./app.8b8db46f.js";const p="/assets/image12.bf98e6ff.png",o="/assets/image13.d55ec80e.png",e="/assets/image14.18bf33a2.png",c="/assets/image15.d280467b.png",t="/assets/image16.5ba1f22a.png",r="/assets/image17.4fffedf8.png",y="/assets/image18.cce292c6.png",b=JSON.parse('{"title":"React16+\u6E90\u7801\u89E3\u6790","description":"","frontmatter":{"outline":"deep"},"headers":[{"level":2,"title":"1. \u914D\u7F6E React \u6E90\u7801\u672C\u5730\u8C03\u8BD5\u73AF\u5883","slug":"_1-\u914D\u7F6E-react-\u6E90\u7801\u672C\u5730\u8C03\u8BD5\u73AF\u5883","link":"#_1-\u914D\u7F6E-react-\u6E90\u7801\u672C\u5730\u8C03\u8BD5\u73AF\u5883","children":[]},{"level":2,"title":"2. \u521B\u5EFA React \u5143\u7D20","slug":"_2-\u521B\u5EFA-react-\u5143\u7D20","link":"#_2-\u521B\u5EFA-react-\u5143\u7D20","children":[{"level":3,"title":"2.1 createElement","slug":"_2-1-createelement","link":"#_2-1-createelement","children":[]},{"level":3,"title":"2.2 ReactElement","slug":"_2-2-reactelement","link":"#_2-2-reactelement","children":[]},{"level":3,"title":"2.3 hasValidRef","slug":"_2-3-hasvalidref","link":"#_2-3-hasvalidref","children":[]},{"level":3,"title":"2.4 hasValidKey","slug":"_2-4-hasvalidkey","link":"#_2-4-hasvalidkey","children":[]},{"level":3,"title":"2.5 isValidElement","slug":"_2-5-isvalidelement","link":"#_2-5-isvalidelement","children":[]},{"level":3,"title":"2.6 defineKeyPropWarningGetter","slug":"_2-6-definekeypropwarninggetter","link":"#_2-6-definekeypropwarninggetter","children":[]},{"level":3,"title":"2.7 defineRefPropWarningGetter","slug":"_2-7-definerefpropwarninggetter","link":"#_2-7-definerefpropwarninggetter","children":[]}]},{"level":2,"title":"3. React \u67B6\u6784","slug":"_3-react-\u67B6\u6784","link":"#_3-react-\u67B6\u6784","children":[{"level":3,"title":"3.1 Scheduler \u8C03\u5EA6\u5C42","slug":"_3-1-scheduler-\u8C03\u5EA6\u5C42","link":"#_3-1-scheduler-\u8C03\u5EA6\u5C42","children":[]},{"level":3,"title":"3.2 Reconciler \u534F\u8C03\u5C42","slug":"_3-2-reconciler-\u534F\u8C03\u5C42","link":"#_3-2-reconciler-\u534F\u8C03\u5C42","children":[]},{"level":3,"title":"3.3 Renderer \u6E32\u67D3\u5C42","slug":"_3-3-renderer-\u6E32\u67D3\u5C42","link":"#_3-3-renderer-\u6E32\u67D3\u5C42","children":[]}]},{"level":2,"title":"4. \u6570\u636E\u7ED3\u6784","slug":"_4-\u6570\u636E\u7ED3\u6784","link":"#_4-\u6570\u636E\u7ED3\u6784","children":[{"level":3,"title":"4.1 Fiber","slug":"_4-1-fiber","link":"#_4-1-fiber","children":[]},{"level":3,"title":"4.2 WorkTag","slug":"_4-2-worktag","link":"#_4-2-worktag","children":[]},{"level":3,"title":"4.3 TypeOfMode","slug":"_4-3-typeofmode","link":"#_4-3-typeofmode","children":[]},{"level":3,"title":"4.3 SideEffectTag","slug":"_4-3-sideeffecttag","link":"#_4-3-sideeffecttag","children":[]},{"level":3,"title":"4.4 Update","slug":"_4-4-update","link":"#_4-4-update","children":[]},{"level":3,"title":"4.5 UpdateQueue","slug":"_4-5-updatequeue","link":"#_4-5-updatequeue","children":[]},{"level":3,"title":"4.6 RootTag","slug":"_4-6-roottag","link":"#_4-6-roottag","children":[]},{"level":3,"title":"4.7 \u53CC\u7F13\u5B58\u6280\u672F","slug":"_4-7-\u53CC\u7F13\u5B58\u6280\u672F","link":"#_4-7-\u53CC\u7F13\u5B58\u6280\u672F","children":[]},{"level":3,"title":"4.8 \u533A\u5206 fiberRoot \u4E0E rootFiber","slug":"_4-8-\u533A\u5206-fiberroot-\u4E0E-rootfiber","link":"#_4-8-\u533A\u5206-fiberroot-\u4E0E-rootfiber","children":[]}]},{"level":2,"title":"5. \u521D\u59CB\u5316\u6E32\u67D3","slug":"_5-\u521D\u59CB\u5316\u6E32\u67D3","link":"#_5-\u521D\u59CB\u5316\u6E32\u67D3","children":[{"level":3,"title":"5.1 render \u9636\u6BB5","slug":"_5-1-render-\u9636\u6BB5","link":"#_5-1-render-\u9636\u6BB5","children":[]},{"level":3,"title":"5.2 commit \u9636\u6BB5","slug":"_5-2-commit-\u9636\u6BB5","link":"#_5-2-commit-\u9636\u6BB5","children":[]}]}],"relativePath":"Framework/React/React16Code.md"}'),D={name:"Framework/React/React16Code.md"},A=l(`<h1 id="react16-\u6E90\u7801\u89E3\u6790" tabindex="-1">React16+\u6E90\u7801\u89E3\u6790 <a class="header-anchor" href="#react16-\u6E90\u7801\u89E3\u6790" aria-hidden="true">#</a></h1><h2 id="_1-\u914D\u7F6E-react-\u6E90\u7801\u672C\u5730\u8C03\u8BD5\u73AF\u5883" tabindex="-1">1. \u914D\u7F6E React \u6E90\u7801\u672C\u5730\u8C03\u8BD5\u73AF\u5883 <a class="header-anchor" href="#_1-\u914D\u7F6E-react-\u6E90\u7801\u672C\u5730\u8C03\u8BD5\u73AF\u5883" aria-hidden="true">#</a></h2><ol><li><p>\u4F7F\u7528 create-react-app \u811A\u624B\u67B6\u521B\u5EFA\u9879\u76EE</p><p><code>npx create-react-app react-test</code></p></li><li><p>\u5F39\u5C04 create-react-app \u811A\u624B\u67B6\u5185\u90E8\u914D\u7F6E</p><p><code>npm run eject</code></p></li><li><p>\u514B\u9686 react \u5B98\u65B9\u6E90\u7801 (\u5728\u9879\u76EE\u7684\u6839\u76EE\u5F55\u4E0B\u8FDB\u884C\u514B\u9686)</p><p><code>git clone --branch v16.13.1 --depth=1 https://github.com/facebook/react.git src/react</code></p></li><li><p>\u94FE\u63A5\u672C\u5730\u6E90\u7801</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// \u6587\u4EF6\u4F4D\u7F6E: react-test/config/webpack.config.js</span></span>
<span class="line"><span style="color:#80A665;">resolve</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">alias</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">react-native</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#DBD7CAEE;">: </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">react-native-web</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">react</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#DBD7CAEE;">: </span><span style="color:#BD976A;">path</span><span style="color:#666666;">.</span><span style="color:#80A665;">resolve</span><span style="color:#666666;">(</span><span style="color:#BD976A;">__dirname</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">../src/react/packages/react</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">),</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">react-dom</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#DBD7CAEE;">: </span><span style="color:#BD976A;">path</span><span style="color:#666666;">.</span><span style="color:#80A665;">resolve</span><span style="color:#666666;">(</span><span style="color:#BD976A;">__dirname</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">../src/react/packages/react-dom</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">),</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">shared</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#DBD7CAEE;">: </span><span style="color:#BD976A;">path</span><span style="color:#666666;">.</span><span style="color:#80A665;">resolve</span><span style="color:#666666;">(</span><span style="color:#BD976A;">__dirname</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">../src/react/packages/shared</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">),</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">react-reconciler</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#DBD7CAEE;">: </span><span style="color:#BD976A;">path</span><span style="color:#666666;">.</span><span style="color:#80A665;">resolve</span><span style="color:#666666;">(</span><span style="color:#BD976A;">__dirname</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">../src/react/packages/react-reconciler</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">),</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">legacy-events</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#DBD7CAEE;">: </span><span style="color:#BD976A;">path</span><span style="color:#666666;">.</span><span style="color:#80A665;">resolve</span><span style="color:#666666;">(</span><span style="color:#BD976A;">__dirname</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">../src/react/packages/legacy-events</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// \u6587\u4EF6\u4F4D\u7F6E: react-test/config/webpack.config.js</span></span>
<span class="line"><span style="color:#59873A;">resolve</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">alias</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">react-native</span><span style="color:#B56959AA;">&quot;</span><span style="color:#393A34;">: </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">react-native-web</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">react</span><span style="color:#B56959AA;">&quot;</span><span style="color:#393A34;">: </span><span style="color:#B07D48;">path</span><span style="color:#999999;">.</span><span style="color:#59873A;">resolve</span><span style="color:#999999;">(</span><span style="color:#B07D48;">__dirname</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">../src/react/packages/react</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">),</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">react-dom</span><span style="color:#B56959AA;">&quot;</span><span style="color:#393A34;">: </span><span style="color:#B07D48;">path</span><span style="color:#999999;">.</span><span style="color:#59873A;">resolve</span><span style="color:#999999;">(</span><span style="color:#B07D48;">__dirname</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">../src/react/packages/react-dom</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">),</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">shared</span><span style="color:#B56959AA;">&quot;</span><span style="color:#393A34;">: </span><span style="color:#B07D48;">path</span><span style="color:#999999;">.</span><span style="color:#59873A;">resolve</span><span style="color:#999999;">(</span><span style="color:#B07D48;">__dirname</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">../src/react/packages/shared</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">),</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">react-reconciler</span><span style="color:#B56959AA;">&quot;</span><span style="color:#393A34;">: </span><span style="color:#B07D48;">path</span><span style="color:#999999;">.</span><span style="color:#59873A;">resolve</span><span style="color:#999999;">(</span><span style="color:#B07D48;">__dirname</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">../src/react/packages/react-reconciler</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">),</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">legacy-events</span><span style="color:#B56959AA;">&quot;</span><span style="color:#393A34;">: </span><span style="color:#B07D48;">path</span><span style="color:#999999;">.</span><span style="color:#59873A;">resolve</span><span style="color:#999999;">(</span><span style="color:#B07D48;">__dirname</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">../src/react/packages/legacy-events</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div></li><li><p>\u4FEE\u6539\u73AF\u5883\u53D8\u91CF</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// \u6587\u4EF6\u4F4D\u7F6E: react-test/config/env.js</span></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">stringified</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">p<wbr>rocess.env</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Object</span><span style="color:#666666;">.</span><span style="color:#80A665;">keys</span><span style="color:#666666;">(</span><span style="color:#BD976A;">raw</span><span style="color:#666666;">).</span><span style="color:#80A665;">reduce</span><span style="color:#666666;">((</span><span style="color:#BD976A;">env</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">key</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">env</span><span style="color:#666666;">[</span><span style="color:#BD976A;">key</span><span style="color:#666666;">]</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">JSON</span><span style="color:#666666;">.</span><span style="color:#80A665;">stringify</span><span style="color:#666666;">(</span><span style="color:#BD976A;">raw</span><span style="color:#666666;">[</span><span style="color:#BD976A;">key</span><span style="color:#666666;">]);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">env</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">},</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{}),</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">__DEV__</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">SharedArrayBuffer</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">spyOnDev</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">spyOnDevAndProd</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">spyOnProd</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">__PROFILE__</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">__UMD__</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">__EXPERIMENTAL__</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">__VARIANT__</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">gate</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">trustedTypes</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">};</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// \u6587\u4EF6\u4F4D\u7F6E: react-test/config/env.js</span></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">stringified</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">p<wbr>rocess.env</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Object</span><span style="color:#999999;">.</span><span style="color:#59873A;">keys</span><span style="color:#999999;">(</span><span style="color:#B07D48;">raw</span><span style="color:#999999;">).</span><span style="color:#59873A;">reduce</span><span style="color:#999999;">((</span><span style="color:#B07D48;">env</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">key</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">env</span><span style="color:#999999;">[</span><span style="color:#B07D48;">key</span><span style="color:#999999;">]</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">JSON</span><span style="color:#999999;">.</span><span style="color:#59873A;">stringify</span><span style="color:#999999;">(</span><span style="color:#B07D48;">raw</span><span style="color:#999999;">[</span><span style="color:#B07D48;">key</span><span style="color:#999999;">]);</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">env</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">},</span><span style="color:#393A34;"> </span><span style="color:#999999;">{}),</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">__DEV__</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">SharedArrayBuffer</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">spyOnDev</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">spyOnDevAndProd</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">spyOnProd</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">__PROFILE__</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">__UMD__</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">__EXPERIMENTAL__</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">__VARIANT__</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">gate</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">trustedTypes</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">};</span></span>
<span class="line"></span></code></pre></div></li><li><p>\u544A\u8BC9 babel \u5728\u8F6C\u6362\u4EE3\u7801\u65F6\u5FFD\u7565\u7C7B\u578B\u68C0\u67E5</p><p><code>npm install @babel/plugin-transform-flow-strip-types -D</code></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// \u6587\u4EF6\u4F4D\u7F6E: react-test/config/webpack.config.js [babel-loader]</span></span>
<span class="line"><span style="color:#80A665;">plugins</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span><span style="color:#BD976A;">require</span><span style="color:#666666;">.</span><span style="color:#80A665;">resolve</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">@babel/plugin-transform-flow-strip-types</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)];</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// \u6587\u4EF6\u4F4D\u7F6E: react-test/config/webpack.config.js [babel-loader]</span></span>
<span class="line"><span style="color:#59873A;">plugins</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span><span style="color:#B07D48;">require</span><span style="color:#999999;">.</span><span style="color:#59873A;">resolve</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">@babel/plugin-transform-flow-strip-types</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)];</span></span>
<span class="line"></span></code></pre></div></li><li><p>\u5BFC\u51FA HostConfig</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// \u6587\u4EF6\u4F4D\u7F6E: /react/packages/react-reconciler/src/ReactFiberHostConfig.js</span></span>
<span class="line"><span style="color:#CB7676;">+</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">*</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">./forks/ReactFiberHostConfig.dom</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#CB7676;">-</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">invariant</span><span style="color:#666666;">(</span><span style="color:#4D9375;">false</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">This module must be shimmed by a specific renderer.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// \u6587\u4EF6\u4F4D\u7F6E: /react/packages/react-reconciler/src/ReactFiberHostConfig.js</span></span>
<span class="line"><span style="color:#AB5959;">+</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">*</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">./forks/ReactFiberHostConfig.dom</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#AB5959;">-</span><span style="color:#393A34;"> </span><span style="color:#59873A;">invariant</span><span style="color:#999999;">(</span><span style="color:#1E754F;">false</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">This module must be shimmed by a specific renderer.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"></span></code></pre></div></li><li><p>\u4FEE\u6539 ReactSharedInternals.js \u6587\u4EF6</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// \u6587\u4EF6\u4F4D\u7F6E: /react/packages/shared/ReactSharedInternals.js</span></span>
<span class="line"><span style="color:#CB7676;">-</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">*</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">as</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">React</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">react</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#CB7676;">-</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ReactSharedInternals</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">React</span><span style="color:#666666;">.</span><span style="color:#BD976A;">__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#CB7676;">+</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ReactSharedInternals</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">../react/src/ReactSharedInternals</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">;</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// \u6587\u4EF6\u4F4D\u7F6E: /react/packages/shared/ReactSharedInternals.js</span></span>
<span class="line"><span style="color:#AB5959;">-</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">*</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">as</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">React</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">react</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#AB5959;">-</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ReactSharedInternals</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">React</span><span style="color:#999999;">.</span><span style="color:#B07D48;">__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#AB5959;">+</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ReactSharedInternals</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">../react/src/ReactSharedInternals</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">;</span></span>
<span class="line"></span></code></pre></div></li><li><p>\u5173\u95ED eslint \u6269\u5C55</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// \u6587\u4EF6\u4F4D\u7F6E: react/.eslingrc.js [module.exports]</span></span>
<span class="line"><span style="color:#758575DD;">// \u5220\u9664 extends</span></span>
<span class="line"><span style="color:#80A665;">extends</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">fbjs</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">prettier</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"><span style="color:#666666;">]</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// \u6587\u4EF6\u4F4D\u7F6E: react/.eslingrc.js [module.exports]</span></span>
<span class="line"><span style="color:#A0ADA0;">// \u5220\u9664 extends</span></span>
<span class="line"><span style="color:#59873A;">extends</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">fbjs</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">prettier</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#999999;">]</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div></li><li><p>\u7981\u6B62 invariant \u62A5\u9519</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// \u6587\u4EF6\u4F4D\u7F6E: /react/packages/shared/invariant.js</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">default</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">invariant</span><span style="color:#666666;">(</span><span style="color:#BD976A;">condition</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">format</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">a</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">b</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">c</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">d</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">e</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">f</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">condition</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">return</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">throw</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">Error</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Internal React error: invariant() is meant to be replaced at compile </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">+</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">time. There is no runtime version.</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// \u6587\u4EF6\u4F4D\u7F6E: /react/packages/shared/invariant.js</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">default</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">invariant</span><span style="color:#999999;">(</span><span style="color:#B07D48;">condition</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">format</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">a</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">b</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">c</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">d</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">e</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">f</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">condition</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">return</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">throw</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">Error</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Internal React error: invariant() is meant to be replaced at compile </span><span style="color:#B56959AA;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">time. There is no runtime version.</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div></li><li><p>eslint \u914D\u7F6E</p><p>\u5728 react \u6E90\u7801\u6587\u4EF6\u5939\u4E2D\u65B0\u5EFA .eslintrc.json \u5E76\u6DFB\u52A0\u5982\u4E0B\u914D\u7F6E</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">extends</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#DBD7CAEE;">: </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">react-app</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">globals</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#DBD7CAEE;">: </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">SharedArrayBuffer</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">spyOnDev</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">spyOnDevAndProd</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">spyOnProd</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">__PROFILE__</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">__UMD__</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">__EXPERIMENTAL__</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">__VARIANT__</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">gate</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">trustedTypes</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">extends</span><span style="color:#B56959AA;">&quot;</span><span style="color:#393A34;">: </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">react-app</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">globals</span><span style="color:#B56959AA;">&quot;</span><span style="color:#393A34;">: </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">SharedArrayBuffer</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">spyOnDev</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">spyOnDevAndProd</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">spyOnProd</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">__PROFILE__</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">__UMD__</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">__EXPERIMENTAL__</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">__VARIANT__</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">gate</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">trustedTypes</span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div></li><li><p>\u4FEE\u6539 react react-dom \u5F15\u5165\u65B9\u5F0F</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">*</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">as</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">React</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">react</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">import</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">*</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">as</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ReactDOM</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">from</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">react-dom</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">;</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">*</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">as</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">React</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">react</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">import</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">*</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">as</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ReactDOM</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">from</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">react-dom</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">;</span></span>
<span class="line"></span></code></pre></div></li><li><p>\u89E3\u51B3 vsCode \u4E2D flow \u62A5\u9519</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">javascript.validate.enable</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#DBD7CAEE;">: </span><span style="color:#4D9375;">false</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">javascript.validate.enable</span><span style="color:#B56959AA;">&quot;</span><span style="color:#393A34;">: </span><span style="color:#1E754F;">false</span></span>
<span class="line"></span></code></pre></div></li><li><p>\u53EF\u9009\u9879\u914D\u7F6E</p><p>\u5982\u679C\u4F60\u7684 vscode \u7F16\u8F91\u5668\u5B89\u88C5\u4E86 prettier \u63D2\u4EF6\u5E76\u4E14\u5728\u4FDD\u5B58 react \u6E90\u7801\u6587\u4EF6\u65F6\u53F3\u4E0B\u89D2\u51FA\u73B0\u5982\u4E0B\u9519\u8BEF\uFF0C\u6309\u7167\u5982\u4E0B\u6B65\u9AA4\u89E3\u51B3</p></li></ol><p><img src="`+p+`" alt="1.png"></p><pre><code>1. \u5168\u5C40\u5B89\u88C5 prettier

   \`npm i prettier -g\`

2. \u914D\u7F6E prettier path

   Settings &gt; Extensions &gt; Prettier &gt; Prettier path
</code></pre><p><img src="`+o+`" alt="1.png"></p><ol start="15"><li><p>__DEV__ \u62A5\u9519</p><p>\u5220\u9664 node_modules \u6587\u4EF6\u5939\uFF0C\u6267\u884C npm install</p></li></ol><h2 id="_2-\u521B\u5EFA-react-\u5143\u7D20" tabindex="-1">2. \u521B\u5EFA React \u5143\u7D20 <a class="header-anchor" href="#_2-\u521B\u5EFA-react-\u5143\u7D20" aria-hidden="true">#</a></h2><p>JSX \u88AB Babel \u7F16\u8BD1\u4E3A React.createElement \u65B9\u6CD5\u7684\u8C03\u7528\uFF0CcreateElement \u65B9\u6CD5\u5728\u8C03\u7528\u540E\u8FD4\u56DE\u7684\u5C31\u662F ReactElement\uFF0C\u5C31\u662F virtualDOM\u3002</p><h3 id="_2-1-createelement" tabindex="-1">2.1 createElement <a class="header-anchor" href="#_2-1-createelement" aria-hidden="true">#</a></h3><p><code>\u6587\u4EF6\u4F4D\u7F6E\uFF1Apackages/react/src/ReactElement.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * \u521B\u5EFA React Element</span></span>
<span class="line"><span style="color:#758575DD;"> * type      \u5143\u7D20\u7C7B\u578B</span></span>
<span class="line"><span style="color:#758575DD;"> * config    \u914D\u7F6E\u5C5E\u6027</span></span>
<span class="line"><span style="color:#758575DD;"> * children  \u5B50\u5143\u7D20</span></span>
<span class="line"><span style="color:#758575DD;"> * 1. \u5206\u79BB props \u5C5E\u6027\u548C\u7279\u6B8A\u5C5E\u6027</span></span>
<span class="line"><span style="color:#758575DD;"> * 2. \u5C06\u5B50\u5143\u7D20\u6302\u8F7D\u5230 props.children \u4E2D</span></span>
<span class="line"><span style="color:#758575DD;"> * 3. \u4E3A props \u5C5E\u6027\u8D4B\u9ED8\u8BA4\u503C (defaultProps)</span></span>
<span class="line"><span style="color:#758575DD;"> * 4. \u521B\u5EFA\u5E76\u8FD4\u56DE ReactElement</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">createElement</span><span style="color:#666666;">(</span><span style="color:#BD976A;">type</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">config</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">children</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">     * propName -&gt; \u5C5E\u6027\u540D\u79F0</span></span>
<span class="line"><span style="color:#758575DD;">     * \u7528\u4E8E\u540E\u9762\u7684 for \u5FAA\u73AF</span></span>
<span class="line"><span style="color:#758575DD;">     */</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">propName</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">     * \u5B58\u50A8 React Element \u4E2D\u7684\u666E\u901A\u5143\u7D20\u5C5E\u6027 \u5373\u4E0D\u5305\u542B key ref self source</span></span>
<span class="line"><span style="color:#758575DD;">     */</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">props</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">     * \u5F85\u63D0\u53D6\u5C5E\u6027</span></span>
<span class="line"><span style="color:#758575DD;">     * React \u5185\u90E8\u4E3A\u4E86\u5B9E\u73B0\u67D0\u4E9B\u529F\u80FD\u800C\u5B58\u5728\u7684\u5C5E\u6027</span></span>
<span class="line"><span style="color:#758575DD;">     */</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">key</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ref</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">self</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">source</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C config \u4E0D\u4E3A null</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">config</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5982\u679C config \u5BF9\u8C61\u4E2D\u6709\u5408\u6CD5\u7684 ref \u5C5E\u6027</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#80A665;">hasValidRef</span><span style="color:#666666;">(</span><span style="color:#BD976A;">config</span><span style="color:#666666;">))</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5C06 config.ref \u5C5E\u6027\u63D0\u53D6\u5230 ref \u53D8\u91CF\u4E2D</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">ref</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">config</span><span style="color:#666666;">.</span><span style="color:#BD976A;">ref</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5728\u5F00\u53D1\u73AF\u5883\u4E2D</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">__DEV__</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u5982\u679C ref \u5C5E\u6027\u7684\u503C\u88AB\u8BBE\u7F6E\u6210\u4E86\u5B57\u7B26\u4E32\u5F62\u5F0F\u5C31\u62A5\u4E00\u4E2A\u63D0\u793A</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u8BF4\u660E\u6B64\u7528\u6CD5\u5728\u5C06\u6765\u7684\u7248\u672C\u4E2D\u4F1A\u88AB\u5220\u9664</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#80A665;">warnIfStringRefCannotBeAutoConverted</span><span style="color:#666666;">(</span><span style="color:#BD976A;">config</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5982\u679C\u5728 config \u5BF9\u8C61\u4E2D\u62E5\u6709\u5408\u6CD5\u7684 key \u5C5E\u6027</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#80A665;">hasValidKey</span><span style="color:#666666;">(</span><span style="color:#BD976A;">config</span><span style="color:#666666;">))</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5C06 config.key \u5C5E\u6027\u4E2D\u7684\u503C\u63D0\u53D6\u5230 key \u53D8\u91CF\u4E2D</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">key</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">+</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">config</span><span style="color:#666666;">.</span><span style="color:#BD976A;">key</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">self</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">config</span><span style="color:#666666;">.</span><span style="color:#BD976A;">__self</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">undefined</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">?</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">config</span><span style="color:#666666;">.</span><span style="color:#BD976A;">__self</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">source</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">config</span><span style="color:#666666;">.</span><span style="color:#BD976A;">__source</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">undefined</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">?</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">config</span><span style="color:#666666;">.</span><span style="color:#BD976A;">__source</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u904D\u5386 config \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">for</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">propName</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">in</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">config</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5982\u679C\u5F53\u524D\u904D\u5386\u5230\u7684\u5C5E\u6027\u662F\u5BF9\u8C61\u81EA\u8EAB\u5C5E\u6027</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5E76\u4E14\u5728 RESERVED_PROPS \u5BF9\u8C61\u4E2D\u4E0D\u5B58\u5728\u8BE5\u5C5E\u6027</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">hasOwnProperty</span><span style="color:#666666;">.</span><span style="color:#80A665;">call</span><span style="color:#666666;">(</span><span style="color:#BD976A;">config</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">propName</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#CB7676;">!</span><span style="color:#BD976A;">RESERVED_PROPS</span><span style="color:#666666;">.</span><span style="color:#80A665;">hasOwnProperty</span><span style="color:#666666;">(</span><span style="color:#BD976A;">propName</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u5C06\u6EE1\u8DB3\u6761\u4EF6\u7684\u5C5E\u6027\u6DFB\u52A0\u5230 props \u5BF9\u8C61\u4E2D (\u666E\u901A\u5C5E\u6027)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">props</span><span style="color:#666666;">[</span><span style="color:#BD976A;">propName</span><span style="color:#666666;">]</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">config</span><span style="color:#666666;">[</span><span style="color:#BD976A;">propName</span><span style="color:#666666;">];</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">     * \u5C06\u7B2C\u4E09\u4E2A\u53CA\u4E4B\u540E\u7684\u53C2\u6570\u6302\u8F7D\u5230 props.children \u5C5E\u6027\u4E2D</span></span>
<span class="line"><span style="color:#758575DD;">     * \u5982\u679C\u5B50\u5143\u7D20\u662F\u591A\u4E2A props.children \u662F\u6570\u7EC4</span></span>
<span class="line"><span style="color:#758575DD;">     * \u5982\u679C\u5B50\u5143\u7D20\u662F\u4E00\u4E2A props.children \u662F\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#758575DD;">     */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u7531\u4E8E\u4ECE\u7B2C\u4E09\u4E2A\u53C2\u6570\u5F00\u59CB\u53CA\u4EE5\u540E\u90FD\u8868\u793A\u5B50\u5143\u7D20</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u6240\u4EE5\u51CF\u53BB\u524D\u4E24\u4E2A\u53C2\u6570\u7684\u7ED3\u679C\u5C31\u662F\u5B50\u5143\u7D20\u7684\u6570\u91CF</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">childrenLength</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C99076;">arguments</span><span style="color:#666666;">.</span><span style="color:#B8A965;">length</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">-</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">2</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C\u5B50\u5143\u7D20\u7684\u6570\u91CF\u662F 1</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">childrenLength</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">1</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u76F4\u63A5\u5C06\u5B50\u5143\u7D20\u6302\u8F7D\u5230\u5230 props.children \u5C5E\u6027\u4E0A</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u6B64\u65F6 children \u662F\u5BF9\u8C61\u7C7B\u578B</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">props</span><span style="color:#666666;">.</span><span style="color:#BD976A;">children</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">children</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5982\u679C\u5B50\u5143\u7D20\u7684\u6570\u91CF\u5927\u4E8E 1</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">childrenLength</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">1</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u521B\u5EFA\u6570\u7EC4, \u6570\u7EC4\u4E2D\u5143\u7D20\u7684\u6570\u91CF\u7B49\u4E8E\u5B50\u5143\u7D20\u7684\u6570\u91CF</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">childArray</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">Array</span><span style="color:#666666;">(</span><span style="color:#BD976A;">childrenLength</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5F00\u542F\u5FAA\u73AF \u5FAA\u73AF\u6B21\u5339\u914D\u5B50\u5143\u7D20\u7684\u6570\u91CF</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">for</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">i</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">i</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">childrenLength</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">i</span><span style="color:#CB7676;">++</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5C06\u5B50\u5143\u7D20\u6DFB\u52A0\u5230 childArray \u6570\u7EC4\u4E2D</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// i + 2 \u7684\u539F\u56E0\u662F\u5B9E\u53C2\u96C6\u5408\u7684\u524D\u4E24\u4E2A\u53C2\u6570\u4E0D\u662F\u5B50\u5143\u7D20</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">childArray</span><span style="color:#666666;">[</span><span style="color:#BD976A;">i</span><span style="color:#666666;">]</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C99076;">arguments</span><span style="color:#666666;">[</span><span style="color:#BD976A;">i</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">+</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">2</span><span style="color:#666666;">];</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5982\u679C\u662F\u5F00\u53D1\u73AF\u5883</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">__DEV__</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5982\u679C Object \u5BF9\u8C61\u4E2D\u5B58\u5728 freeze \u65B9\u6CD5</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">Object</span><span style="color:#666666;">.</span><span style="color:#BD976A;">freeze</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u8C03\u7528 freeze \u65B9\u6CD5 \u51BB\u7ED3 childArray \u6570\u7EC4</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u9632\u6B62 React \u6838\u5FC3\u5BF9\u8C61\u88AB\u4FEE\u6539 \u51BB\u7ED3\u5BF9\u8C61\u63D0\u9AD8\u6027\u80FD</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">Object</span><span style="color:#666666;">.</span><span style="color:#80A665;">freeze</span><span style="color:#666666;">(</span><span style="color:#BD976A;">childArray</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5C06\u5B50\u5143\u7D20\u6570\u7EC4\u6302\u8F7D\u5230 props.children \u5C5E\u6027\u4E2D</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">props</span><span style="color:#666666;">.</span><span style="color:#BD976A;">children</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">childArray</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">     * \u5982\u679C\u5F53\u524D\u5904\u7406\u662F\u7EC4\u4EF6</span></span>
<span class="line"><span style="color:#758575DD;">     * \u770B\u7EC4\u4EF6\u8EAB\u4E0A\u662F\u5426\u6709 defaultProps \u5C5E\u6027</span></span>
<span class="line"><span style="color:#758575DD;">     * \u8FD9\u4E2A\u5C5E\u6027\u4E2D\u5B58\u50A8\u7684\u662F props \u5BF9\u8C61\u4E2D\u5C5E\u6027\u7684\u9ED8\u8BA4\u503C</span></span>
<span class="line"><span style="color:#758575DD;">     * \u904D\u5386 defaultProps \u5BF9\u8C61 \u67E5\u770B\u5BF9\u5E94\u7684 props \u5C5E\u6027\u7684\u503C\u662F\u5426\u4E3A undefined</span></span>
<span class="line"><span style="color:#758575DD;">     * \u5982\u679C\u4E3Aundefined \u5C31\u5C06\u9ED8\u8BA4\u503C\u8D4B\u503C\u7ED9\u5BF9\u5E94\u7684 props \u5C5E\u6027\u503C</span></span>
<span class="line"><span style="color:#758575DD;">     */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5C06 type \u5C5E\u6027\u503C\u89C6\u4E3A\u51FD\u6570 \u67E5\u770B\u5176\u4E2D\u662F\u5426\u5177\u6709 defaultProps \u5C5E\u6027</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">type</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">type</span><span style="color:#666666;">.</span><span style="color:#BD976A;">defaultProps</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5C06 type \u51FD\u6570\u4E0B\u7684 defaultProps \u5C5E\u6027\u8D4B\u503C\u7ED9 defaultProps \u53D8\u91CF</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">defaultProps</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">type</span><span style="color:#666666;">.</span><span style="color:#BD976A;">defaultProps</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u904D\u5386 defaultProps \u5BF9\u8C61\u4E2D\u7684\u5C5E\u6027 \u5C06\u5C5E\u6027\u540D\u79F0\u8D4B\u503C\u7ED9 propName \u53D8\u91CF</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">for</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">propName</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">in</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">defaultProps</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5982\u679C props \u5BF9\u8C61\u4E2D\u7684\u8BE5\u5C5E\u6027\u7684\u503C\u4E3A undefined</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">props</span><span style="color:#666666;">[</span><span style="color:#BD976A;">propName</span><span style="color:#666666;">]</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">undefined</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u5C06 defaultProps \u5BF9\u8C61\u4E2D\u7684\u5BF9\u5E94\u5C5E\u6027\u7684\u503C\u8D4B\u503C\u7ED9 props \u5BF9\u8C61\u4E2D\u7684\u5BF9\u5E94\u5C5E\u6027\u7684\u503C</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">props</span><span style="color:#666666;">[</span><span style="color:#BD976A;">propName</span><span style="color:#666666;">]</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">defaultProps</span><span style="color:#666666;">[</span><span style="color:#BD976A;">propName</span><span style="color:#666666;">];</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">     * \u5728\u5F00\u53D1\u73AF\u5883\u4E2D \u5982\u679C\u5143\u7D20\u7684 key \u5C5E\u6027 \u6216\u8005 ref \u5C5E\u6027\u5B58\u5728</span></span>
<span class="line"><span style="color:#758575DD;">     * \u76D1\u6D4B\u5F00\u53D1\u8005\u662F\u5426\u5728\u7EC4\u4EF6\u5185\u90E8\u901A\u8FC7 props \u5BF9\u8C61\u83B7\u53D6\u4E86 key \u5C5E\u6027\u6216\u8005 ref \u5C5E\u6027</span></span>
<span class="line"><span style="color:#758575DD;">     * \u5982\u679C\u83B7\u53D6\u4E86 \u5C31\u62A5\u9519</span></span>
<span class="line"><span style="color:#758575DD;">     */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C\u5904\u4E8E\u5F00\u53D1\u73AF\u5883</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">__DEV__</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5143\u7D20\u5177\u6709 key \u5C5E\u6027\u6216\u8005 ref \u5C5E\u6027</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">key</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">||</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ref</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u770B\u4E00\u4E0B type \u5C5E\u6027\u4E2D\u5B58\u50A8\u7684\u662F\u5426\u662F\u51FD\u6570 \u5982\u679C\u662F\u51FD\u6570\u5C31\u8868\u793A\u5F53\u524D\u5143\u7D20\u662F\u7EC4\u4EF6</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5982\u679C\u5143\u7D20\u4E0D\u662F\u7EC4\u4EF6 \u5C31\u76F4\u63A5\u8FD4\u56DE\u5143\u7D20\u7C7B\u578B\u5B57\u7B26\u4E32</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// displayName \u7528\u4E8E\u5728\u62A5\u9519\u8FC7\u7A0B\u4E2D\u663E\u793A\u662F\u54EA\u4E00\u4E2A\u7EC4\u4EF6\u62A5\u9519\u4E86</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5982\u679C\u5F00\u53D1\u8005\u663E\u5F0F\u5B9A\u4E49\u4E86 displayName \u5C5E\u6027 \u5C31\u663E\u793A\u5F00\u53D1\u8005\u5B9A\u4E49\u7684</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5426\u8005\u5C31\u663E\u793A\u7EC4\u4EF6\u540D\u79F0 \u5982\u679C\u7EC4\u4EF6\u4E5F\u6CA1\u6709\u540D\u79F0 \u5C31\u663E\u793A &#39;Unknown&#39;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">displayName</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#CB7676;">typeof</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">type</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">function</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#CB7676;">?</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">type</span><span style="color:#666666;">.</span><span style="color:#BD976A;">displayName</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">||</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">type</span><span style="color:#666666;">.</span><span style="color:#BD976A;">name</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">||</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Unknown</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#CB7676;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">type</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5982\u679C key \u5C5E\u6027\u5B58\u5728</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">key</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u4E3A props \u5BF9\u8C61\u6DFB\u52A0key \u5C5E\u6027</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u5E76\u6307\u5B9A\u5F53\u901A\u8FC7 props \u5BF9\u8C61\u83B7\u53D6 key \u5C5E\u6027\u65F6\u62A5\u9519</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#80A665;">defineKeyPropWarningGetter</span><span style="color:#666666;">(</span><span style="color:#BD976A;">props</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">displayName</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5982\u679C ref \u5C5E\u6027\u5B58\u5728</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">ref</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u4E3A props \u5BF9\u8C61\u6DFB\u52A0 ref \u5C5E\u6027</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u5E76\u6307\u5B9A\u5F53\u901A\u8FC7 props \u5BF9\u8C61\u83B7\u53D6 ref \u5C5E\u6027\u65F6\u62A5\u9519</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#80A665;">defineRefPropWarningGetter</span><span style="color:#666666;">(</span><span style="color:#BD976A;">props</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">displayName</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u8FD4\u56DE ReactElement</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">ReactElement</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">type</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">key</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">ref</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">self</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">source</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5728 Virtual DOM \u4E2D\u7528\u4E8E\u8BC6\u522B\u81EA\u5B9A\u4E49\u7EC4\u4EF6</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">ReactCurrentOwner</span><span style="color:#666666;">.</span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">props</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u521B\u5EFA React Element</span></span>
<span class="line"><span style="color:#A0ADA0;"> * type      \u5143\u7D20\u7C7B\u578B</span></span>
<span class="line"><span style="color:#A0ADA0;"> * config    \u914D\u7F6E\u5C5E\u6027</span></span>
<span class="line"><span style="color:#A0ADA0;"> * children  \u5B50\u5143\u7D20</span></span>
<span class="line"><span style="color:#A0ADA0;"> * 1. \u5206\u79BB props \u5C5E\u6027\u548C\u7279\u6B8A\u5C5E\u6027</span></span>
<span class="line"><span style="color:#A0ADA0;"> * 2. \u5C06\u5B50\u5143\u7D20\u6302\u8F7D\u5230 props.children \u4E2D</span></span>
<span class="line"><span style="color:#A0ADA0;"> * 3. \u4E3A props \u5C5E\u6027\u8D4B\u9ED8\u8BA4\u503C (defaultProps)</span></span>
<span class="line"><span style="color:#A0ADA0;"> * 4. \u521B\u5EFA\u5E76\u8FD4\u56DE ReactElement</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">createElement</span><span style="color:#999999;">(</span><span style="color:#B07D48;">type</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">config</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">children</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">     * propName -&gt; \u5C5E\u6027\u540D\u79F0</span></span>
<span class="line"><span style="color:#A0ADA0;">     * \u7528\u4E8E\u540E\u9762\u7684 for \u5FAA\u73AF</span></span>
<span class="line"><span style="color:#A0ADA0;">     */</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">propName</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">     * \u5B58\u50A8 React Element \u4E2D\u7684\u666E\u901A\u5143\u7D20\u5C5E\u6027 \u5373\u4E0D\u5305\u542B key ref self source</span></span>
<span class="line"><span style="color:#A0ADA0;">     */</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">props</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">{};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">     * \u5F85\u63D0\u53D6\u5C5E\u6027</span></span>
<span class="line"><span style="color:#A0ADA0;">     * React \u5185\u90E8\u4E3A\u4E86\u5B9E\u73B0\u67D0\u4E9B\u529F\u80FD\u800C\u5B58\u5728\u7684\u5C5E\u6027</span></span>
<span class="line"><span style="color:#A0ADA0;">     */</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">key</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ref</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">self</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">source</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C config \u4E0D\u4E3A null</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">config</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5982\u679C config \u5BF9\u8C61\u4E2D\u6709\u5408\u6CD5\u7684 ref \u5C5E\u6027</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#59873A;">hasValidRef</span><span style="color:#999999;">(</span><span style="color:#B07D48;">config</span><span style="color:#999999;">))</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5C06 config.ref \u5C5E\u6027\u63D0\u53D6\u5230 ref \u53D8\u91CF\u4E2D</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">ref</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">config</span><span style="color:#999999;">.</span><span style="color:#B07D48;">ref</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5728\u5F00\u53D1\u73AF\u5883\u4E2D</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">__DEV__</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u5982\u679C ref \u5C5E\u6027\u7684\u503C\u88AB\u8BBE\u7F6E\u6210\u4E86\u5B57\u7B26\u4E32\u5F62\u5F0F\u5C31\u62A5\u4E00\u4E2A\u63D0\u793A</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u8BF4\u660E\u6B64\u7528\u6CD5\u5728\u5C06\u6765\u7684\u7248\u672C\u4E2D\u4F1A\u88AB\u5220\u9664</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#59873A;">warnIfStringRefCannotBeAutoConverted</span><span style="color:#999999;">(</span><span style="color:#B07D48;">config</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5982\u679C\u5728 config \u5BF9\u8C61\u4E2D\u62E5\u6709\u5408\u6CD5\u7684 key \u5C5E\u6027</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#59873A;">hasValidKey</span><span style="color:#999999;">(</span><span style="color:#B07D48;">config</span><span style="color:#999999;">))</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5C06 config.key \u5C5E\u6027\u4E2D\u7684\u503C\u63D0\u53D6\u5230 key \u53D8\u91CF\u4E2D</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">key</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">config</span><span style="color:#999999;">.</span><span style="color:#B07D48;">key</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">self</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">config</span><span style="color:#999999;">.</span><span style="color:#B07D48;">__self</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">undefined</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">?</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">config</span><span style="color:#999999;">.</span><span style="color:#B07D48;">__self</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">source</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">config</span><span style="color:#999999;">.</span><span style="color:#B07D48;">__source</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">undefined</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">?</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">config</span><span style="color:#999999;">.</span><span style="color:#B07D48;">__source</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u904D\u5386 config \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">for</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">propName</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">in</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">config</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5982\u679C\u5F53\u524D\u904D\u5386\u5230\u7684\u5C5E\u6027\u662F\u5BF9\u8C61\u81EA\u8EAB\u5C5E\u6027</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5E76\u4E14\u5728 RESERVED_PROPS \u5BF9\u8C61\u4E2D\u4E0D\u5B58\u5728\u8BE5\u5C5E\u6027</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">hasOwnProperty</span><span style="color:#999999;">.</span><span style="color:#59873A;">call</span><span style="color:#999999;">(</span><span style="color:#B07D48;">config</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">propName</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#AB5959;">!</span><span style="color:#B07D48;">RESERVED_PROPS</span><span style="color:#999999;">.</span><span style="color:#59873A;">hasOwnProperty</span><span style="color:#999999;">(</span><span style="color:#B07D48;">propName</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u5C06\u6EE1\u8DB3\u6761\u4EF6\u7684\u5C5E\u6027\u6DFB\u52A0\u5230 props \u5BF9\u8C61\u4E2D (\u666E\u901A\u5C5E\u6027)</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">props</span><span style="color:#999999;">[</span><span style="color:#B07D48;">propName</span><span style="color:#999999;">]</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">config</span><span style="color:#999999;">[</span><span style="color:#B07D48;">propName</span><span style="color:#999999;">];</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">     * \u5C06\u7B2C\u4E09\u4E2A\u53CA\u4E4B\u540E\u7684\u53C2\u6570\u6302\u8F7D\u5230 props.children \u5C5E\u6027\u4E2D</span></span>
<span class="line"><span style="color:#A0ADA0;">     * \u5982\u679C\u5B50\u5143\u7D20\u662F\u591A\u4E2A props.children \u662F\u6570\u7EC4</span></span>
<span class="line"><span style="color:#A0ADA0;">     * \u5982\u679C\u5B50\u5143\u7D20\u662F\u4E00\u4E2A props.children \u662F\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#A0ADA0;">     */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u7531\u4E8E\u4ECE\u7B2C\u4E09\u4E2A\u53C2\u6570\u5F00\u59CB\u53CA\u4EE5\u540E\u90FD\u8868\u793A\u5B50\u5143\u7D20</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u6240\u4EE5\u51CF\u53BB\u524D\u4E24\u4E2A\u53C2\u6570\u7684\u7ED3\u679C\u5C31\u662F\u5B50\u5143\u7D20\u7684\u6570\u91CF</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">childrenLength</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#A65E2B;">arguments</span><span style="color:#999999;">.</span><span style="color:#998418;">length</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">-</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">2</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C\u5B50\u5143\u7D20\u7684\u6570\u91CF\u662F 1</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">childrenLength</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">1</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u76F4\u63A5\u5C06\u5B50\u5143\u7D20\u6302\u8F7D\u5230\u5230 props.children \u5C5E\u6027\u4E0A</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u6B64\u65F6 children \u662F\u5BF9\u8C61\u7C7B\u578B</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">props</span><span style="color:#999999;">.</span><span style="color:#B07D48;">children</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">children</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5982\u679C\u5B50\u5143\u7D20\u7684\u6570\u91CF\u5927\u4E8E 1</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">childrenLength</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">1</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u521B\u5EFA\u6570\u7EC4, \u6570\u7EC4\u4E2D\u5143\u7D20\u7684\u6570\u91CF\u7B49\u4E8E\u5B50\u5143\u7D20\u7684\u6570\u91CF</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">childArray</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">Array</span><span style="color:#999999;">(</span><span style="color:#B07D48;">childrenLength</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5F00\u542F\u5FAA\u73AF \u5FAA\u73AF\u6B21\u5339\u914D\u5B50\u5143\u7D20\u7684\u6570\u91CF</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">for</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">i</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">i</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">childrenLength</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">i</span><span style="color:#AB5959;">++</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5C06\u5B50\u5143\u7D20\u6DFB\u52A0\u5230 childArray \u6570\u7EC4\u4E2D</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// i + 2 \u7684\u539F\u56E0\u662F\u5B9E\u53C2\u96C6\u5408\u7684\u524D\u4E24\u4E2A\u53C2\u6570\u4E0D\u662F\u5B50\u5143\u7D20</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">childArray</span><span style="color:#999999;">[</span><span style="color:#B07D48;">i</span><span style="color:#999999;">]</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#A65E2B;">arguments</span><span style="color:#999999;">[</span><span style="color:#B07D48;">i</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">2</span><span style="color:#999999;">];</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5982\u679C\u662F\u5F00\u53D1\u73AF\u5883</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">__DEV__</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5982\u679C Object \u5BF9\u8C61\u4E2D\u5B58\u5728 freeze \u65B9\u6CD5</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">Object</span><span style="color:#999999;">.</span><span style="color:#B07D48;">freeze</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u8C03\u7528 freeze \u65B9\u6CD5 \u51BB\u7ED3 childArray \u6570\u7EC4</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u9632\u6B62 React \u6838\u5FC3\u5BF9\u8C61\u88AB\u4FEE\u6539 \u51BB\u7ED3\u5BF9\u8C61\u63D0\u9AD8\u6027\u80FD</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">Object</span><span style="color:#999999;">.</span><span style="color:#59873A;">freeze</span><span style="color:#999999;">(</span><span style="color:#B07D48;">childArray</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5C06\u5B50\u5143\u7D20\u6570\u7EC4\u6302\u8F7D\u5230 props.children \u5C5E\u6027\u4E2D</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">props</span><span style="color:#999999;">.</span><span style="color:#B07D48;">children</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">childArray</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">     * \u5982\u679C\u5F53\u524D\u5904\u7406\u662F\u7EC4\u4EF6</span></span>
<span class="line"><span style="color:#A0ADA0;">     * \u770B\u7EC4\u4EF6\u8EAB\u4E0A\u662F\u5426\u6709 defaultProps \u5C5E\u6027</span></span>
<span class="line"><span style="color:#A0ADA0;">     * \u8FD9\u4E2A\u5C5E\u6027\u4E2D\u5B58\u50A8\u7684\u662F props \u5BF9\u8C61\u4E2D\u5C5E\u6027\u7684\u9ED8\u8BA4\u503C</span></span>
<span class="line"><span style="color:#A0ADA0;">     * \u904D\u5386 defaultProps \u5BF9\u8C61 \u67E5\u770B\u5BF9\u5E94\u7684 props \u5C5E\u6027\u7684\u503C\u662F\u5426\u4E3A undefined</span></span>
<span class="line"><span style="color:#A0ADA0;">     * \u5982\u679C\u4E3Aundefined \u5C31\u5C06\u9ED8\u8BA4\u503C\u8D4B\u503C\u7ED9\u5BF9\u5E94\u7684 props \u5C5E\u6027\u503C</span></span>
<span class="line"><span style="color:#A0ADA0;">     */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5C06 type \u5C5E\u6027\u503C\u89C6\u4E3A\u51FD\u6570 \u67E5\u770B\u5176\u4E2D\u662F\u5426\u5177\u6709 defaultProps \u5C5E\u6027</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">type</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">type</span><span style="color:#999999;">.</span><span style="color:#B07D48;">defaultProps</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5C06 type \u51FD\u6570\u4E0B\u7684 defaultProps \u5C5E\u6027\u8D4B\u503C\u7ED9 defaultProps \u53D8\u91CF</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">defaultProps</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">type</span><span style="color:#999999;">.</span><span style="color:#B07D48;">defaultProps</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u904D\u5386 defaultProps \u5BF9\u8C61\u4E2D\u7684\u5C5E\u6027 \u5C06\u5C5E\u6027\u540D\u79F0\u8D4B\u503C\u7ED9 propName \u53D8\u91CF</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">for</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">propName</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">in</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">defaultProps</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5982\u679C props \u5BF9\u8C61\u4E2D\u7684\u8BE5\u5C5E\u6027\u7684\u503C\u4E3A undefined</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">props</span><span style="color:#999999;">[</span><span style="color:#B07D48;">propName</span><span style="color:#999999;">]</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">undefined</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u5C06 defaultProps \u5BF9\u8C61\u4E2D\u7684\u5BF9\u5E94\u5C5E\u6027\u7684\u503C\u8D4B\u503C\u7ED9 props \u5BF9\u8C61\u4E2D\u7684\u5BF9\u5E94\u5C5E\u6027\u7684\u503C</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">props</span><span style="color:#999999;">[</span><span style="color:#B07D48;">propName</span><span style="color:#999999;">]</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">defaultProps</span><span style="color:#999999;">[</span><span style="color:#B07D48;">propName</span><span style="color:#999999;">];</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">     * \u5728\u5F00\u53D1\u73AF\u5883\u4E2D \u5982\u679C\u5143\u7D20\u7684 key \u5C5E\u6027 \u6216\u8005 ref \u5C5E\u6027\u5B58\u5728</span></span>
<span class="line"><span style="color:#A0ADA0;">     * \u76D1\u6D4B\u5F00\u53D1\u8005\u662F\u5426\u5728\u7EC4\u4EF6\u5185\u90E8\u901A\u8FC7 props \u5BF9\u8C61\u83B7\u53D6\u4E86 key \u5C5E\u6027\u6216\u8005 ref \u5C5E\u6027</span></span>
<span class="line"><span style="color:#A0ADA0;">     * \u5982\u679C\u83B7\u53D6\u4E86 \u5C31\u62A5\u9519</span></span>
<span class="line"><span style="color:#A0ADA0;">     */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C\u5904\u4E8E\u5F00\u53D1\u73AF\u5883</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">__DEV__</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5143\u7D20\u5177\u6709 key \u5C5E\u6027\u6216\u8005 ref \u5C5E\u6027</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">key</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">||</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ref</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u770B\u4E00\u4E0B type \u5C5E\u6027\u4E2D\u5B58\u50A8\u7684\u662F\u5426\u662F\u51FD\u6570 \u5982\u679C\u662F\u51FD\u6570\u5C31\u8868\u793A\u5F53\u524D\u5143\u7D20\u662F\u7EC4\u4EF6</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5982\u679C\u5143\u7D20\u4E0D\u662F\u7EC4\u4EF6 \u5C31\u76F4\u63A5\u8FD4\u56DE\u5143\u7D20\u7C7B\u578B\u5B57\u7B26\u4E32</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// displayName \u7528\u4E8E\u5728\u62A5\u9519\u8FC7\u7A0B\u4E2D\u663E\u793A\u662F\u54EA\u4E00\u4E2A\u7EC4\u4EF6\u62A5\u9519\u4E86</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5982\u679C\u5F00\u53D1\u8005\u663E\u5F0F\u5B9A\u4E49\u4E86 displayName \u5C5E\u6027 \u5C31\u663E\u793A\u5F00\u53D1\u8005\u5B9A\u4E49\u7684</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5426\u8005\u5C31\u663E\u793A\u7EC4\u4EF6\u540D\u79F0 \u5982\u679C\u7EC4\u4EF6\u4E5F\u6CA1\u6709\u540D\u79F0 \u5C31\u663E\u793A &#39;Unknown&#39;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">displayName</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#AB5959;">typeof</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">type</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">function</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#AB5959;">?</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">type</span><span style="color:#999999;">.</span><span style="color:#B07D48;">displayName</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">||</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">type</span><span style="color:#999999;">.</span><span style="color:#B07D48;">name</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">||</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Unknown</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#AB5959;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">type</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5982\u679C key \u5C5E\u6027\u5B58\u5728</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">key</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u4E3A props \u5BF9\u8C61\u6DFB\u52A0key \u5C5E\u6027</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u5E76\u6307\u5B9A\u5F53\u901A\u8FC7 props \u5BF9\u8C61\u83B7\u53D6 key \u5C5E\u6027\u65F6\u62A5\u9519</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#59873A;">defineKeyPropWarningGetter</span><span style="color:#999999;">(</span><span style="color:#B07D48;">props</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">displayName</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5982\u679C ref \u5C5E\u6027\u5B58\u5728</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">ref</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u4E3A props \u5BF9\u8C61\u6DFB\u52A0 ref \u5C5E\u6027</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u5E76\u6307\u5B9A\u5F53\u901A\u8FC7 props \u5BF9\u8C61\u83B7\u53D6 ref \u5C5E\u6027\u65F6\u62A5\u9519</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#59873A;">defineRefPropWarningGetter</span><span style="color:#999999;">(</span><span style="color:#B07D48;">props</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">displayName</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u8FD4\u56DE ReactElement</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#59873A;">ReactElement</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">type</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">key</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">ref</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">self</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">source</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5728 Virtual DOM \u4E2D\u7528\u4E8E\u8BC6\u522B\u81EA\u5B9A\u4E49\u7EC4\u4EF6</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">ReactCurrentOwner</span><span style="color:#999999;">.</span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">props</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-2-reactelement" tabindex="-1">2.2 ReactElement <a class="header-anchor" href="#_2-2-reactelement" aria-hidden="true">#</a></h3><p><code>\u6587\u4EF6\u4F4D\u7F6E\uFF1Apackages/react/src/ReactElement.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * \u63A5\u6536\u53C2\u6570 \u8FD4\u56DE ReactElement</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">ReactElement</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">type</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">key</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ref</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">self</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">source</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">owner</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">props</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">element</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">         * \u7EC4\u4EF6\u7684\u7C7B\u578B, \u5341\u516D\u8FDB\u5236\u6570\u503C\u6216\u8005 Symbol \u503C</span></span>
<span class="line"><span style="color:#758575DD;">         * React \u5728\u6700\u7EC8\u5728\u6E32\u67D3 DOM \u7684\u65F6\u5019, \u9700\u8981\u786E\u4FDD\u5143\u7D20\u7684\u7C7B\u578B\u662F REACT_ELEMENT_TYPE</span></span>
<span class="line"><span style="color:#758575DD;">         * \u9700\u8981\u6B64\u5C5E\u6027\u4F5C\u4E3A\u5224\u65AD\u7684\u4F9D\u636E</span></span>
<span class="line"><span style="color:#758575DD;">         */</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">$$typeof</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">REACT_ELEMENT_TYPE</span><span style="color:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">         * \u5143\u7D20\u5177\u4F53\u7684\u7C7B\u578B\u503C \u5982\u679C\u662F\u5143\u7D20\u8282\u70B9 type \u5C5E\u6027\u4E2D\u5B58\u50A8\u7684\u5C31\u662F div span \u7B49\u7B49</span></span>
<span class="line"><span style="color:#758575DD;">         * \u5982\u679C\u5143\u7D20\u662F\u7EC4\u4EF6 type \u5C5E\u6027\u4E2D\u5B58\u50A8\u7684\u5C31\u662F\u7EC4\u4EF6\u7684\u6784\u9020\u51FD\u6570</span></span>
<span class="line"><span style="color:#758575DD;">         */</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">type</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">type</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">         * \u5143\u7D20\u7684\u552F\u4E00\u6807\u8BC6</span></span>
<span class="line"><span style="color:#758575DD;">         * \u7528\u4F5C\u5185\u90E8 vdom \u6BD4\u5BF9 \u63D0\u5347 DOM \u64CD\u4F5C\u6027\u80FD</span></span>
<span class="line"><span style="color:#758575DD;">         */</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">key</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">key</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">         * \u5B58\u50A8\u5143\u7D20 DOM \u5BF9\u8C61\u6216\u8005\u7EC4\u4EF6 \u5B9E\u4F8B\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#758575DD;">         */</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">ref</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ref</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">         * \u5B58\u50A8\u5411\u7EC4\u4EF6\u5185\u90E8\u4F20\u9012\u7684\u6570\u636E</span></span>
<span class="line"><span style="color:#758575DD;">         */</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">props</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">props</span><span style="color:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">         * \u8BB0\u5F55\u5F53\u524D\u5143\u7D20\u6240\u5C5E\u7EC4\u4EF6 (\u8BB0\u5F55\u5F53\u524D\u5143\u7D20\u662F\u54EA\u4E2A\u7EC4\u4EF6\u521B\u5EFA\u7684)</span></span>
<span class="line"><span style="color:#758575DD;">         */</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">_owner</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">owner</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">};</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u8FD4\u56DE ReactElement</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">element</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">};</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u63A5\u6536\u53C2\u6570 \u8FD4\u56DE ReactElement</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#59873A;">ReactElement</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">type</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">key</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ref</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">self</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">source</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">owner</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">props</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">element</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">         * \u7EC4\u4EF6\u7684\u7C7B\u578B, \u5341\u516D\u8FDB\u5236\u6570\u503C\u6216\u8005 Symbol \u503C</span></span>
<span class="line"><span style="color:#A0ADA0;">         * React \u5728\u6700\u7EC8\u5728\u6E32\u67D3 DOM \u7684\u65F6\u5019, \u9700\u8981\u786E\u4FDD\u5143\u7D20\u7684\u7C7B\u578B\u662F REACT_ELEMENT_TYPE</span></span>
<span class="line"><span style="color:#A0ADA0;">         * \u9700\u8981\u6B64\u5C5E\u6027\u4F5C\u4E3A\u5224\u65AD\u7684\u4F9D\u636E</span></span>
<span class="line"><span style="color:#A0ADA0;">         */</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">$$typeof</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">REACT_ELEMENT_TYPE</span><span style="color:#999999;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">         * \u5143\u7D20\u5177\u4F53\u7684\u7C7B\u578B\u503C \u5982\u679C\u662F\u5143\u7D20\u8282\u70B9 type \u5C5E\u6027\u4E2D\u5B58\u50A8\u7684\u5C31\u662F div span \u7B49\u7B49</span></span>
<span class="line"><span style="color:#A0ADA0;">         * \u5982\u679C\u5143\u7D20\u662F\u7EC4\u4EF6 type \u5C5E\u6027\u4E2D\u5B58\u50A8\u7684\u5C31\u662F\u7EC4\u4EF6\u7684\u6784\u9020\u51FD\u6570</span></span>
<span class="line"><span style="color:#A0ADA0;">         */</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">type</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">type</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">         * \u5143\u7D20\u7684\u552F\u4E00\u6807\u8BC6</span></span>
<span class="line"><span style="color:#A0ADA0;">         * \u7528\u4F5C\u5185\u90E8 vdom \u6BD4\u5BF9 \u63D0\u5347 DOM \u64CD\u4F5C\u6027\u80FD</span></span>
<span class="line"><span style="color:#A0ADA0;">         */</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">key</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">key</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">         * \u5B58\u50A8\u5143\u7D20 DOM \u5BF9\u8C61\u6216\u8005\u7EC4\u4EF6 \u5B9E\u4F8B\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#A0ADA0;">         */</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">ref</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ref</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">         * \u5B58\u50A8\u5411\u7EC4\u4EF6\u5185\u90E8\u4F20\u9012\u7684\u6570\u636E</span></span>
<span class="line"><span style="color:#A0ADA0;">         */</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">props</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">props</span><span style="color:#999999;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">         * \u8BB0\u5F55\u5F53\u524D\u5143\u7D20\u6240\u5C5E\u7EC4\u4EF6 (\u8BB0\u5F55\u5F53\u524D\u5143\u7D20\u662F\u54EA\u4E2A\u7EC4\u4EF6\u521B\u5EFA\u7684)</span></span>
<span class="line"><span style="color:#A0ADA0;">         */</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">_owner</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">owner</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">};</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u8FD4\u56DE ReactElement</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">element</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">};</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-3-hasvalidref" tabindex="-1">2.3 hasValidRef <a class="header-anchor" href="#_2-3-hasvalidref" aria-hidden="true">#</a></h3><p><code>\u6587\u4EF6\u4F4D\u7F6E\uFF1Apackages/react/src/ReactElement.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * \u67E5\u770B\u53C2\u6570\u5BF9\u8C61\u4E2D\u662F\u5426\u6709\u5408\u6CD5\u7684 ref \u5C5E\u6027</span></span>
<span class="line"><span style="color:#758575DD;"> * \u8FD4\u56DE\u5E03\u5C14\u503C</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">hasValidRef</span><span style="color:#666666;">(</span><span style="color:#BD976A;">config</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">config</span><span style="color:#666666;">.</span><span style="color:#BD976A;">ref</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">undefined</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u67E5\u770B\u53C2\u6570\u5BF9\u8C61\u4E2D\u662F\u5426\u6709\u5408\u6CD5\u7684 ref \u5C5E\u6027</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u8FD4\u56DE\u5E03\u5C14\u503C</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">hasValidRef</span><span style="color:#999999;">(</span><span style="color:#B07D48;">config</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">config</span><span style="color:#999999;">.</span><span style="color:#B07D48;">ref</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">undefined</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-4-hasvalidkey" tabindex="-1">2.4 hasValidKey <a class="header-anchor" href="#_2-4-hasvalidkey" aria-hidden="true">#</a></h3><p><code>\u6587\u4EF6\u4F4D\u7F6E\uFF1Apackages/react/src/ReactElement.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * \u67E5\u770B\u53C2\u6570\u5BF9\u8C61\u4E2D\u662F\u5426\u6709\u5408\u6CD5\u7684 key \u5C5E\u6027</span></span>
<span class="line"><span style="color:#758575DD;"> * \u8FD4\u56DE\u5E03\u5C14\u503C</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">hasValidKey</span><span style="color:#666666;">(</span><span style="color:#BD976A;">config</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">config</span><span style="color:#666666;">.</span><span style="color:#BD976A;">key</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">undefined</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u67E5\u770B\u53C2\u6570\u5BF9\u8C61\u4E2D\u662F\u5426\u6709\u5408\u6CD5\u7684 key \u5C5E\u6027</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u8FD4\u56DE\u5E03\u5C14\u503C</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">hasValidKey</span><span style="color:#999999;">(</span><span style="color:#B07D48;">config</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">config</span><span style="color:#999999;">.</span><span style="color:#B07D48;">key</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">undefined</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-5-isvalidelement" tabindex="-1">2.5 isValidElement <a class="header-anchor" href="#_2-5-isvalidelement" aria-hidden="true">#</a></h3><p><code>\u6587\u4EF6\u4F4D\u7F6E\uFF1Apackages/react/src/ReactElement.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * \u9A8C\u8BC1 object \u53C2\u6570\u662F\u5426\u662F ReactElement. \u8FD4\u56DE\u5E03\u5C14\u503C</span></span>
<span class="line"><span style="color:#758575DD;"> * \u9A8C\u8BC1\u6210\u529F\u7684\u6761\u4EF6:</span></span>
<span class="line"><span style="color:#758575DD;"> * object \u662F\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#758575DD;"> * object \u4E0D\u4E3Anull</span></span>
<span class="line"><span style="color:#758575DD;"> * object\u5BF9\u8C61\u4E2D\u7684 $$typeof \u5C5E\u6027\u503C\u4E3A REACT_ELEMENT_TYPE</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">isValidElement</span><span style="color:#666666;">(</span><span style="color:#BD976A;">object</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">typeof</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">object</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">object</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">object</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">object</span><span style="color:#666666;">.</span><span style="color:#BD976A;">$$typeof</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">REACT_ELEMENT_TYPE</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u9A8C\u8BC1 object \u53C2\u6570\u662F\u5426\u662F ReactElement. \u8FD4\u56DE\u5E03\u5C14\u503C</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u9A8C\u8BC1\u6210\u529F\u7684\u6761\u4EF6:</span></span>
<span class="line"><span style="color:#A0ADA0;"> * object \u662F\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#A0ADA0;"> * object \u4E0D\u4E3Anull</span></span>
<span class="line"><span style="color:#A0ADA0;"> * object\u5BF9\u8C61\u4E2D\u7684 $$typeof \u5C5E\u6027\u503C\u4E3A REACT_ELEMENT_TYPE</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">isValidElement</span><span style="color:#999999;">(</span><span style="color:#B07D48;">object</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">typeof</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">object</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">object</span><span style="color:#B56959AA;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">object</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">object</span><span style="color:#999999;">.</span><span style="color:#B07D48;">$$typeof</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">REACT_ELEMENT_TYPE</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-6-definekeypropwarninggetter" tabindex="-1">2.6 defineKeyPropWarningGetter <a class="header-anchor" href="#_2-6-definekeypropwarninggetter" aria-hidden="true">#</a></h3><p><code>\u6587\u4EF6\u4F4D\u7F6E\uFF1Apackages/react/src/ReactElement.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki has-diff vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> *  \u6307\u5B9A\u5F53\u901A\u8FC7 props \u5BF9\u8C61\u83B7\u53D6 key \u5C5E\u6027\u65F6\u62A5\u9519</span></span>
<span class="line"><span style="color:#758575DD;"> *  props        \u7EC4\u4EF6\u4E2D\u7684 props \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#758575DD;"> *  displayName  \u7EC4\u4EF6\u540D\u79F0\u6807\u8BC6</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">defineKeyPropWarningGetter</span><span style="color:#666666;">(</span><span style="color:#BD976A;">props</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">displayName</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u901A\u8FC7 props \u5BF9\u8C61\u83B7\u53D6 key \u5C5E\u6027\u62A5\u9519</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">warnAboutAccessingKey</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5728\u5F00\u53D1\u73AF\u5883\u4E2D</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">__DEV__</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// specialPropKeyWarningShown \u63A7\u5236\u9519\u8BEF\u53EA\u8F93\u51FA\u4E00\u6B21\u7684\u53D8\u91CF</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#CB7676;">!</span><span style="color:#BD976A;">specialPropKeyWarningShown</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u901A\u8FC7 specialPropKeyWarningShown \u53D8\u91CF\u9501\u4F4F\u5224\u65AD\u6761\u4EF6</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">specialPropKeyWarningShown</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u6307\u5B9A\u62A5\u9519\u4FE1\u606F\u548C\u7EC4\u4EF6\u540D\u79F0</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">error</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">%s: \`key\` is not a prop. Trying to access it will result </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">+</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                        </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">in \`undefined\` being returned. If you need to access the same </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">+</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                        </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">value within the child component, you should pass it as a different </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">+</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                        </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">prop. (https://reactjs.org/link/special-props)</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">displayName</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">};</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">warnAboutAccessingKey</span><span style="color:#666666;">.</span><span style="color:#BD976A;">isReactWarning</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u4E3A props \u5BF9\u8C61\u6DFB\u52A0 key \u5C5E\u6027</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">Object</span><span style="color:#666666;">.</span><span style="color:#80A665;">defineProperty</span><span style="color:#666666;">(</span><span style="color:#BD976A;">props</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">key</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5F53\u83B7\u53D6 key \u5C5E\u6027\u65F6\u8C03\u7528 warnAboutAccessingKey \u65B9\u6CD5\u8FDB\u884C\u62A5\u9519</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">get</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">warnAboutAccessingKey</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">configurable</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">});</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki has-diff vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> *  \u6307\u5B9A\u5F53\u901A\u8FC7 props \u5BF9\u8C61\u83B7\u53D6 key \u5C5E\u6027\u65F6\u62A5\u9519</span></span>
<span class="line"><span style="color:#A0ADA0;"> *  props        \u7EC4\u4EF6\u4E2D\u7684 props \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#A0ADA0;"> *  displayName  \u7EC4\u4EF6\u540D\u79F0\u6807\u8BC6</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">defineKeyPropWarningGetter</span><span style="color:#999999;">(</span><span style="color:#B07D48;">props</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">displayName</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u901A\u8FC7 props \u5BF9\u8C61\u83B7\u53D6 key \u5C5E\u6027\u62A5\u9519</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#59873A;">warnAboutAccessingKey</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5728\u5F00\u53D1\u73AF\u5883\u4E2D</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">__DEV__</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// specialPropKeyWarningShown \u63A7\u5236\u9519\u8BEF\u53EA\u8F93\u51FA\u4E00\u6B21\u7684\u53D8\u91CF</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#AB5959;">!</span><span style="color:#B07D48;">specialPropKeyWarningShown</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u901A\u8FC7 specialPropKeyWarningShown \u53D8\u91CF\u9501\u4F4F\u5224\u65AD\u6761\u4EF6</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">specialPropKeyWarningShown</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u6307\u5B9A\u62A5\u9519\u4FE1\u606F\u548C\u7EC4\u4EF6\u540D\u79F0</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">error</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">%s: \`key\` is not a prop. Trying to access it will result </span><span style="color:#B56959AA;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+</span></span>
<span class="line"><span style="color:#393A34;">                        </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">in \`undefined\` being returned. If you need to access the same </span><span style="color:#B56959AA;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+</span></span>
<span class="line"><span style="color:#393A34;">                        </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">value within the child component, you should pass it as a different </span><span style="color:#B56959AA;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+</span></span>
<span class="line"><span style="color:#393A34;">                        </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">prop. (https://reactjs.org/link/special-props)</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">displayName</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">};</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">warnAboutAccessingKey</span><span style="color:#999999;">.</span><span style="color:#B07D48;">isReactWarning</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u4E3A props \u5BF9\u8C61\u6DFB\u52A0 key \u5C5E\u6027</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">Object</span><span style="color:#999999;">.</span><span style="color:#59873A;">defineProperty</span><span style="color:#999999;">(</span><span style="color:#B07D48;">props</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">key</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5F53\u83B7\u53D6 key \u5C5E\u6027\u65F6\u8C03\u7528 warnAboutAccessingKey \u65B9\u6CD5\u8FDB\u884C\u62A5\u9519</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">get</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">warnAboutAccessingKey</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">configurable</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">});</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-7-definerefpropwarninggetter" tabindex="-1">2.7 defineRefPropWarningGetter <a class="header-anchor" href="#_2-7-definerefpropwarninggetter" aria-hidden="true">#</a></h3><p><code>\u6587\u4EF6\u4F4D\u7F6E\uFF1Apackages/react/src/ReactElement.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki has-diff vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> *  \u6307\u5B9A\u5F53\u901A\u8FC7 props \u5BF9\u8C61\u83B7\u53D6 ref \u5C5E\u6027\u65F6\u62A5\u9519</span></span>
<span class="line"><span style="color:#758575DD;"> *  props        \u7EC4\u4EF6\u4E2D\u7684 props \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#758575DD;"> *  displayName  \u7EC4\u4EF6\u540D\u79F0\u6807\u8BC6</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">defineRefPropWarningGetter</span><span style="color:#666666;">(</span><span style="color:#BD976A;">props</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">displayName</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u901A\u8FC7 props \u5BF9\u8C61\u83B7\u53D6 ref \u5C5E\u6027\u62A5\u9519</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">warnAboutAccessingRef</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">__DEV__</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// specialPropRefWarningShown \u63A7\u5236\u9519\u8BEF\u53EA\u8F93\u51FA\u4E00\u6B21\u7684\u53D8\u91CF</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#CB7676;">!</span><span style="color:#BD976A;">specialPropRefWarningShown</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u901A\u8FC7 specialPropRefWarningShown \u53D8\u91CF\u9501\u4F4F\u5224\u65AD\u6761\u4EF6</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">specialPropRefWarningShown</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u6307\u5B9A\u62A5\u9519\u4FE1\u606F\u548C\u7EC4\u4EF6\u540D\u79F0</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">error</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">%s: \`ref\` is not a prop. Trying to access it will result </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">+</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                        </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">in \`undefined\` being returned. If you need to access the same </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">+</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                        </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">value within the child component, you should pass it as a different </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">+</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                        </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">prop. (https://reactjs.org/link/special-props)</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">displayName</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">warnAboutAccessingRef</span><span style="color:#666666;">.</span><span style="color:#BD976A;">isReactWarning</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u4E3A props \u5BF9\u8C61\u6DFB\u52A0 key \u5C5E\u6027</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">Object</span><span style="color:#666666;">.</span><span style="color:#80A665;">defineProperty</span><span style="color:#666666;">(</span><span style="color:#BD976A;">props</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">ref</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">get</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">warnAboutAccessingRef</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">configurable</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">});</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki has-diff vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> *  \u6307\u5B9A\u5F53\u901A\u8FC7 props \u5BF9\u8C61\u83B7\u53D6 ref \u5C5E\u6027\u65F6\u62A5\u9519</span></span>
<span class="line"><span style="color:#A0ADA0;"> *  props        \u7EC4\u4EF6\u4E2D\u7684 props \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#A0ADA0;"> *  displayName  \u7EC4\u4EF6\u540D\u79F0\u6807\u8BC6</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">defineRefPropWarningGetter</span><span style="color:#999999;">(</span><span style="color:#B07D48;">props</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">displayName</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u901A\u8FC7 props \u5BF9\u8C61\u83B7\u53D6 ref \u5C5E\u6027\u62A5\u9519</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#59873A;">warnAboutAccessingRef</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">__DEV__</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// specialPropRefWarningShown \u63A7\u5236\u9519\u8BEF\u53EA\u8F93\u51FA\u4E00\u6B21\u7684\u53D8\u91CF</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#AB5959;">!</span><span style="color:#B07D48;">specialPropRefWarningShown</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u901A\u8FC7 specialPropRefWarningShown \u53D8\u91CF\u9501\u4F4F\u5224\u65AD\u6761\u4EF6</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">specialPropRefWarningShown</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u6307\u5B9A\u62A5\u9519\u4FE1\u606F\u548C\u7EC4\u4EF6\u540D\u79F0</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">error</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">%s: \`ref\` is not a prop. Trying to access it will result </span><span style="color:#B56959AA;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+</span></span>
<span class="line"><span style="color:#393A34;">                        </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">in \`undefined\` being returned. If you need to access the same </span><span style="color:#B56959AA;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+</span></span>
<span class="line"><span style="color:#393A34;">                        </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">value within the child component, you should pass it as a different </span><span style="color:#B56959AA;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+</span></span>
<span class="line"><span style="color:#393A34;">                        </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">prop. (https://reactjs.org/link/special-props)</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">displayName</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">warnAboutAccessingRef</span><span style="color:#999999;">.</span><span style="color:#B07D48;">isReactWarning</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u4E3A props \u5BF9\u8C61\u6DFB\u52A0 key \u5C5E\u6027</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">Object</span><span style="color:#999999;">.</span><span style="color:#59873A;">defineProperty</span><span style="color:#999999;">(</span><span style="color:#B07D48;">props</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">ref</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">get</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">warnAboutAccessingRef</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">configurable</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">});</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="_3-react-\u67B6\u6784" tabindex="-1">3. React \u67B6\u6784 <a class="header-anchor" href="#_3-react-\u67B6\u6784" aria-hidden="true">#</a></h2><p>React 16 \u7248\u672C\u7684\u67B6\u6784\u53EF\u4EE5\u5206\u4E3A\u4E09\u5C42\uFF1A\u8C03\u5EA6\u5C42\u3001\u534F\u8C03\u5C42\u3001\u6E32\u67D3\u5C42\u3002</p><ul><li>Scheduler (\u8C03\u5EA6\u5C42)\uFF1A\u8C03\u5EA6\u4EFB\u52A1\u7684\u4F18\u5148\u7EA7\uFF0C\u9AD8\u4F18\u4EFB\u52A1\u4F18\u5148\u8FDB\u5165\u534F\u8C03\u5668</li><li>Reconciler (\u534F\u8C03\u5C42)\uFF1A\u6784\u5EFA Fiber \u6570\u636E\u7ED3\u6784\uFF0C\u6BD4\u5BF9 Fiber \u5BF9\u8C61\u627E\u51FA\u5DEE\u5F02, \u8BB0\u5F55 Fiber \u5BF9\u8C61\u8981\u8FDB\u884C\u7684 DOM \u64CD\u4F5C</li><li>Renderer (\u6E32\u67D3\u5C42)\uFF1A\u8D1F\u8D23\u5C06\u53D1\u751F\u53D8\u5316\u7684\u90E8\u5206\u6E32\u67D3\u5230\u9875\u9762\u4E0A</li></ul><h3 id="_3-1-scheduler-\u8C03\u5EA6\u5C42" tabindex="-1">3.1 Scheduler \u8C03\u5EA6\u5C42 <a class="header-anchor" href="#_3-1-scheduler-\u8C03\u5EA6\u5C42" aria-hidden="true">#</a></h3><p>\u5728 React 15 \u7684\u7248\u672C\u4E2D\uFF0C\u91C7\u7528\u4E86\u5FAA\u73AF\u52A0\u9012\u5F52\u7684\u65B9\u5F0F\u8FDB\u884C\u4E86 virtualDOM \u7684\u6BD4\u5BF9\uFF0C\u7531\u4E8E\u9012\u5F52\u4F7F\u7528 JavaScript \u81EA\u8EAB\u7684\u6267\u884C\u6808\uFF0C\u4E00\u65E6\u5F00\u59CB\u5C31\u65E0\u6CD5\u505C\u6B62\uFF0C\u76F4\u5230\u4EFB\u52A1\u6267\u884C\u5B8C\u6210\u3002\u5982\u679C VirtualDOM \u6811\u7684\u5C42\u7EA7\u6BD4\u8F83\u6DF1\uFF0CvirtualDOM \u7684\u6BD4\u5BF9\u5C31\u4F1A\u957F\u671F\u5360\u7528 JavaScript \u4E3B\u7EBF\u7A0B\uFF0C\u7531\u4E8E JavaScript \u53C8\u662F\u5355\u7EBF\u7A0B\u7684\u65E0\u6CD5\u540C\u65F6\u6267\u884C\u5176\u4ED6\u4EFB\u52A1\uFF0C\u6240\u4EE5\u5728\u6BD4\u5BF9\u7684\u8FC7\u7A0B\u4E2D\u65E0\u6CD5\u54CD\u5E94\u7528\u6237\u64CD\u4F5C\uFF0C\u65E0\u6CD5\u5373\u65F6\u6267\u884C\u5143\u7D20\u52A8\u753B\uFF0C\u9020\u6210\u4E86\u9875\u9762\u5361\u987F\u7684\u73B0\u8C61\u3002</p><p>\u5728 React 16 \u7684\u7248\u672C\u4E2D\uFF0C\u653E\u5F03\u4E86 JavaScript \u9012\u5F52\u7684\u65B9\u5F0F\u8FDB\u884C virtualDOM \u7684\u6BD4\u5BF9\uFF0C\u800C\u662F\u91C7\u7528\u5FAA\u73AF\u6A21\u62DF\u9012\u5F52\u3002\u800C\u4E14\u6BD4\u5BF9\u7684\u8FC7\u7A0B\u662F\u5229\u7528\u6D4F\u89C8\u5668\u7684\u7A7A\u95F2\u65F6\u95F4\u5B8C\u6210\u7684\uFF0C\u4E0D\u4F1A\u957F\u671F\u5360\u7528\u4E3B\u7EBF\u7A0B\uFF0C\u8FD9\u5C31\u89E3\u51B3\u4E86 virtualDOM \u6BD4\u5BF9\u9020\u6210\u9875\u9762\u5361\u987F\u7684\u95EE\u9898\u3002</p><p>\u5728 window \u5BF9\u8C61\u4E2D\u63D0\u4F9B\u4E86 requestIdleCallback API\uFF0C\u5B83\u53EF\u4EE5\u5229\u7528\u6D4F\u89C8\u5668\u7684\u7A7A\u95F2\u65F6\u95F4\u6267\u884C\u4EFB\u52A1\uFF0C\u4F46\u662F\u5B83\u81EA\u8EAB\u4E5F\u5B58\u5728\u4E00\u4E9B\u95EE\u9898\uFF0C\u6BD4\u5982\u8BF4\u5E76\u4E0D\u662F\u6240\u6709\u7684\u6D4F\u89C8\u5668\u90FD\u652F\u6301\u5B83\uFF0C\u800C\u4E14\u5B83\u7684\u89E6\u53D1\u9891\u7387\u4E5F\u4E0D\u662F\u5F88\u7A33\u5B9A\uFF0C\u6240\u4EE5 React \u6700\u7EC8\u653E\u5F03\u4E86 requestIdleCallback \u7684\u4F7F\u7528\u3002</p><p>\u5728 React \u4E2D\uFF0C\u5B98\u65B9\u5B9E\u73B0\u4E86\u81EA\u5DF1\u7684\u4EFB\u52A1\u8C03\u5EA6\u5E93\uFF0C\u8FD9\u4E2A\u5E93\u5C31\u53EB\u505A Scheduler\u3002\u5B83\u4E5F\u53EF\u4EE5\u5B9E\u73B0\u5728\u6D4F\u89C8\u5668\u7A7A\u95F2\u65F6\u6267\u884C\u4EFB\u52A1\uFF0C\u800C\u4E14\u8FD8\u53EF\u4EE5\u8BBE\u7F6E\u4EFB\u52A1\u7684\u4F18\u5148\u7EA7\uFF0C\u9AD8\u4F18\u5148\u7EA7\u4EFB\u52A1\u5148\u6267\u884C\uFF0C\u4F4E\u4F18\u5148\u7EA7\u4EFB\u52A1\u540E\u6267\u884C\u3002</p><p>Scheduler \u5B58\u50A8\u5728 <code>packages/scheduler</code> \u6587\u4EF6\u5939\u4E2D\u3002</p><h3 id="_3-2-reconciler-\u534F\u8C03\u5C42" tabindex="-1">3.2 Reconciler \u534F\u8C03\u5C42 <a class="header-anchor" href="#_3-2-reconciler-\u534F\u8C03\u5C42" aria-hidden="true">#</a></h3><p>\u5728 React 15 \u7684\u7248\u672C\u4E2D\uFF0C\u534F\u8C03\u5668\u548C\u6E32\u67D3\u5668\u4EA4\u66FF\u6267\u884C\uFF0C\u5373\u627E\u5230\u4E86\u5DEE\u5F02\u5C31\u76F4\u63A5\u66F4\u65B0\u5DEE\u5F02\u3002\u5728 React 16 \u7684\u7248\u672C\u4E2D\uFF0C\u8FD9\u79CD\u60C5\u51B5\u53D1\u751F\u4E86\u53D8\u5316\uFF0C\u534F\u8C03\u5668\u548C\u6E32\u67D3\u5668\u4E0D\u518D\u4EA4\u66FF\u6267\u884C\u3002\u534F\u8C03\u5668\u8D1F\u8D23\u627E\u51FA\u5DEE\u5F02\uFF0C\u5728\u6240\u6709\u5DEE\u5F02\u627E\u51FA\u4E4B\u540E\uFF0C\u7EDF\u4E00\u4EA4\u7ED9\u6E32\u67D3\u5668\u8FDB\u884C DOM \u7684\u66F4\u65B0\u3002\u4E5F\u5C31\u662F\u8BF4\u534F\u8C03\u5668\u7684\u4E3B\u8981\u4EFB\u52A1\u5C31\u662F\u627E\u51FA\u5DEE\u5F02\u90E8\u5206\uFF0C\u5E76\u4E3A\u5DEE\u5F02\u6253\u4E0A\u6807\u8BB0\u3002</p><h3 id="_3-3-renderer-\u6E32\u67D3\u5C42" tabindex="-1">3.3 Renderer \u6E32\u67D3\u5C42 <a class="header-anchor" href="#_3-3-renderer-\u6E32\u67D3\u5C42" aria-hidden="true">#</a></h3><p>\u6E32\u67D3\u5668\u6839\u636E\u534F\u8C03\u5668\u4E3A Fiber \u8282\u70B9\u6253\u7684\u6807\u8BB0\uFF0C\u540C\u6B65\u6267\u884C\u5BF9\u5E94\u7684 DOM \u64CD\u4F5C\u3002</p><p>\u65E2\u7136\u6BD4\u5BF9\u7684\u8FC7\u7A0B\u4ECE\u9012\u5F52\u53D8\u6210\u4E86\u53EF\u4EE5\u4E2D\u65AD\u7684\u5FAA\u73AF\uFF0C\u90A3\u4E48 React \u662F\u5982\u4F55\u89E3\u51B3\u4E2D\u65AD\u66F4\u65B0\u65F6 DOM \u6E32\u67D3\u4E0D\u5B8C\u5168\u7684\u95EE\u9898\u5462\uFF1F</p><p>\u5176\u5B9E\u6839\u672C\u5C31\u4E0D\u5B58\u5728\u8FD9\u4E2A\u95EE\u9898\uFF0C\u56E0\u4E3A\u5728\u6574\u4E2A\u8FC7\u7A0B\u4E2D\uFF0C\u8C03\u5EA6\u5668\u548C\u534F\u8C03\u5668\u7684\u5DE5\u4F5C\u662F\u5728\u5185\u5B58\u4E2D\u5B8C\u6210\u7684\u662F\u53EF\u4EE5\u88AB\u6253\u65AD\u7684\uFF0C\u6E32\u67D3\u5668\u7684\u5DE5\u4F5C\u88AB\u8BBE\u5B9A\u6210\u4E0D\u53EF\u4EE5\u88AB\u6253\u65AD\uFF0C\u6240\u4EE5\u4E0D\u5B58\u5728 DOM \u6E32\u67D3\u4E0D\u5B8C\u5168\u7684\u95EE\u9898\u3002</p><h2 id="_4-\u6570\u636E\u7ED3\u6784" tabindex="-1">4. \u6570\u636E\u7ED3\u6784 <a class="header-anchor" href="#_4-\u6570\u636E\u7ED3\u6784" aria-hidden="true">#</a></h2><h3 id="_4-1-fiber" tabindex="-1">4.1 Fiber <a class="header-anchor" href="#_4-1-fiber" aria-hidden="true">#</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">type</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#758575DD;">/************************  DOM \u5B9E\u4F8B\u76F8\u5173  *****************************/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u6807\u8BB0\u4E0D\u540C\u7684\u7EC4\u4EF6\u7C7B\u578B, \u503C\u8BE6\u89C1 WorkTag</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">tag</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">WorkTag</span><span style="color:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u7EC4\u4EF6\u7C7B\u578B div\u3001span\u3001\u7EC4\u4EF6\u6784\u9020\u51FD\u6570</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">type</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">any</span><span style="color:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5B9E\u4F8B\u5BF9\u8C61, \u5982\u7C7B\u7EC4\u4EF6\u7684\u5B9E\u4F8B\u3001\u539F\u751F dom \u5B9E\u4F8B, \u800C function \u7EC4\u4EF6\u6CA1\u6709\u5B9E\u4F8B, \u56E0\u6B64\u8BE5\u5C5E\u6027\u662F\u7A7A</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">stateNode</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">any</span><span style="color:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#758575DD;">/************************  \u6784\u5EFA Fiber \u6811\u76F8\u5173  ***************************/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u6307\u5411\u81EA\u5DF1\u7684\u7236\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">return</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;"> | </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u6307\u5411\u81EA\u5DF1\u7684\u7B2C\u4E00\u4E2A\u5B50\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">child</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;"> | </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u6307\u5411\u81EA\u5DF1\u7684\u4E0B\u4E00\u4E2A\u5144\u5F1F iber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">sibling</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;"> | </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5728 Fiber \u6811\u66F4\u65B0\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u6BCF\u4E2A Fiber \u90FD\u4F1A\u6709\u4E00\u4E2A\u8DDF\u5176\u5BF9\u5E94\u7684 Fiber</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u6211\u4EEC\u79F0\u4ED6\u4E3A current &lt;==&gt; workInProgress</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5728\u6E32\u67D3\u5B8C\u6210\u4E4B\u540E\u4ED6\u4EEC\u4F1A\u4EA4\u6362\u4F4D\u7F6E</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// alternate \u6307\u5411\u5F53\u524D Fiber \u5728 workInProgress \u6811\u4E2D\u7684\u5BF9\u5E94 Fiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">alternate</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;"> | </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#758575DD;">/************************  \u72B6\u6001\u6570\u636E\u76F8\u5173  ********************************/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5373\u5C06\u66F4\u65B0\u7684 props</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">pendingProps</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">any</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u65E7\u7684 props</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">memoizedProps</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">any</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u65E7\u7684 state</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">memoizedState</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">any</span><span style="color:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#758575DD;">/************************  \u526F\u4F5C\u7528\u76F8\u5173 ******************************/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u8BE5 Fiber \u5BF9\u5E94\u7684\u7EC4\u4EF6\u4EA7\u751F\u7684\u72B6\u6001\u66F4\u65B0\u4F1A\u5B58\u653E\u5728\u8FD9\u4E2A\u961F\u5217\u91CC\u9762</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">updateQueue</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">UpdateQueue</span><span style="color:#666666;">&lt;</span><span style="color:#5DA9A7;">any</span><span style="color:#666666;">&gt; | </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u7528\u6765\u8BB0\u5F55\u5F53\u524D Fiber \u8981\u6267\u884C\u7684 DOM \u64CD\u4F5C</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">effectTag</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">SideEffectTag</span><span style="color:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5B58\u50A8\u7B2C\u4E00\u4E2A\u8981\u6267\u884C\u526F\u4F5C\u7528\u7684\u5B50\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">firstEffect</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;"> | </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5B58\u50A8\u4E0B\u4E00\u4E2A\u8981\u6267\u884C\u526F\u4F5C\u7528\u7684\u5B50\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u6267\u884C DOM \u6E32\u67D3\u65F6\u8981\u5148\u901A\u8FC7 first \u627E\u5230\u7B2C\u4E00\u4E2A, \u7136\u540E\u901A\u8FC7 next \u4E00\u76F4\u5411\u540E\u67E5\u627E</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;"> | </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5B58\u50A8 DOM \u64CD\u4F5C\u5B8C\u540E\u7684\u526F\u4F5C\u7528 \u6BD4\u5982\u8C03\u7528\u751F\u547D\u5468\u671F\u51FD\u6570\u6216\u8005\u94A9\u5B50\u51FD\u6570\u7684\u8C03\u7528</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">lastEffect</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;"> | </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u4EFB\u52A1\u7684\u8FC7\u671F\u65F6\u95F4</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">expirationTime</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">ExpirationTime</span><span style="color:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5F53\u524D\u7EC4\u4EF6\u53CA\u5B50\u7EC4\u4EF6\u5904\u4E8E\u4F55\u79CD\u6E32\u67D3\u6A21\u5F0F \u8BE6\u89C1 TypeOfMode</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">mode</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">TypeOfMode</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">};</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">type</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">Fiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A0ADA0;">/************************  DOM \u5B9E\u4F8B\u76F8\u5173  *****************************/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u6807\u8BB0\u4E0D\u540C\u7684\u7EC4\u4EF6\u7C7B\u578B, \u503C\u8BE6\u89C1 WorkTag</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">tag</span><span style="color:#999999;">: </span><span style="color:#2E808F;">WorkTag</span><span style="color:#999999;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u7EC4\u4EF6\u7C7B\u578B div\u3001span\u3001\u7EC4\u4EF6\u6784\u9020\u51FD\u6570</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">type</span><span style="color:#999999;">: </span><span style="color:#2E808F;">any</span><span style="color:#999999;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5B9E\u4F8B\u5BF9\u8C61, \u5982\u7C7B\u7EC4\u4EF6\u7684\u5B9E\u4F8B\u3001\u539F\u751F dom \u5B9E\u4F8B, \u800C function \u7EC4\u4EF6\u6CA1\u6709\u5B9E\u4F8B, \u56E0\u6B64\u8BE5\u5C5E\u6027\u662F\u7A7A</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">stateNode</span><span style="color:#999999;">: </span><span style="color:#2E808F;">any</span><span style="color:#999999;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A0ADA0;">/************************  \u6784\u5EFA Fiber \u6811\u76F8\u5173  ***************************/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u6307\u5411\u81EA\u5DF1\u7684\u7236\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">return</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;"> | </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u6307\u5411\u81EA\u5DF1\u7684\u7B2C\u4E00\u4E2A\u5B50\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">child</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;"> | </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u6307\u5411\u81EA\u5DF1\u7684\u4E0B\u4E00\u4E2A\u5144\u5F1F iber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">sibling</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;"> | </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5728 Fiber \u6811\u66F4\u65B0\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u6BCF\u4E2A Fiber \u90FD\u4F1A\u6709\u4E00\u4E2A\u8DDF\u5176\u5BF9\u5E94\u7684 Fiber</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u6211\u4EEC\u79F0\u4ED6\u4E3A current &lt;==&gt; workInProgress</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5728\u6E32\u67D3\u5B8C\u6210\u4E4B\u540E\u4ED6\u4EEC\u4F1A\u4EA4\u6362\u4F4D\u7F6E</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// alternate \u6307\u5411\u5F53\u524D Fiber \u5728 workInProgress \u6811\u4E2D\u7684\u5BF9\u5E94 Fiber</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">alternate</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;"> | </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A0ADA0;">/************************  \u72B6\u6001\u6570\u636E\u76F8\u5173  ********************************/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5373\u5C06\u66F4\u65B0\u7684 props</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">pendingProps</span><span style="color:#999999;">: </span><span style="color:#2E808F;">any</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u65E7\u7684 props</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">memoizedProps</span><span style="color:#999999;">: </span><span style="color:#2E808F;">any</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u65E7\u7684 state</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">memoizedState</span><span style="color:#999999;">: </span><span style="color:#2E808F;">any</span><span style="color:#999999;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A0ADA0;">/************************  \u526F\u4F5C\u7528\u76F8\u5173 ******************************/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u8BE5 Fiber \u5BF9\u5E94\u7684\u7EC4\u4EF6\u4EA7\u751F\u7684\u72B6\u6001\u66F4\u65B0\u4F1A\u5B58\u653E\u5728\u8FD9\u4E2A\u961F\u5217\u91CC\u9762</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">updateQueue</span><span style="color:#999999;">: </span><span style="color:#2E808F;">UpdateQueue</span><span style="color:#999999;">&lt;</span><span style="color:#2E808F;">any</span><span style="color:#999999;">&gt; | </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u7528\u6765\u8BB0\u5F55\u5F53\u524D Fiber \u8981\u6267\u884C\u7684 DOM \u64CD\u4F5C</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">effectTag</span><span style="color:#999999;">: </span><span style="color:#2E808F;">SideEffectTag</span><span style="color:#999999;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5B58\u50A8\u7B2C\u4E00\u4E2A\u8981\u6267\u884C\u526F\u4F5C\u7528\u7684\u5B50\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">firstEffect</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;"> | </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5B58\u50A8\u4E0B\u4E00\u4E2A\u8981\u6267\u884C\u526F\u4F5C\u7528\u7684\u5B50\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u6267\u884C DOM \u6E32\u67D3\u65F6\u8981\u5148\u901A\u8FC7 first \u627E\u5230\u7B2C\u4E00\u4E2A, \u7136\u540E\u901A\u8FC7 next \u4E00\u76F4\u5411\u540E\u67E5\u627E</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;"> | </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5B58\u50A8 DOM \u64CD\u4F5C\u5B8C\u540E\u7684\u526F\u4F5C\u7528 \u6BD4\u5982\u8C03\u7528\u751F\u547D\u5468\u671F\u51FD\u6570\u6216\u8005\u94A9\u5B50\u51FD\u6570\u7684\u8C03\u7528</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">lastEffect</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;"> | </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u4EFB\u52A1\u7684\u8FC7\u671F\u65F6\u95F4</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">expirationTime</span><span style="color:#999999;">: </span><span style="color:#2E808F;">ExpirationTime</span><span style="color:#999999;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5F53\u524D\u7EC4\u4EF6\u53CA\u5B50\u7EC4\u4EF6\u5904\u4E8E\u4F55\u79CD\u6E32\u67D3\u6A21\u5F0F \u8BE6\u89C1 TypeOfMode</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">mode</span><span style="color:#999999;">: </span><span style="color:#2E808F;">TypeOfMode</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">};</span></span>
<span class="line"></span></code></pre></div><p><img src="`+e+`" alt="1.png"></p><h3 id="_4-2-worktag" tabindex="-1">4.2 WorkTag <a class="header-anchor" href="#_4-2-worktag" aria-hidden="true">#</a></h3><p><code>\u6587\u4EF6\u4F4D\u7F6E\uFF1Apackages/shared/ReactWorkTags.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">type</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">WorkTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">1</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">2</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">3</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">4</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">5</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">6</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">7</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">8</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">9</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">10</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">11</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">12</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">13</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">14</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">15</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">16</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">17</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">18</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">19</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">20</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">21</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">22</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">FunctionComponent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ClassComponent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">1</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">IndeterminateComponent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">2</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostRoot</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">3</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostPortal</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">4</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostComponent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">5</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostText</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">6</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Fragment</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">7</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Mode</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">8</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ContextConsumer</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">9</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ContextProvider</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">10</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ForwardRef</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">11</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Profiler</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">12</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">SuspenseComponent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">13</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">MemoComponent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">14</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">SimpleMemoComponent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">15</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">LazyComponent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">16</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">IncompleteClassComponent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">17</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">DehydratedFragment</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">18</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">SuspenseListComponent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">19</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">FundamentalComponent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">20</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ScopeComponent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">21</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Block</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">22</span><span style="color:#666666;">;</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">type</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">WorkTag</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">1</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">2</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">3</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">4</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">5</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">6</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">7</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">8</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">9</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">10</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">11</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">12</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">13</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">14</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">15</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">16</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">17</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">18</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">19</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">20</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">21</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">22</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">FunctionComponent</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ClassComponent</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">1</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">IndeterminateComponent</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">2</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostRoot</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">3</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostPortal</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">4</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostComponent</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">5</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostText</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">6</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Fragment</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">7</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Mode</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">8</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ContextConsumer</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">9</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ContextProvider</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">10</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ForwardRef</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">11</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Profiler</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">12</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">SuspenseComponent</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">13</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">MemoComponent</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">14</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">SimpleMemoComponent</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">15</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">LazyComponent</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">16</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">IncompleteClassComponent</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">17</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">DehydratedFragment</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">18</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">SuspenseListComponent</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">19</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">FundamentalComponent</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">20</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ScopeComponent</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">21</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Block</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">22</span><span style="color:#999999;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="_4-3-typeofmode" tabindex="-1">4.3 TypeOfMode <a class="header-anchor" href="#_4-3-typeofmode" aria-hidden="true">#</a></h3><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactTypeOfMode.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">type</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">TypeOfMode</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">number</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// 0 \u540C\u6B65\u6E32\u67D3\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoMode</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0000</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#758575DD;">// 1 \u4E25\u683C\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">StrictMode</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0001</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#758575DD;">// 10 \u5F02\u6B65\u6E32\u67D3\u8FC7\u6E21\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">BlockingMode</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0010</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#758575DD;">// 100 \u5F02\u6B65\u6E32\u67D3\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ConcurrentMode</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0100</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#758575DD;">// 1000 \u6027\u80FD\u6D4B\u8BD5\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ProfileMode</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b1000</span><span style="color:#666666;">;</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">type</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">TypeOfMode</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">number</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// 0 \u540C\u6B65\u6E32\u67D3\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoMode</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0000</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#A0ADA0;">// 1 \u4E25\u683C\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">StrictMode</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0001</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#A0ADA0;">// 10 \u5F02\u6B65\u6E32\u67D3\u8FC7\u6E21\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">BlockingMode</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0010</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#A0ADA0;">// 100 \u5F02\u6B65\u6E32\u67D3\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ConcurrentMode</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0100</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#A0ADA0;">// 1000 \u6027\u80FD\u6D4B\u8BD5\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ProfileMode</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b1000</span><span style="color:#999999;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="_4-3-sideeffecttag" tabindex="-1">4.3 SideEffectTag <a class="header-anchor" href="#_4-3-sideeffecttag" aria-hidden="true">#</a></h3><p><code>\u6587\u4EF6\u4F4D\u7F6E\uFF1Apackages/shared/ReactSideEffectTags.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">type</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">SideEffectTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">number</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// Don&#39;t change these two values. They&#39;re used by React Dev Tools.</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">/*              */</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0000000000000</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 0</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">PerformedWork</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">/*         */</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0000000000001</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// You can change the rest (and add more).</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Placement</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">/*             */</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0000000000010</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 2</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Update</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">/*                */</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0000000000100</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 4</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">PlacementAndUpdate</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">/*    */</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0000000000110</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 6</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Deletion</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">/*              */</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0000000001000</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 8</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ContentReset</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">/*          */</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0000000010000</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 16</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Callback</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">/*              */</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0000000100000</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 32</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">DidCapture</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">/*            */</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0000001000000</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 64</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Ref</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">/*                   */</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0000010000000</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 128</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Snapshot</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">/*              */</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0000100000000</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 256</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Passive</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">/*               */</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0001000000000</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 512</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Hydrating</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">/*             */</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0010000000000</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 1024</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HydratingAndUpdate</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">/*    */</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0010000000100</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 1028</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// Passive &amp; Update &amp; Callback &amp; Ref &amp; Snapshot</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">LifecycleEffectMask</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">/*   */</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0001110100100</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 932</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// Union of all host effects</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostEffectMask</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">/*        */</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0011111111111</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 2047</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Incomplete</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">/*            */</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b0100000000000</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 2048</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ShouldCapture</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">/*         */</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0b1000000000000</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#758575DD;">// 4096</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">type</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">SideEffectTag</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">number</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// Don&#39;t change these two values. They&#39;re used by React Dev Tools.</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoEffect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">/*              */</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0000000000000</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 0</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">PerformedWork</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">/*         */</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0000000000001</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// You can change the rest (and add more).</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Placement</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">/*             */</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0000000000010</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 2</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Update</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">/*                */</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0000000000100</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 4</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">PlacementAndUpdate</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">/*    */</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0000000000110</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 6</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Deletion</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">/*              */</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0000000001000</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 8</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ContentReset</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">/*          */</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0000000010000</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 16</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Callback</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">/*              */</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0000000100000</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 32</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">DidCapture</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">/*            */</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0000001000000</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 64</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Ref</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">/*                   */</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0000010000000</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 128</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Snapshot</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">/*              */</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0000100000000</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 256</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Passive</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">/*               */</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0001000000000</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 512</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Hydrating</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">/*             */</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0010000000000</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 1024</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HydratingAndUpdate</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">/*    */</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0010000000100</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 1028</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// Passive &amp; Update &amp; Callback &amp; Ref &amp; Snapshot</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">LifecycleEffectMask</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">/*   */</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0001110100100</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 932</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// Union of all host effects</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostEffectMask</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">/*        */</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0011111111111</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 2047</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Incomplete</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">/*            */</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b0100000000000</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 2048</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ShouldCapture</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">/*         */</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0b1000000000000</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 4096</span></span>
<span class="line"></span></code></pre></div><h3 id="_4-4-update" tabindex="-1">4.4 Update <a class="header-anchor" href="#_4-4-update" aria-hidden="true">#</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">update</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Update</span><span style="color:#666666;">&lt;*&gt; =</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">expirationTime</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">suspenseConfig</span><span style="color:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">tag</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">UpdateState</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">payload</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">callback</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">next</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">null</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">any</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">};</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">update</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Update</span><span style="color:#999999;">&lt;*&gt; =</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">expirationTime</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">suspenseConfig</span><span style="color:#999999;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">tag</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">UpdateState</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">payload</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">callback</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">next</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">null</span><span style="color:#999999;">: </span><span style="color:#2E808F;">any</span><span style="color:#999999;">)</span><span style="color:#393A34;">,</span></span>
<span class="line"><span style="color:#393A34;">};</span></span>
<span class="line"></span></code></pre></div><h3 id="_4-5-updatequeue" tabindex="-1">4.5 UpdateQueue <a class="header-anchor" href="#_4-5-updatequeue" aria-hidden="true">#</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">queue</span><span style="color:#666666;">: &lt;</span><span style="color:#5DA9A7;">State</span><span style="color:#666666;">&gt; =</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// \u4E0A\u4E00\u6B21\u66F4\u65B0\u4E4B\u540E\u7684 state, \u4F5C\u4E3A\u4E0B\u4E00\u6B21\u66F4\u65B0\u7684\u57FA\u7840</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">baseState</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">fiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">memoizedState</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">baseQueue</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">shared</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">pending</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">effects</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#BD976A;">fiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">updateQueue</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">queue</span><span style="color:#666666;">;</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#59873A;">queue</span><span style="color:#999999;">: &lt;</span><span style="color:#2E808F;">State</span><span style="color:#999999;">&gt; =</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// \u4E0A\u4E00\u6B21\u66F4\u65B0\u4E4B\u540E\u7684 state, \u4F5C\u4E3A\u4E0B\u4E00\u6B21\u66F4\u65B0\u7684\u57FA\u7840</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">baseState</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">fiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">memoizedState</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">baseQueue</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">shared</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">pending</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">effects</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#B07D48;">fiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">updateQueue</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">queue</span><span style="color:#999999;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="_4-6-roottag" tabindex="-1">4.6 RootTag <a class="header-anchor" href="#_4-6-roottag" aria-hidden="true">#</a></h3><p><code>\u6587\u4EF6\u4F4D\u7F6E\uFF1Apackages/shared/ReactRootTags.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">type</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">RootTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">1</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">2</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// ReactDOM.render</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">LegacyRoot</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#758575DD;">// ReactDOM.createBlockingRoot</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">BlockingRoot</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">1</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#758575DD;">// ReactDOM.createRoot</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ConcurrentRoot</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">2</span><span style="color:#666666;">;</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">type</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">RootTag</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0</span><span style="color:#393A34;"> </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">1</span><span style="color:#393A34;"> </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">2</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// ReactDOM.render</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">LegacyRoot</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#A0ADA0;">// ReactDOM.createBlockingRoot</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">BlockingRoot</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">1</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#A0ADA0;">// ReactDOM.createRoot</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ConcurrentRoot</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">2</span><span style="color:#999999;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="_4-7-\u53CC\u7F13\u5B58\u6280\u672F" tabindex="-1">4.7 \u53CC\u7F13\u5B58\u6280\u672F <a class="header-anchor" href="#_4-7-\u53CC\u7F13\u5B58\u6280\u672F" aria-hidden="true">#</a></h3><p>\u5728 React \u4E2D\uFF0CDOM \u7684\u66F4\u65B0\u91C7\u7528\u4E86\u53CC\u7F13\u5B58\u6280\u672F\uFF0C\u53CC\u7F13\u5B58\u6280\u672F\u81F4\u529B\u4E8E\u66F4\u5FEB\u901F\u7684 DOM \u66F4\u65B0\u3002</p><p>\u4EC0\u4E48\u662F\u53CC\u7F13\u5B58\uFF1F\u4E3E\u4E2A\u4F8B\u5B50\uFF0C\u4F7F\u7528 canvas \u7ED8\u5236\u52A8\u753B\u65F6\uFF0C\u5728\u7ED8\u5236\u6BCF\u4E00\u5E27\u524D\u90FD\u4F1A\u6E05\u9664\u4E0A\u4E00\u5E27\u7684\u753B\u9762\uFF0C\u6E05\u9664\u4E0A\u4E00\u5E27\u9700\u8981\u82B1\u8D39\u65F6\u95F4\uFF0C\u5982\u679C\u5F53\u524D\u5E27\u753B\u9762\u8BA1\u7B97\u91CF\u53C8\u6BD4\u8F83\u5927\uFF0C\u53C8\u9700\u8981\u82B1\u8D39\u6BD4\u8F83\u957F\u7684\u65F6\u95F4\uFF0C\u8FD9\u5C31\u5BFC\u81F4\u4E0A\u4E00\u5E27\u6E05\u9664\u5230\u4E0B\u4E00\u5E27\u663E\u793A\u4E2D\u95F4\u4F1A\u6709\u8F83\u957F\u7684\u95F4\u9699\uFF0C\u5C31\u4F1A\u51FA\u73B0\u767D\u5C4F\u3002</p><p>\u4E3A\u4E86\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5728\u5185\u5B58\u4E2D\u7ED8\u5236\u5F53\u524D\u5E27\u52A8\u753B\uFF0C\u7ED8\u5236\u5B8C\u6BD5\u540E\u76F4\u63A5\u7528\u5F53\u524D\u5E27\u66FF\u6362\u4E0A\u4E00\u5E27\u753B\u9762\uFF0C\u8FD9\u6837\u7684\u8BDD\u5728\u5E27\u753B\u9762\u66FF\u6362\u7684\u8FC7\u7A0B\u4E2D\u5C31\u4F1A\u8282\u7EA6\u975E\u5E38\u591A\u7684\u65F6\u95F4\uFF0C\u5C31\u4E0D\u4F1A\u51FA\u73B0\u767D\u5C4F\u95EE\u9898\u3002\u8FD9\u79CD\u5728\u5185\u5B58\u4E2D\u6784\u5EFA\u5E76\u76F4\u63A5\u66FF\u6362\u7684\u6280\u672F\u53EB\u505A\u53CC\u7F13\u5B58\u3002</p><p>React \u4F7F\u7528\u53CC\u7F13\u5B58\u6280\u672F\u5B8C\u6210 Fiber \u6811\u7684\u6784\u5EFA\u4E0E\u66FF\u6362\uFF0C\u5B9E\u73B0 DOM \u5BF9\u8C61\u7684\u5FEB\u901F\u66F4\u65B0\u3002</p><p>\u5728 React \u4E2D\u6700\u591A\u4F1A\u540C\u65F6\u5B58\u5728\u4E24\u68F5 Fiber \u6811\uFF0C\u5F53\u524D\u5728\u5C4F\u5E55\u4E2D\u663E\u793A\u7684\u5185\u5BB9\u5BF9\u5E94\u7684 Fiber \u6811\u53EB\u505A current Fiber \u6811\uFF0C\u5F53\u53D1\u751F\u66F4\u65B0\u65F6\uFF0CReact \u4F1A\u5728\u5185\u5B58\u4E2D\u91CD\u65B0\u6784\u5EFA\u4E00\u9897\u65B0\u7684 Fiber \u6811\uFF0C\u8FD9\u9897\u6B63\u5728\u6784\u5EFA\u7684 Fiber \u6811\u53EB\u505A workInProgress Fiber \u6811\u3002\u5728\u53CC\u7F13\u5B58\u6280\u672F\u4E2D\uFF0CworkInProgress Fiber \u6811\u5C31\u662F\u5373\u5C06\u8981\u663E\u793A\u5728\u9875\u9762\u4E2D\u7684 Fiber \u6811\uFF0C\u5F53\u8FD9\u9897 Fiber \u6811\u6784\u5EFA\u5B8C\u6210\u540E\uFF0CReact \u4F1A\u4F7F\u7528\u5B83\u76F4\u63A5\u66FF\u6362 current Fiber \u6811\u8FBE\u5230\u5FEB\u901F\u66F4\u65B0 DOM \u7684\u76EE\u7684\uFF0C\u56E0\u4E3A workInProgress Fiber \u6811\u662F\u5728\u5185\u5B58\u4E2D\u6784\u5EFA\u7684\u6240\u4EE5\u6784\u5EFA\u5B83\u7684\u901F\u5EA6\u662F\u975E\u5E38\u5FEB\u7684\u3002</p><p>\u4E00\u65E6 workInProgress Fiber \u6811\u5728\u5C4F\u5E55\u4E0A\u5448\u73B0\uFF0C\u5B83\u5C31\u4F1A\u53D8\u6210 current Fiber \u6811\u3002</p><p>\u5728 current Fiber \u8282\u70B9\u5BF9\u8C61\u4E2D\u6709\u4E00\u4E2A alternate \u5C5E\u6027\u6307\u5411\u5BF9\u5E94\u7684 workInProgress Fiber \u8282\u70B9\u5BF9\u8C61\uFF0C\u5728 workInProgress Fiber \u8282\u70B9\u4E2D\u6709\u4E00\u4E2A alternate \u5C5E\u6027\u4E5F\u6307\u5411\u5BF9\u5E94\u7684 current Fiber \u8282\u70B9\u5BF9\u8C61\u3002</p><p><img src="`+c+'" alt="3.png"><img src="'+t+'" alt="3.png"></p><h3 id="_4-8-\u533A\u5206-fiberroot-\u4E0E-rootfiber" tabindex="-1">4.8 \u533A\u5206 fiberRoot \u4E0E rootFiber <a class="header-anchor" href="#_4-8-\u533A\u5206-fiberroot-\u4E0E-rootfiber" aria-hidden="true">#</a></h3><p>fiberRoot \u8868\u793A Fiber \u6570\u636E\u7ED3\u6784\u5BF9\u8C61\uFF0C\u662F Fiber \u6570\u636E\u7ED3\u6784\u4E2D\u7684\u6700\u5916\u5C42\u5BF9\u8C61</p><p>rootFiber \u8868\u793A\u7EC4\u4EF6\u6302\u8F7D\u70B9\u5BF9\u5E94\u7684 Fiber \u5BF9\u8C61\uFF0C\u6BD4\u5982 React \u5E94\u7528\u4E2D\u9ED8\u8BA4\u7684\u7EC4\u4EF6\u6302\u8F7D\u70B9\u5C31\u662F id \u4E3A root \u7684 div</p><p>fiberRoot \u5305\u542B rootFiber\uFF0C\u5728 fiberRoot \u5BF9\u8C61\u4E2D\u6709\u4E00\u4E2A current \u5C5E\u6027\uFF0C\u5B58\u50A8 rootFiber</p><p>rootFiber \u6307\u5411 fiberRoot\uFF0C\u5728 rootFiber \u5BF9\u8C61\u4E2D\u6709\u4E00\u4E2A stateNode \u5C5E\u6027\uFF0C\u6307\u5411 fiberRoot</p><p>\u5728 React \u5E94\u7528\u4E2D FiberRoot \u53EA\u6709\u4E00\u4E2A\uFF0C\u800C rootFiber \u53EF\u4EE5\u6709\u591A\u4E2A\uFF0C\u56E0\u4E3A render \u65B9\u6CD5\u662F\u53EF\u4EE5\u8C03\u7528\u591A\u6B21\u7684</p><p>fiberRoot \u4F1A\u8BB0\u5F55\u5E94\u7528\u7684\u66F4\u65B0\u4FE1\u606F\uFF0C\u6BD4\u5982\u534F\u8C03\u5668\u5728\u5B8C\u6210\u5DE5\u4F5C\u540E\uFF0C\u4F1A\u5C06\u5DE5\u4F5C\u6210\u679C\u5B58\u50A8\u5728 fiberRoot \u4E2D\u3002</p><p><img src="'+r+`" alt="3.png"></p><h2 id="_5-\u521D\u59CB\u5316\u6E32\u67D3" tabindex="-1">5. \u521D\u59CB\u5316\u6E32\u67D3 <a class="header-anchor" href="#_5-\u521D\u59CB\u5316\u6E32\u67D3" aria-hidden="true">#</a></h2><p>\u8981\u5C06 React \u5143\u7D20\u6E32\u67D3\u5230\u9875\u9762\u4E2D\uFF0C\u5206\u4E3A\u4E24\u4E2A\u9636\u6BB5\uFF0Crender \u9636\u6BB5\u548C commit \u9636\u6BB5\u3002</p><p>render \u9636\u6BB5\u8D1F\u8D23\u521B\u5EFA Fiber \u6570\u636E\u7ED3\u6784\u5E76\u4E3A Fiber \u8282\u70B9\u6253\u6807\u8BB0\uFF0C\u6807\u8BB0\u5F53\u524D Fiber \u8282\u70B9\u8981\u8FDB\u884C\u7684 DOM \u64CD\u4F5C\u3002</p><p>commit \u9636\u6BB5\u8D1F\u8D23\u6839\u636E Fiber \u8282\u70B9\u6807\u8BB0 ( effectTag ) \u8FDB\u884C\u76F8\u5E94\u7684 DOM \u64CD\u4F5C\u3002</p><h3 id="_5-1-render-\u9636\u6BB5" tabindex="-1">5.1 render \u9636\u6BB5 <a class="header-anchor" href="#_5-1-render-\u9636\u6BB5" aria-hidden="true">#</a></h3><h4 id="_5-1-1-render" tabindex="-1">5.1.1 render <a class="header-anchor" href="#_5-1-1-render" aria-hidden="true">#</a></h4><p><code>\u6587\u4EF6\u4F4D\u7F6E\uFF1Apackages/react-dom/src/client/ReactDOMLegacy.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * \u6E32\u67D3\u5165\u53E3</span></span>
<span class="line"><span style="color:#758575DD;"> * element \u8981\u8FDB\u884C\u6E32\u67D3\u7684 ReactElement, createElement \u65B9\u6CD5\u7684\u8FD4\u56DE\u503C</span></span>
<span class="line"><span style="color:#758575DD;"> * container \u6E32\u67D3\u5BB9\u5668 &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#758575DD;"> * callback \u6E32\u67D3\u5B8C\u6210\u540E\u6267\u884C\u7684\u56DE\u8C03\u51FD\u6570</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">render</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">element</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">React$Element</span><span style="color:#666666;">&lt;</span><span style="color:#5DA9A7;">any</span><span style="color:#666666;">&gt;,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">container</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Container</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">callback</span><span style="color:#666666;">: </span><span style="color:#CB7676;">?</span><span style="color:#5DA9A7;">Function</span></span>
<span class="line"><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u68C0\u6D4B container \u662F\u5426\u662F\u7B26\u5408\u8981\u6C42\u7684\u6E32\u67D3\u5BB9\u5668</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5373\u68C0\u6D4B container \u662F\u5426\u662F\u771F\u5B9E\u7684DOM\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C\u4E0D\u7B26\u5408\u8981\u6C42\u5C31\u62A5\u9519</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">invariant</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">isValidContainer</span><span style="color:#666666;">(</span><span style="color:#BD976A;">container</span><span style="color:#666666;">),</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Target container is not a DOM element.</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">legacyRenderSubtreeIntoContainer</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u7236\u7EC4\u4EF6 \u521D\u59CB\u6E32\u67D3\u6CA1\u6709\u7236\u7EC4\u4EF6 \u4F20\u9012 null \u5360\u4F4D</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">element</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">container</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u662F\u5426\u4E3A\u670D\u52A1\u5668\u7AEF\u6E32\u67D3 false \u4E0D\u662F\u670D\u52A1\u5668\u7AEF\u6E32\u67D3 true \u662F\u670D\u52A1\u5668\u7AEF\u6E32\u67D3</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">false</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">callback</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u6E32\u67D3\u5165\u53E3</span></span>
<span class="line"><span style="color:#A0ADA0;"> * element \u8981\u8FDB\u884C\u6E32\u67D3\u7684 ReactElement, createElement \u65B9\u6CD5\u7684\u8FD4\u56DE\u503C</span></span>
<span class="line"><span style="color:#A0ADA0;"> * container \u6E32\u67D3\u5BB9\u5668 &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#A0ADA0;"> * callback \u6E32\u67D3\u5B8C\u6210\u540E\u6267\u884C\u7684\u56DE\u8C03\u51FD\u6570</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">render</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">element</span><span style="color:#999999;">: </span><span style="color:#2E808F;">React$Element</span><span style="color:#999999;">&lt;</span><span style="color:#2E808F;">any</span><span style="color:#999999;">&gt;,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">container</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Container</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">callback</span><span style="color:#999999;">: </span><span style="color:#AB5959;">?</span><span style="color:#2E808F;">Function</span></span>
<span class="line"><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u68C0\u6D4B container \u662F\u5426\u662F\u7B26\u5408\u8981\u6C42\u7684\u6E32\u67D3\u5BB9\u5668</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5373\u68C0\u6D4B container \u662F\u5426\u662F\u771F\u5B9E\u7684DOM\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C\u4E0D\u7B26\u5408\u8981\u6C42\u5C31\u62A5\u9519</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">invariant</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">isValidContainer</span><span style="color:#999999;">(</span><span style="color:#B07D48;">container</span><span style="color:#999999;">),</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Target container is not a DOM element.</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#59873A;">legacyRenderSubtreeIntoContainer</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u7236\u7EC4\u4EF6 \u521D\u59CB\u6E32\u67D3\u6CA1\u6709\u7236\u7EC4\u4EF6 \u4F20\u9012 null \u5360\u4F4D</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">element</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">container</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u662F\u5426\u4E3A\u670D\u52A1\u5668\u7AEF\u6E32\u67D3 false \u4E0D\u662F\u670D\u52A1\u5668\u7AEF\u6E32\u67D3 true \u662F\u670D\u52A1\u5668\u7AEF\u6E32\u67D3</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">false</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">callback</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="_5-1-2-isvalidcontainer" tabindex="-1">5.1.2 isValidContainer <a class="header-anchor" href="#_5-1-2-isvalidcontainer" aria-hidden="true">#</a></h4><p><code>\u6587\u4EF6\u4F4D\u7F6E\uFF1Apackages/react-dom/src/client/ReactDOMRoot.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * \u5224\u65AD node \u662F\u5426\u662F\u7B26\u5408\u8981\u6C42\u7684 DOM \u8282\u70B9</span></span>
<span class="line"><span style="color:#758575DD;"> * 1. node \u53EF\u4EE5\u662F\u5143\u7D20\u8282\u70B9</span></span>
<span class="line"><span style="color:#758575DD;"> * 2. node \u53EF\u4EE5\u662F document \u8282\u70B9</span></span>
<span class="line"><span style="color:#758575DD;"> * 3. node \u53EF\u4EE5\u662F \u6587\u6863\u788E\u7247\u8282\u70B9</span></span>
<span class="line"><span style="color:#758575DD;"> * 4. node \u53EF\u4EE5\u662F\u6CE8\u91CA\u8282\u70B9\u4F46\u6CE8\u91CA\u5185\u5BB9\u5FC5\u987B\u662F react-mount-point-unstable</span></span>
<span class="line"><span style="color:#758575DD;"> * 		react \u5185\u90E8\u4F1A\u627E\u5230\u6CE8\u91CA\u8282\u70B9\u7684\u7236\u7EA7 \u901A\u8FC7\u8C03\u7528\u7236\u7EA7\u5143\u7D20\u7684 insertBefore \u65B9\u6CD5, \u5C06 element \u63D2\u5165\u5230\u6CE8\u91CA\u8282\u70B9\u7684\u524D\u9762</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">isValidContainer</span><span style="color:#666666;">(</span><span style="color:#BD976A;">node</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">mixed</span><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">boolean</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!!</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">node</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">(</span><span style="color:#BD976A;">node</span><span style="color:#666666;">.</span><span style="color:#BD976A;">nodeType</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ELEMENT_NODE</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">||</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">node</span><span style="color:#666666;">.</span><span style="color:#BD976A;">nodeType</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">DOCUMENT_NODE</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">||</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">node</span><span style="color:#666666;">.</span><span style="color:#BD976A;">nodeType</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">DOCUMENT_FRAGMENT_NODE</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">||</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">(</span><span style="color:#BD976A;">node</span><span style="color:#666666;">.</span><span style="color:#BD976A;">nodeType</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">COMMENT_NODE</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#666666;">(</span><span style="color:#BD976A;">node</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">any</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;">.nodeValue === &#39; react-mount-point-unstable &#39;))</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    );</span></span>
<span class="line"><span style="color:#DBD7CAEE;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u5224\u65AD node \u662F\u5426\u662F\u7B26\u5408\u8981\u6C42\u7684 DOM \u8282\u70B9</span></span>
<span class="line"><span style="color:#A0ADA0;"> * 1. node \u53EF\u4EE5\u662F\u5143\u7D20\u8282\u70B9</span></span>
<span class="line"><span style="color:#A0ADA0;"> * 2. node \u53EF\u4EE5\u662F document \u8282\u70B9</span></span>
<span class="line"><span style="color:#A0ADA0;"> * 3. node \u53EF\u4EE5\u662F \u6587\u6863\u788E\u7247\u8282\u70B9</span></span>
<span class="line"><span style="color:#A0ADA0;"> * 4. node \u53EF\u4EE5\u662F\u6CE8\u91CA\u8282\u70B9\u4F46\u6CE8\u91CA\u5185\u5BB9\u5FC5\u987B\u662F react-mount-point-unstable</span></span>
<span class="line"><span style="color:#A0ADA0;"> * 		react \u5185\u90E8\u4F1A\u627E\u5230\u6CE8\u91CA\u8282\u70B9\u7684\u7236\u7EA7 \u901A\u8FC7\u8C03\u7528\u7236\u7EA7\u5143\u7D20\u7684 insertBefore \u65B9\u6CD5, \u5C06 element \u63D2\u5165\u5230\u6CE8\u91CA\u8282\u70B9\u7684\u524D\u9762</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">isValidContainer</span><span style="color:#999999;">(</span><span style="color:#B07D48;">node</span><span style="color:#999999;">: </span><span style="color:#2E808F;">mixed</span><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">boolean</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!!</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">node</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">(</span><span style="color:#B07D48;">node</span><span style="color:#999999;">.</span><span style="color:#B07D48;">nodeType</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ELEMENT_NODE</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">||</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">node</span><span style="color:#999999;">.</span><span style="color:#B07D48;">nodeType</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">DOCUMENT_NODE</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">||</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">node</span><span style="color:#999999;">.</span><span style="color:#B07D48;">nodeType</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">DOCUMENT_FRAGMENT_NODE</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">||</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">(</span><span style="color:#B07D48;">node</span><span style="color:#999999;">.</span><span style="color:#B07D48;">nodeType</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">COMMENT_NODE</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#999999;">(</span><span style="color:#B07D48;">node</span><span style="color:#999999;">: </span><span style="color:#2E808F;">any</span><span style="color:#999999;">)</span><span style="color:#393A34;">.nodeValue === &#39; react-mount-point-unstable &#39;))</span></span>
<span class="line"><span style="color:#393A34;">    );</span></span>
<span class="line"><span style="color:#393A34;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="_5-1-3-\u521D\u59CB\u5316-fiberroot" tabindex="-1">5.1.3 \u521D\u59CB\u5316 FiberRoot <a class="header-anchor" href="#_5-1-3-\u521D\u59CB\u5316-fiberroot" aria-hidden="true">#</a></h4><h5 id="_5-1-3-1-legacyrendersubtreeintocontainer" tabindex="-1">5.1.3.1 legacyRenderSubtreeIntoContainer <a class="header-anchor" href="#_5-1-3-1-legacyrendersubtreeintocontainer" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-dom/src/client/ReactDOMLegacy.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * \u5C06\u5B50\u6811\u6E32\u67D3\u5230\u5BB9\u5668\u4E2D (\u521D\u59CB\u5316 Fiber \u6570\u636E\u7ED3\u6784: \u521B\u5EFA fiberRoot \u53CA rootFiber)</span></span>
<span class="line"><span style="color:#758575DD;"> * parentComponent: \u7236\u7EC4\u4EF6, \u521D\u59CB\u6E32\u67D3\u4F20\u5165\u4E86 null</span></span>
<span class="line"><span style="color:#758575DD;"> * children: render \u65B9\u6CD5\u4E2D\u7684\u7B2C\u4E00\u4E2A\u53C2\u6570, \u8981\u6E32\u67D3\u7684 ReactElement</span></span>
<span class="line"><span style="color:#758575DD;"> * container: \u6E32\u67D3\u5BB9\u5668</span></span>
<span class="line"><span style="color:#758575DD;"> * forceHydrate: true \u4E3A\u670D\u52A1\u7AEF\u6E32\u67D3, false \u4E3A\u5BA2\u6237\u7AEF\u6E32\u67D3</span></span>
<span class="line"><span style="color:#758575DD;"> * callback: \u7EC4\u4EF6\u6E32\u67D3\u5B8C\u6210\u540E\u9700\u8981\u6267\u884C\u7684\u56DE\u8C03\u51FD\u6570</span></span>
<span class="line"><span style="color:#758575DD;"> **/</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">legacyRenderSubtreeIntoContainer</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">parentComponent</span><span style="color:#666666;">: </span><span style="color:#CB7676;">?</span><span style="color:#5DA9A7;">React$Component</span><span style="color:#666666;">&lt;</span><span style="color:#5DA9A7;">any</span><span style="color:#666666;">, </span><span style="color:#5DA9A7;">any</span><span style="color:#666666;">&gt;,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">children</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">ReactNodeList</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">container</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Container</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">forceHydrate</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">boolean</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">callback</span><span style="color:#666666;">: </span><span style="color:#CB7676;">?</span><span style="color:#5DA9A7;">Function</span></span>
<span class="line"><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">     * \u68C0\u6D4B container \u662F\u5426\u5DF2\u7ECF\u662F\u521D\u59CB\u5316\u8FC7\u7684\u6E32\u67D3\u5BB9\u5668</span></span>
<span class="line"><span style="color:#758575DD;">     * react \u5728\u521D\u59CB\u6E32\u67D3\u65F6\u4F1A\u4E3A\u6700\u5916\u5C42\u5BB9\u5668\u6DFB\u52A0 _reactRootContainer \u5C5E\u6027</span></span>
<span class="line"><span style="color:#758575DD;">     * react \u4F1A\u6839\u636E\u6B64\u5C5E\u6027\u8FDB\u884C\u4E0D\u540C\u7684\u6E32\u67D3\u65B9\u5F0F</span></span>
<span class="line"><span style="color:#758575DD;">     * root \u4E0D\u5B58\u5728 \u8868\u793A\u521D\u59CB\u6E32\u67D3</span></span>
<span class="line"><span style="color:#758575DD;">     * root \u5B58\u5728 \u8868\u793A\u66F4\u65B0</span></span>
<span class="line"><span style="color:#758575DD;">     */</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6 container \u5BB9\u5668\u5BF9\u8C61\u4E0B\u662F\u5426\u6709 _reactRootContainer \u5C5E\u6027</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">root</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">RootType</span><span style="color:#666666;"> =</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">container</span><span style="color:#666666;">.</span><span style="color:#BD976A;">_reactRootContainer</span><span style="color:#DBD7CAEE;">: </span><span style="color:#BD976A;">any</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5373\u5C06\u5B58\u50A8\u6839 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">fiberRoot</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#CB7676;">!</span><span style="color:#BD976A;">root</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u521D\u59CB\u5316\u6839 Fiber \u6570\u636E\u7ED3\u6784</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u4E3A container \u5BB9\u5668\u6DFB\u52A0 _reactRootContainer \u5C5E\u6027</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5728 _reactRootContainer \u5BF9\u8C61\u4E2D\u6709\u4E00\u4E2A\u5C5E\u6027\u53EB\u505A _internalRoot</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// _internalRoot \u5C5E\u6027\u503C\u5373\u4E3A FiberRoot \u8868\u793A\u6839\u8282\u70B9 Fiber \u6570\u636E\u7ED3\u6784</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// legacyCreateRootFromDOMContainer</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// createLegacyRoot</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// new ReactDOMBlockingRoot -&gt; this._internalRoot</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// createRootImpl</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">root</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">container</span><span style="color:#666666;">.</span><span style="color:#BD976A;">_reactRootContainer</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">legacyCreateRootFromDOMContainer</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">container</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">forceHydrate</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u83B7\u53D6 Fiber Root \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">fiberRoot</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">root</span><span style="color:#666666;">.</span><span style="color:#BD976A;">_internalRoot</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">         * \u6539\u53D8 callback \u51FD\u6570\u4E2D\u7684 this \u6307\u5411</span></span>
<span class="line"><span style="color:#758575DD;">         * \u4F7F\u5176\u6307\u5411 render \u65B9\u6CD5\u7B2C\u4E00\u4E2A\u53C2\u6570\u7684\u771F\u5B9E DOM \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#758575DD;">         */</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5982\u679C callback \u53C2\u6570\u662F\u51FD\u6570\u7C7B\u578B</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#CB7676;">typeof</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">callback</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">function</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u4F7F\u7528 originalCallback \u5B58\u50A8 callback \u51FD\u6570</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">originalCallback</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">callback</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u4E3A callback \u53C2\u6570\u91CD\u65B0\u8D4B\u503C</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#80A665;">callback</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u83B7\u53D6 render \u65B9\u6CD5\u7B2C\u4E00\u4E2A\u53C2\u6570\u7684\u771F\u5B9E DOM \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u5B9E\u9645\u4E0A\u5C31\u662F id=&quot;root&quot; \u7684 div \u7684\u5B50\u5143\u7D20</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// rootFiber.child.stateNode</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// rootFiber \u5C31\u662F id=&quot;root&quot; \u7684 div</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">instance</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">getPublicRootInstance</span><span style="color:#666666;">(</span><span style="color:#BD976A;">fiberRoot</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u8C03\u7528 callback \u51FD\u6570\u5E76\u6539\u53D8\u51FD\u6570\u5185\u90E8 this \u6307\u5411</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">originalCallback</span><span style="color:#666666;">.</span><span style="color:#80A665;">call</span><span style="color:#666666;">(</span><span style="color:#BD976A;">instance</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">};</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u521D\u59CB\u5316\u6E32\u67D3\u4E0D\u6267\u884C\u6279\u91CF\u66F4\u65B0</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u56E0\u4E3A\u6279\u91CF\u66F4\u65B0\u662F\u5F02\u6B65\u7684\u662F\u53EF\u4EE5\u88AB\u6253\u65AD\u7684, \u4F46\u662F\u521D\u59CB\u5316\u6E32\u67D3\u5E94\u8BE5\u5C3D\u5FEB\u5B8C\u6210\u4E0D\u80FD\u88AB\u6253\u65AD</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u6240\u4EE5\u4E0D\u6267\u884C\u6279\u91CF\u66F4\u65B0</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">unbatchedUpdates</span><span style="color:#666666;">(()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#80A665;">updateContainer</span><span style="color:#666666;">(</span><span style="color:#BD976A;">children</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">fiberRoot</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">parentComponent</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">callback</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">});</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u975E\u521D\u59CB\u5316\u6E32\u67D3 \u5373\u66F4\u65B0</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">fiberRoot</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">root</span><span style="color:#666666;">.</span><span style="color:#BD976A;">_internalRoot</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#CB7676;">typeof</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">callback</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">function</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">originalCallback</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">callback</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#80A665;">callback</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">instance</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">getPublicRootInstance</span><span style="color:#666666;">(</span><span style="color:#BD976A;">fiberRoot</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">originalCallback</span><span style="color:#666666;">.</span><span style="color:#80A665;">call</span><span style="color:#666666;">(</span><span style="color:#BD976A;">instance</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">};</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// Update</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">updateContainer</span><span style="color:#666666;">(</span><span style="color:#BD976A;">children</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">fiberRoot</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">parentComponent</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">callback</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u8FD4\u56DE render \u65B9\u6CD5\u7B2C\u4E00\u4E2A\u53C2\u6570\u7684\u771F\u5B9E DOM \u5BF9\u8C61\u4F5C\u4E3A render \u65B9\u6CD5\u7684\u8FD4\u56DE\u503C</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5C31\u662F\u8BF4\u6E32\u67D3\u8C01 \u8FD4\u56DE\u8C01\u7684\u771F\u5B9E DOM \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">getPublicRootInstance</span><span style="color:#666666;">(</span><span style="color:#BD976A;">fiberRoot</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u5C06\u5B50\u6811\u6E32\u67D3\u5230\u5BB9\u5668\u4E2D (\u521D\u59CB\u5316 Fiber \u6570\u636E\u7ED3\u6784: \u521B\u5EFA fiberRoot \u53CA rootFiber)</span></span>
<span class="line"><span style="color:#A0ADA0;"> * parentComponent: \u7236\u7EC4\u4EF6, \u521D\u59CB\u6E32\u67D3\u4F20\u5165\u4E86 null</span></span>
<span class="line"><span style="color:#A0ADA0;"> * children: render \u65B9\u6CD5\u4E2D\u7684\u7B2C\u4E00\u4E2A\u53C2\u6570, \u8981\u6E32\u67D3\u7684 ReactElement</span></span>
<span class="line"><span style="color:#A0ADA0;"> * container: \u6E32\u67D3\u5BB9\u5668</span></span>
<span class="line"><span style="color:#A0ADA0;"> * forceHydrate: true \u4E3A\u670D\u52A1\u7AEF\u6E32\u67D3, false \u4E3A\u5BA2\u6237\u7AEF\u6E32\u67D3</span></span>
<span class="line"><span style="color:#A0ADA0;"> * callback: \u7EC4\u4EF6\u6E32\u67D3\u5B8C\u6210\u540E\u9700\u8981\u6267\u884C\u7684\u56DE\u8C03\u51FD\u6570</span></span>
<span class="line"><span style="color:#A0ADA0;"> **/</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">legacyRenderSubtreeIntoContainer</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">parentComponent</span><span style="color:#999999;">: </span><span style="color:#AB5959;">?</span><span style="color:#2E808F;">React$Component</span><span style="color:#999999;">&lt;</span><span style="color:#2E808F;">any</span><span style="color:#999999;">, </span><span style="color:#2E808F;">any</span><span style="color:#999999;">&gt;,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">children</span><span style="color:#999999;">: </span><span style="color:#2E808F;">ReactNodeList</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">container</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Container</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">forceHydrate</span><span style="color:#999999;">: </span><span style="color:#2E808F;">boolean</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">callback</span><span style="color:#999999;">: </span><span style="color:#AB5959;">?</span><span style="color:#2E808F;">Function</span></span>
<span class="line"><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">     * \u68C0\u6D4B container \u662F\u5426\u5DF2\u7ECF\u662F\u521D\u59CB\u5316\u8FC7\u7684\u6E32\u67D3\u5BB9\u5668</span></span>
<span class="line"><span style="color:#A0ADA0;">     * react \u5728\u521D\u59CB\u6E32\u67D3\u65F6\u4F1A\u4E3A\u6700\u5916\u5C42\u5BB9\u5668\u6DFB\u52A0 _reactRootContainer \u5C5E\u6027</span></span>
<span class="line"><span style="color:#A0ADA0;">     * react \u4F1A\u6839\u636E\u6B64\u5C5E\u6027\u8FDB\u884C\u4E0D\u540C\u7684\u6E32\u67D3\u65B9\u5F0F</span></span>
<span class="line"><span style="color:#A0ADA0;">     * root \u4E0D\u5B58\u5728 \u8868\u793A\u521D\u59CB\u6E32\u67D3</span></span>
<span class="line"><span style="color:#A0ADA0;">     * root \u5B58\u5728 \u8868\u793A\u66F4\u65B0</span></span>
<span class="line"><span style="color:#A0ADA0;">     */</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6 container \u5BB9\u5668\u5BF9\u8C61\u4E0B\u662F\u5426\u6709 _reactRootContainer \u5C5E\u6027</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">root</span><span style="color:#999999;">: </span><span style="color:#2E808F;">RootType</span><span style="color:#999999;"> =</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">container</span><span style="color:#999999;">.</span><span style="color:#B07D48;">_reactRootContainer</span><span style="color:#393A34;">: </span><span style="color:#B07D48;">any</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5373\u5C06\u5B58\u50A8\u6839 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">fiberRoot</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#AB5959;">!</span><span style="color:#B07D48;">root</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u521D\u59CB\u5316\u6839 Fiber \u6570\u636E\u7ED3\u6784</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u4E3A container \u5BB9\u5668\u6DFB\u52A0 _reactRootContainer \u5C5E\u6027</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5728 _reactRootContainer \u5BF9\u8C61\u4E2D\u6709\u4E00\u4E2A\u5C5E\u6027\u53EB\u505A _internalRoot</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// _internalRoot \u5C5E\u6027\u503C\u5373\u4E3A FiberRoot \u8868\u793A\u6839\u8282\u70B9 Fiber \u6570\u636E\u7ED3\u6784</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// legacyCreateRootFromDOMContainer</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// createLegacyRoot</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// new ReactDOMBlockingRoot -&gt; this._internalRoot</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// createRootImpl</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">root</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">container</span><span style="color:#999999;">.</span><span style="color:#B07D48;">_reactRootContainer</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">legacyCreateRootFromDOMContainer</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">container</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">forceHydrate</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u83B7\u53D6 Fiber Root \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">fiberRoot</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">root</span><span style="color:#999999;">.</span><span style="color:#B07D48;">_internalRoot</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">         * \u6539\u53D8 callback \u51FD\u6570\u4E2D\u7684 this \u6307\u5411</span></span>
<span class="line"><span style="color:#A0ADA0;">         * \u4F7F\u5176\u6307\u5411 render \u65B9\u6CD5\u7B2C\u4E00\u4E2A\u53C2\u6570\u7684\u771F\u5B9E DOM \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#A0ADA0;">         */</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5982\u679C callback \u53C2\u6570\u662F\u51FD\u6570\u7C7B\u578B</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#AB5959;">typeof</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">callback</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">function</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u4F7F\u7528 originalCallback \u5B58\u50A8 callback \u51FD\u6570</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">originalCallback</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">callback</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u4E3A callback \u53C2\u6570\u91CD\u65B0\u8D4B\u503C</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#59873A;">callback</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u83B7\u53D6 render \u65B9\u6CD5\u7B2C\u4E00\u4E2A\u53C2\u6570\u7684\u771F\u5B9E DOM \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u5B9E\u9645\u4E0A\u5C31\u662F id=&quot;root&quot; \u7684 div \u7684\u5B50\u5143\u7D20</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// rootFiber.child.stateNode</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// rootFiber \u5C31\u662F id=&quot;root&quot; \u7684 div</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">instance</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">getPublicRootInstance</span><span style="color:#999999;">(</span><span style="color:#B07D48;">fiberRoot</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u8C03\u7528 callback \u51FD\u6570\u5E76\u6539\u53D8\u51FD\u6570\u5185\u90E8 this \u6307\u5411</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">originalCallback</span><span style="color:#999999;">.</span><span style="color:#59873A;">call</span><span style="color:#999999;">(</span><span style="color:#B07D48;">instance</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">};</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u521D\u59CB\u5316\u6E32\u67D3\u4E0D\u6267\u884C\u6279\u91CF\u66F4\u65B0</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u56E0\u4E3A\u6279\u91CF\u66F4\u65B0\u662F\u5F02\u6B65\u7684\u662F\u53EF\u4EE5\u88AB\u6253\u65AD\u7684, \u4F46\u662F\u521D\u59CB\u5316\u6E32\u67D3\u5E94\u8BE5\u5C3D\u5FEB\u5B8C\u6210\u4E0D\u80FD\u88AB\u6253\u65AD</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u6240\u4EE5\u4E0D\u6267\u884C\u6279\u91CF\u66F4\u65B0</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">unbatchedUpdates</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#59873A;">updateContainer</span><span style="color:#999999;">(</span><span style="color:#B07D48;">children</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">fiberRoot</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">parentComponent</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">callback</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">});</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u975E\u521D\u59CB\u5316\u6E32\u67D3 \u5373\u66F4\u65B0</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">fiberRoot</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">root</span><span style="color:#999999;">.</span><span style="color:#B07D48;">_internalRoot</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#AB5959;">typeof</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">callback</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">function</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">originalCallback</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">callback</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#59873A;">callback</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">instance</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">getPublicRootInstance</span><span style="color:#999999;">(</span><span style="color:#B07D48;">fiberRoot</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">originalCallback</span><span style="color:#999999;">.</span><span style="color:#59873A;">call</span><span style="color:#999999;">(</span><span style="color:#B07D48;">instance</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">};</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// Update</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">updateContainer</span><span style="color:#999999;">(</span><span style="color:#B07D48;">children</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">fiberRoot</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">parentComponent</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">callback</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u8FD4\u56DE render \u65B9\u6CD5\u7B2C\u4E00\u4E2A\u53C2\u6570\u7684\u771F\u5B9E DOM \u5BF9\u8C61\u4F5C\u4E3A render \u65B9\u6CD5\u7684\u8FD4\u56DE\u503C</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5C31\u662F\u8BF4\u6E32\u67D3\u8C01 \u8FD4\u56DE\u8C01\u7684\u771F\u5B9E DOM \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#59873A;">getPublicRootInstance</span><span style="color:#999999;">(</span><span style="color:#B07D48;">fiberRoot</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><p><img src="`+y+`" alt="3.png"></p><h5 id="_5-1-3-2-legacycreaterootfromdomcontainer" tabindex="-1">5.1.3.2 legacyCreateRootFromDOMContainer <a class="header-anchor" href="#_5-1-3-2-legacycreaterootfromdomcontainer" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-dom/src/client/ReactDOMLegacy.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * \u5224\u65AD\u662F\u5426\u4E3A\u670D\u52A1\u5668\u7AEF\u6E32\u67D3 \u5982\u679C\u4E0D\u662F\u670D\u52A1\u5668\u7AEF\u6E32\u67D3</span></span>
<span class="line"><span style="color:#758575DD;"> * \u6E05\u7A7A container \u5BB9\u5668\u4E2D\u7684\u8282\u70B9</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">legacyCreateRootFromDOMContainer</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">container</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Container</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">forceHydrate</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">boolean</span></span>
<span class="line"><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">RootType</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// container =&gt; &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u68C0\u6D4B\u662F\u5426\u4E3A\u670D\u52A1\u5668\u7AEF\u6E32\u67D3</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">shouldHydrate</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">forceHydrate</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">||</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">shouldHydrateDueToLegacyHeuristic</span><span style="color:#666666;">(</span><span style="color:#BD976A;">container</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C\u4E0D\u662F\u670D\u52A1\u5668\u7AEF\u6E32\u67D3</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#CB7676;">!</span><span style="color:#BD976A;">shouldHydrate</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">rootSibling</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5F00\u542F\u5FAA\u73AF \u5220\u9664 container \u5BB9\u5668\u4E2D\u7684\u8282\u70B9</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">while</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">((</span><span style="color:#BD976A;">rootSibling</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">container</span><span style="color:#666666;">.</span><span style="color:#BD976A;">lastChild</span><span style="color:#666666;">))</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5220\u9664 container \u5BB9\u5668\u4E2D\u7684\u8282\u70B9</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">container</span><span style="color:#666666;">.</span><span style="color:#80A665;">removeChild</span><span style="color:#666666;">(</span><span style="color:#BD976A;">rootSibling</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">             * \u4E3A\u4EC0\u4E48\u8981\u6E05\u9664 container \u4E2D\u7684\u5143\u7D20 ?</span></span>
<span class="line"><span style="color:#758575DD;">             * \u4E3A\u63D0\u4F9B\u9996\u5C4F\u52A0\u8F7D\u7684\u7528\u6237\u4F53\u9A8C, \u6709\u65F6\u9700\u8981\u5728 container \u4E2D\u653E\u7F6E\u4E00\u4E9B\u5360\u4F4D\u56FE\u6216\u8005 loading \u56FE</span></span>
<span class="line"><span style="color:#758575DD;">             * \u5C31\u65E0\u53EF\u907F\u514D\u7684\u8981\u5411 container \u4E2D\u52A0\u5165 html \u6807\u8BB0.</span></span>
<span class="line"><span style="color:#758575DD;">             * \u5728\u5C06 ReactElement \u6E32\u67D3\u5230 container \u4E4B\u524D, \u5FC5\u7136\u8981\u5148\u6E05\u7A7A container</span></span>
<span class="line"><span style="color:#758575DD;">             * \u56E0\u4E3A\u5360\u4F4D\u56FE\u548C ReactElement \u4E0D\u80FD\u540C\u65F6\u663E\u793A</span></span>
<span class="line"><span style="color:#758575DD;">             *</span></span>
<span class="line"><span style="color:#758575DD;">             * \u5728\u52A0\u5165\u5360\u4F4D\u4EE3\u7801\u65F6, \u6700\u597D\u53EA\u6709\u4E00\u4E2A\u7236\u7EA7\u5143\u7D20, \u53EF\u4EE5\u51CF\u5C11\u5185\u90E8\u4EE3\u7801\u7684\u5FAA\u73AF\u6B21\u6570\u4EE5\u63D0\u9AD8\u6027\u80FD</span></span>
<span class="line"><span style="color:#758575DD;">             * &lt;div&gt;</span></span>
<span class="line"><span style="color:#758575DD;">             *  &lt;p&gt;placement&lt;p&gt;</span></span>
<span class="line"><span style="color:#758575DD;">             *  &lt;p&gt;placement&lt;p&gt;</span></span>
<span class="line"><span style="color:#758575DD;">             *  &lt;p&gt;placement&lt;p&gt;</span></span>
<span class="line"><span style="color:#758575DD;">             * &lt;/div&gt;</span></span>
<span class="line"><span style="color:#758575DD;">             */</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">createLegacyRoot</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">container</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">shouldHydrate</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#CB7676;">?</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                  </span><span style="color:#B8A965;">hydrate</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">              </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#CB7676;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">undefined</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u5224\u65AD\u662F\u5426\u4E3A\u670D\u52A1\u5668\u7AEF\u6E32\u67D3 \u5982\u679C\u4E0D\u662F\u670D\u52A1\u5668\u7AEF\u6E32\u67D3</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u6E05\u7A7A container \u5BB9\u5668\u4E2D\u7684\u8282\u70B9</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">legacyCreateRootFromDOMContainer</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">container</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Container</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">forceHydrate</span><span style="color:#999999;">: </span><span style="color:#2E808F;">boolean</span></span>
<span class="line"><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">RootType</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// container =&gt; &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u68C0\u6D4B\u662F\u5426\u4E3A\u670D\u52A1\u5668\u7AEF\u6E32\u67D3</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">shouldHydrate</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">forceHydrate</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">||</span><span style="color:#393A34;"> </span><span style="color:#59873A;">shouldHydrateDueToLegacyHeuristic</span><span style="color:#999999;">(</span><span style="color:#B07D48;">container</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C\u4E0D\u662F\u670D\u52A1\u5668\u7AEF\u6E32\u67D3</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#AB5959;">!</span><span style="color:#B07D48;">shouldHydrate</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">rootSibling</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5F00\u542F\u5FAA\u73AF \u5220\u9664 container \u5BB9\u5668\u4E2D\u7684\u8282\u70B9</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">while</span><span style="color:#393A34;"> </span><span style="color:#999999;">((</span><span style="color:#B07D48;">rootSibling</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">container</span><span style="color:#999999;">.</span><span style="color:#B07D48;">lastChild</span><span style="color:#999999;">))</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5220\u9664 container \u5BB9\u5668\u4E2D\u7684\u8282\u70B9</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">container</span><span style="color:#999999;">.</span><span style="color:#59873A;">removeChild</span><span style="color:#999999;">(</span><span style="color:#B07D48;">rootSibling</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">             * \u4E3A\u4EC0\u4E48\u8981\u6E05\u9664 container \u4E2D\u7684\u5143\u7D20 ?</span></span>
<span class="line"><span style="color:#A0ADA0;">             * \u4E3A\u63D0\u4F9B\u9996\u5C4F\u52A0\u8F7D\u7684\u7528\u6237\u4F53\u9A8C, \u6709\u65F6\u9700\u8981\u5728 container \u4E2D\u653E\u7F6E\u4E00\u4E9B\u5360\u4F4D\u56FE\u6216\u8005 loading \u56FE</span></span>
<span class="line"><span style="color:#A0ADA0;">             * \u5C31\u65E0\u53EF\u907F\u514D\u7684\u8981\u5411 container \u4E2D\u52A0\u5165 html \u6807\u8BB0.</span></span>
<span class="line"><span style="color:#A0ADA0;">             * \u5728\u5C06 ReactElement \u6E32\u67D3\u5230 container \u4E4B\u524D, \u5FC5\u7136\u8981\u5148\u6E05\u7A7A container</span></span>
<span class="line"><span style="color:#A0ADA0;">             * \u56E0\u4E3A\u5360\u4F4D\u56FE\u548C ReactElement \u4E0D\u80FD\u540C\u65F6\u663E\u793A</span></span>
<span class="line"><span style="color:#A0ADA0;">             *</span></span>
<span class="line"><span style="color:#A0ADA0;">             * \u5728\u52A0\u5165\u5360\u4F4D\u4EE3\u7801\u65F6, \u6700\u597D\u53EA\u6709\u4E00\u4E2A\u7236\u7EA7\u5143\u7D20, \u53EF\u4EE5\u51CF\u5C11\u5185\u90E8\u4EE3\u7801\u7684\u5FAA\u73AF\u6B21\u6570\u4EE5\u63D0\u9AD8\u6027\u80FD</span></span>
<span class="line"><span style="color:#A0ADA0;">             * &lt;div&gt;</span></span>
<span class="line"><span style="color:#A0ADA0;">             *  &lt;p&gt;placement&lt;p&gt;</span></span>
<span class="line"><span style="color:#A0ADA0;">             *  &lt;p&gt;placement&lt;p&gt;</span></span>
<span class="line"><span style="color:#A0ADA0;">             *  &lt;p&gt;placement&lt;p&gt;</span></span>
<span class="line"><span style="color:#A0ADA0;">             * &lt;/div&gt;</span></span>
<span class="line"><span style="color:#A0ADA0;">             */</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#59873A;">createLegacyRoot</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">container</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">shouldHydrate</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#AB5959;">?</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">                  </span><span style="color:#998418;">hydrate</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">              </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#AB5959;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">undefined</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-1-3-3-createlegacyroot" tabindex="-1">5.1.3.3 createLegacyRoot <a class="header-anchor" href="#_5-1-3-3-createlegacyroot" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-dom/src/client/ReactDOMRoot.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * \u901A\u8FC7\u5B9E\u4F8B\u5316 ReactDOMBlockingRoot \u7C7B\u521B\u5EFA LegacyRoot</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">createLegacyRoot</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">container</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Container</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">options</span><span style="color:#CB7676;">?</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">RootOptions</span></span>
<span class="line"><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">RootType</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// container =&gt; &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// LegacyRoot \u5E38\u91CF, \u503C\u4E3A 0,</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u901A\u8FC7 render \u65B9\u6CD5\u521B\u5EFA\u7684 container \u5C31\u662F LegacyRoot</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">ReactDOMBlockingRoot</span><span style="color:#666666;">(</span><span style="color:#BD976A;">container</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">LegacyRoot</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">options</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u901A\u8FC7\u5B9E\u4F8B\u5316 ReactDOMBlockingRoot \u7C7B\u521B\u5EFA LegacyRoot</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">createLegacyRoot</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">container</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Container</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">options</span><span style="color:#AB5959;">?</span><span style="color:#999999;">: </span><span style="color:#2E808F;">RootOptions</span></span>
<span class="line"><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">RootType</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// container =&gt; &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// LegacyRoot \u5E38\u91CF, \u503C\u4E3A 0,</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u901A\u8FC7 render \u65B9\u6CD5\u521B\u5EFA\u7684 container \u5C31\u662F LegacyRoot</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">ReactDOMBlockingRoot</span><span style="color:#999999;">(</span><span style="color:#B07D48;">container</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">LegacyRoot</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">options</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-1-3-3-reactdomblockingroot" tabindex="-1">5.1.3.3 ReactDOMBlockingRoot <a class="header-anchor" href="#_5-1-3-3-reactdomblockingroot" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-dom/src/client/ReactDOMRoot.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * \u7C7B, \u901A\u8FC7\u5B83\u53EF\u4EE5\u521B\u5EFA LegacyRoot \u7684 Fiber \u6570\u636E\u7ED3\u6784</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">ReactDOMBlockingRoot</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">container</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Container</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">tag</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">RootTag</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">options</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">void</span><span style="color:#666666;"> | </span><span style="color:#5DA9A7;">RootOptions</span></span>
<span class="line"><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// tag =&gt; 0 =&gt; legacyRoot</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// container =&gt; &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// container._reactRootContainer = {_internalRoot: {}}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">_internalRoot</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">createRootImpl</span><span style="color:#666666;">(</span><span style="color:#BD976A;">container</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">tag</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">options</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u7C7B, \u901A\u8FC7\u5B83\u53EF\u4EE5\u521B\u5EFA LegacyRoot \u7684 Fiber \u6570\u636E\u7ED3\u6784</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">ReactDOMBlockingRoot</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">container</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Container</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">tag</span><span style="color:#999999;">: </span><span style="color:#2E808F;">RootTag</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">options</span><span style="color:#999999;">: </span><span style="color:#2E808F;">void</span><span style="color:#999999;"> | </span><span style="color:#2E808F;">RootOptions</span></span>
<span class="line"><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// tag =&gt; 0 =&gt; legacyRoot</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// container =&gt; &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// container._reactRootContainer = {_internalRoot: {}}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">_internalRoot</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">createRootImpl</span><span style="color:#999999;">(</span><span style="color:#B07D48;">container</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">tag</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">options</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-1-3-4-createrootimpl" tabindex="-1">5.1.3.4 createRootImpl <a class="header-anchor" href="#_5-1-3-4-createrootimpl" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-dom/src/client/ReactDOMRoot.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">createRootImpl</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">container</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Container</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">tag</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">RootTag</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">options</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">void</span><span style="color:#666666;"> | </span><span style="color:#5DA9A7;">RootOptions</span></span>
<span class="line"><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// container =&gt; &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// tag =&gt; 0</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// options =&gt; undefined</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">root</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">createContainer</span><span style="color:#666666;">(</span><span style="color:#BD976A;">container</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">tag</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">hydrate</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">hydrationCallbacks</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">markContainerAsRoot</span><span style="color:#666666;">(</span><span style="color:#BD976A;">root</span><span style="color:#666666;">.</span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">container</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">root</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">createRootImpl</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">container</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Container</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">tag</span><span style="color:#999999;">: </span><span style="color:#2E808F;">RootTag</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">options</span><span style="color:#999999;">: </span><span style="color:#2E808F;">void</span><span style="color:#999999;"> | </span><span style="color:#2E808F;">RootOptions</span></span>
<span class="line"><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// container =&gt; &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// tag =&gt; 0</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// options =&gt; undefined</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">root</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">createContainer</span><span style="color:#999999;">(</span><span style="color:#B07D48;">container</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">tag</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">hydrate</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">hydrationCallbacks</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">markContainerAsRoot</span><span style="color:#999999;">(</span><span style="color:#B07D48;">root</span><span style="color:#999999;">.</span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">container</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">root</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-1-3-5-createcontainer" tabindex="-1">5.1.3.5 createContainer <a class="header-anchor" href="#_5-1-3-5-createcontainer" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberReconciler.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// \u521B\u5EFA container</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">createContainer</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">containerInfo</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Container</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">tag</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">RootTag</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">hydrate</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">boolean</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">hydrationCallbacks</span><span style="color:#666666;">: </span><span style="color:#CB7676;">null</span><span style="color:#666666;"> | </span><span style="color:#5DA9A7;">SuspenseHydrationCallbacks</span></span>
<span class="line"><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">OpaqueRoot</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// containerInfo =&gt; &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// tag: 0</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// hydrate: false</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// hydrationCallbacks: null</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5FFD\u7565\u4E86\u548C\u670D\u52A1\u5668\u7AEF\u6E32\u67D3\u76F8\u5173\u7684\u5185\u5BB9</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">createFiberRoot</span><span style="color:#666666;">(</span><span style="color:#BD976A;">containerInfo</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">tag</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">hydrate</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">hydrationCallbacks</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// \u521B\u5EFA container</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">createContainer</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">containerInfo</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Container</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">tag</span><span style="color:#999999;">: </span><span style="color:#2E808F;">RootTag</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">hydrate</span><span style="color:#999999;">: </span><span style="color:#2E808F;">boolean</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">hydrationCallbacks</span><span style="color:#999999;">: </span><span style="color:#AB5959;">null</span><span style="color:#999999;"> | </span><span style="color:#2E808F;">SuspenseHydrationCallbacks</span></span>
<span class="line"><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">OpaqueRoot</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// containerInfo =&gt; &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// tag: 0</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// hydrate: false</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// hydrationCallbacks: null</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5FFD\u7565\u4E86\u548C\u670D\u52A1\u5668\u7AEF\u6E32\u67D3\u76F8\u5173\u7684\u5185\u5BB9</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#59873A;">createFiberRoot</span><span style="color:#999999;">(</span><span style="color:#B07D48;">containerInfo</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">tag</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">hydrate</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">hydrationCallbacks</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-1-3-6-createfiberroot" tabindex="-1">5.1.3.6 createFiberRoot <a class="header-anchor" href="#_5-1-3-6-createfiberroot" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberRoot.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// \u521B\u5EFA\u6839\u8282\u70B9\u5BF9\u5E94\u7684 fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">createFiberRoot</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">containerInfo</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">any</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">tag</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">RootTag</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">hydrate</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">boolean</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">hydrationCallbacks</span><span style="color:#666666;">: </span><span style="color:#CB7676;">null</span><span style="color:#666666;"> | </span><span style="color:#5DA9A7;">SuspenseHydrationCallbacks</span></span>
<span class="line"><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">FiberRoot</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u521B\u5EFA FiberRoot</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">root</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">FiberRoot</span><span style="color:#666666;"> =</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">FiberRootNode</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">containerInfo</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">tag</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">hydrate</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;">: </span><span style="color:#BD976A;">any</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u521B\u5EFA\u6839\u8282\u70B9\u5BF9\u5E94\u7684 rootFiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">uninitializedFiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">createHostRootFiber</span><span style="color:#666666;">(</span><span style="color:#BD976A;">tag</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u4E3A fiberRoot \u6DFB\u52A0 current \u5C5E\u6027 \u503C\u4E3A rootFiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">root</span><span style="color:#666666;">.</span><span style="color:#BD976A;">current</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">uninitializedFiber</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u4E3A rootFiber \u6DFB\u52A0 stateNode \u5C5E\u6027 \u503C\u4E3A fiberRoot</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">uninitializedFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">stateNode</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">root</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u4E3A fiber \u5BF9\u8C61\u6DFB\u52A0 updateQueue \u5C5E\u6027, \u521D\u59CB\u5316 updateQueue \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// updateQueue \u7528\u4E8E\u5B58\u653E Update \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// Update \u5BF9\u8C61\u7528\u4E8E\u8BB0\u5F55\u7EC4\u4EF6\u72B6\u6001\u7684\u6539\u53D8</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">initializeUpdateQueue</span><span style="color:#666666;">(</span><span style="color:#BD976A;">uninitializedFiber</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u8FD4\u56DE root</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">root</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// \u521B\u5EFA\u6839\u8282\u70B9\u5BF9\u5E94\u7684 fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">createFiberRoot</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">containerInfo</span><span style="color:#999999;">: </span><span style="color:#2E808F;">any</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">tag</span><span style="color:#999999;">: </span><span style="color:#2E808F;">RootTag</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">hydrate</span><span style="color:#999999;">: </span><span style="color:#2E808F;">boolean</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">hydrationCallbacks</span><span style="color:#999999;">: </span><span style="color:#AB5959;">null</span><span style="color:#999999;"> | </span><span style="color:#2E808F;">SuspenseHydrationCallbacks</span></span>
<span class="line"><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">FiberRoot</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u521B\u5EFA FiberRoot</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">root</span><span style="color:#999999;">: </span><span style="color:#2E808F;">FiberRoot</span><span style="color:#999999;"> =</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">FiberRootNode</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">containerInfo</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">tag</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">hydrate</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">)</span><span style="color:#393A34;">: </span><span style="color:#B07D48;">any</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u521B\u5EFA\u6839\u8282\u70B9\u5BF9\u5E94\u7684 rootFiber</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">uninitializedFiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">createHostRootFiber</span><span style="color:#999999;">(</span><span style="color:#B07D48;">tag</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u4E3A fiberRoot \u6DFB\u52A0 current \u5C5E\u6027 \u503C\u4E3A rootFiber</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">root</span><span style="color:#999999;">.</span><span style="color:#B07D48;">current</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">uninitializedFiber</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u4E3A rootFiber \u6DFB\u52A0 stateNode \u5C5E\u6027 \u503C\u4E3A fiberRoot</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">uninitializedFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">stateNode</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">root</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u4E3A fiber \u5BF9\u8C61\u6DFB\u52A0 updateQueue \u5C5E\u6027, \u521D\u59CB\u5316 updateQueue \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// updateQueue \u7528\u4E8E\u5B58\u653E Update \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// Update \u5BF9\u8C61\u7528\u4E8E\u8BB0\u5F55\u7EC4\u4EF6\u72B6\u6001\u7684\u6539\u53D8</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">initializeUpdateQueue</span><span style="color:#999999;">(</span><span style="color:#B07D48;">uninitializedFiber</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u8FD4\u56DE root</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">root</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-1-3-7-fiberrootnode" tabindex="-1">5.1.3.7 FiberRootNode <a class="header-anchor" href="#_5-1-3-7-fiberrootnode" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberRoot.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">FiberRootNode</span><span style="color:#666666;">(</span><span style="color:#BD976A;">containerInfo</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">tag</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">hydrate</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">tag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">tag</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">current</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">containerInfo</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">containerInfo</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">pendingChildren</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">pingCache</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">finishedExpirationTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoWork</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">finishedWork</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">timeoutHandle</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">noTimeout</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">context</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">pendingContext</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">hydrate</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">hydrate</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">callbackNode</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">callbackPriority</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoPriority</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">firstPendingTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoWork</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">firstSuspendedTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoWork</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">lastSuspendedTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoWork</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">nextKnownPendingLevel</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoWork</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">lastPingedTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoWork</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">lastExpiredTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoWork</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">enableSchedulerTracing</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">interactionThreadID</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">unstable_getThreadID</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">memoizedInteractions</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">Set</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">pendingInteractionMap</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">Map</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">enableSuspenseCallback</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#C99076;">this</span><span style="color:#666666;">.</span><span style="color:#BD976A;">hydrationCallbacks</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">FiberRootNode</span><span style="color:#999999;">(</span><span style="color:#B07D48;">containerInfo</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">tag</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">hydrate</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">tag</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">tag</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">current</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">containerInfo</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">containerInfo</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">pendingChildren</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">pingCache</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">finishedExpirationTime</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoWork</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">finishedWork</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">timeoutHandle</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">noTimeout</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">context</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">pendingContext</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">hydrate</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">hydrate</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">callbackNode</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">callbackPriority</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoPriority</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">firstPendingTime</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoWork</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">firstSuspendedTime</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoWork</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">lastSuspendedTime</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoWork</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">nextKnownPendingLevel</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoWork</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">lastPingedTime</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoWork</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">lastExpiredTime</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoWork</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">enableSchedulerTracing</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">interactionThreadID</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">unstable_getThreadID</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">memoizedInteractions</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">Set</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">pendingInteractionMap</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">Map</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">enableSuspenseCallback</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#A65E2B;">this</span><span style="color:#999999;">.</span><span style="color:#B07D48;">hydrationCallbacks</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-3-1-8-initializeupdatequeue" tabindex="-1">5.3.1.8 initializeUpdateQueue <a class="header-anchor" href="#_5-3-1-8-initializeupdatequeue" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberRoot.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">initializeUpdateQueue</span><span style="color:#666666;">&lt;</span><span style="color:#5DA9A7;">State</span><span style="color:#666666;">&gt;(</span><span style="color:#BD976A;">fiber</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">void</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">queue</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">UpdateQueue</span><span style="color:#666666;">&lt;</span><span style="color:#5DA9A7;">State</span><span style="color:#666666;">&gt; =</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">baseState</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">fiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">memoizedState</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">baseQueue</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">shared</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#B8A965;">pending</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">effects</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">};</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">fiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">updateQueue</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">queue</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">initializeUpdateQueue</span><span style="color:#999999;">&lt;</span><span style="color:#2E808F;">State</span><span style="color:#999999;">&gt;(</span><span style="color:#B07D48;">fiber</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">void</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">queue</span><span style="color:#999999;">: </span><span style="color:#2E808F;">UpdateQueue</span><span style="color:#999999;">&lt;</span><span style="color:#2E808F;">State</span><span style="color:#999999;">&gt; =</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">baseState</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">fiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">memoizedState</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">baseQueue</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">shared</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#998418;">pending</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">effects</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">};</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">fiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">updateQueue</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">queue</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="_5-1-4-\u83B7\u53D6-rootfiber-child-\u5B9E\u4F8B\u5BF9\u8C61" tabindex="-1">5.1.4 \u83B7\u53D6 rootFiber.child \u5B9E\u4F8B\u5BF9\u8C61 <a class="header-anchor" href="#_5-1-4-\u83B7\u53D6-rootfiber-child-\u5B9E\u4F8B\u5BF9\u8C61" aria-hidden="true">#</a></h4><h5 id="_5-1-4-1-getpublicrootinstance" tabindex="-1">5.1.4.1 getPublicRootInstance <a class="header-anchor" href="#_5-1-4-1-getpublicrootinstance" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberReconciler.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * \u83B7\u53D6 container \u7684\u7B2C\u4E00\u4E2A\u5B50\u5143\u7D20\u7684\u5B9E\u4F8B\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">getPublicRootInstance</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// FiberRoot</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">container</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">OpaqueRoot</span></span>
<span class="line"><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">React$Component</span><span style="color:#666666;">&lt;</span><span style="color:#5DA9A7;">any</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">any</span><span style="color:#666666;">&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">PublicInstance</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6 rootFiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">containerFiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">container</span><span style="color:#666666;">.</span><span style="color:#BD976A;">current</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C rootFiber \u6CA1\u6709\u5B50\u5143\u7D20</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u6307\u7684\u5C31\u662F id=&quot;root&quot; \u7684 div \u6CA1\u6709\u5B50\u5143\u7D20</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#CB7676;">!</span><span style="color:#BD976A;">containerFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">child</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u8FD4\u56DE null</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5339\u914D\u5B50\u5143\u7D20\u7684\u7C7B\u578B</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">switch</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">containerFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">child</span><span style="color:#666666;">.</span><span style="color:#BD976A;">tag</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u666E\u901A</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostComponent</span><span style="color:#666666;">:</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">getPublicInstance</span><span style="color:#666666;">(</span><span style="color:#BD976A;">containerFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">child</span><span style="color:#666666;">.</span><span style="color:#BD976A;">stateNode</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">default</span><span style="color:#666666;">:</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u8FD4\u56DE\u5B50\u5143\u7D20\u7684\u771F\u5B9E DOM \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">containerFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">child</span><span style="color:#666666;">.</span><span style="color:#BD976A;">stateNode</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u83B7\u53D6 container \u7684\u7B2C\u4E00\u4E2A\u5B50\u5143\u7D20\u7684\u5B9E\u4F8B\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">getPublicRootInstance</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// FiberRoot</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">container</span><span style="color:#999999;">: </span><span style="color:#2E808F;">OpaqueRoot</span></span>
<span class="line"><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">React$Component</span><span style="color:#999999;">&lt;</span><span style="color:#2E808F;">any</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">any</span><span style="color:#999999;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">PublicInstance</span><span style="color:#393A34;"> </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6 rootFiber</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">containerFiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">container</span><span style="color:#999999;">.</span><span style="color:#B07D48;">current</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C rootFiber \u6CA1\u6709\u5B50\u5143\u7D20</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u6307\u7684\u5C31\u662F id=&quot;root&quot; \u7684 div \u6CA1\u6709\u5B50\u5143\u7D20</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#AB5959;">!</span><span style="color:#B07D48;">containerFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">child</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u8FD4\u56DE null</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5339\u914D\u5B50\u5143\u7D20\u7684\u7C7B\u578B</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">switch</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">containerFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">child</span><span style="color:#999999;">.</span><span style="color:#B07D48;">tag</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u666E\u901A</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostComponent</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#59873A;">getPublicInstance</span><span style="color:#999999;">(</span><span style="color:#B07D48;">containerFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">child</span><span style="color:#999999;">.</span><span style="color:#B07D48;">stateNode</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">default</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u8FD4\u56DE\u5B50\u5143\u7D20\u7684\u771F\u5B9E DOM \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">containerFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">child</span><span style="color:#999999;">.</span><span style="color:#B07D48;">stateNode</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-1-4-2-getpublicinstance" tabindex="-1">5.1.4.2 getPublicInstance <a class="header-anchor" href="#_5-1-4-2-getpublicinstance" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-dom/src/client/ReactDOMHostConfig.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">getPublicInstance</span><span style="color:#666666;">(</span><span style="color:#BD976A;">instance</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Instance</span><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> * </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">instance</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">getPublicInstance</span><span style="color:#999999;">(</span><span style="color:#B07D48;">instance</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Instance</span><span style="color:#999999;">):</span><span style="color:#393A34;"> * </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">instance</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="_5-1-5-updatecontainer" tabindex="-1">5.1.5 updateContainer <a class="header-anchor" href="#_5-1-5-updatecontainer" aria-hidden="true">#</a></h4><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberReconciler.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * \u8BA1\u7B97\u4EFB\u52A1\u7684\u8FC7\u671F\u65F6\u95F4</span></span>
<span class="line"><span style="color:#758575DD;"> * \u518D\u6839\u636E\u4EFB\u52A1\u8FC7\u671F\u65F6\u95F4\u521B\u5EFA Update \u4EFB\u52A1</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">updateContainer</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// element \u8981\u6E32\u67D3\u7684 ReactElement</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">element</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">ReactNodeList</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// container Fiber Root \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">container</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">OpaqueRoot</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// parentComponent \u7236\u7EC4\u4EF6 \u521D\u59CB\u6E32\u67D3\u4E3A null</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">parentComponent</span><span style="color:#666666;">: </span><span style="color:#CB7676;">?</span><span style="color:#5DA9A7;">React$Component</span><span style="color:#666666;">&lt;</span><span style="color:#5DA9A7;">any</span><span style="color:#666666;">, </span><span style="color:#5DA9A7;">any</span><span style="color:#666666;">&gt;,</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// ReactElement \u6E32\u67D3\u5B8C\u6210\u6267\u884C\u7684\u56DE\u8C03\u51FD\u6570</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">callback</span><span style="color:#666666;">: </span><span style="color:#CB7676;">?</span><span style="color:#5DA9A7;">Function</span></span>
<span class="line"><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">ExpirationTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// container \u83B7\u53D6 rootFiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">container</span><span style="color:#666666;">.</span><span style="color:#BD976A;">current</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6\u5F53\u524D\u8DDD\u79BB react \u5E94\u7528\u521D\u59CB\u5316\u7684\u65F6\u95F4 1073741805</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">currentTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">requestCurrentTimeForUpdate</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5F02\u6B65\u52A0\u8F7D\u8BBE\u7F6E</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">suspenseConfig</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">requestCurrentSuspenseConfig</span><span style="color:#666666;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u8BA1\u7B97\u8FC7\u671F\u65F6\u95F4</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u4E3A\u9632\u6B62\u4EFB\u52A1\u56E0\u4E3A\u4F18\u5148\u7EA7\u7684\u539F\u56E0\u4E00\u76F4\u88AB\u6253\u65AD\u800C\u672A\u80FD\u6267\u884C</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// react \u4F1A\u8BBE\u7F6E\u4E00\u4E2A\u8FC7\u671F\u65F6\u95F4, \u5F53\u65F6\u95F4\u5230\u4E86\u8FC7\u671F\u65F6\u95F4\u7684\u65F6\u5019</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C\u4EFB\u52A1\u8FD8\u672A\u6267\u884C\u7684\u8BDD, react \u5C06\u4F1A\u5F3A\u5236\u6267\u884C\u8BE5\u4EFB\u52A1</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u521D\u59CB\u5316\u6E32\u67D3\u65F6, \u4EFB\u52A1\u540C\u6B65\u6267\u884C\u4E0D\u6D89\u53CA\u88AB\u6253\u65AD\u7684\u95EE\u9898 1073741823</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">expirationTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">computeExpirationForFiber</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">currentTime</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">suspenseConfig</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u8BBE\u7F6EFiberRoot.context, \u9996\u6B21\u6267\u884C\u8FD4\u56DE\u4E00\u4E2AemptyContext, \u662F\u4E00\u4E2A {}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">context</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">getContextForSubtree</span><span style="color:#666666;">(</span><span style="color:#BD976A;">parentComponent</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3\u65F6 Fiber Root \u5BF9\u8C61\u4E2D\u7684 context \u5C5E\u6027\u503C\u4E3A null</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u6240\u4EE5\u4F1A\u8FDB\u5165\u5230 if \u4E2D</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">container</span><span style="color:#666666;">.</span><span style="color:#BD976A;">context</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3\u65F6\u5C06 context \u5C5E\u6027\u503C\u8BBE\u7F6E\u4E3A {}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">container</span><span style="color:#666666;">.</span><span style="color:#BD976A;">context</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">context</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">container</span><span style="color:#666666;">.</span><span style="color:#BD976A;">pendingContext</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">context</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u521B\u5EFA\u4E00\u4E2A\u5F85\u6267\u884C\u4EFB\u52A1</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">update</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">createUpdate</span><span style="color:#666666;">(</span><span style="color:#BD976A;">expirationTime</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">suspenseConfig</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5C06\u8981\u66F4\u65B0\u7684\u5185\u5BB9\u6302\u8F7D\u5230\u66F4\u65B0\u5BF9\u8C61\u4E2D\u7684 payload \u4E2D</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5C06\u8981\u66F4\u65B0\u7684\u7EC4\u4EF6\u5B58\u50A8\u5728 payload \u5BF9\u8C61\u4E2D, \u65B9\u4FBF\u540E\u671F\u83B7\u53D6</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">update</span><span style="color:#666666;">.</span><span style="color:#BD976A;">payload</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">element</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">};</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5224\u65AD callback \u662F\u5426\u5B58\u5728</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">callback</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">callback</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">undefined</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">?</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">callback</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C callback \u5B58\u5728</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">callback</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5C06 callback \u6302\u8F7D\u5230 update \u5BF9\u8C61\u4E2D</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5176\u5B9E\u5C31\u662F\u4E00\u5C42\u5C42\u4F20\u9012 \u65B9\u4FBF ReactElement \u5143\u7D20\u6E32\u67D3\u5B8C\u6210\u8C03\u7528</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u56DE\u8C03\u51FD\u6570\u6267\u884C\u5B8C\u6210\u540E\u4F1A\u88AB\u6E05\u9664 \u53EF\u4EE5\u5728\u4EE3\u7801\u7684\u540E\u9762\u52A0\u4E0A return \u8FDB\u884C\u9A8C\u8BC1</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">update</span><span style="color:#666666;">.</span><span style="color:#BD976A;">callback</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">callback</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5C06 update \u5BF9\u8C61\u52A0\u5165\u5230\u5F53\u524D Fiber \u7684\u66F4\u65B0\u961F\u5217\u5F53\u4E2D (updateQueue)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">enqueueUpdate</span><span style="color:#666666;">(</span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">update</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u8C03\u5EA6\u548C\u66F4\u65B0 current \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">scheduleWork</span><span style="color:#666666;">(</span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">expirationTime</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u8FD4\u56DE\u8FC7\u671F\u65F6\u95F4</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">expirationTime</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u8BA1\u7B97\u4EFB\u52A1\u7684\u8FC7\u671F\u65F6\u95F4</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u518D\u6839\u636E\u4EFB\u52A1\u8FC7\u671F\u65F6\u95F4\u521B\u5EFA Update \u4EFB\u52A1</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">updateContainer</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// element \u8981\u6E32\u67D3\u7684 ReactElement</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">element</span><span style="color:#999999;">: </span><span style="color:#2E808F;">ReactNodeList</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// container Fiber Root \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">container</span><span style="color:#999999;">: </span><span style="color:#2E808F;">OpaqueRoot</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// parentComponent \u7236\u7EC4\u4EF6 \u521D\u59CB\u6E32\u67D3\u4E3A null</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">parentComponent</span><span style="color:#999999;">: </span><span style="color:#AB5959;">?</span><span style="color:#2E808F;">React$Component</span><span style="color:#999999;">&lt;</span><span style="color:#2E808F;">any</span><span style="color:#999999;">, </span><span style="color:#2E808F;">any</span><span style="color:#999999;">&gt;,</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// ReactElement \u6E32\u67D3\u5B8C\u6210\u6267\u884C\u7684\u56DE\u8C03\u51FD\u6570</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">callback</span><span style="color:#999999;">: </span><span style="color:#AB5959;">?</span><span style="color:#2E808F;">Function</span></span>
<span class="line"><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">ExpirationTime</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// container \u83B7\u53D6 rootFiber</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">container</span><span style="color:#999999;">.</span><span style="color:#B07D48;">current</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u5F53\u524D\u8DDD\u79BB react \u5E94\u7528\u521D\u59CB\u5316\u7684\u65F6\u95F4 1073741805</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">currentTime</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">requestCurrentTimeForUpdate</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5F02\u6B65\u52A0\u8F7D\u8BBE\u7F6E</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">suspenseConfig</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">requestCurrentSuspenseConfig</span><span style="color:#999999;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u8BA1\u7B97\u8FC7\u671F\u65F6\u95F4</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u4E3A\u9632\u6B62\u4EFB\u52A1\u56E0\u4E3A\u4F18\u5148\u7EA7\u7684\u539F\u56E0\u4E00\u76F4\u88AB\u6253\u65AD\u800C\u672A\u80FD\u6267\u884C</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// react \u4F1A\u8BBE\u7F6E\u4E00\u4E2A\u8FC7\u671F\u65F6\u95F4, \u5F53\u65F6\u95F4\u5230\u4E86\u8FC7\u671F\u65F6\u95F4\u7684\u65F6\u5019</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C\u4EFB\u52A1\u8FD8\u672A\u6267\u884C\u7684\u8BDD, react \u5C06\u4F1A\u5F3A\u5236\u6267\u884C\u8BE5\u4EFB\u52A1</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u521D\u59CB\u5316\u6E32\u67D3\u65F6, \u4EFB\u52A1\u540C\u6B65\u6267\u884C\u4E0D\u6D89\u53CA\u88AB\u6253\u65AD\u7684\u95EE\u9898 1073741823</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">expirationTime</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">computeExpirationForFiber</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">currentTime</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">suspenseConfig</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u8BBE\u7F6EFiberRoot.context, \u9996\u6B21\u6267\u884C\u8FD4\u56DE\u4E00\u4E2AemptyContext, \u662F\u4E00\u4E2A {}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">context</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">getContextForSubtree</span><span style="color:#999999;">(</span><span style="color:#B07D48;">parentComponent</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3\u65F6 Fiber Root \u5BF9\u8C61\u4E2D\u7684 context \u5C5E\u6027\u503C\u4E3A null</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u6240\u4EE5\u4F1A\u8FDB\u5165\u5230 if \u4E2D</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">container</span><span style="color:#999999;">.</span><span style="color:#B07D48;">context</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3\u65F6\u5C06 context \u5C5E\u6027\u503C\u8BBE\u7F6E\u4E3A {}</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">container</span><span style="color:#999999;">.</span><span style="color:#B07D48;">context</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">context</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">container</span><span style="color:#999999;">.</span><span style="color:#B07D48;">pendingContext</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">context</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u521B\u5EFA\u4E00\u4E2A\u5F85\u6267\u884C\u4EFB\u52A1</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">update</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">createUpdate</span><span style="color:#999999;">(</span><span style="color:#B07D48;">expirationTime</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">suspenseConfig</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5C06\u8981\u66F4\u65B0\u7684\u5185\u5BB9\u6302\u8F7D\u5230\u66F4\u65B0\u5BF9\u8C61\u4E2D\u7684 payload \u4E2D</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5C06\u8981\u66F4\u65B0\u7684\u7EC4\u4EF6\u5B58\u50A8\u5728 payload \u5BF9\u8C61\u4E2D, \u65B9\u4FBF\u540E\u671F\u83B7\u53D6</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">update</span><span style="color:#999999;">.</span><span style="color:#B07D48;">payload</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">element</span><span style="color:#393A34;"> </span><span style="color:#999999;">};</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5224\u65AD callback \u662F\u5426\u5B58\u5728</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">callback</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">callback</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">undefined</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">?</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">callback</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C callback \u5B58\u5728</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">callback</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5C06 callback \u6302\u8F7D\u5230 update \u5BF9\u8C61\u4E2D</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5176\u5B9E\u5C31\u662F\u4E00\u5C42\u5C42\u4F20\u9012 \u65B9\u4FBF ReactElement \u5143\u7D20\u6E32\u67D3\u5B8C\u6210\u8C03\u7528</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u56DE\u8C03\u51FD\u6570\u6267\u884C\u5B8C\u6210\u540E\u4F1A\u88AB\u6E05\u9664 \u53EF\u4EE5\u5728\u4EE3\u7801\u7684\u540E\u9762\u52A0\u4E0A return \u8FDB\u884C\u9A8C\u8BC1</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">update</span><span style="color:#999999;">.</span><span style="color:#B07D48;">callback</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">callback</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5C06 update \u5BF9\u8C61\u52A0\u5165\u5230\u5F53\u524D Fiber \u7684\u66F4\u65B0\u961F\u5217\u5F53\u4E2D (updateQueue)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">enqueueUpdate</span><span style="color:#999999;">(</span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">update</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u8C03\u5EA6\u548C\u66F4\u65B0 current \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">scheduleWork</span><span style="color:#999999;">(</span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">expirationTime</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u8FD4\u56DE\u8FC7\u671F\u65F6\u95F4</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">expirationTime</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="_5-1-6-enqueueupdate" tabindex="-1">5.1.6 enqueueUpdate <a class="header-anchor" href="#_5-1-6-enqueueupdate" aria-hidden="true">#</a></h4><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactUpdateQueue.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// \u5C06\u4EFB\u52A1(Update)\u5B58\u653E\u4E8E\u4EFB\u52A1\u961F\u5217(updateQueue)\u4E2D</span></span>
<span class="line"><span style="color:#758575DD;">// \u521B\u5EFA\u5355\u5411\u94FE\u8868\u7ED3\u6784\u5B58\u653E update, next \u7528\u6765\u4E32\u8054 update</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">enqueueUpdate</span><span style="color:#666666;">&lt;</span><span style="color:#5DA9A7;">State</span><span style="color:#666666;">&gt;(</span><span style="color:#BD976A;">fiber</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">update</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Update</span><span style="color:#666666;">&lt;</span><span style="color:#5DA9A7;">State</span><span style="color:#666666;">&gt;)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6\u5F53\u524D Fiber \u7684 \u66F4\u65B0\u961F\u5217</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">updateQueue</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">fiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">updateQueue</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C\u66F4\u65B0\u961F\u5217\u4E0D\u5B58\u5728 \u5C31\u8FD4\u56DE null</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">updateQueue</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u4EC5\u53D1\u751F\u5728 fiber \u5DF2\u7ECF\u88AB\u5378\u8F7D</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">return</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6\u5F85\u6267\u884C\u7684 Update \u4EFB\u52A1</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3\u65F6\u6CA1\u6709\u5F85\u6267\u884C\u7684\u4EFB\u52A1</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">sharedQueue</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">updateQueue</span><span style="color:#666666;">.</span><span style="color:#BD976A;">shared</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">pending</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">sharedQueue</span><span style="color:#666666;">.</span><span style="color:#BD976A;">pending</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C\u6CA1\u6709\u5F85\u6267\u884C\u7684 Update \u4EFB\u52A1</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">pending</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u8FD9\u662F\u7B2C\u4E00\u6B21\u66F4\u65B0, \u521B\u5EFA\u4E00\u4E2A\u5FAA\u73AF\u5217\u8868.</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">update</span><span style="color:#666666;">.</span><span style="color:#BD976A;">next</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">update</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">update</span><span style="color:#666666;">.</span><span style="color:#BD976A;">next</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">pending</span><span style="color:#666666;">.</span><span style="color:#BD976A;">next</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">pending</span><span style="color:#666666;">.</span><span style="color:#BD976A;">next</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">update</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5C06 Update \u4EFB\u52A1\u5B58\u50A8\u5728 pending \u5C5E\u6027\u4E2D</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">sharedQueue</span><span style="color:#666666;">.</span><span style="color:#BD976A;">pending</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">update</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// \u5C06\u4EFB\u52A1(Update)\u5B58\u653E\u4E8E\u4EFB\u52A1\u961F\u5217(updateQueue)\u4E2D</span></span>
<span class="line"><span style="color:#A0ADA0;">// \u521B\u5EFA\u5355\u5411\u94FE\u8868\u7ED3\u6784\u5B58\u653E update, next \u7528\u6765\u4E32\u8054 update</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">enqueueUpdate</span><span style="color:#999999;">&lt;</span><span style="color:#2E808F;">State</span><span style="color:#999999;">&gt;(</span><span style="color:#B07D48;">fiber</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">update</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Update</span><span style="color:#999999;">&lt;</span><span style="color:#2E808F;">State</span><span style="color:#999999;">&gt;)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u5F53\u524D Fiber \u7684 \u66F4\u65B0\u961F\u5217</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">updateQueue</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">fiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">updateQueue</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C\u66F4\u65B0\u961F\u5217\u4E0D\u5B58\u5728 \u5C31\u8FD4\u56DE null</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">updateQueue</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u4EC5\u53D1\u751F\u5728 fiber \u5DF2\u7ECF\u88AB\u5378\u8F7D</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">return</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u5F85\u6267\u884C\u7684 Update \u4EFB\u52A1</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3\u65F6\u6CA1\u6709\u5F85\u6267\u884C\u7684\u4EFB\u52A1</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">sharedQueue</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">updateQueue</span><span style="color:#999999;">.</span><span style="color:#B07D48;">shared</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">pending</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">sharedQueue</span><span style="color:#999999;">.</span><span style="color:#B07D48;">pending</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C\u6CA1\u6709\u5F85\u6267\u884C\u7684 Update \u4EFB\u52A1</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">pending</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u8FD9\u662F\u7B2C\u4E00\u6B21\u66F4\u65B0, \u521B\u5EFA\u4E00\u4E2A\u5FAA\u73AF\u5217\u8868.</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">update</span><span style="color:#999999;">.</span><span style="color:#B07D48;">next</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">update</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">update</span><span style="color:#999999;">.</span><span style="color:#B07D48;">next</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">pending</span><span style="color:#999999;">.</span><span style="color:#B07D48;">next</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">pending</span><span style="color:#999999;">.</span><span style="color:#B07D48;">next</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">update</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5C06 Update \u4EFB\u52A1\u5B58\u50A8\u5728 pending \u5C5E\u6027\u4E2D</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">sharedQueue</span><span style="color:#999999;">.</span><span style="color:#B07D48;">pending</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">update</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="_5-1-7-scheduleupdateonfiber" tabindex="-1">5.1.7 scheduleUpdateOnFiber <a class="header-anchor" href="#_5-1-7-scheduleupdateonfiber" aria-hidden="true">#</a></h4><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberWorkLoop.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * \u5224\u65AD\u4EFB\u52A1\u662F\u5426\u4E3A\u540C\u6B65 \u8C03\u7528\u540C\u6B65\u4EFB\u52A1\u5165\u53E3</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">scheduleUpdateOnFiber</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// rootFiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">fiber</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">expirationTime</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">ExpirationTime</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">   * fiber: \u521D\u59CB\u5316\u6E32\u67D3\u65F6\u4E3A rootFiber, \u5373 &lt;div id=&quot;root&quot;&gt;&lt;/div&gt; \u5BF9\u5E94\u7684 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#758575DD;">   * expirationTime: \u4EFB\u52A1\u8FC7\u671F\u65F6\u95F4 =&gt;1073741823</span></span>
<span class="line"><span style="color:#758575DD;">   */</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">   * \u5224\u65AD\u662F\u5426\u662F\u65E0\u9650\u5FAA\u73AF\u7684 update \u5982\u679C\u662F\u5C31\u62A5\u9519</span></span>
<span class="line"><span style="color:#758575DD;">   * \u5728 componentWillUpdate \u6216\u8005 componentDidUpdate \u751F\u547D\u5468\u671F\u51FD\u6570\u4E2D\u91CD\u590D\u8C03\u7528</span></span>
<span class="line"><span style="color:#758575DD;">   * setState \u65B9\u6CD5\u65F6, \u53EF\u80FD\u4F1A\u53D1\u751F\u8FD9\u79CD\u60C5\u51B5, React \u9650\u5236\u4E86\u5D4C\u5957\u66F4\u65B0\u7684\u6570\u91CF\u4EE5\u9632\u6B62\u65E0\u9650\u5FAA\u73AF</span></span>
<span class="line"><span style="color:#758575DD;">   * \u9650\u5236\u7684\u5D4C\u5957\u66F4\u65B0\u6570\u91CF\u4E3A 50, \u53EF\u901A\u8FC7 NESTED_UPDATE_LIMIT \u5168\u5C40\u53D8\u91CF\u83B7\u53D6</span></span>
<span class="line"><span style="color:#758575DD;">   */</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">checkForNestedUpdates</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// \u5224\u65AD\u4EFB\u52A1\u662F\u5426\u662F\u540C\u6B65\u4EFB\u52A1 Sync\u7684\u503C\u4E3A: 1073741823</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">expirationTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Sync</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#666666;">      </span><span style="color:#758575DD;">// \u68C0\u67E5\u662F\u5426\u5904\u4E8E\u975E\u6279\u91CF\u66F4\u65B0\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">(</span><span style="color:#BD976A;">executionContext</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">LegacyUnbatchedContext</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoContext</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span></span>
<span class="line"><span style="color:#666666;">      </span><span style="color:#758575DD;">// \u68C0\u67E5\u662F\u5426\u6CA1\u6709\u5904\u4E8E\u6B63\u5728\u8FDB\u884C\u6E32\u67D3\u7684\u4EFB\u52A1</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">(</span><span style="color:#BD976A;">executionContext</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">RenderContext</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">CommitContext</span><span style="color:#666666;">))</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoContext</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">      </span><span style="color:#758575DD;">// \u540C\u6B65\u4EFB\u52A1\u5165\u53E3\u70B9</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#80A665;">performSyncWorkOnRoot</span><span style="color:#666666;">(</span><span style="color:#BD976A;">root</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// \u5FFD\u7565\u4E86\u4E00\u4E9B\u521D\u59CB\u5316\u6E32\u67D3\u4E0D\u4F1A\u5F97\u5230\u6267\u884C\u7684\u4EE3\u7801</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u5224\u65AD\u4EFB\u52A1\u662F\u5426\u4E3A\u540C\u6B65 \u8C03\u7528\u540C\u6B65\u4EFB\u52A1\u5165\u53E3</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">scheduleUpdateOnFiber</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// rootFiber</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">fiber</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">expirationTime</span><span style="color:#999999;">: </span><span style="color:#2E808F;">ExpirationTime</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">   * fiber: \u521D\u59CB\u5316\u6E32\u67D3\u65F6\u4E3A rootFiber, \u5373 &lt;div id=&quot;root&quot;&gt;&lt;/div&gt; \u5BF9\u5E94\u7684 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#A0ADA0;">   * expirationTime: \u4EFB\u52A1\u8FC7\u671F\u65F6\u95F4 =&gt;1073741823</span></span>
<span class="line"><span style="color:#A0ADA0;">   */</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">   * \u5224\u65AD\u662F\u5426\u662F\u65E0\u9650\u5FAA\u73AF\u7684 update \u5982\u679C\u662F\u5C31\u62A5\u9519</span></span>
<span class="line"><span style="color:#A0ADA0;">   * \u5728 componentWillUpdate \u6216\u8005 componentDidUpdate \u751F\u547D\u5468\u671F\u51FD\u6570\u4E2D\u91CD\u590D\u8C03\u7528</span></span>
<span class="line"><span style="color:#A0ADA0;">   * setState \u65B9\u6CD5\u65F6, \u53EF\u80FD\u4F1A\u53D1\u751F\u8FD9\u79CD\u60C5\u51B5, React \u9650\u5236\u4E86\u5D4C\u5957\u66F4\u65B0\u7684\u6570\u91CF\u4EE5\u9632\u6B62\u65E0\u9650\u5FAA\u73AF</span></span>
<span class="line"><span style="color:#A0ADA0;">   * \u9650\u5236\u7684\u5D4C\u5957\u66F4\u65B0\u6570\u91CF\u4E3A 50, \u53EF\u901A\u8FC7 NESTED_UPDATE_LIMIT \u5168\u5C40\u53D8\u91CF\u83B7\u53D6</span></span>
<span class="line"><span style="color:#A0ADA0;">   */</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">checkForNestedUpdates</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// \u5224\u65AD\u4EFB\u52A1\u662F\u5426\u662F\u540C\u6B65\u4EFB\u52A1 Sync\u7684\u503C\u4E3A: 1073741823</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">expirationTime</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Sync</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#999999;">      </span><span style="color:#A0ADA0;">// \u68C0\u67E5\u662F\u5426\u5904\u4E8E\u975E\u6279\u91CF\u66F4\u65B0\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">(</span><span style="color:#B07D48;">executionContext</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">LegacyUnbatchedContext</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoContext</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span></span>
<span class="line"><span style="color:#999999;">      </span><span style="color:#A0ADA0;">// \u68C0\u67E5\u662F\u5426\u6CA1\u6709\u5904\u4E8E\u6B63\u5728\u8FDB\u884C\u6E32\u67D3\u7684\u4EFB\u52A1</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">(</span><span style="color:#B07D48;">executionContext</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">RenderContext</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">CommitContext</span><span style="color:#999999;">))</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoContext</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">      </span><span style="color:#A0ADA0;">// \u540C\u6B65\u4EFB\u52A1\u5165\u53E3\u70B9</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#59873A;">performSyncWorkOnRoot</span><span style="color:#999999;">(</span><span style="color:#B07D48;">root</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// \u5FFD\u7565\u4E86\u4E00\u4E9B\u521D\u59CB\u5316\u6E32\u67D3\u4E0D\u4F1A\u5F97\u5230\u6267\u884C\u7684\u4EE3\u7801</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="_5-1-8-\u6784\u5EFA-fiber-\u5BF9\u8C61" tabindex="-1">5.1.8 \u6784\u5EFA Fiber \u5BF9\u8C61 <a class="header-anchor" href="#_5-1-8-\u6784\u5EFA-fiber-\u5BF9\u8C61" aria-hidden="true">#</a></h4><h5 id="_5-1-8-1-performsyncworkonroot" tabindex="-1">5.1.8.1 performSyncWorkOnRoot <a class="header-anchor" href="#_5-1-8-1-performsyncworkonroot" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberWorkLoop.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// \u8FDB\u5165 render \u9636\u6BB5, \u6784\u5EFA workInProgress Fiber \u6811</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">performSyncWorkOnRoot</span><span style="color:#666666;">(</span><span style="color:#BD976A;">root</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u53C2\u6570 root \u4E3A fiberRoot \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u68C0\u67E5\u662F\u5426\u6709\u8FC7\u671F\u7684\u4EFB\u52A1</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C\u6CA1\u6709\u8FC7\u671F\u7684\u4EFB\u52A1 \u503C\u4E3A 0</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u521D\u59CB\u5316\u6E32\u67D3\u6CA1\u6709\u8FC7\u671F\u7684\u4EFB\u52A1\u5F85\u6267\u884C</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">lastExpiredTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">root</span><span style="color:#666666;">.</span><span style="color:#BD976A;">lastExpiredTime</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// NoWork \u503C\u4E3A 0</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C\u6709\u8FC7\u671F\u7684\u4EFB\u52A1 \u5C06\u8FC7\u671F\u65F6\u95F4\u8BBE\u7F6E\u4E3A lastExpiredTime \u5426\u5219\u5C06\u8FC7\u671F\u65F6\u95F4\u8BBE\u7F6E\u4E3A Sync</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3\u8FC7\u671F\u65F6\u95F4\u88AB\u8BBE\u7F6E\u6210\u4E86 Sync</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">expirationTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">lastExpiredTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoWork</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">?</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">lastExpiredTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Sync</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C root \u548C workInProgressRoot \u4E0D\u76F8\u7B49</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u8BF4\u660E workInProgressRoot \u4E0D\u5B58\u5728, \u8BF4\u660E\u8FD8\u6CA1\u6709\u6784\u5EFA workInProgress Fiber \u6811</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// workInProgressRoot \u4E3A\u5168\u5C40\u53D8\u91CF \u9ED8\u8BA4\u503C\u4E3A null, \u521D\u59CB\u6E32\u67D3\u65F6\u503C\u4E3A null</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// expirationTime =&gt; 1073741823</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// renderExpirationTime =&gt; 0</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// true</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">root</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgressRoot</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">||</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">expirationTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">renderExpirationTime</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u6784\u5EFA workInProgressFiber \u6811\u53CArootFiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">prepareFreshStack</span><span style="color:#666666;">(</span><span style="color:#BD976A;">root</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">expirationTime</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// workInProgress \u5982\u679C\u4E0D\u4E3A null</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">workInProgress</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">do</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">try</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u4EE5\u540C\u6B65\u7684\u65B9\u5F0F\u5F00\u59CB\u6784\u5EFA Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#80A665;">workLoopSync</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u8DF3\u51FA while \u5FAA\u73AF</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#4D9375;">break</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">catch</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">thrownValue</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#80A665;">handleError</span><span style="color:#666666;">(</span><span style="color:#BD976A;">root</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">thrownValue</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">while</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#4D9375;">true</span><span style="color:#666666;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">workInProgress</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u8FD9\u662F\u4E00\u4E2A\u540C\u6B65\u6E32\u67D3, \u6240\u4EE5\u6211\u4EEC\u5E94\u8BE5\u5B8C\u6210\u6574\u68F5\u6811.</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u65E0\u6CD5\u63D0\u4EA4\u4E0D\u5B8C\u6574\u7684 root, \u6B64\u9519\u8BEF\u53EF\u80FD\u662F\u7531\u4E8EReact\u4E2D\u7684\u9519\u8BEF\u6240\u81F4. \u8BF7\u63D0\u51FA\u95EE\u9898.</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#80A665;">invariant</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#4D9375;">false</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Cannot commit an incomplete root. This error is likely caused by a </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">+</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">bug in React. Please file an issue.</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5C06\u6784\u5EFA\u597D\u7684\u65B0 Fiber \u5BF9\u8C61\u5B58\u50A8\u5728 finishedWork \u5C5E\u6027\u4E2D</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u63D0\u4EA4\u9636\u6BB5\u4F7F\u7528</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">root</span><span style="color:#666666;">.</span><span style="color:#BD976A;">finishedWork</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">root</span><span style="color:#666666;">.</span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">alternate</span><span style="color:#DBD7CAEE;">: </span><span style="color:#BD976A;">any</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">root</span><span style="color:#666666;">.</span><span style="color:#BD976A;">finishedExpirationTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">expirationTime</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u7ED3\u675F render \u9636\u6BB5</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u8FDB\u5165 commit \u9636\u6BB5</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#80A665;">finishSyncRender</span><span style="color:#666666;">(</span><span style="color:#BD976A;">root</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// \u8FDB\u5165 render \u9636\u6BB5, \u6784\u5EFA workInProgress Fiber \u6811</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">performSyncWorkOnRoot</span><span style="color:#999999;">(</span><span style="color:#B07D48;">root</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u53C2\u6570 root \u4E3A fiberRoot \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u68C0\u67E5\u662F\u5426\u6709\u8FC7\u671F\u7684\u4EFB\u52A1</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C\u6CA1\u6709\u8FC7\u671F\u7684\u4EFB\u52A1 \u503C\u4E3A 0</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u521D\u59CB\u5316\u6E32\u67D3\u6CA1\u6709\u8FC7\u671F\u7684\u4EFB\u52A1\u5F85\u6267\u884C</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">lastExpiredTime</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">root</span><span style="color:#999999;">.</span><span style="color:#B07D48;">lastExpiredTime</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// NoWork \u503C\u4E3A 0</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C\u6709\u8FC7\u671F\u7684\u4EFB\u52A1 \u5C06\u8FC7\u671F\u65F6\u95F4\u8BBE\u7F6E\u4E3A lastExpiredTime \u5426\u5219\u5C06\u8FC7\u671F\u65F6\u95F4\u8BBE\u7F6E\u4E3A Sync</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3\u8FC7\u671F\u65F6\u95F4\u88AB\u8BBE\u7F6E\u6210\u4E86 Sync</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">expirationTime</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">lastExpiredTime</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoWork</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">?</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">lastExpiredTime</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Sync</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C root \u548C workInProgressRoot \u4E0D\u76F8\u7B49</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u8BF4\u660E workInProgressRoot \u4E0D\u5B58\u5728, \u8BF4\u660E\u8FD8\u6CA1\u6709\u6784\u5EFA workInProgress Fiber \u6811</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// workInProgressRoot \u4E3A\u5168\u5C40\u53D8\u91CF \u9ED8\u8BA4\u503C\u4E3A null, \u521D\u59CB\u6E32\u67D3\u65F6\u503C\u4E3A null</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// expirationTime =&gt; 1073741823</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// renderExpirationTime =&gt; 0</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// true</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">root</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgressRoot</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">||</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">expirationTime</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">renderExpirationTime</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u6784\u5EFA workInProgressFiber \u6811\u53CArootFiber</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">prepareFreshStack</span><span style="color:#999999;">(</span><span style="color:#B07D48;">root</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">expirationTime</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// workInProgress \u5982\u679C\u4E0D\u4E3A null</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">workInProgress</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">do</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">try</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u4EE5\u540C\u6B65\u7684\u65B9\u5F0F\u5F00\u59CB\u6784\u5EFA Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#59873A;">workLoopSync</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u8DF3\u51FA while \u5FAA\u73AF</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#1E754F;">break</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">catch</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">thrownValue</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#59873A;">handleError</span><span style="color:#999999;">(</span><span style="color:#B07D48;">root</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">thrownValue</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">while</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#1E754F;">true</span><span style="color:#999999;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">workInProgress</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u8FD9\u662F\u4E00\u4E2A\u540C\u6B65\u6E32\u67D3, \u6240\u4EE5\u6211\u4EEC\u5E94\u8BE5\u5B8C\u6210\u6574\u68F5\u6811.</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u65E0\u6CD5\u63D0\u4EA4\u4E0D\u5B8C\u6574\u7684 root, \u6B64\u9519\u8BEF\u53EF\u80FD\u662F\u7531\u4E8EReact\u4E2D\u7684\u9519\u8BEF\u6240\u81F4. \u8BF7\u63D0\u51FA\u95EE\u9898.</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#59873A;">invariant</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#1E754F;">false</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Cannot commit an incomplete root. This error is likely caused by a </span><span style="color:#B56959AA;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">bug in React. Please file an issue.</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5C06\u6784\u5EFA\u597D\u7684\u65B0 Fiber \u5BF9\u8C61\u5B58\u50A8\u5728 finishedWork \u5C5E\u6027\u4E2D</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u63D0\u4EA4\u9636\u6BB5\u4F7F\u7528</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">root</span><span style="color:#999999;">.</span><span style="color:#B07D48;">finishedWork</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">root</span><span style="color:#999999;">.</span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">alternate</span><span style="color:#393A34;">: </span><span style="color:#B07D48;">any</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">root</span><span style="color:#999999;">.</span><span style="color:#B07D48;">finishedExpirationTime</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">expirationTime</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u7ED3\u675F render \u9636\u6BB5</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u8FDB\u5165 commit \u9636\u6BB5</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#59873A;">finishSyncRender</span><span style="color:#999999;">(</span><span style="color:#B07D48;">root</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-1-8-2-preparefreshstack" tabindex="-1">5.1.8.2 prepareFreshStack <a class="header-anchor" href="#_5-1-8-2-preparefreshstack" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberWorkLoop.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * \u6839\u636E currentFiber \u6811\u4E2D\u7684 rootFiber</span></span>
<span class="line"><span style="color:#758575DD;"> * \u6784\u5EFA workInProgressFiber \u6811\u4E2D\u7684 rootFiber</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">prepareFreshStack</span><span style="color:#666666;">(</span><span style="color:#BD976A;">root</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">expirationTime</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u4E3A FiberRoot \u5BF9\u8C61\u6DFB\u52A0 finishedWork \u5C5E\u6027</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// finishedWork \u8868\u793A render \u9636\u6BB5\u6267\u884C\u5B8C\u6210\u540E\u6784\u5EFA\u7684\u5F85\u63D0\u4EA4\u7684 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">root</span><span style="color:#666666;">.</span><span style="color:#BD976A;">finishedWork</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u521D\u59CB\u5316 finishedExpirationTime \u503C\u4E3A 0</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">root</span><span style="color:#666666;">.</span><span style="color:#BD976A;">finishedExpirationTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoWork</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5EFA\u6784 workInProgress Fiber \u6811\u7684 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">workInProgressRoot</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">root</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u6784\u5EFA workInProgress Fiber \u6811\u4E2D\u7684 rootFiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">workInProgress</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">createWorkInProgress</span><span style="color:#666666;">(</span><span style="color:#BD976A;">root</span><span style="color:#666666;">.</span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">renderExpirationTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">expirationTime</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">workInProgressRootExitStatus</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">RootIncomplete</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u6839\u636E currentFiber \u6811\u4E2D\u7684 rootFiber</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u6784\u5EFA workInProgressFiber \u6811\u4E2D\u7684 rootFiber</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">prepareFreshStack</span><span style="color:#999999;">(</span><span style="color:#B07D48;">root</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">expirationTime</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u4E3A FiberRoot \u5BF9\u8C61\u6DFB\u52A0 finishedWork \u5C5E\u6027</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// finishedWork \u8868\u793A render \u9636\u6BB5\u6267\u884C\u5B8C\u6210\u540E\u6784\u5EFA\u7684\u5F85\u63D0\u4EA4\u7684 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">root</span><span style="color:#999999;">.</span><span style="color:#B07D48;">finishedWork</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u521D\u59CB\u5316 finishedExpirationTime \u503C\u4E3A 0</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">root</span><span style="color:#999999;">.</span><span style="color:#B07D48;">finishedExpirationTime</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoWork</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5EFA\u6784 workInProgress Fiber \u6811\u7684 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">workInProgressRoot</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">root</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u6784\u5EFA workInProgress Fiber \u6811\u4E2D\u7684 rootFiber</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">workInProgress</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">createWorkInProgress</span><span style="color:#999999;">(</span><span style="color:#B07D48;">root</span><span style="color:#999999;">.</span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">renderExpirationTime</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">expirationTime</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">workInProgressRootExitStatus</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">RootIncomplete</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-1-8-3-createworkinprogress" tabindex="-1">5.1.8.3 createWorkInProgress <a class="header-anchor" href="#_5-1-8-3-createworkinprogress" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiber.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// \u6784\u5EFA workInProgress Fiber \u6811\u4E2D\u7684 rootFiber</span></span>
<span class="line"><span style="color:#758575DD;">// \u6784\u5EFA\u5B8C\u6210\u540E\u4F1A\u66FF\u6362 current fiber</span></span>
<span class="line"><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3 pendingProps \u4E3A null</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">createWorkInProgress</span><span style="color:#666666;">(</span><span style="color:#BD976A;">current</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">pendingProps</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">any</span><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// current: current Fiber \u4E2D\u7684 rootFiber</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6 current Fiber \u4E2D\u5BF9\u5E94\u7684 workInProgress Fiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">alternate</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C workInProgress \u4E0D\u5B58\u5728</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">workInProgress</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u521B\u5EFA fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">workInProgress</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">createFiber</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">tag</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">pendingProps</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">key</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">mode</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5C5E\u6027\u590D\u7528</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">elementType</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">elementType</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">type</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">type</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">stateNode</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">stateNode</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u4F7F\u7528 alternate \u5B58\u50A8 current</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">alternate</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u4F7F\u7528 alternate \u5B58\u50A8 workInProgress</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">alternate</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">childExpirationTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">childExpirationTime</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">expirationTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">expirationTime</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">child</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">child</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">memoizedProps</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">memoizedProps</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">memoizedState</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">memoizedState</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">updateQueue</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">updateQueue</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">sibling</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">sibling</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">index</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">index</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">ref</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">ref</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u8FD4\u56DE\u521B\u5EFA\u597D\u7684 workInProgress Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// \u6784\u5EFA workInProgress Fiber \u6811\u4E2D\u7684 rootFiber</span></span>
<span class="line"><span style="color:#A0ADA0;">// \u6784\u5EFA\u5B8C\u6210\u540E\u4F1A\u66FF\u6362 current fiber</span></span>
<span class="line"><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3 pendingProps \u4E3A null</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">createWorkInProgress</span><span style="color:#999999;">(</span><span style="color:#B07D48;">current</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">pendingProps</span><span style="color:#999999;">: </span><span style="color:#2E808F;">any</span><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">Fiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// current: current Fiber \u4E2D\u7684 rootFiber</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6 current Fiber \u4E2D\u5BF9\u5E94\u7684 workInProgress Fiber</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">alternate</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C workInProgress \u4E0D\u5B58\u5728</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">workInProgress</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u521B\u5EFA fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">workInProgress</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">createFiber</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">tag</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">pendingProps</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">key</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">mode</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5C5E\u6027\u590D\u7528</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">elementType</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">elementType</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">type</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">type</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">stateNode</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">stateNode</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u4F7F\u7528 alternate \u5B58\u50A8 current</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">alternate</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u4F7F\u7528 alternate \u5B58\u50A8 workInProgress</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">alternate</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">childExpirationTime</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">childExpirationTime</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">expirationTime</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">expirationTime</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">child</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">child</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">memoizedProps</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">memoizedProps</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">memoizedState</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">memoizedState</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">updateQueue</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">updateQueue</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">sibling</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">sibling</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">index</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">index</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">ref</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">ref</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u8FD4\u56DE\u521B\u5EFA\u597D\u7684 workInProgress Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-1-8-4-workloopsync" tabindex="-1">5.1.8.4 workLoopSync <a class="header-anchor" href="#_5-1-8-4-workloopsync" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberWorkLoop.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// \u4EE5\u540C\u6B65\u7684\u65B9\u5F0F\u6784\u5EFA workInProgress Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">workLoopSync</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// workInProgress \u662F\u4E00\u4E2A fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5B83\u7684\u503C\u4E0D\u4E3A null \u610F\u5473\u7740\u8BE5 fiber \u5BF9\u8C61\u4E0A\u4ECD\u7136\u6709\u66F4\u65B0\u8981\u6267\u884C</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">while</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">workInProgress</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">workInProgress</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">performUnitOfWork</span><span style="color:#666666;">(</span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// \u4EE5\u540C\u6B65\u7684\u65B9\u5F0F\u6784\u5EFA workInProgress Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">workLoopSync</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// workInProgress \u662F\u4E00\u4E2A fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5B83\u7684\u503C\u4E0D\u4E3A null \u610F\u5473\u7740\u8BE5 fiber \u5BF9\u8C61\u4E0A\u4ECD\u7136\u6709\u66F4\u65B0\u8981\u6267\u884C</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">while</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">workInProgress</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">workInProgress</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">performUnitOfWork</span><span style="color:#999999;">(</span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-1-8-5-performunitofwork" tabindex="-1">5.1.8.5 performUnitOfWork <a class="header-anchor" href="#_5-1-8-5-performunitofwork" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberWorkLoop.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">performUnitOfWork</span><span style="color:#666666;">(</span><span style="color:#BD976A;">unitOfWork</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// unitOfWork =&gt; workInProgress Fiber \u6811\u4E2D\u7684 rootFiber</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// current =&gt; currentFiber \u6811\u4E2D\u7684 rootFiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">unitOfWork</span><span style="color:#666666;">.</span><span style="color:#BD976A;">alternate</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5B58\u50A8\u4E0B\u4E00\u4E2A\u8981\u6784\u5EFA\u7684\u5B50\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">next</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// false</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">enableProfilerTimer</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">unitOfWork</span><span style="color:#666666;">.</span><span style="color:#BD976A;">mode</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ProfileMode</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoMode</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3 \u4E0D\u6267\u884C</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// beginWork: \u4ECE\u7236\u5230\u5B50, \u6784\u5EFA Fiber \u8282\u70B9\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u8FD4\u56DE\u503C next \u4E3A\u5F53\u524D\u8282\u70B9\u7684\u5B50\u8282\u70B9</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">next</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">beginWork</span><span style="color:#666666;">(</span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">unitOfWork</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">renderExpirationTime</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u4E3A\u65E7\u7684 props \u5C5E\u6027\u8D4B\u503C</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u6B64\u6B21\u66F4\u65B0\u540E pendingProps \u53D8\u4E3A memoizedProps</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">unitOfWork</span><span style="color:#666666;">.</span><span style="color:#BD976A;">memoizedProps</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">unitOfWork</span><span style="color:#666666;">.</span><span style="color:#BD976A;">pendingProps</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C\u5B50\u8282\u70B9\u4E0D\u5B58\u5728\u8BF4\u660E\u5F53\u524D\u8282\u70B9\u5411\u4E0B\u904D\u5386\u5B50\u8282\u70B9\u5DF2\u7ECF\u5230\u5E95\u4E86</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u7EE7\u7EED\u5411\u4E0A\u8FD4\u56DE \u9047\u5230\u5144\u5F1F\u8282\u70B9 \u6784\u5EFA\u5144\u5F1F\u8282\u70B9\u7684\u5B50 Fiber \u5BF9\u8C61 \u76F4\u5230\u8FD4\u56DE\u5230\u6839 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">next</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u4ECE\u5B50\u5230\u7236, \u6784\u5EFA\u5176\u4F59\u8282\u70B9 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">next</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">completeUnitOfWork</span><span style="color:#666666;">(</span><span style="color:#BD976A;">unitOfWork</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">next</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">performUnitOfWork</span><span style="color:#999999;">(</span><span style="color:#B07D48;">unitOfWork</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">Fiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// unitOfWork =&gt; workInProgress Fiber \u6811\u4E2D\u7684 rootFiber</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// current =&gt; currentFiber \u6811\u4E2D\u7684 rootFiber</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">unitOfWork</span><span style="color:#999999;">.</span><span style="color:#B07D48;">alternate</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5B58\u50A8\u4E0B\u4E00\u4E2A\u8981\u6784\u5EFA\u7684\u5B50\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">next</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// false</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">enableProfilerTimer</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">unitOfWork</span><span style="color:#999999;">.</span><span style="color:#B07D48;">mode</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ProfileMode</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoMode</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3 \u4E0D\u6267\u884C</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// beginWork: \u4ECE\u7236\u5230\u5B50, \u6784\u5EFA Fiber \u8282\u70B9\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u8FD4\u56DE\u503C next \u4E3A\u5F53\u524D\u8282\u70B9\u7684\u5B50\u8282\u70B9</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">next</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">beginWork</span><span style="color:#999999;">(</span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">unitOfWork</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">renderExpirationTime</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u4E3A\u65E7\u7684 props \u5C5E\u6027\u8D4B\u503C</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u6B64\u6B21\u66F4\u65B0\u540E pendingProps \u53D8\u4E3A memoizedProps</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">unitOfWork</span><span style="color:#999999;">.</span><span style="color:#B07D48;">memoizedProps</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">unitOfWork</span><span style="color:#999999;">.</span><span style="color:#B07D48;">pendingProps</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C\u5B50\u8282\u70B9\u4E0D\u5B58\u5728\u8BF4\u660E\u5F53\u524D\u8282\u70B9\u5411\u4E0B\u904D\u5386\u5B50\u8282\u70B9\u5DF2\u7ECF\u5230\u5E95\u4E86</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u7EE7\u7EED\u5411\u4E0A\u8FD4\u56DE \u9047\u5230\u5144\u5F1F\u8282\u70B9 \u6784\u5EFA\u5144\u5F1F\u8282\u70B9\u7684\u5B50 Fiber \u5BF9\u8C61 \u76F4\u5230\u8FD4\u56DE\u5230\u6839 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">next</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u4ECE\u5B50\u5230\u7236, \u6784\u5EFA\u5176\u4F59\u8282\u70B9 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">next</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">completeUnitOfWork</span><span style="color:#999999;">(</span><span style="color:#B07D48;">unitOfWork</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">next</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-1-8-6-beginwork" tabindex="-1">5.1.8.6 beginWork <a class="header-anchor" href="#_5-1-8-6-beginwork" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberBeginWork.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// \u4ECE\u7236\u5230\u5B50, \u6784\u5EFA Fiber \u8282\u70B9\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">beginWork</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">current</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;"> | </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">renderExpirationTime</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">ExpirationTime</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// NoWork \u5E38\u91CF \u503C\u4E3A0 \u6E05\u7A7A\u8FC7\u671F\u65F6\u95F4</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">expirationTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoWork</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// \u6839\u636E\u5F53\u524D Fiber \u7684\u7C7B\u578B\u51B3\u5B9A\u5982\u4F55\u6784\u5EFA\u8D77\u5B50\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// \u6587\u4EF6\u4F4D\u7F6E: shared/ReactWorkTags.js</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">switch</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">tag</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// 2</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u51FD\u6570\u578B\u7EC4\u4EF6\u5728\u7B2C\u4E00\u6B21\u6E32\u67D3\u7EC4\u4EF6\u65F6\u4F7F\u7528</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">IndeterminateComponent</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">mountIndeterminateComponent</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u65E7 Fiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u65B0 Fiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u65B0 Fiber \u7684 type \u503C \u521D\u59CB\u6E32\u67D3\u65F6\u662FApp\u7EC4\u4EF6\u51FD\u6570</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">type</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u540C\u6B65 \u6574\u6570\u6700\u5927\u503C 1073741823</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">renderExpirationTime</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// 0</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">FunctionComponent</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Component</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">type</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">unresolvedProps</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">pendingProps</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">resolvedProps</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">elementType</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Component</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#CB7676;">?</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">unresolvedProps</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#CB7676;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">resolveDefaultProps</span><span style="color:#666666;">(</span><span style="color:#BD976A;">Component</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">unresolvedProps</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">updateFunctionComponent</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">Component</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">resolvedProps</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">renderExpirationTime</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// 1</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ClassComponent</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Component</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">type</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">unresolvedProps</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">pendingProps</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">resolvedProps</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">elementType</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Component</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#CB7676;">?</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">unresolvedProps</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#CB7676;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">resolveDefaultProps</span><span style="color:#666666;">(</span><span style="color:#BD976A;">Component</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">unresolvedProps</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">updateClassComponent</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">Component</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">resolvedProps</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">renderExpirationTime</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// 3</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostRoot</span><span style="color:#666666;">:</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">updateHostRoot</span><span style="color:#666666;">(</span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">renderExpirationTime</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// 5</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostComponent</span><span style="color:#666666;">:</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">updateHostComponent</span><span style="color:#666666;">(</span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">renderExpirationTime</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// 6</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostText</span><span style="color:#666666;">:</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">updateHostText</span><span style="color:#666666;">(</span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// \u7EC4\u4EF6\u7C7B\u578B\u672A\u77E5 \u62A5\u9519</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">invariant</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">false</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Unknown unit of work tag (%s). This error is likely caused by a bug in </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">+</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">React. Please file an issue.</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">tag</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// \u4ECE\u7236\u5230\u5B50, \u6784\u5EFA Fiber \u8282\u70B9\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">beginWork</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">current</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;"> | </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">renderExpirationTime</span><span style="color:#999999;">: </span><span style="color:#2E808F;">ExpirationTime</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">Fiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// NoWork \u5E38\u91CF \u503C\u4E3A0 \u6E05\u7A7A\u8FC7\u671F\u65F6\u95F4</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">expirationTime</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoWork</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// \u6839\u636E\u5F53\u524D Fiber \u7684\u7C7B\u578B\u51B3\u5B9A\u5982\u4F55\u6784\u5EFA\u8D77\u5B50\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// \u6587\u4EF6\u4F4D\u7F6E: shared/ReactWorkTags.js</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">switch</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">tag</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// 2</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u51FD\u6570\u578B\u7EC4\u4EF6\u5728\u7B2C\u4E00\u6B21\u6E32\u67D3\u7EC4\u4EF6\u65F6\u4F7F\u7528</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">IndeterminateComponent</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#59873A;">mountIndeterminateComponent</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u65E7 Fiber</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u65B0 Fiber</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u65B0 Fiber \u7684 type \u503C \u521D\u59CB\u6E32\u67D3\u65F6\u662FApp\u7EC4\u4EF6\u51FD\u6570</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">type</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u540C\u6B65 \u6574\u6570\u6700\u5927\u503C 1073741823</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">renderExpirationTime</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// 0</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">FunctionComponent</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Component</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">type</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">unresolvedProps</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">pendingProps</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">resolvedProps</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">elementType</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Component</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#AB5959;">?</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">unresolvedProps</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#AB5959;">:</span><span style="color:#393A34;"> </span><span style="color:#59873A;">resolveDefaultProps</span><span style="color:#999999;">(</span><span style="color:#B07D48;">Component</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">unresolvedProps</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#59873A;">updateFunctionComponent</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">Component</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">resolvedProps</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">renderExpirationTime</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// 1</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ClassComponent</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Component</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">type</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">unresolvedProps</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">pendingProps</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">resolvedProps</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">elementType</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Component</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#AB5959;">?</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">unresolvedProps</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#AB5959;">:</span><span style="color:#393A34;"> </span><span style="color:#59873A;">resolveDefaultProps</span><span style="color:#999999;">(</span><span style="color:#B07D48;">Component</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">unresolvedProps</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#59873A;">updateClassComponent</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">Component</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">resolvedProps</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">renderExpirationTime</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// 3</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostRoot</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#59873A;">updateHostRoot</span><span style="color:#999999;">(</span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">renderExpirationTime</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// 5</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostComponent</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#59873A;">updateHostComponent</span><span style="color:#999999;">(</span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">renderExpirationTime</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// 6</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostText</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#59873A;">updateHostText</span><span style="color:#999999;">(</span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// \u7EC4\u4EF6\u7C7B\u578B\u672A\u77E5 \u62A5\u9519</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">invariant</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">false</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Unknown unit of work tag (%s). This error is likely caused by a bug in </span><span style="color:#B56959AA;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">React. Please file an issue.</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">tag</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-1-8-7-updatehostroot" tabindex="-1">5.1.8.7 updateHostRoot <a class="header-anchor" href="#_5-1-8-7-updatehostroot" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberBeginWork.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// HostRoot =&gt; &lt;div id=&quot;root&quot;&gt;&lt;/div&gt; \u5BF9\u5E94\u7684 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#758575DD;">// \u627E\u51FA HostRoot \u7684\u5B50 ReactElement \u5E76\u4E3A\u5176\u6784\u5EFA Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">updateHostRoot</span><span style="color:#666666;">(</span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">renderExpirationTime</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6\u66F4\u65B0\u961F\u5217</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">updateQueue</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">updateQueue</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6\u65B0\u7684 props \u5BF9\u8C61 null</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextProps</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">pendingProps</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6\u4E0A\u4E00\u6B21\u6E32\u67D3\u4F7F\u7528\u7684 state null</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">prevState</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">memoizedState</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6\u4E0A\u4E00\u6B21\u6E32\u67D3\u4F7F\u7528\u7684 children null</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">prevChildren</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">prevState</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">?</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">prevState</span><span style="color:#666666;">.</span><span style="color:#BD976A;">element</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u6D45\u590D\u5236\u66F4\u65B0\u961F\u5217, \u9632\u6B62\u5F15\u7528\u5C5E\u6027\u4E92\u76F8\u5F71\u54CD</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// workInProgress.updateQueue \u6D45\u62F7\u8D1D current.updateQueue</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">cloneUpdateQueue</span><span style="color:#666666;">(</span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6 updateQueue.payload \u5E76\u8D4B\u503C\u5230 workInProgress.memoizedState</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u8981\u66F4\u65B0\u7684\u5185\u5BB9\u5C31\u662F element \u5C31\u662F rootFiber \u7684\u5B50\u5143\u7D20</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">processUpdateQueue</span><span style="color:#666666;">(</span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextProps</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">renderExpirationTime</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6 element \u6240\u5728\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextState</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">memoizedState</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u4ECE\u5BF9\u8C61\u4E2D\u83B7\u53D6 element</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextChildren</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextState</span><span style="color:#666666;">.</span><span style="color:#BD976A;">element</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6 fiberRoot \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">root</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">FiberRoot</span><span style="color:#666666;"> =</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">stateNode</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u670D\u52A1\u5668\u7AEF\u6E32\u67D3\u8D70 if</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">root</span><span style="color:#666666;">.</span><span style="color:#BD976A;">hydrate</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">enterHydrationState</span><span style="color:#666666;">(</span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">))</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5FFD\u7565</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5BA2\u6237\u7AEF\u6E32\u67D3\u8D70 else</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u6784\u5EFA\u5B50\u8282\u70B9 fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">reconcileChildren</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">nextChildren</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">renderExpirationTime</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u8FD4\u56DE\u5B50\u8282\u70B9 fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">child</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// HostRoot =&gt; &lt;div id=&quot;root&quot;&gt;&lt;/div&gt; \u5BF9\u5E94\u7684 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#A0ADA0;">// \u627E\u51FA HostRoot \u7684\u5B50 ReactElement \u5E76\u4E3A\u5176\u6784\u5EFA Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">updateHostRoot</span><span style="color:#999999;">(</span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">renderExpirationTime</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u66F4\u65B0\u961F\u5217</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">updateQueue</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">updateQueue</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u65B0\u7684 props \u5BF9\u8C61 null</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextProps</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">pendingProps</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u4E0A\u4E00\u6B21\u6E32\u67D3\u4F7F\u7528\u7684 state null</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">prevState</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">memoizedState</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u4E0A\u4E00\u6B21\u6E32\u67D3\u4F7F\u7528\u7684 children null</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">prevChildren</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">prevState</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">?</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">prevState</span><span style="color:#999999;">.</span><span style="color:#B07D48;">element</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u6D45\u590D\u5236\u66F4\u65B0\u961F\u5217, \u9632\u6B62\u5F15\u7528\u5C5E\u6027\u4E92\u76F8\u5F71\u54CD</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// workInProgress.updateQueue \u6D45\u62F7\u8D1D current.updateQueue</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">cloneUpdateQueue</span><span style="color:#999999;">(</span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6 updateQueue.payload \u5E76\u8D4B\u503C\u5230 workInProgress.memoizedState</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u8981\u66F4\u65B0\u7684\u5185\u5BB9\u5C31\u662F element \u5C31\u662F rootFiber \u7684\u5B50\u5143\u7D20</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">processUpdateQueue</span><span style="color:#999999;">(</span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextProps</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">renderExpirationTime</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6 element \u6240\u5728\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextState</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">memoizedState</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u4ECE\u5BF9\u8C61\u4E2D\u83B7\u53D6 element</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextChildren</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextState</span><span style="color:#999999;">.</span><span style="color:#B07D48;">element</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6 fiberRoot \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">root</span><span style="color:#999999;">: </span><span style="color:#2E808F;">FiberRoot</span><span style="color:#999999;"> =</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">stateNode</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u670D\u52A1\u5668\u7AEF\u6E32\u67D3\u8D70 if</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">root</span><span style="color:#999999;">.</span><span style="color:#B07D48;">hydrate</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span><span style="color:#393A34;"> </span><span style="color:#59873A;">enterHydrationState</span><span style="color:#999999;">(</span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">))</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5FFD\u7565</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5BA2\u6237\u7AEF\u6E32\u67D3\u8D70 else</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u6784\u5EFA\u5B50\u8282\u70B9 fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">reconcileChildren</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">nextChildren</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">renderExpirationTime</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u8FD4\u56DE\u5B50\u8282\u70B9 fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">child</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-1-8-8-reconcilechildren" tabindex="-1">5.1.8.8 reconcileChildren <a class="header-anchor" href="#_5-1-8-8-reconcilechildren" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberBeginWork.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">reconcileChildren</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u65E7 Fiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">current</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;"> | </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u7236\u7EA7 Fiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5B50\u7EA7 vdom \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">nextChildren</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">any</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3 \u6574\u578B\u6700\u5927\u503C \u4EE3\u8868\u540C\u6B65\u4EFB\u52A1</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">renderExpirationTime</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">ExpirationTime</span></span>
<span class="line"><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">     * \u4E3A\u4EC0\u4E48\u8981\u4F20\u9012 current ?</span></span>
<span class="line"><span style="color:#758575DD;">     * \u5982\u679C\u4E0D\u662F\u521D\u59CB\u6E32\u67D3\u7684\u60C5\u51B5, \u8981\u8FDB\u884C\u65B0\u65E7 Fiber \u5BF9\u6BD4</span></span>
<span class="line"><span style="color:#758575DD;">     * \u521D\u59CB\u6E32\u67D3\u65F6\u5219\u7528\u4E0D\u5230 current</span></span>
<span class="line"><span style="color:#758575DD;">     */</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C\u5C31 Fiber \u4E3A null \u8868\u793A\u521D\u59CB\u6E32\u67D3</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">current</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u4E3A\u5F53\u524D\u6784\u5EFA\u7684 Fiber \u5BF9\u8C61\u6DFB\u52A0\u5B50\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">child</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">mountChildFibers</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">nextChildren</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">renderExpirationTime</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5FFD\u7565\u4E86 else \u7684\u60C5\u51B5</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">reconcileChildren</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u65E7 Fiber</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">current</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;"> | </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u7236\u7EA7 Fiber</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5B50\u7EA7 vdom \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">nextChildren</span><span style="color:#999999;">: </span><span style="color:#2E808F;">any</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3 \u6574\u578B\u6700\u5927\u503C \u4EE3\u8868\u540C\u6B65\u4EFB\u52A1</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">renderExpirationTime</span><span style="color:#999999;">: </span><span style="color:#2E808F;">ExpirationTime</span></span>
<span class="line"><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">     * \u4E3A\u4EC0\u4E48\u8981\u4F20\u9012 current ?</span></span>
<span class="line"><span style="color:#A0ADA0;">     * \u5982\u679C\u4E0D\u662F\u521D\u59CB\u6E32\u67D3\u7684\u60C5\u51B5, \u8981\u8FDB\u884C\u65B0\u65E7 Fiber \u5BF9\u6BD4</span></span>
<span class="line"><span style="color:#A0ADA0;">     * \u521D\u59CB\u6E32\u67D3\u65F6\u5219\u7528\u4E0D\u5230 current</span></span>
<span class="line"><span style="color:#A0ADA0;">     */</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C\u5C31 Fiber \u4E3A null \u8868\u793A\u521D\u59CB\u6E32\u67D3</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">current</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u4E3A\u5F53\u524D\u6784\u5EFA\u7684 Fiber \u5BF9\u8C61\u6DFB\u52A0\u5B50\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">child</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">mountChildFibers</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">nextChildren</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">renderExpirationTime</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5FFD\u7565\u4E86 else \u7684\u60C5\u51B5</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-1-8-9-childreconciler" tabindex="-1">5.1.8.9 ChildReconciler <a class="header-anchor" href="#_5-1-8-9-childreconciler" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactChildFiber.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * shouldTrackSideEffects \u6807\u8BC6, \u662F\u5426\u4E3A Fiber \u5BF9\u8C61\u6DFB\u52A0 effectTag</span></span>
<span class="line"><span style="color:#758575DD;"> * true \u6DFB\u52A0 false \u4E0D\u6DFB\u52A0</span></span>
<span class="line"><span style="color:#758575DD;"> * \u5BF9\u4E8E\u521D\u59CB\u6E32\u67D3\u6765\u8BF4, \u53EA\u6709\u6839\u7EC4\u4EF6\u9700\u8981\u6DFB\u52A0, \u5176\u4ED6\u5143\u7D20\u4E0D\u9700\u8981\u6DFB\u52A0, \u9632\u6B62\u8FC7\u591A\u7684 DOM \u64CD\u4F5C</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#758575DD;">// \u7528\u4E8E\u521D\u59CB\u6E32\u67D3</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">mountChildFibers</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">ChildReconciler</span><span style="color:#666666;">(</span><span style="color:#4D9375;">false</span><span style="color:#666666;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">ChildReconciler</span><span style="color:#666666;">(</span><span style="color:#BD976A;">shouldTrackSideEffects</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">placeChild</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">newFiber</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">lastPlacedIndex</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">number</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">newIndex</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">number</span></span>
<span class="line"><span style="color:#666666;">    ):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">number</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">newFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">index</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">newIndex</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#CB7676;">!</span><span style="color:#BD976A;">shouldTrackSideEffects</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">lastPlacedIndex</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5FFD\u7565\u4E86\u4E00\u90E8\u5206\u521D\u59CB\u5316\u6E32\u67D3\u4E0D\u6267\u884C\u7684\u4EE3\u7801</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">placeSingleChild</span><span style="color:#666666;">(</span><span style="color:#BD976A;">newFiber</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5982\u679C\u662F\u521D\u59CB\u6E32\u67D3 \u4F1A\u5728\u6839\u7EC4\u4EF6(App)\u4E0A\u8BBE\u7F6E effectTag \u5C5E\u6027\u4E3A Placement \u503C\u4E3A 1</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5176\u4ED6\u5B50\u7EA7\u8282\u70B9\u5177\u6709\u9ED8\u8BA4\u503C\u4E3A 0 \u9632\u6B62\u5728 commit \u9636\u6BB5\u53CD\u590D\u64CD\u4F5C\u771F\u5B9EDOM</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3\u65F6\u5982\u679C\u5F53\u524D\u5904\u7406\u7684\u662F\u6839\u7EC4\u4EF6 true \u5176\u4ED6\u7EC4\u4EF6 false</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">shouldTrackSideEffects</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">newFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">alternate</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// Placement \u8868\u793A\u65B0\u521B\u5EFA\u7684\u8282\u70B9</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">newFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">effectTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Placement</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">newFiber</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5904\u7406\u5B50\u5143\u7D20\u662F\u6570\u7EC4\u7684\u60C5\u51B5</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">reconcileChildrenArray</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u7236\u7EA7 Fiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">currentFirstChild</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;"> | </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5B50\u7EA7 vdom \u6570\u7EC4</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">newChildren</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Array</span><span style="color:#666666;">&lt;*&gt;,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">expirationTime</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">ExpirationTime</span></span>
<span class="line"><span style="color:#666666;">    ):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">         * \u5B58\u50A8\u7B2C\u4E00\u4E2A\u5B50\u8282\u70B9 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#758575DD;">         * \u65B9\u6CD5\u8FD4\u56DE\u7684\u4E5F\u662F\u7B2C\u4E00\u4E2A\u5B50\u8282\u70B9 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#758575DD;">         * \u56E0\u4E3A\u5176\u4ED6\u5B50\u8282\u70B9 Fiber \u5BF9\u8C61\u90FD\u5B58\u50A8\u5728\u4E0A\u4E00\u4E2A\u5B50 Fiber \u8282\u70B9\u5BF9\u8C61\u7684 sibling \u5C5E\u6027\u4E2D</span></span>
<span class="line"><span style="color:#758575DD;">         */</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">resultingFirstChild</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;"> | </span><span style="color:#CB7676;">null</span><span style="color:#666666;"> =</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u4E0A\u4E00\u6B21\u521B\u5EFA\u7684 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">previousNewFiber</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;"> | </span><span style="color:#CB7676;">null</span><span style="color:#666666;"> =</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3\u6CA1\u6709\u65E7\u7684\u5B50\u7EA7 \u6240\u4EE5\u4E3A null</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">oldFiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">currentFirstChild</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">lastPlacedIndex</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">newIdx</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextOldFiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// oldFiber \u4E3A\u7A7A \u8BF4\u660E\u662F\u521D\u59CB\u6E32\u67D3</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">oldFiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u904D\u5386\u5B50 vdom \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">for</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">newIdx</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">newChildren</span><span style="color:#666666;">.</span><span style="color:#B8A965;">length</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">newIdx</span><span style="color:#CB7676;">++</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u521B\u5EFA\u5B50 vdom \u5BF9\u5E94\u7684 fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">newFiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">createChild</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">newChildren</span><span style="color:#666666;">[</span><span style="color:#BD976A;">newIdx</span><span style="color:#666666;">],</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">expirationTime</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u5982\u679C newFiber \u4E3A null</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">newFiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                    </span><span style="color:#758575DD;">// \u8FDB\u5165\u4E0B\u6B21\u5FAA\u73AF</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#4D9375;">continue</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3\u65F6\u53EA\u4E3A newFiber \u6DFB\u52A0\u4E86 index \u5C5E\u6027,</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u5176\u4ED6\u4E8B\u6CA1\u5E72. lastPlacedIndex \u88AB\u539F\u5C01\u4E0D\u52A8\u7684\u8FD4\u56DE\u4E86</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">lastPlacedIndex</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">placeChild</span><span style="color:#666666;">(</span><span style="color:#BD976A;">newFiber</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">lastPlacedIndex</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">newIdx</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u4E3A\u5F53\u524D\u8282\u70B9\u8BBE\u7F6E\u4E0B\u4E00\u4E2A\u5144\u5F1F\u8282\u70B9</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">previousNewFiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                    </span><span style="color:#758575DD;">// \u5B58\u50A8\u7B2C\u4E00\u4E2A\u5B50 Fiber \u53D1\u751F\u5728\u7B2C\u4E00\u6B21\u5FAA\u73AF\u65F6</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">resultingFirstChild</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">newFiber</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                    </span><span style="color:#758575DD;">// \u4E3A\u8282\u70B9\u8BBE\u7F6E\u4E0B\u4E00\u4E2A\u5144\u5F1F Fiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">previousNewFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">sibling</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">newFiber</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u5728\u5FAA\u73AF\u7684\u8FC7\u7A0B\u4E2D\u66F4\u65B0\u4E0A\u4E00\u4E2A\u521B\u5EFA\u7684Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">previousNewFiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">newFiber</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u8FD4\u56DE\u521B\u5EFA\u597D\u7684\u5B50 Fiber</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5176\u4ED6 Fiber \u90FD\u4F5C\u4E3A sibling \u5B58\u5728</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">resultingFirstChild</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u8FD4\u56DE\u7B2C\u4E00\u4E2A\u5B50\u5143\u7D20 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">resultingFirstChild</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5904\u7406\u5B50\u5143\u7D20\u662F\u6587\u672C\u6216\u8005\u6570\u503C\u7684\u60C5\u51B5</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">reconcileSingleTextNode</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">currentFirstChild</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;"> | </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">textContent</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">string</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">expirationTime</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">ExpirationTime</span></span>
<span class="line"><span style="color:#666666;">    ):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3\u4E0D\u6267\u884C</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">currentFirstChild</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">currentFirstChild</span><span style="color:#666666;">.</span><span style="color:#BD976A;">tag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostText</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// We already have an existing node so let&#39;s just update it and delete</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// the rest.</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#80A665;">deleteRemainingChildren</span><span style="color:#666666;">(</span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">currentFirstChild</span><span style="color:#666666;">.</span><span style="color:#BD976A;">sibling</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">existing</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">useFiber</span><span style="color:#666666;">(</span><span style="color:#BD976A;">currentFirstChild</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">textContent</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">existing</span><span style="color:#666666;">.</span><span style="color:#BD976A;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">existing</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u73B0\u6709\u7684\u7B2C\u4E00\u4E2A\u5B50\u8282\u70B9\u4E0D\u662F\u6587\u672C\u8282\u70B9\uFF0C\u56E0\u6B64\u6211\u4EEC\u9700\u8981\u521B\u5EFA\u4E00\u4E2A\u5E76\u5220\u9664\u73B0\u6709\u7684.</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3\u4E0D\u6267\u884C</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">deleteRemainingChildren</span><span style="color:#666666;">(</span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">currentFirstChild</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u6839\u636E\u6587\u672C\u521B\u5EFA Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">created</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">createFiberFromText</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">textContent</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">mode</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">expirationTime</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u8BBE\u7F6E\u7236 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">created</span><span style="color:#666666;">.</span><span style="color:#BD976A;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u8FD4\u56DE\u521B\u5EFA\u597D\u7684 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">created</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5904\u7406\u5B50\u5143\u7D20\u662F\u5355\u4E2A\u5BF9\u8C61\u7684\u60C5\u51B5</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">reconcileSingleElement</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u7236 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5907\u4EFD\u5B50 fiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">currentFirstChild</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;"> | </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5B50 vdom \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">element</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">ReactElement</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">expirationTime</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">ExpirationTime</span></span>
<span class="line"><span style="color:#666666;">    ):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u67E5\u770B\u5B50 vdom \u5BF9\u8C61\u662F\u5426\u8868\u793A fragment</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">element</span><span style="color:#666666;">.</span><span style="color:#BD976A;">type</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">REACT_FRAGMENT_TYPE</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// false</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u6839\u636E React Element \u521B\u5EFA Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u8FD4\u56DE\u521B\u5EFA\u597D\u7684 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">created</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">createFiberFromElement</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">element</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u7528\u6765\u8868\u793A\u5F53\u524D\u7EC4\u4EF6\u4E0B\u7684\u6240\u6709\u5B50\u7EC4\u4EF6\u8981\u7528\u5904\u4E8E\u4F55\u79CD\u6E32\u67D3\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u6587\u4EF6\u4F4D\u7F6E: ./ReactTypeOfMode.js</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// 0    \u540C\u6B65\u6E32\u67D3\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// 100  \u5F02\u6B65\u6E32\u67D3\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">mode</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">expirationTime</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u6DFB\u52A0 ref \u5C5E\u6027 { current: DOM }</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">created</span><span style="color:#666666;">.</span><span style="color:#BD976A;">ref</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">coerceRef</span><span style="color:#666666;">(</span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">currentFirstChild</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">element</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u6DFB\u52A0\u7236\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">created</span><span style="color:#666666;">.</span><span style="color:#BD976A;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u8FD4\u56DE\u521B\u5EFA\u597D\u7684\u5B50 Fiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">created</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">reconcileChildFibers</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u7236 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u65E7\u7684\u7B2C\u4E00\u4E2A\u5B50 Fiber \u521D\u59CB\u6E32\u67D3 null</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">currentFirstChild</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;"> | </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u65B0\u7684\u5B50 vdom \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">newChild</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">any</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3 \u6574\u578B\u6700\u5927\u503C \u4EE3\u8868\u540C\u6B65\u4EFB\u52A1</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">expirationTime</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">ExpirationTime</span></span>
<span class="line"><span style="color:#666666;">    ):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u8FD9\u662F\u5165\u53E3\u65B9\u6CD5, \u6839\u636E newChild \u7C7B\u578B\u8FDB\u884C\u5BF9\u5E94\u5904\u7406</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5224\u65AD\u65B0\u7684\u5B50 vdom \u662F\u5426\u4E3A\u5360\u4F4D\u7EC4\u4EF6 \u6BD4\u5982 &lt;&gt;&lt;/&gt;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// false</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">isUnkeyedTopLevelFragment</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#CB7676;">typeof</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">newChild</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">object</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">newChild</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">newChild</span><span style="color:#666666;">.</span><span style="color:#BD976A;">type</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">REACT_FRAGMENT_TYPE</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">newChild</span><span style="color:#666666;">.</span><span style="color:#BD976A;">key</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5982\u679C newChild \u4E3A\u5360\u4F4D\u7B26, \u4F7F\u7528 \u5360\u4F4D\u7B26\u7EC4\u4EF6\u7684\u5B50\u5143\u7D20\u4F5C\u4E3A newChild</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">isUnkeyedTopLevelFragment</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">newChild</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">newChild</span><span style="color:#666666;">.</span><span style="color:#BD976A;">props</span><span style="color:#666666;">.</span><span style="color:#BD976A;">children</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u68C0\u6D4B newChild \u662F\u5426\u4E3A\u5BF9\u8C61\u7C7B\u578B</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">isObject</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">typeof</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">newChild</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">object</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">newChild</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// newChild \u662F\u5355\u4E2A\u5BF9\u8C61\u7684\u60C5\u51B5</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">isObject</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5339\u914D\u5B50\u5143\u7D20\u7684\u7C7B\u578B</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">switch</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">newChild</span><span style="color:#666666;">.</span><span style="color:#BD976A;">$$typeof</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u5B50\u5143\u7D20\u4E3A ReactElement</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">REACT_ELEMENT_TYPE</span><span style="color:#666666;">:</span></span>
<span class="line"><span style="color:#666666;">                    </span><span style="color:#758575DD;">// \u4E3A Fiber \u5BF9\u8C61\u8BBE\u7F6E effectTag \u5C5E\u6027</span></span>
<span class="line"><span style="color:#666666;">                    </span><span style="color:#758575DD;">// \u8FD4\u56DE\u521B\u5EFA\u597D\u7684\u5B50 Fiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">placeSingleChild</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#666666;">                        </span><span style="color:#758575DD;">// \u5904\u7406\u5355\u4E2A React Element \u7684\u60C5\u51B5</span></span>
<span class="line"><span style="color:#666666;">                        </span><span style="color:#758575DD;">// \u5185\u90E8\u4F1A\u8C03\u7528\u5176\u4ED6\u65B9\u6CD5\u521B\u5EFA\u5BF9\u5E94\u7684 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                        </span><span style="color:#80A665;">reconcileSingleElement</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                            </span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                            </span><span style="color:#BD976A;">currentFirstChild</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                            </span><span style="color:#BD976A;">newChild</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                            </span><span style="color:#BD976A;">expirationTime</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                        </span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5904\u7406 children \u4E3A\u6587\u672C\u548C\u6570\u503C\u7684\u60C5\u51B5 return &quot;App works&quot;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#CB7676;">typeof</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">newChild</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">string</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">||</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">typeof</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">newChild</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">number</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">placeSingleChild</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#80A665;">reconcileSingleTextNode</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">currentFirstChild</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">                    </span><span style="color:#758575DD;">// \u5982\u679C newChild \u662F\u6570\u503C, \u8F6C\u6362\u4E3A\u5B57\u7B26\u4E32</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#C98A7DAA;">&#39;&#39;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">+</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">newChild</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">expirationTime</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// children \u662F\u6570\u7EC4\u7684\u60C5\u51B5</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#80A665;">isArray</span><span style="color:#666666;">(</span><span style="color:#BD976A;">newChild</span><span style="color:#666666;">))</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u8FD4\u56DE\u521B\u5EFA\u597D\u7684\u5B50 Fiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">reconcileChildrenArray</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">currentFirstChild</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">newChild</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">expirationTime</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * shouldTrackSideEffects \u6807\u8BC6, \u662F\u5426\u4E3A Fiber \u5BF9\u8C61\u6DFB\u52A0 effectTag</span></span>
<span class="line"><span style="color:#A0ADA0;"> * true \u6DFB\u52A0 false \u4E0D\u6DFB\u52A0</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u5BF9\u4E8E\u521D\u59CB\u6E32\u67D3\u6765\u8BF4, \u53EA\u6709\u6839\u7EC4\u4EF6\u9700\u8981\u6DFB\u52A0, \u5176\u4ED6\u5143\u7D20\u4E0D\u9700\u8981\u6DFB\u52A0, \u9632\u6B62\u8FC7\u591A\u7684 DOM \u64CD\u4F5C</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#A0ADA0;">// \u7528\u4E8E\u521D\u59CB\u6E32\u67D3</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">mountChildFibers</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">ChildReconciler</span><span style="color:#999999;">(</span><span style="color:#1E754F;">false</span><span style="color:#999999;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">ChildReconciler</span><span style="color:#999999;">(</span><span style="color:#B07D48;">shouldTrackSideEffects</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">placeChild</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">newFiber</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">lastPlacedIndex</span><span style="color:#999999;">: </span><span style="color:#2E808F;">number</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">newIndex</span><span style="color:#999999;">: </span><span style="color:#2E808F;">number</span></span>
<span class="line"><span style="color:#999999;">    ):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">number</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">newFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">index</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">newIndex</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#AB5959;">!</span><span style="color:#B07D48;">shouldTrackSideEffects</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">lastPlacedIndex</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5FFD\u7565\u4E86\u4E00\u90E8\u5206\u521D\u59CB\u5316\u6E32\u67D3\u4E0D\u6267\u884C\u7684\u4EE3\u7801</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">placeSingleChild</span><span style="color:#999999;">(</span><span style="color:#B07D48;">newFiber</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">Fiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5982\u679C\u662F\u521D\u59CB\u6E32\u67D3 \u4F1A\u5728\u6839\u7EC4\u4EF6(App)\u4E0A\u8BBE\u7F6E effectTag \u5C5E\u6027\u4E3A Placement \u503C\u4E3A 1</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5176\u4ED6\u5B50\u7EA7\u8282\u70B9\u5177\u6709\u9ED8\u8BA4\u503C\u4E3A 0 \u9632\u6B62\u5728 commit \u9636\u6BB5\u53CD\u590D\u64CD\u4F5C\u771F\u5B9EDOM</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3\u65F6\u5982\u679C\u5F53\u524D\u5904\u7406\u7684\u662F\u6839\u7EC4\u4EF6 true \u5176\u4ED6\u7EC4\u4EF6 false</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">shouldTrackSideEffects</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">newFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">alternate</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// Placement \u8868\u793A\u65B0\u521B\u5EFA\u7684\u8282\u70B9</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">newFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">effectTag</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Placement</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">newFiber</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5904\u7406\u5B50\u5143\u7D20\u662F\u6570\u7EC4\u7684\u60C5\u51B5</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">reconcileChildrenArray</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u7236\u7EA7 Fiber</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">currentFirstChild</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;"> | </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5B50\u7EA7 vdom \u6570\u7EC4</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">newChildren</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Array</span><span style="color:#999999;">&lt;*&gt;,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">expirationTime</span><span style="color:#999999;">: </span><span style="color:#2E808F;">ExpirationTime</span></span>
<span class="line"><span style="color:#999999;">    ):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">Fiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">         * \u5B58\u50A8\u7B2C\u4E00\u4E2A\u5B50\u8282\u70B9 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#A0ADA0;">         * \u65B9\u6CD5\u8FD4\u56DE\u7684\u4E5F\u662F\u7B2C\u4E00\u4E2A\u5B50\u8282\u70B9 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#A0ADA0;">         * \u56E0\u4E3A\u5176\u4ED6\u5B50\u8282\u70B9 Fiber \u5BF9\u8C61\u90FD\u5B58\u50A8\u5728\u4E0A\u4E00\u4E2A\u5B50 Fiber \u8282\u70B9\u5BF9\u8C61\u7684 sibling \u5C5E\u6027\u4E2D</span></span>
<span class="line"><span style="color:#A0ADA0;">         */</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">resultingFirstChild</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;"> | </span><span style="color:#AB5959;">null</span><span style="color:#999999;"> =</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u4E0A\u4E00\u6B21\u521B\u5EFA\u7684 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">previousNewFiber</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;"> | </span><span style="color:#AB5959;">null</span><span style="color:#999999;"> =</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3\u6CA1\u6709\u65E7\u7684\u5B50\u7EA7 \u6240\u4EE5\u4E3A null</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">oldFiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">currentFirstChild</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">lastPlacedIndex</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">newIdx</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextOldFiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// oldFiber \u4E3A\u7A7A \u8BF4\u660E\u662F\u521D\u59CB\u6E32\u67D3</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">oldFiber</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u904D\u5386\u5B50 vdom \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">for</span><span style="color:#393A34;"> </span><span style="color:#999999;">(;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">newIdx</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">newChildren</span><span style="color:#999999;">.</span><span style="color:#998418;">length</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">newIdx</span><span style="color:#AB5959;">++</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u521B\u5EFA\u5B50 vdom \u5BF9\u5E94\u7684 fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">newFiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">createChild</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">newChildren</span><span style="color:#999999;">[</span><span style="color:#B07D48;">newIdx</span><span style="color:#999999;">],</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">expirationTime</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u5982\u679C newFiber \u4E3A null</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">newFiber</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                    </span><span style="color:#A0ADA0;">// \u8FDB\u5165\u4E0B\u6B21\u5FAA\u73AF</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#1E754F;">continue</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3\u65F6\u53EA\u4E3A newFiber \u6DFB\u52A0\u4E86 index \u5C5E\u6027,</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u5176\u4ED6\u4E8B\u6CA1\u5E72. lastPlacedIndex \u88AB\u539F\u5C01\u4E0D\u52A8\u7684\u8FD4\u56DE\u4E86</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">lastPlacedIndex</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">placeChild</span><span style="color:#999999;">(</span><span style="color:#B07D48;">newFiber</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">lastPlacedIndex</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">newIdx</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u4E3A\u5F53\u524D\u8282\u70B9\u8BBE\u7F6E\u4E0B\u4E00\u4E2A\u5144\u5F1F\u8282\u70B9</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">previousNewFiber</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                    </span><span style="color:#A0ADA0;">// \u5B58\u50A8\u7B2C\u4E00\u4E2A\u5B50 Fiber \u53D1\u751F\u5728\u7B2C\u4E00\u6B21\u5FAA\u73AF\u65F6</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">resultingFirstChild</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">newFiber</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                    </span><span style="color:#A0ADA0;">// \u4E3A\u8282\u70B9\u8BBE\u7F6E\u4E0B\u4E00\u4E2A\u5144\u5F1F Fiber</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">previousNewFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">sibling</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">newFiber</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u5728\u5FAA\u73AF\u7684\u8FC7\u7A0B\u4E2D\u66F4\u65B0\u4E0A\u4E00\u4E2A\u521B\u5EFA\u7684Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">previousNewFiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">newFiber</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u8FD4\u56DE\u521B\u5EFA\u597D\u7684\u5B50 Fiber</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5176\u4ED6 Fiber \u90FD\u4F5C\u4E3A sibling \u5B58\u5728</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">resultingFirstChild</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u8FD4\u56DE\u7B2C\u4E00\u4E2A\u5B50\u5143\u7D20 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">resultingFirstChild</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5904\u7406\u5B50\u5143\u7D20\u662F\u6587\u672C\u6216\u8005\u6570\u503C\u7684\u60C5\u51B5</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">reconcileSingleTextNode</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">currentFirstChild</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;"> | </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">textContent</span><span style="color:#999999;">: </span><span style="color:#2E808F;">string</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">expirationTime</span><span style="color:#999999;">: </span><span style="color:#2E808F;">ExpirationTime</span></span>
<span class="line"><span style="color:#999999;">    ):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">Fiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3\u4E0D\u6267\u884C</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">currentFirstChild</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">currentFirstChild</span><span style="color:#999999;">.</span><span style="color:#B07D48;">tag</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostText</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// We already have an existing node so let&#39;s just update it and delete</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// the rest.</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#59873A;">deleteRemainingChildren</span><span style="color:#999999;">(</span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">currentFirstChild</span><span style="color:#999999;">.</span><span style="color:#B07D48;">sibling</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">existing</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">useFiber</span><span style="color:#999999;">(</span><span style="color:#B07D48;">currentFirstChild</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">textContent</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">existing</span><span style="color:#999999;">.</span><span style="color:#B07D48;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">existing</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u73B0\u6709\u7684\u7B2C\u4E00\u4E2A\u5B50\u8282\u70B9\u4E0D\u662F\u6587\u672C\u8282\u70B9\uFF0C\u56E0\u6B64\u6211\u4EEC\u9700\u8981\u521B\u5EFA\u4E00\u4E2A\u5E76\u5220\u9664\u73B0\u6709\u7684.</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3\u4E0D\u6267\u884C</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">deleteRemainingChildren</span><span style="color:#999999;">(</span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">currentFirstChild</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u6839\u636E\u6587\u672C\u521B\u5EFA Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">created</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">createFiberFromText</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">textContent</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">mode</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">expirationTime</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u8BBE\u7F6E\u7236 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">created</span><span style="color:#999999;">.</span><span style="color:#B07D48;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u8FD4\u56DE\u521B\u5EFA\u597D\u7684 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">created</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5904\u7406\u5B50\u5143\u7D20\u662F\u5355\u4E2A\u5BF9\u8C61\u7684\u60C5\u51B5</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">reconcileSingleElement</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u7236 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5907\u4EFD\u5B50 fiber</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">currentFirstChild</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;"> | </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5B50 vdom \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">element</span><span style="color:#999999;">: </span><span style="color:#2E808F;">ReactElement</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">expirationTime</span><span style="color:#999999;">: </span><span style="color:#2E808F;">ExpirationTime</span></span>
<span class="line"><span style="color:#999999;">    ):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">Fiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u67E5\u770B\u5B50 vdom \u5BF9\u8C61\u662F\u5426\u8868\u793A fragment</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">element</span><span style="color:#999999;">.</span><span style="color:#B07D48;">type</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">REACT_FRAGMENT_TYPE</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// false</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u6839\u636E React Element \u521B\u5EFA Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u8FD4\u56DE\u521B\u5EFA\u597D\u7684 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">created</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">createFiberFromElement</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">element</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u7528\u6765\u8868\u793A\u5F53\u524D\u7EC4\u4EF6\u4E0B\u7684\u6240\u6709\u5B50\u7EC4\u4EF6\u8981\u7528\u5904\u4E8E\u4F55\u79CD\u6E32\u67D3\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u6587\u4EF6\u4F4D\u7F6E: ./ReactTypeOfMode.js</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// 0    \u540C\u6B65\u6E32\u67D3\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// 100  \u5F02\u6B65\u6E32\u67D3\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">mode</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">expirationTime</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u6DFB\u52A0 ref \u5C5E\u6027 { current: DOM }</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">created</span><span style="color:#999999;">.</span><span style="color:#B07D48;">ref</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">coerceRef</span><span style="color:#999999;">(</span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">currentFirstChild</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">element</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u6DFB\u52A0\u7236\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">created</span><span style="color:#999999;">.</span><span style="color:#B07D48;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u8FD4\u56DE\u521B\u5EFA\u597D\u7684\u5B50 Fiber</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">created</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">reconcileChildFibers</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u7236 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u65E7\u7684\u7B2C\u4E00\u4E2A\u5B50 Fiber \u521D\u59CB\u6E32\u67D3 null</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">currentFirstChild</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;"> | </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u65B0\u7684\u5B50 vdom \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">newChild</span><span style="color:#999999;">: </span><span style="color:#2E808F;">any</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3 \u6574\u578B\u6700\u5927\u503C \u4EE3\u8868\u540C\u6B65\u4EFB\u52A1</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">expirationTime</span><span style="color:#999999;">: </span><span style="color:#2E808F;">ExpirationTime</span></span>
<span class="line"><span style="color:#999999;">    ):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">Fiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u8FD9\u662F\u5165\u53E3\u65B9\u6CD5, \u6839\u636E newChild \u7C7B\u578B\u8FDB\u884C\u5BF9\u5E94\u5904\u7406</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5224\u65AD\u65B0\u7684\u5B50 vdom \u662F\u5426\u4E3A\u5360\u4F4D\u7EC4\u4EF6 \u6BD4\u5982 &lt;&gt;&lt;/&gt;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// false</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">isUnkeyedTopLevelFragment</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#AB5959;">typeof</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">newChild</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">object</span><span style="color:#B56959AA;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">newChild</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">newChild</span><span style="color:#999999;">.</span><span style="color:#B07D48;">type</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">REACT_FRAGMENT_TYPE</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">newChild</span><span style="color:#999999;">.</span><span style="color:#B07D48;">key</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5982\u679C newChild \u4E3A\u5360\u4F4D\u7B26, \u4F7F\u7528 \u5360\u4F4D\u7B26\u7EC4\u4EF6\u7684\u5B50\u5143\u7D20\u4F5C\u4E3A newChild</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">isUnkeyedTopLevelFragment</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">newChild</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">newChild</span><span style="color:#999999;">.</span><span style="color:#B07D48;">props</span><span style="color:#999999;">.</span><span style="color:#B07D48;">children</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u68C0\u6D4B newChild \u662F\u5426\u4E3A\u5BF9\u8C61\u7C7B\u578B</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">isObject</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">typeof</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">newChild</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">object</span><span style="color:#B56959AA;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">newChild</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// newChild \u662F\u5355\u4E2A\u5BF9\u8C61\u7684\u60C5\u51B5</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">isObject</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5339\u914D\u5B50\u5143\u7D20\u7684\u7C7B\u578B</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">switch</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">newChild</span><span style="color:#999999;">.</span><span style="color:#B07D48;">$$typeof</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u5B50\u5143\u7D20\u4E3A ReactElement</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">REACT_ELEMENT_TYPE</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#999999;">                    </span><span style="color:#A0ADA0;">// \u4E3A Fiber \u5BF9\u8C61\u8BBE\u7F6E effectTag \u5C5E\u6027</span></span>
<span class="line"><span style="color:#999999;">                    </span><span style="color:#A0ADA0;">// \u8FD4\u56DE\u521B\u5EFA\u597D\u7684\u5B50 Fiber</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#59873A;">placeSingleChild</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#999999;">                        </span><span style="color:#A0ADA0;">// \u5904\u7406\u5355\u4E2A React Element \u7684\u60C5\u51B5</span></span>
<span class="line"><span style="color:#999999;">                        </span><span style="color:#A0ADA0;">// \u5185\u90E8\u4F1A\u8C03\u7528\u5176\u4ED6\u65B9\u6CD5\u521B\u5EFA\u5BF9\u5E94\u7684 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">                        </span><span style="color:#59873A;">reconcileSingleElement</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">                            </span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                            </span><span style="color:#B07D48;">currentFirstChild</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                            </span><span style="color:#B07D48;">newChild</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                            </span><span style="color:#B07D48;">expirationTime</span></span>
<span class="line"><span style="color:#393A34;">                        </span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5904\u7406 children \u4E3A\u6587\u672C\u548C\u6570\u503C\u7684\u60C5\u51B5 return &quot;App works&quot;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#AB5959;">typeof</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">newChild</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">string</span><span style="color:#B56959AA;">&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">||</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">typeof</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">newChild</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">number</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#59873A;">placeSingleChild</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#59873A;">reconcileSingleTextNode</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">currentFirstChild</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">                    </span><span style="color:#A0ADA0;">// \u5982\u679C newChild \u662F\u6570\u503C, \u8F6C\u6362\u4E3A\u5B57\u7B26\u4E32</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B56959AA;">&#39;&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">newChild</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">expirationTime</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// children \u662F\u6570\u7EC4\u7684\u60C5\u51B5</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#59873A;">isArray</span><span style="color:#999999;">(</span><span style="color:#B07D48;">newChild</span><span style="color:#999999;">))</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u8FD4\u56DE\u521B\u5EFA\u597D\u7684\u5B50 Fiber</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#59873A;">reconcileChildrenArray</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">currentFirstChild</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">newChild</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">expirationTime</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-1-8-10-completeunitofwork" tabindex="-1">5.1.8.10 completeUnitOfWork <a class="header-anchor" href="#_5-1-8-10-completeunitofwork" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberWorkLoop.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> *</span></span>
<span class="line"><span style="color:#758575DD;"> * \u4ECE\u4E0B\u81F3\u4E0A\u79FB\u52A8\u5230\u8BE5\u8282\u70B9\u7684\u5144\u5F1F\u8282\u70B9, \u5982\u679C\u4E00\u76F4\u5F80\u4E0A\u6CA1\u6709\u5144\u5F1F\u8282\u70B9\u5C31\u8FD4\u56DE\u7236\u8282\u70B9, \u6700\u7EC8\u4F1A\u5230\u8FBE root \u8282\u70B9</span></span>
<span class="line"><span style="color:#758575DD;"> * 1. \u521B\u5EFA\u5176\u4ED6\u8282\u70B9\u7684 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#758575DD;"> * 2. \u521B\u5EFA\u6BCF\u4E00\u4E2A\u8282\u70B9\u7684\u771F\u5B9E DOM \u5BF9\u8C61\u5E76\u5C06\u5176\u6DFB\u52A0\u5230 stateNode \u5C5E\u6027\u4E2D</span></span>
<span class="line"><span style="color:#758575DD;"> * 3. \u6784\u5EFA effect \u94FE\u8868\u7ED3\u6784</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">completeUnitOfWork</span><span style="color:#666666;">(</span><span style="color:#BD976A;">unitOfWork</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u4E3A workInProgress \u5168\u5C40\u53D8\u91CF\u91CD\u65B0\u8D4B\u503C</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">workInProgress</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">unitOfWork</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">do</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u83B7\u53D6\u5907\u4EFD\u8282\u70B9</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u521D\u59CB\u5316\u6E32\u67D3 \u975E\u6839 Fiber \u5BF9\u8C61\u6CA1\u6709\u5907\u4EFD\u8282\u70B9 \u6240\u4EE5 current \u4E3A null</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">alternate</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u7236\u7EA7 Fiber \u5BF9\u8C61, \u975E\u6839 Fiber \u5BF9\u8C61\u90FD\u6709\u7236\u7EA7</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">returnFiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">return</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5224\u65AD\u4F20\u5165\u7684 Fiber \u5BF9\u8C61\u662F\u5426\u6784\u5EFA\u5B8C\u6210, \u4EFB\u52A1\u8C03\u5EA6\u76F8\u5173</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// &amp; \u662F\u8868\u793A\u4F4D\u7684\u4E0E\u8FD0\u7B97, \u628A\u5DE6\u53F3\u4E24\u8FB9\u7684\u6570\u5B57\u8F6C\u5316\u4E3A\u4E8C\u8FDB\u5236</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u7136\u540E\u6BCF\u4E00\u4F4D\u5206\u522B\u8FDB\u884C\u6BD4\u8F83, \u5982\u679C\u76F8\u7B49\u5C31\u4E3A1, \u4E0D\u76F8\u7B49\u5373\u4E3A0</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u6B64\u5904\u5E94\u7528&quot;\u4F4D\u4E0E&quot;\u8FD0\u7B97\u7B26\u7684\u76EE\u7684\u662F&quot;\u6E05\u96F6&quot;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// true</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">((</span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">effectTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Incomplete</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoEffect</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">next</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5982\u679C\u4E0D\u80FD\u4F7F\u7528\u5206\u6790\u5668\u7684 timer, \u76F4\u63A5\u6267\u884C completeWork</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// enableProfilerTimer =&gt; true</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u4F46\u6B64\u5904\u65E0\u8BBA\u6761\u4EF6\u662F\u5426\u6210\u7ACB\u90FD\u4F1A\u6267\u884C completeWork</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#CB7676;">!</span><span style="color:#BD976A;">enableProfilerTimer</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">||</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#666666;">(</span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">mode</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ProfileMode</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoMode</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u91CD\u70B9\u4EE3\u7801(\u4E8C)</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u521B\u5EFA\u8282\u70B9\u771F\u5B9E DOM \u5BF9\u8C61\u5E76\u5C06\u5176\u6DFB\u52A0\u5230 stateNode \u5C5E\u6027\u4E2D</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">next</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">completeWork</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">renderExpirationTime</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u521B\u5EFA\u8282\u70B9\u771F\u5B9E DOM \u5BF9\u8C61\u5E76\u5C06\u5176\u6DFB\u52A0\u5230 stateNode \u5C5E\u6027\u4E2D</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">next</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">completeWork</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">renderExpirationTime</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u91CD\u70B9\u4EE3\u7801(\u4E00)</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5982\u679C\u5B50\u7EA7\u5B58\u5728</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">next</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u8FD4\u56DE\u5B50\u7EA7 \u4E00\u76F4\u8FD4\u56DE\u5230 workLoopSync</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u518D\u91CD\u65B0\u6267\u884C performUnitOfWork \u6784\u5EFA\u5B50\u7EA7 Fiber \u8282\u70B9\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">next</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u6784\u5EFA effect \u94FE\u8868\u7ED3\u6784</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5982\u679C\u4E0D\u662F\u6839 Fiber \u5C31\u662F true \u5426\u5219\u5C31\u662F false</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5C06\u5B50\u6811\u548C\u6B64 Fiber \u7684\u6240\u6709 effect \u9644\u52A0\u5230\u7236\u7EA7\u7684 effect \u5217\u8868\u4E2D</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u5982\u679C\u7236 Fiber \u5B58\u5728 \u5E76\u4E14</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">returnFiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u7236 Fiber \u5BF9\u8C61\u4E2D\u7684 effectTag \u4E3A 0</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#666666;">(</span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">effectTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Incomplete</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoEffect</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u5C06\u5B50\u6811\u548C\u6B64 Fiber \u7684\u6240\u6709\u526F\u4F5C\u7528\u9644\u52A0\u5230\u7236\u7EA7\u7684 effect \u5217\u8868\u4E0A</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u4EE5\u4E0B\u4E24\u4E2A\u5224\u65AD\u7684\u4F5C\u7528\u662F\u641C\u96C6\u5B50 Fiber\u7684 effect \u5230\u7236 Fiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">firstEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                    </span><span style="color:#758575DD;">// first</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">firstEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">firstEffect</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">lastEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">lastEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                        </span><span style="color:#758575DD;">// next</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                        </span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">lastEffect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">nextEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                            </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">firstEffect</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">                    </span><span style="color:#758575DD;">// last</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">lastEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">lastEffect</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u83B7\u53D6\u526F\u4F5C\u7528\u6807\u8BB0</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3\u65F6\u9664[\u6839\u7EC4\u4EF6]\u4EE5\u5916\u7684 Fiber, effectTag \u503C\u90FD\u4E3A 0, \u5373\u4E0D\u9700\u8981\u6267\u884C\u4EFB\u4F55\u771F\u5B9EDOM\u64CD\u4F5C</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u6839\u7EC4\u4EF6\u7684 effectTag \u503C\u4E3A 3, \u5373\u9700\u8981\u5C06\u6B64\u8282\u70B9\u5BF9\u5E94\u7684\u771F\u5B9EDOM\u5BF9\u8C61\u6DFB\u52A0\u5230\u9875\u9762\u4E2D</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">effectTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">effectTag</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u521B\u5EFA effect \u5217\u8868\u65F6\u8DF3\u8FC7 NoWork(0) \u548C PerformedWork(1) \u6807\u8BB0</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// PerformedWork \u7531 React DevTools \u8BFB\u53D6, \u4E0D\u63D0\u4EA4</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3\u65F6 \u53EA\u6709\u904D\u5386\u5230\u4E86\u6839\u7EC4\u4EF6 \u5224\u65AD\u6761\u4EF6\u624D\u80FD\u6210\u7ACB, \u5C06 effect \u94FE\u8868\u6DFB\u52A0\u5230 rootFiber</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3 FiberRoot \u5BF9\u8C61\u4E2D\u7684 firstEffect \u548C lastEffect \u90FD\u662F App \u7EC4\u4EF6</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u56E0\u4E3A\u5F53\u6240\u6709\u8282\u70B9\u5728\u5185\u5B58\u4E2D\u6784\u5EFA\u5B8C\u6210\u540E, \u53EA\u9700\u8981\u4E00\u6B21\u5C06\u6240\u6709 DOM \u6DFB\u52A0\u5230\u9875\u9762\u4E2D</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">effectTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">PerformedWork</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                    </span><span style="color:#758575DD;">// false</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">lastEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                        </span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">lastEffect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">nextEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                        </span><span style="color:#758575DD;">// \u4E3A fiberRoot \u6DFB\u52A0 firstEffect</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                        </span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">firstEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">                    </span><span style="color:#758575DD;">// \u4E3A fiberRoot \u6DFB\u52A0 lastEffect</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">lastEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5FFD\u7565\u4E86\u521D\u59CB\u6E32\u67D3\u4E0D\u6267\u884C\u7684\u4EE3\u7801</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u83B7\u53D6\u4E0B\u4E00\u4E2A\u540C\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">siblingFiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">sibling</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5982\u679C\u4E0B\u4E00\u4E2A\u540C\u7EA7 Fiber \u5BF9\u8C61\u5B58\u5728</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">siblingFiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u8FD4\u56DE\u4E0B\u4E00\u4E2A\u540C\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">siblingFiber</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5426\u5219\u9000\u56DE\u7236\u7EA7</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">workInProgress</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">returnFiber</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">while</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">workInProgress</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5F53\u6267\u884C\u5230\u8FD9\u91CC\u7684\u65F6\u5019, \u8BF4\u660E\u904D\u5386\u5230\u4E86 root \u8282\u70B9, \u5DF2\u5B8C\u6210\u904D\u5386</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u66F4\u65B0 workInProgressRootExitStatus \u7684\u72B6\u6001\u4E3A \u5DF2\u5B8C\u6210</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">workInProgressRootExitStatus</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">RootIncomplete</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">workInProgressRootExitStatus</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">RootCompleted</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> *</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u4ECE\u4E0B\u81F3\u4E0A\u79FB\u52A8\u5230\u8BE5\u8282\u70B9\u7684\u5144\u5F1F\u8282\u70B9, \u5982\u679C\u4E00\u76F4\u5F80\u4E0A\u6CA1\u6709\u5144\u5F1F\u8282\u70B9\u5C31\u8FD4\u56DE\u7236\u8282\u70B9, \u6700\u7EC8\u4F1A\u5230\u8FBE root \u8282\u70B9</span></span>
<span class="line"><span style="color:#A0ADA0;"> * 1. \u521B\u5EFA\u5176\u4ED6\u8282\u70B9\u7684 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#A0ADA0;"> * 2. \u521B\u5EFA\u6BCF\u4E00\u4E2A\u8282\u70B9\u7684\u771F\u5B9E DOM \u5BF9\u8C61\u5E76\u5C06\u5176\u6DFB\u52A0\u5230 stateNode \u5C5E\u6027\u4E2D</span></span>
<span class="line"><span style="color:#A0ADA0;"> * 3. \u6784\u5EFA effect \u94FE\u8868\u7ED3\u6784</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">completeUnitOfWork</span><span style="color:#999999;">(</span><span style="color:#B07D48;">unitOfWork</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">Fiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u4E3A workInProgress \u5168\u5C40\u53D8\u91CF\u91CD\u65B0\u8D4B\u503C</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">workInProgress</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">unitOfWork</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">do</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u5907\u4EFD\u8282\u70B9</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u521D\u59CB\u5316\u6E32\u67D3 \u975E\u6839 Fiber \u5BF9\u8C61\u6CA1\u6709\u5907\u4EFD\u8282\u70B9 \u6240\u4EE5 current \u4E3A null</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">alternate</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u7236\u7EA7 Fiber \u5BF9\u8C61, \u975E\u6839 Fiber \u5BF9\u8C61\u90FD\u6709\u7236\u7EA7</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">returnFiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">return</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5224\u65AD\u4F20\u5165\u7684 Fiber \u5BF9\u8C61\u662F\u5426\u6784\u5EFA\u5B8C\u6210, \u4EFB\u52A1\u8C03\u5EA6\u76F8\u5173</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// &amp; \u662F\u8868\u793A\u4F4D\u7684\u4E0E\u8FD0\u7B97, \u628A\u5DE6\u53F3\u4E24\u8FB9\u7684\u6570\u5B57\u8F6C\u5316\u4E3A\u4E8C\u8FDB\u5236</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u7136\u540E\u6BCF\u4E00\u4F4D\u5206\u522B\u8FDB\u884C\u6BD4\u8F83, \u5982\u679C\u76F8\u7B49\u5C31\u4E3A1, \u4E0D\u76F8\u7B49\u5373\u4E3A0</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u6B64\u5904\u5E94\u7528&quot;\u4F4D\u4E0E&quot;\u8FD0\u7B97\u7B26\u7684\u76EE\u7684\u662F&quot;\u6E05\u96F6&quot;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// true</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">((</span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">effectTag</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Incomplete</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoEffect</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">next</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5982\u679C\u4E0D\u80FD\u4F7F\u7528\u5206\u6790\u5668\u7684 timer, \u76F4\u63A5\u6267\u884C completeWork</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// enableProfilerTimer =&gt; true</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u4F46\u6B64\u5904\u65E0\u8BBA\u6761\u4EF6\u662F\u5426\u6210\u7ACB\u90FD\u4F1A\u6267\u884C completeWork</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#AB5959;">!</span><span style="color:#B07D48;">enableProfilerTimer</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">||</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#999999;">(</span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">mode</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ProfileMode</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoMode</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u91CD\u70B9\u4EE3\u7801(\u4E8C)</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u521B\u5EFA\u8282\u70B9\u771F\u5B9E DOM \u5BF9\u8C61\u5E76\u5C06\u5176\u6DFB\u52A0\u5230 stateNode \u5C5E\u6027\u4E2D</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">next</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">completeWork</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">renderExpirationTime</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u521B\u5EFA\u8282\u70B9\u771F\u5B9E DOM \u5BF9\u8C61\u5E76\u5C06\u5176\u6DFB\u52A0\u5230 stateNode \u5C5E\u6027\u4E2D</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">next</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">completeWork</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">renderExpirationTime</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u91CD\u70B9\u4EE3\u7801(\u4E00)</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5982\u679C\u5B50\u7EA7\u5B58\u5728</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">next</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u8FD4\u56DE\u5B50\u7EA7 \u4E00\u76F4\u8FD4\u56DE\u5230 workLoopSync</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u518D\u91CD\u65B0\u6267\u884C performUnitOfWork \u6784\u5EFA\u5B50\u7EA7 Fiber \u8282\u70B9\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">next</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u6784\u5EFA effect \u94FE\u8868\u7ED3\u6784</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5982\u679C\u4E0D\u662F\u6839 Fiber \u5C31\u662F true \u5426\u5219\u5C31\u662F false</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5C06\u5B50\u6811\u548C\u6B64 Fiber \u7684\u6240\u6709 effect \u9644\u52A0\u5230\u7236\u7EA7\u7684 effect \u5217\u8868\u4E2D</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u5982\u679C\u7236 Fiber \u5B58\u5728 \u5E76\u4E14</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">returnFiber</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u7236 Fiber \u5BF9\u8C61\u4E2D\u7684 effectTag \u4E3A 0</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#999999;">(</span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">effectTag</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Incomplete</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoEffect</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u5C06\u5B50\u6811\u548C\u6B64 Fiber \u7684\u6240\u6709\u526F\u4F5C\u7528\u9644\u52A0\u5230\u7236\u7EA7\u7684 effect \u5217\u8868\u4E0A</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u4EE5\u4E0B\u4E24\u4E2A\u5224\u65AD\u7684\u4F5C\u7528\u662F\u641C\u96C6\u5B50 Fiber\u7684 effect \u5230\u7236 Fiber</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">firstEffect</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                    </span><span style="color:#A0ADA0;">// first</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">firstEffect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">firstEffect</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">lastEffect</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">lastEffect</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                        </span><span style="color:#A0ADA0;">// next</span></span>
<span class="line"><span style="color:#393A34;">                        </span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">lastEffect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">nextEffect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span></span>
<span class="line"><span style="color:#393A34;">                            </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">firstEffect</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">                    </span><span style="color:#A0ADA0;">// last</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">lastEffect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">lastEffect</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u526F\u4F5C\u7528\u6807\u8BB0</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3\u65F6\u9664[\u6839\u7EC4\u4EF6]\u4EE5\u5916\u7684 Fiber, effectTag \u503C\u90FD\u4E3A 0, \u5373\u4E0D\u9700\u8981\u6267\u884C\u4EFB\u4F55\u771F\u5B9EDOM\u64CD\u4F5C</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u6839\u7EC4\u4EF6\u7684 effectTag \u503C\u4E3A 3, \u5373\u9700\u8981\u5C06\u6B64\u8282\u70B9\u5BF9\u5E94\u7684\u771F\u5B9EDOM\u5BF9\u8C61\u6DFB\u52A0\u5230\u9875\u9762\u4E2D</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">effectTag</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">effectTag</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u521B\u5EFA effect \u5217\u8868\u65F6\u8DF3\u8FC7 NoWork(0) \u548C PerformedWork(1) \u6807\u8BB0</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// PerformedWork \u7531 React DevTools \u8BFB\u53D6, \u4E0D\u63D0\u4EA4</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3\u65F6 \u53EA\u6709\u904D\u5386\u5230\u4E86\u6839\u7EC4\u4EF6 \u5224\u65AD\u6761\u4EF6\u624D\u80FD\u6210\u7ACB, \u5C06 effect \u94FE\u8868\u6DFB\u52A0\u5230 rootFiber</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3 FiberRoot \u5BF9\u8C61\u4E2D\u7684 firstEffect \u548C lastEffect \u90FD\u662F App \u7EC4\u4EF6</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u56E0\u4E3A\u5F53\u6240\u6709\u8282\u70B9\u5728\u5185\u5B58\u4E2D\u6784\u5EFA\u5B8C\u6210\u540E, \u53EA\u9700\u8981\u4E00\u6B21\u5C06\u6240\u6709 DOM \u6DFB\u52A0\u5230\u9875\u9762\u4E2D</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">effectTag</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">PerformedWork</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                    </span><span style="color:#A0ADA0;">// false</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">lastEffect</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">                        </span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">lastEffect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">nextEffect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                        </span><span style="color:#A0ADA0;">// \u4E3A fiberRoot \u6DFB\u52A0 firstEffect</span></span>
<span class="line"><span style="color:#393A34;">                        </span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">firstEffect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">                    </span><span style="color:#A0ADA0;">// \u4E3A fiberRoot \u6DFB\u52A0 lastEffect</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">lastEffect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5FFD\u7565\u4E86\u521D\u59CB\u6E32\u67D3\u4E0D\u6267\u884C\u7684\u4EE3\u7801</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u4E0B\u4E00\u4E2A\u540C\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">siblingFiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">sibling</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5982\u679C\u4E0B\u4E00\u4E2A\u540C\u7EA7 Fiber \u5BF9\u8C61\u5B58\u5728</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">siblingFiber</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u8FD4\u56DE\u4E0B\u4E00\u4E2A\u540C\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">siblingFiber</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5426\u5219\u9000\u56DE\u7236\u7EA7</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">workInProgress</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">returnFiber</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">while</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">workInProgress</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5F53\u6267\u884C\u5230\u8FD9\u91CC\u7684\u65F6\u5019, \u8BF4\u660E\u904D\u5386\u5230\u4E86 root \u8282\u70B9, \u5DF2\u5B8C\u6210\u904D\u5386</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u66F4\u65B0 workInProgressRootExitStatus \u7684\u72B6\u6001\u4E3A \u5DF2\u5B8C\u6210</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">workInProgressRootExitStatus</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">RootIncomplete</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">workInProgressRootExitStatus</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">RootCompleted</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-1-8-11-completework" tabindex="-1">5.1.8.11 completeWork <a class="header-anchor" href="#_5-1-8-11-completework" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberCompleteWork.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">completeWork</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">current</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;"> | </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">renderExpirationTime</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">ExpirationTime</span></span>
<span class="line"><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6\u5F85\u66F4\u65B0 props</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">newProps</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">pendingProps</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">switch</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">tag</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// 0</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">FunctionComponent</span><span style="color:#666666;">:</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// 3</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostRoot</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#80A665;">updateHostContainer</span><span style="color:#666666;">(</span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// 5</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostComponent</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u83B7\u53D6 rootDOM \u8282\u70B9 &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">rootContainerInstance</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">getRootHostContainer</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u8282\u70B9\u7684\u5177\u4F53\u7684\u7C7B\u578B div span ...</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">type</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">type</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// false current = null</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">current</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">stateNode</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3\u4E0D\u6267\u884C</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// false</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">wasHydrated</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                    </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3\u4E0D\u6267\u884C</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                    </span><span style="color:#758575DD;">// \u521B\u5EFA\u8282\u70B9\u5B9E\u4F8B\u5BF9\u8C61 &lt;div&gt;&lt;/div&gt; &lt;span&gt;&lt;/span&gt;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">instance</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">createInstance</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                        </span><span style="color:#BD976A;">type</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                        </span><span style="color:#BD976A;">newProps</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                        </span><span style="color:#BD976A;">rootContainerInstance</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                        </span><span style="color:#BD976A;">currentHostContext</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                        </span><span style="color:#BD976A;">workInProgress</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">                     * \u5C06\u6240\u6709\u7684\u5B50\u7EA7\u8FFD\u52A0\u5230\u7236\u7EA7\u4E2D</span></span>
<span class="line"><span style="color:#758575DD;">                     * instance \u4E3A\u7236\u7EA7</span></span>
<span class="line"><span style="color:#758575DD;">                     * workInProgress.child \u4E3A\u5B50\u7EA7</span></span>
<span class="line"><span style="color:#758575DD;">                     */</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#80A665;">appendAllChildren</span><span style="color:#666666;">(</span><span style="color:#BD976A;">instance</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">false</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">false</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">                    </span><span style="color:#758575DD;">// \u4E3A Fiber \u5BF9\u8C61\u6DFB\u52A0 stateNode \u5C5E\u6027</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">stateNode</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">instance</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u5904\u7406 ref DOM \u5F15\u7528</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">ref</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#80A665;">markRef</span><span style="color:#666666;">(</span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">completeWork</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">current</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;"> | </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">renderExpirationTime</span><span style="color:#999999;">: </span><span style="color:#2E808F;">ExpirationTime</span></span>
<span class="line"><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">Fiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">|</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u5F85\u66F4\u65B0 props</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">newProps</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">pendingProps</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">switch</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">tag</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// 0</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">FunctionComponent</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// 3</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostRoot</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#59873A;">updateHostContainer</span><span style="color:#999999;">(</span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// 5</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostComponent</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u83B7\u53D6 rootDOM \u8282\u70B9 &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">rootContainerInstance</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">getRootHostContainer</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u8282\u70B9\u7684\u5177\u4F53\u7684\u7C7B\u578B div span ...</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">type</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">type</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// false current = null</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">current</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">stateNode</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3\u4E0D\u6267\u884C</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// false</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">wasHydrated</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                    </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3\u4E0D\u6267\u884C</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                    </span><span style="color:#A0ADA0;">// \u521B\u5EFA\u8282\u70B9\u5B9E\u4F8B\u5BF9\u8C61 &lt;div&gt;&lt;/div&gt; &lt;span&gt;&lt;/span&gt;</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">instance</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">createInstance</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">                        </span><span style="color:#B07D48;">type</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                        </span><span style="color:#B07D48;">newProps</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                        </span><span style="color:#B07D48;">rootContainerInstance</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                        </span><span style="color:#B07D48;">currentHostContext</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                        </span><span style="color:#B07D48;">workInProgress</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">                     * \u5C06\u6240\u6709\u7684\u5B50\u7EA7\u8FFD\u52A0\u5230\u7236\u7EA7\u4E2D</span></span>
<span class="line"><span style="color:#A0ADA0;">                     * instance \u4E3A\u7236\u7EA7</span></span>
<span class="line"><span style="color:#A0ADA0;">                     * workInProgress.child \u4E3A\u5B50\u7EA7</span></span>
<span class="line"><span style="color:#A0ADA0;">                     */</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#59873A;">appendAllChildren</span><span style="color:#999999;">(</span><span style="color:#B07D48;">instance</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">false</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">false</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">                    </span><span style="color:#A0ADA0;">// \u4E3A Fiber \u5BF9\u8C61\u6DFB\u52A0 stateNode \u5C5E\u6027</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">stateNode</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">instance</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u5904\u7406 ref DOM \u5F15\u7528</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">ref</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#59873A;">markRef</span><span style="color:#999999;">(</span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-1-8-12-appendallchildren" tabindex="-1">5.1.8.12 appendAllChildren <a class="header-anchor" href="#_5-1-8-12-appendallchildren" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberCompleteWork.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#80A665;">appendAllChildren</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">parent</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Instance</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">needsVisibilityToggle</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">boolean</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">isHidden</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">boolean</span></span>
<span class="line"><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6\u5B50\u7EA7</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">node</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">.</span><span style="color:#BD976A;">child</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C\u5B50\u7EA7\u4E0D\u4E3A\u7A7A \u6267\u884C\u5FAA\u73AF</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">while</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">node</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5982\u679C node \u662F\u666E\u901A ReactElement \u6216\u8005\u4E3A\u6587\u672C</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">node</span><span style="color:#666666;">.</span><span style="color:#BD976A;">tag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostComponent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">||</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">node</span><span style="color:#666666;">.</span><span style="color:#BD976A;">tag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostText</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5C06\u5B50\u7EA7\u8FFD\u52A0\u5230\u7236\u7EA7\u4E2D</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#80A665;">appendInitialChild</span><span style="color:#666666;">(</span><span style="color:#BD976A;">parent</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">node</span><span style="color:#666666;">.</span><span style="color:#BD976A;">stateNode</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">node</span><span style="color:#666666;">.</span><span style="color:#BD976A;">child</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5982\u679C node \u4E0D\u662F\u666E\u901A ReactElement \u53C8\u4E0D\u662F\u6587\u672C</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5C06 node \u89C6\u4E3A\u7EC4\u4EF6, \u7EC4\u4EF6\u672C\u8EAB\u4E0D\u80FD\u8F6C\u6362\u4E3A\u771F\u5B9E DOM \u5143\u7D20</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u83B7\u53D6\u5230\u7EC4\u4EF6\u7684\u7B2C\u4E00\u4E2A\u5B50\u5143\u7D20, \u7EE7\u7EED\u6267\u884C\u5FAA\u73AF</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">node</span><span style="color:#666666;">.</span><span style="color:#BD976A;">child</span><span style="color:#666666;">.</span><span style="color:#BD976A;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">node</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">node</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">node</span><span style="color:#666666;">.</span><span style="color:#BD976A;">child</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">continue</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5982\u679C node \u548C workInProgress \u662F\u540C\u4E00\u4E2A\u8282\u70B9</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u8BF4\u660E node \u5DF2\u7ECF\u9000\u56DE\u5230\u7236\u7EA7 \u7EC8\u6B62\u5FAA\u73AF</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u8BF4\u660E\u6B64\u65F6\u6240\u6709\u5B50\u7EA7\u90FD\u5DF2\u7ECF\u8FFD\u52A0\u5230\u7236\u7EA7\u4E2D\u4E86</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">node</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">return</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5904\u7406\u5B50\u7EA7\u8282\u70B9\u7684\u5144\u5F1F\u8282\u70B9</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">while</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">node</span><span style="color:#666666;">.</span><span style="color:#BD976A;">sibling</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5982\u679C\u8282\u70B9\u6CA1\u6709\u7236\u7EA7\u6216\u8005\u8282\u70B9\u7684\u7236\u7EA7\u662F\u81EA\u5DF1, \u9000\u51FA\u5FAA\u73AF</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u8BF4\u660E\u6B64\u65F6\u6240\u6709\u5B50\u7EA7\u90FD\u5DF2\u7ECF\u8FFD\u52A0\u5230\u7236\u7EA7\u4E2D\u4E86</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">node</span><span style="color:#666666;">.</span><span style="color:#BD976A;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">||</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">node</span><span style="color:#666666;">.</span><span style="color:#BD976A;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">workInProgress</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#4D9375;">return</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u66F4\u65B0 node</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">node</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">node</span><span style="color:#666666;">.</span><span style="color:#BD976A;">return</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u66F4\u65B0\u7236\u7EA7 \u65B9\u4FBF\u56DE\u9000</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">node</span><span style="color:#666666;">.</span><span style="color:#BD976A;">sibling</span><span style="color:#666666;">.</span><span style="color:#BD976A;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">node</span><span style="color:#666666;">.</span><span style="color:#BD976A;">return</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5C06 node \u66F4\u65B0\u4E3A\u4E0B\u4E00\u4E2A\u5144\u5F1F\u8282\u70B9</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">node</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">node</span><span style="color:#666666;">.</span><span style="color:#BD976A;">sibling</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">};</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#59873A;">appendAllChildren</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">parent</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Instance</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">needsVisibilityToggle</span><span style="color:#999999;">: </span><span style="color:#2E808F;">boolean</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">isHidden</span><span style="color:#999999;">: </span><span style="color:#2E808F;">boolean</span></span>
<span class="line"><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u5B50\u7EA7</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">node</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">.</span><span style="color:#B07D48;">child</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C\u5B50\u7EA7\u4E0D\u4E3A\u7A7A \u6267\u884C\u5FAA\u73AF</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">while</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">node</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5982\u679C node \u662F\u666E\u901A ReactElement \u6216\u8005\u4E3A\u6587\u672C</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">node</span><span style="color:#999999;">.</span><span style="color:#B07D48;">tag</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostComponent</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">||</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">node</span><span style="color:#999999;">.</span><span style="color:#B07D48;">tag</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostText</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5C06\u5B50\u7EA7\u8FFD\u52A0\u5230\u7236\u7EA7\u4E2D</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#59873A;">appendInitialChild</span><span style="color:#999999;">(</span><span style="color:#B07D48;">parent</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">node</span><span style="color:#999999;">.</span><span style="color:#B07D48;">stateNode</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">node</span><span style="color:#999999;">.</span><span style="color:#B07D48;">child</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5982\u679C node \u4E0D\u662F\u666E\u901A ReactElement \u53C8\u4E0D\u662F\u6587\u672C</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5C06 node \u89C6\u4E3A\u7EC4\u4EF6, \u7EC4\u4EF6\u672C\u8EAB\u4E0D\u80FD\u8F6C\u6362\u4E3A\u771F\u5B9E DOM \u5143\u7D20</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u5230\u7EC4\u4EF6\u7684\u7B2C\u4E00\u4E2A\u5B50\u5143\u7D20, \u7EE7\u7EED\u6267\u884C\u5FAA\u73AF</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">node</span><span style="color:#999999;">.</span><span style="color:#B07D48;">child</span><span style="color:#999999;">.</span><span style="color:#B07D48;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">node</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">node</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">node</span><span style="color:#999999;">.</span><span style="color:#B07D48;">child</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">continue</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5982\u679C node \u548C workInProgress \u662F\u540C\u4E00\u4E2A\u8282\u70B9</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u8BF4\u660E node \u5DF2\u7ECF\u9000\u56DE\u5230\u7236\u7EA7 \u7EC8\u6B62\u5FAA\u73AF</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u8BF4\u660E\u6B64\u65F6\u6240\u6709\u5B50\u7EA7\u90FD\u5DF2\u7ECF\u8FFD\u52A0\u5230\u7236\u7EA7\u4E2D\u4E86</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">node</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">return</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5904\u7406\u5B50\u7EA7\u8282\u70B9\u7684\u5144\u5F1F\u8282\u70B9</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">while</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">node</span><span style="color:#999999;">.</span><span style="color:#B07D48;">sibling</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5982\u679C\u8282\u70B9\u6CA1\u6709\u7236\u7EA7\u6216\u8005\u8282\u70B9\u7684\u7236\u7EA7\u662F\u81EA\u5DF1, \u9000\u51FA\u5FAA\u73AF</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u8BF4\u660E\u6B64\u65F6\u6240\u6709\u5B50\u7EA7\u90FD\u5DF2\u7ECF\u8FFD\u52A0\u5230\u7236\u7EA7\u4E2D\u4E86</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">node</span><span style="color:#999999;">.</span><span style="color:#B07D48;">return</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">||</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">node</span><span style="color:#999999;">.</span><span style="color:#B07D48;">return</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">workInProgress</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#1E754F;">return</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u66F4\u65B0 node</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">node</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">node</span><span style="color:#999999;">.</span><span style="color:#B07D48;">return</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u66F4\u65B0\u7236\u7EA7 \u65B9\u4FBF\u56DE\u9000</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">node</span><span style="color:#999999;">.</span><span style="color:#B07D48;">sibling</span><span style="color:#999999;">.</span><span style="color:#B07D48;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">node</span><span style="color:#999999;">.</span><span style="color:#B07D48;">return</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5C06 node \u66F4\u65B0\u4E3A\u4E0B\u4E00\u4E2A\u5144\u5F1F\u8282\u70B9</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">node</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">node</span><span style="color:#999999;">.</span><span style="color:#B07D48;">sibling</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">};</span></span>
<span class="line"></span></code></pre></div><h3 id="_5-2-commit-\u9636\u6BB5" tabindex="-1">5.2 commit \u9636\u6BB5 <a class="header-anchor" href="#_5-2-commit-\u9636\u6BB5" aria-hidden="true">#</a></h3><h4 id="_5-2-1-finishsyncrender" tabindex="-1">5.2.1 finishSyncRender <a class="header-anchor" href="#_5-2-1-finishsyncrender" aria-hidden="true">#</a></h4><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberWorkLoop.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">finishSyncRender</span><span style="color:#666666;">(</span><span style="color:#BD976A;">root</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u9500\u6BC1 workInProgress Fiber \u6811</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u56E0\u4E3A\u5F85\u63D0\u4EA4 Fiber \u5BF9\u8C61\u5DF2\u7ECF\u88AB\u5B58\u50A8\u5728\u4E86 root.finishedWork \u4E2D</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">workInProgressRoot</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u8FDB\u5165 commit \u9636\u6BB5</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">commitRoot</span><span style="color:#666666;">(</span><span style="color:#BD976A;">root</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">finishSyncRender</span><span style="color:#999999;">(</span><span style="color:#B07D48;">root</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u9500\u6BC1 workInProgress Fiber \u6811</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u56E0\u4E3A\u5F85\u63D0\u4EA4 Fiber \u5BF9\u8C61\u5DF2\u7ECF\u88AB\u5B58\u50A8\u5728\u4E86 root.finishedWork \u4E2D</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">workInProgressRoot</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u8FDB\u5165 commit \u9636\u6BB5</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">commitRoot</span><span style="color:#999999;">(</span><span style="color:#B07D48;">root</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="_5-2-2-commitroot" tabindex="-1">5.2.2 commitRoot <a class="header-anchor" href="#_5-2-2-commitroot" aria-hidden="true">#</a></h4><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberWorkLoop.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">commitRoot</span><span style="color:#666666;">(</span><span style="color:#BD976A;">root</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6\u4EFB\u52A1\u4F18\u5148\u7EA7 97 =&gt; \u666E\u901A\u4F18\u5148\u7EA7</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">renderPriorityLevel</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">getCurrentPriorityLevel</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u4F7F\u7528\u6700\u9AD8\u4F18\u5148\u7EA7\u6267\u884C\u5F53\u524D\u4EFB\u52A1, \u56E0\u4E3A commit \u9636\u6BB5\u4E0D\u53EF\u4EE5\u88AB\u6253\u65AD</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// ImmediatePriority, \u4F18\u5148\u7EA7\u4E3A 99, \u6700\u9AD8\u4F18\u5148\u7EA7</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">runWithPriority</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">ImmediatePriority</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">commitRootImpl</span><span style="color:#666666;">.</span><span style="color:#80A665;">bind</span><span style="color:#666666;">(</span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">root</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">renderPriorityLevel</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">commitRoot</span><span style="color:#999999;">(</span><span style="color:#B07D48;">root</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u4EFB\u52A1\u4F18\u5148\u7EA7 97 =&gt; \u666E\u901A\u4F18\u5148\u7EA7</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">renderPriorityLevel</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">getCurrentPriorityLevel</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u4F7F\u7528\u6700\u9AD8\u4F18\u5148\u7EA7\u6267\u884C\u5F53\u524D\u4EFB\u52A1, \u56E0\u4E3A commit \u9636\u6BB5\u4E0D\u53EF\u4EE5\u88AB\u6253\u65AD</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// ImmediatePriority, \u4F18\u5148\u7EA7\u4E3A 99, \u6700\u9AD8\u4F18\u5148\u7EA7</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">runWithPriority</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">ImmediatePriority</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">commitRootImpl</span><span style="color:#999999;">.</span><span style="color:#59873A;">bind</span><span style="color:#999999;">(</span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">root</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">renderPriorityLevel</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="_5-2-3-commitrootimpl" tabindex="-1">5.2.3 commitRootImpl <a class="header-anchor" href="#_5-2-3-commitrootimpl" aria-hidden="true">#</a></h4><p>commit \u9636\u6BB5\u53EF\u4EE5\u5206\u4E3A\u4E09\u4E2A\u5B50\u9636\u6BB5\uFF1A</p><ul><li>before mutation \u9636\u6BB5\uFF08\u6267\u884C DOM \u64CD\u4F5C\u524D\uFF09</li><li>mutation \u9636\u6BB5\uFF08\u6267\u884C DOM \u64CD\u4F5C\uFF09</li><li>layout \u9636\u6BB5\uFF08\u6267\u884C DOM \u64CD\u4F5C\u540E\uFF09</li></ul><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberWorkLoop.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">commitRootImpl</span><span style="color:#666666;">(</span><span style="color:#BD976A;">root</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">renderPriorityLevel</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6\u5F85\u63D0\u4EA4 Fiber \u5BF9\u8C61 rootFiber</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">finishedWork</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">root</span><span style="color:#666666;">.</span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C\u6CA1\u6709\u4EFB\u52A1\u8981\u6267\u884C</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">finishedWork</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u963B\u6B62\u7A0B\u5E8F\u7EE7\u7EED\u5411\u4E0B\u6267\u884C</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">root</span><span style="color:#666666;">.</span><span style="color:#BD976A;">finishedWork</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">root</span><span style="color:#666666;">.</span><span style="color:#BD976A;">callbackNode</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">root</span><span style="color:#666666;">.</span><span style="color:#BD976A;">callbackExpirationTime</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoWork</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">root</span><span style="color:#666666;">.</span><span style="color:#BD976A;">callbackPriority</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoPriority</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">root</span><span style="color:#666666;">.</span><span style="color:#BD976A;">nextKnownPendingLevel</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoWork</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6\u8981\u6267\u884C DOM \u64CD\u4F5C\u7684\u526F\u4F5C\u7528\u5217\u8868</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">firstEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">.</span><span style="color:#BD976A;">firstEffect</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// true</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">firstEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// commit \u7B2C\u4E00\u4E2A\u5B50\u9636\u6BB5</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">nextEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">firstEffect</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5904\u7406\u7C7B\u7EC4\u4EF6\u7684 getSnapShotBeforeUpdate \u751F\u547D\u5468\u671F\u51FD\u6570</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">do</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#80A665;">invokeGuardedCallback</span><span style="color:#666666;">(</span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">commitBeforeMutationEffects</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">while</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">nextEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// commit \u7B2C\u4E8C\u4E2A\u5B50\u9636\u6BB5</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">nextEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">firstEffect</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">do</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#80A665;">invokeGuardedCallback</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">commitMutationEffects</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">root</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">renderPriorityLevel</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">while</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">nextEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5C06 workInProgress Fiber \u6811\u53D8\u6210 current Fiber \u6811</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">root</span><span style="color:#666666;">.</span><span style="color:#BD976A;">current</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// commit \u7B2C\u4E09\u4E2A\u5B50\u9636\u6BB5</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">nextEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">firstEffect</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">do</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#80A665;">invokeGuardedCallback</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">commitLayoutEffects</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">root</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">expirationTime</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">while</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">nextEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u91CD\u7F6E nextEffect</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">nextEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">commitRootImpl</span><span style="color:#999999;">(</span><span style="color:#B07D48;">root</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">renderPriorityLevel</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u5F85\u63D0\u4EA4 Fiber \u5BF9\u8C61 rootFiber</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">finishedWork</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">root</span><span style="color:#999999;">.</span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C\u6CA1\u6709\u4EFB\u52A1\u8981\u6267\u884C</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">finishedWork</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u963B\u6B62\u7A0B\u5E8F\u7EE7\u7EED\u5411\u4E0B\u6267\u884C</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">root</span><span style="color:#999999;">.</span><span style="color:#B07D48;">finishedWork</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">root</span><span style="color:#999999;">.</span><span style="color:#B07D48;">callbackNode</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">root</span><span style="color:#999999;">.</span><span style="color:#B07D48;">callbackExpirationTime</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoWork</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">root</span><span style="color:#999999;">.</span><span style="color:#B07D48;">callbackPriority</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoPriority</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">root</span><span style="color:#999999;">.</span><span style="color:#B07D48;">nextKnownPendingLevel</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoWork</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u8981\u6267\u884C DOM \u64CD\u4F5C\u7684\u526F\u4F5C\u7528\u5217\u8868</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">firstEffect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">.</span><span style="color:#B07D48;">firstEffect</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// true</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">firstEffect</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// commit \u7B2C\u4E00\u4E2A\u5B50\u9636\u6BB5</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">nextEffect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">firstEffect</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5904\u7406\u7C7B\u7EC4\u4EF6\u7684 getSnapShotBeforeUpdate \u751F\u547D\u5468\u671F\u51FD\u6570</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">do</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#59873A;">invokeGuardedCallback</span><span style="color:#999999;">(</span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">commitBeforeMutationEffects</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">while</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">nextEffect</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// commit \u7B2C\u4E8C\u4E2A\u5B50\u9636\u6BB5</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">nextEffect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">firstEffect</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">do</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#59873A;">invokeGuardedCallback</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">commitMutationEffects</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">root</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">renderPriorityLevel</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">while</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">nextEffect</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5C06 workInProgress Fiber \u6811\u53D8\u6210 current Fiber \u6811</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">root</span><span style="color:#999999;">.</span><span style="color:#B07D48;">current</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// commit \u7B2C\u4E09\u4E2A\u5B50\u9636\u6BB5</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">nextEffect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">firstEffect</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">do</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#59873A;">invokeGuardedCallback</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">commitLayoutEffects</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">root</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">expirationTime</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">while</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">nextEffect</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u91CD\u7F6E nextEffect</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">nextEffect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="_5-2-4-\u7B2C\u4E00\u5B50\u9636\u6BB5" tabindex="-1">5.2.4 \u7B2C\u4E00\u5B50\u9636\u6BB5 <a class="header-anchor" href="#_5-2-4-\u7B2C\u4E00\u5B50\u9636\u6BB5" aria-hidden="true">#</a></h4><h5 id="_5-2-4-1-commitbeforemutationeffects" tabindex="-1">5.2.4.1 commitBeforeMutationEffects <a class="header-anchor" href="#_5-2-4-1-commitbeforemutationeffects" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberWorkLoop.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// commit \u9636\u6BB5\u7684\u7B2C\u4E00\u4E2A\u5B50\u9636\u6BB5</span></span>
<span class="line"><span style="color:#758575DD;">// \u8C03\u7528\u7C7B\u7EC4\u4EF6\u7684 getSnapshotBeforeUpdate \u751F\u547D\u5468\u671F\u51FD\u6570</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">commitBeforeMutationEffects</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5FAA\u73AF effect \u94FE</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">while</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">nextEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// nextEffect \u662F effect \u94FE\u4E0A\u4ECE firstEffect \u5230 lastEffec \u7684\u6BCF\u4E00\u4E2A\u9700\u8981commit\u7684 fiber \u5BF9\u8C61</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u521D\u59CB\u5316\u6E32\u67D3\u7B2C\u4E00\u4E2A nextEffect \u4E3A App \u7EC4\u4EF6</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// effectTag =&gt; 3</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">effectTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">effectTag</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// console.log(effectTag);</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// nextEffect = null;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// return;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5982\u679C fiber \u5BF9\u8C61\u4E2D\u91CC\u6709 Snapshot \u8FD9\u4E2A effectTag \u7684\u8BDD</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// Snapshot \u548C\u66F4\u65B0\u6709\u5173\u7CFB \u521D\u59CB\u5316\u6E32\u67D3 \u4E0D\u6267\u884C</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// false</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">((</span><span style="color:#BD976A;">effectTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Snapshot</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">NoEffect</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u83B7\u53D6\u5F53\u524D fiber \u8282\u70B9</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">alternate</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5F53 nextEffect \u4E0A\u6709 Snapshot \u8FD9\u4E2A effectTag \u65F6</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u6267\u884C\u4EE5\u4E0B\u65B9\u6CD5, \u4E3B\u8981\u662F\u7C7B\u7EC4\u4EF6\u8C03\u7528 getSnapshotBeforeUpdate \u751F\u547D\u5468\u671F\u51FD\u6570</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#80A665;">commitBeforeMutationEffectOnFiber</span><span style="color:#666666;">(</span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u66F4\u65B0\u5FAA\u73AF\u6761\u4EF6</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">nextEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// commit \u9636\u6BB5\u7684\u7B2C\u4E00\u4E2A\u5B50\u9636\u6BB5</span></span>
<span class="line"><span style="color:#A0ADA0;">// \u8C03\u7528\u7C7B\u7EC4\u4EF6\u7684 getSnapshotBeforeUpdate \u751F\u547D\u5468\u671F\u51FD\u6570</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">commitBeforeMutationEffects</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5FAA\u73AF effect \u94FE</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">while</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">nextEffect</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// nextEffect \u662F effect \u94FE\u4E0A\u4ECE firstEffect \u5230 lastEffec \u7684\u6BCF\u4E00\u4E2A\u9700\u8981commit\u7684 fiber \u5BF9\u8C61</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u521D\u59CB\u5316\u6E32\u67D3\u7B2C\u4E00\u4E2A nextEffect \u4E3A App \u7EC4\u4EF6</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// effectTag =&gt; 3</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">effectTag</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">effectTag</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// console.log(effectTag);</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// nextEffect = null;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// return;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5982\u679C fiber \u5BF9\u8C61\u4E2D\u91CC\u6709 Snapshot \u8FD9\u4E2A effectTag \u7684\u8BDD</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// Snapshot \u548C\u66F4\u65B0\u6709\u5173\u7CFB \u521D\u59CB\u5316\u6E32\u67D3 \u4E0D\u6267\u884C</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// false</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">((</span><span style="color:#B07D48;">effectTag</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Snapshot</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">NoEffect</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u5F53\u524D fiber \u8282\u70B9</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">alternate</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5F53 nextEffect \u4E0A\u6709 Snapshot \u8FD9\u4E2A effectTag \u65F6</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u6267\u884C\u4EE5\u4E0B\u65B9\u6CD5, \u4E3B\u8981\u662F\u7C7B\u7EC4\u4EF6\u8C03\u7528 getSnapshotBeforeUpdate \u751F\u547D\u5468\u671F\u51FD\u6570</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#59873A;">commitBeforeMutationEffectOnFiber</span><span style="color:#999999;">(</span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u66F4\u65B0\u5FAA\u73AF\u6761\u4EF6</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">nextEffect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-2-4-2-commitbeforemutationlifecycles" tabindex="-1">5.2.4.2 commitBeforeMutationLifeCycles <a class="header-anchor" href="#_5-2-4-2-commitbeforemutationlifecycles" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberCommitWork.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">commitBeforeMutationLifeCycles</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">current</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;"> | </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span></span>
<span class="line"><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">void</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">switch</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">.</span><span style="color:#BD976A;">tag</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">FunctionComponent</span><span style="color:#666666;">:</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ForwardRef</span><span style="color:#666666;">:</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">SimpleMemoComponent</span><span style="color:#666666;">:</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Block</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">return</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5982\u679C\u8BE5 fiber \u7C7B\u578B\u662F ClassComponent</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ClassComponent</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">.</span><span style="color:#BD976A;">effectTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Snapshot</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">current</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                    </span><span style="color:#758575DD;">// \u65E7\u7684 props</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">prevProps</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">memoizedProps</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">                    </span><span style="color:#758575DD;">// \u65E7\u7684 state</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">prevState</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">memoizedState</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">                    </span><span style="color:#758575DD;">// \u83B7\u53D6 classComponent \u7EC4\u4EF6\u7684\u5B9E\u4F8B\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">instance</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">.</span><span style="color:#BD976A;">stateNode</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">                    </span><span style="color:#758575DD;">// \u6267\u884C getSnapshotBeforeUpdate \u751F\u547D\u5468\u671F\u51FD\u6570</span></span>
<span class="line"><span style="color:#666666;">                    </span><span style="color:#758575DD;">// \u5728\u7EC4\u4EF6\u66F4\u65B0\u524D\u6355\u83B7\u4E00\u4E9B DOM \u4FE1\u606F</span></span>
<span class="line"><span style="color:#666666;">                    </span><span style="color:#758575DD;">// \u8FD4\u56DE\u81EA\u5B9A\u4E49\u7684\u503C\u6216 null, \u7EDF\u79F0\u4E3A snapshot</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">snapshot</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">instance</span><span style="color:#666666;">.</span><span style="color:#80A665;">getSnapshotBeforeUpdate</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                        </span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">.</span><span style="color:#BD976A;">elementType</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">.</span><span style="color:#BD976A;">type</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                            </span><span style="color:#CB7676;">?</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">prevProps</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                            </span><span style="color:#CB7676;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">resolveDefaultProps</span><span style="color:#666666;">(</span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">.</span><span style="color:#BD976A;">type</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">prevProps</span><span style="color:#666666;">),</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                        </span><span style="color:#BD976A;">prevState</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">return</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostRoot</span><span style="color:#666666;">:</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostComponent</span><span style="color:#666666;">:</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostText</span><span style="color:#666666;">:</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostPortal</span><span style="color:#666666;">:</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">IncompleteClassComponent</span><span style="color:#666666;">:</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// Nothing to do for these component types</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">return</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">commitBeforeMutationLifeCycles</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">current</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;"> | </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span></span>
<span class="line"><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">void</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">switch</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">.</span><span style="color:#B07D48;">tag</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">FunctionComponent</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ForwardRef</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">SimpleMemoComponent</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Block</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">return</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5982\u679C\u8BE5 fiber \u7C7B\u578B\u662F ClassComponent</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ClassComponent</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">.</span><span style="color:#B07D48;">effectTag</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Snapshot</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">current</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                    </span><span style="color:#A0ADA0;">// \u65E7\u7684 props</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">prevProps</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">memoizedProps</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">                    </span><span style="color:#A0ADA0;">// \u65E7\u7684 state</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">prevState</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">memoizedState</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">                    </span><span style="color:#A0ADA0;">// \u83B7\u53D6 classComponent \u7EC4\u4EF6\u7684\u5B9E\u4F8B\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">instance</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">.</span><span style="color:#B07D48;">stateNode</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">                    </span><span style="color:#A0ADA0;">// \u6267\u884C getSnapshotBeforeUpdate \u751F\u547D\u5468\u671F\u51FD\u6570</span></span>
<span class="line"><span style="color:#999999;">                    </span><span style="color:#A0ADA0;">// \u5728\u7EC4\u4EF6\u66F4\u65B0\u524D\u6355\u83B7\u4E00\u4E9B DOM \u4FE1\u606F</span></span>
<span class="line"><span style="color:#999999;">                    </span><span style="color:#A0ADA0;">// \u8FD4\u56DE\u81EA\u5B9A\u4E49\u7684\u503C\u6216 null, \u7EDF\u79F0\u4E3A snapshot</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">snapshot</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">instance</span><span style="color:#999999;">.</span><span style="color:#59873A;">getSnapshotBeforeUpdate</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">                        </span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">.</span><span style="color:#B07D48;">elementType</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">.</span><span style="color:#B07D48;">type</span></span>
<span class="line"><span style="color:#393A34;">                            </span><span style="color:#AB5959;">?</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">prevProps</span></span>
<span class="line"><span style="color:#393A34;">                            </span><span style="color:#AB5959;">:</span><span style="color:#393A34;"> </span><span style="color:#59873A;">resolveDefaultProps</span><span style="color:#999999;">(</span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">.</span><span style="color:#B07D48;">type</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">prevProps</span><span style="color:#999999;">),</span></span>
<span class="line"><span style="color:#393A34;">                        </span><span style="color:#B07D48;">prevState</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">return</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostRoot</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostComponent</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostText</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostPortal</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">IncompleteClassComponent</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// Nothing to do for these component types</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">return</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="_5-2-5-\u7B2C\u4E8C\u5B50\u9636\u6BB5" tabindex="-1">5.2.5 \u7B2C\u4E8C\u5B50\u9636\u6BB5 <a class="header-anchor" href="#_5-2-5-\u7B2C\u4E8C\u5B50\u9636\u6BB5" aria-hidden="true">#</a></h4><h5 id="_5-2-5-1-commitmutationeffects" tabindex="-1">5.2.5.1 commitMutationEffects <a class="header-anchor" href="#_5-2-5-1-commitmutationeffects" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberWorkLoop.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// commit \u9636\u6BB5\u7684\u7B2C\u4E8C\u4E2A\u5B50\u9636\u6BB5</span></span>
<span class="line"><span style="color:#758575DD;">// \u6839\u636E effectTag \u6267\u884C DOM \u64CD\u4F5C</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">commitMutationEffects</span><span style="color:#666666;">(</span><span style="color:#BD976A;">root</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">FiberRoot</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">renderPriorityLevel</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5FAA\u73AF effect \u94FE</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">while</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">nextEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u83B7\u53D6 effectTag</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3\u7B2C\u4E00\u6B21\u5FAA\u73AF\u4E3A App \u7EC4\u4EF6</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5373\u5C06\u6839\u7EC4\u4EF6\u53CA\u5185\u90E8\u6240\u6709\u5185\u5BB9\u4E00\u6B21\u6027\u6DFB\u52A0\u5230\u9875\u9762\u4E2D</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">effectTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">effectTag</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u6839\u636E effectTag \u5206\u522B\u5904\u7406</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">primaryEffectTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">effectTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">Placement</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Update</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Deletion</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Hydrating</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5339\u914D effectTag</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3 primaryEffectTag \u4E3A 2 \u5339\u914D\u5230 Placement</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">switch</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">primaryEffectTag</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u9488\u5BF9\u8BE5\u8282\u70B9\u53CA\u5B50\u8282\u70B9\u8FDB\u884C\u63D2\u5165\u64CD\u4F5C</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Placement</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#80A665;">commitPlacement</span><span style="color:#666666;">(</span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// effectTag \u4ECE 3 \u53D8\u4E3A 1</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u4ECE effect \u6807\u7B7E\u4E2D\u6E05\u9664 &quot;placement&quot; \u91CD\u7F6E effectTag \u503C</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u4EE5\u4FBF\u6211\u4EEC\u77E5\u9053\u5728\u8C03\u7528\u8BF8\u5982componentDidMount\u4E4B\u7C7B\u7684\u4EFB\u4F55\u751F\u547D\u5468\u671F\u4E4B\u524D\u5DF2\u5C06\u5176\u63D2\u5165\u3002</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">effectTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">&amp;=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">~</span><span style="color:#BD976A;">Placement</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#4D9375;">break</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u63D2\u5165\u5E76\u66F4\u65B0 DOM</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">PlacementAndUpdate</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u63D2\u5165</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#80A665;">commitPlacement</span><span style="color:#666666;">(</span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">effectTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">&amp;=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">~</span><span style="color:#BD976A;">Placement</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u66F4\u65B0</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">alternate</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#80A665;">commitWork</span><span style="color:#666666;">(</span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#4D9375;">break</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u670D\u52A1\u5668\u7AEF\u6E32\u67D3</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Hydrating</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">effectTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">&amp;=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">~</span><span style="color:#BD976A;">Hydrating</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#4D9375;">break</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u670D\u52A1\u5668\u7AEF\u6E32\u67D3</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HydratingAndUpdate</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">effectTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">&amp;=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">~</span><span style="color:#BD976A;">Hydrating</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// Update</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">alternate</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#80A665;">commitWork</span><span style="color:#666666;">(</span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#4D9375;">break</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u66F4\u65B0 DOM</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Update</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">alternate</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#80A665;">commitWork</span><span style="color:#666666;">(</span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#4D9375;">break</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5220\u9664 DOM</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Deletion</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#80A665;">commitDeletion</span><span style="color:#666666;">(</span><span style="color:#BD976A;">root</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">renderPriorityLevel</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#4D9375;">break</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">nextEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// commit \u9636\u6BB5\u7684\u7B2C\u4E8C\u4E2A\u5B50\u9636\u6BB5</span></span>
<span class="line"><span style="color:#A0ADA0;">// \u6839\u636E effectTag \u6267\u884C DOM \u64CD\u4F5C</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">commitMutationEffects</span><span style="color:#999999;">(</span><span style="color:#B07D48;">root</span><span style="color:#999999;">: </span><span style="color:#2E808F;">FiberRoot</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">renderPriorityLevel</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5FAA\u73AF effect \u94FE</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">while</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">nextEffect</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u83B7\u53D6 effectTag</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3\u7B2C\u4E00\u6B21\u5FAA\u73AF\u4E3A App \u7EC4\u4EF6</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5373\u5C06\u6839\u7EC4\u4EF6\u53CA\u5185\u90E8\u6240\u6709\u5185\u5BB9\u4E00\u6B21\u6027\u6DFB\u52A0\u5230\u9875\u9762\u4E2D</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">effectTag</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">effectTag</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u6839\u636E effectTag \u5206\u522B\u5904\u7406</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">primaryEffectTag</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">effectTag</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">Placement</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Update</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Deletion</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Hydrating</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5339\u914D effectTag</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3 primaryEffectTag \u4E3A 2 \u5339\u914D\u5230 Placement</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">switch</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">primaryEffectTag</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u9488\u5BF9\u8BE5\u8282\u70B9\u53CA\u5B50\u8282\u70B9\u8FDB\u884C\u63D2\u5165\u64CD\u4F5C</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Placement</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#59873A;">commitPlacement</span><span style="color:#999999;">(</span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// effectTag \u4ECE 3 \u53D8\u4E3A 1</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u4ECE effect \u6807\u7B7E\u4E2D\u6E05\u9664 &quot;placement&quot; \u91CD\u7F6E effectTag \u503C</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u4EE5\u4FBF\u6211\u4EEC\u77E5\u9053\u5728\u8C03\u7528\u8BF8\u5982componentDidMount\u4E4B\u7C7B\u7684\u4EFB\u4F55\u751F\u547D\u5468\u671F\u4E4B\u524D\u5DF2\u5C06\u5176\u63D2\u5165\u3002</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">effectTag</span><span style="color:#393A34;"> </span><span style="color:#999999;">&amp;=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">~</span><span style="color:#B07D48;">Placement</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#1E754F;">break</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u63D2\u5165\u5E76\u66F4\u65B0 DOM</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">PlacementAndUpdate</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u63D2\u5165</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#59873A;">commitPlacement</span><span style="color:#999999;">(</span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">effectTag</span><span style="color:#393A34;"> </span><span style="color:#999999;">&amp;=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">~</span><span style="color:#B07D48;">Placement</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u66F4\u65B0</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">alternate</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#59873A;">commitWork</span><span style="color:#999999;">(</span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#1E754F;">break</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u670D\u52A1\u5668\u7AEF\u6E32\u67D3</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Hydrating</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">effectTag</span><span style="color:#393A34;"> </span><span style="color:#999999;">&amp;=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">~</span><span style="color:#B07D48;">Hydrating</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#1E754F;">break</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u670D\u52A1\u5668\u7AEF\u6E32\u67D3</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HydratingAndUpdate</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">effectTag</span><span style="color:#393A34;"> </span><span style="color:#999999;">&amp;=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">~</span><span style="color:#B07D48;">Hydrating</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// Update</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">alternate</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#59873A;">commitWork</span><span style="color:#999999;">(</span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#1E754F;">break</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u66F4\u65B0 DOM</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Update</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">alternate</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#59873A;">commitWork</span><span style="color:#999999;">(</span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#1E754F;">break</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5220\u9664 DOM</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Deletion</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#59873A;">commitDeletion</span><span style="color:#999999;">(</span><span style="color:#B07D48;">root</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">renderPriorityLevel</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#1E754F;">break</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">nextEffect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-2-5-2-commitplacement" tabindex="-1">5.2.5.2 commitPlacement <a class="header-anchor" href="#_5-2-5-2-commitplacement" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberCommitWork.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// \u6302\u8F7D DOM \u5143\u7D20</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">commitPlacement</span><span style="color:#666666;">(</span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">void</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// finishedWork \u521D\u59CB\u5316\u6E32\u67D3\u65F6\u4E3A\u6839\u7EC4\u4EF6 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6\u975E\u7EC4\u4EF6\u7236\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3\u65F6\u4E3A &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">parentFiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">getHostParentFiber</span><span style="color:#666666;">(</span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5B58\u50A8\u771F\u6B63\u7684\u7236\u7EA7 DOM \u8282\u70B9\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">parent</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u662F\u5426\u4E3A\u6E32\u67D3\u5BB9\u5668</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u6E32\u67D3\u5BB9\u5668\u548C\u666E\u901Areact\u5143\u7D20\u7684\u4E3B\u8981\u533A\u522B\u5728\u4E8E\u662F\u5426\u9700\u8981\u7279\u6B8A\u5904\u7406\u6CE8\u91CA\u8282\u70B9</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">isContainer</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6\u7236\u7EA7 DOM \u8282\u70B9\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u4F46\u662F\u521D\u59CB\u6E32\u67D3\u65F6 rootFiber \u5BF9\u8C61\u4E2D\u7684 stateNode \u5B58\u50A8\u7684\u662F FiberRoot</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">parentStateNode</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">parentFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">stateNode</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5224\u65AD\u7236\u8282\u70B9\u7684\u7C7B\u578B</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3\u65F6\u662F hostRoot 3</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">switch</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">parentFiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">tag</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostComponent</span><span style="color:#666666;">:</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">parent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">parentStateNode</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">isContainer</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">false</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">break</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostRoot</span><span style="color:#666666;">:</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u83B7\u53D6\u771F\u6B63\u7684 DOM \u8282\u70B9\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">parent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">parentStateNode</span><span style="color:#666666;">.</span><span style="color:#BD976A;">containerInfo</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u662F container \u5BB9\u5668</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">isContainer</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">break</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostPortal</span><span style="color:#666666;">:</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">parent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">parentStateNode</span><span style="color:#666666;">.</span><span style="color:#BD976A;">containerInfo</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">isContainer</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">break</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">FundamentalComponent</span><span style="color:#666666;">:</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">enableFundamentalAPI</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">parent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">parentStateNode</span><span style="color:#666666;">.</span><span style="color:#BD976A;">instance</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">isContainer</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">false</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u67E5\u770B\u5F53\u524D\u8282\u70B9\u662F\u5426\u6709\u4E0B\u4E00\u4E2A\u5144\u5F1F\u8282\u70B9</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u6709, \u6267\u884C insertBefore</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u6CA1\u6709, \u6267\u884C appendChild</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">before</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">getHostSibling</span><span style="color:#666666;">(</span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u6E32\u67D3\u5BB9\u5668</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">isContainer</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5411\u7236\u8282\u70B9\u4E2D\u8FFD\u52A0\u8282\u70B9 \u6216\u8005 \u5C06\u5B50\u8282\u70B9\u63D2\u5165\u5230 before \u8282\u70B9\u7684\u524D\u9762</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">insertOrAppendPlacementNodeIntoContainer</span><span style="color:#666666;">(</span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">before</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">parent</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u975E\u6E32\u67D3\u5BB9\u5668</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5411\u7236\u8282\u70B9\u4E2D\u8FFD\u52A0\u8282\u70B9 \u6216\u8005 \u5C06\u5B50\u8282\u70B9\u63D2\u5165\u5230 before \u8282\u70B9\u7684\u524D\u9762</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">insertOrAppendPlacementNode</span><span style="color:#666666;">(</span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">before</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">parent</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// \u6302\u8F7D DOM \u5143\u7D20</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">commitPlacement</span><span style="color:#999999;">(</span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">void</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// finishedWork \u521D\u59CB\u5316\u6E32\u67D3\u65F6\u4E3A\u6839\u7EC4\u4EF6 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u975E\u7EC4\u4EF6\u7236\u7EA7 Fiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3\u65F6\u4E3A &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">parentFiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">getHostParentFiber</span><span style="color:#999999;">(</span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5B58\u50A8\u771F\u6B63\u7684\u7236\u7EA7 DOM \u8282\u70B9\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">parent</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u662F\u5426\u4E3A\u6E32\u67D3\u5BB9\u5668</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u6E32\u67D3\u5BB9\u5668\u548C\u666E\u901Areact\u5143\u7D20\u7684\u4E3B\u8981\u533A\u522B\u5728\u4E8E\u662F\u5426\u9700\u8981\u7279\u6B8A\u5904\u7406\u6CE8\u91CA\u8282\u70B9</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">isContainer</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u7236\u7EA7 DOM \u8282\u70B9\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u4F46\u662F\u521D\u59CB\u6E32\u67D3\u65F6 rootFiber \u5BF9\u8C61\u4E2D\u7684 stateNode \u5B58\u50A8\u7684\u662F FiberRoot</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">parentStateNode</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">parentFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">stateNode</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5224\u65AD\u7236\u8282\u70B9\u7684\u7C7B\u578B</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3\u65F6\u662F hostRoot 3</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">switch</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">parentFiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">tag</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostComponent</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">parent</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">parentStateNode</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">isContainer</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">false</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">break</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostRoot</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u771F\u6B63\u7684 DOM \u8282\u70B9\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">parent</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">parentStateNode</span><span style="color:#999999;">.</span><span style="color:#B07D48;">containerInfo</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u662F container \u5BB9\u5668</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">isContainer</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">break</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostPortal</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">parent</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">parentStateNode</span><span style="color:#999999;">.</span><span style="color:#B07D48;">containerInfo</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">isContainer</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">break</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">FundamentalComponent</span><span style="color:#999999;">:</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">enableFundamentalAPI</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">parent</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">parentStateNode</span><span style="color:#999999;">.</span><span style="color:#B07D48;">instance</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">isContainer</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">false</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u67E5\u770B\u5F53\u524D\u8282\u70B9\u662F\u5426\u6709\u4E0B\u4E00\u4E2A\u5144\u5F1F\u8282\u70B9</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u6709, \u6267\u884C insertBefore</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u6CA1\u6709, \u6267\u884C appendChild</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">before</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">getHostSibling</span><span style="color:#999999;">(</span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u6E32\u67D3\u5BB9\u5668</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">isContainer</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5411\u7236\u8282\u70B9\u4E2D\u8FFD\u52A0\u8282\u70B9 \u6216\u8005 \u5C06\u5B50\u8282\u70B9\u63D2\u5165\u5230 before \u8282\u70B9\u7684\u524D\u9762</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">insertOrAppendPlacementNodeIntoContainer</span><span style="color:#999999;">(</span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">before</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">parent</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u975E\u6E32\u67D3\u5BB9\u5668</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5411\u7236\u8282\u70B9\u4E2D\u8FFD\u52A0\u8282\u70B9 \u6216\u8005 \u5C06\u5B50\u8282\u70B9\u63D2\u5165\u5230 before \u8282\u70B9\u7684\u524D\u9762</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">insertOrAppendPlacementNode</span><span style="color:#999999;">(</span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">before</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">parent</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-2-5-3-gethostparentfiber" tabindex="-1">5.2.5.3 getHostParentFiber <a class="header-anchor" href="#_5-2-5-3-gethostparentfiber" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberCommitWork.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// \u83B7\u53D6 HostRootFiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">getHostParentFiber</span><span style="color:#666666;">(</span><span style="color:#BD976A;">fiber</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6\u5F53\u524D Fiber \u7236\u7EA7</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">parent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">fiber</span><span style="color:#666666;">.</span><span style="color:#BD976A;">return</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u67E5\u770B\u7236\u7EA7\u662F\u5426\u4E3A null</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">while</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">parent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u67E5\u770B\u7236\u7EA7\u662F\u5426\u4E3A hostRoot</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#80A665;">isHostParent</span><span style="color:#666666;">(</span><span style="color:#BD976A;">parent</span><span style="color:#666666;">))</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u8FD4\u56DE</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">parent</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u7EE7\u7EED\u5411\u4E0A\u67E5\u627E</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">parent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">parent</span><span style="color:#666666;">.</span><span style="color:#BD976A;">return</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// \u83B7\u53D6 HostRootFiber \u5BF9\u8C61</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">getHostParentFiber</span><span style="color:#999999;">(</span><span style="color:#B07D48;">fiber</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">Fiber</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u5F53\u524D Fiber \u7236\u7EA7</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">parent</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">fiber</span><span style="color:#999999;">.</span><span style="color:#B07D48;">return</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u67E5\u770B\u7236\u7EA7\u662F\u5426\u4E3A null</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">while</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">parent</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u67E5\u770B\u7236\u7EA7\u662F\u5426\u4E3A hostRoot</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#59873A;">isHostParent</span><span style="color:#999999;">(</span><span style="color:#B07D48;">parent</span><span style="color:#999999;">))</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u8FD4\u56DE</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">parent</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u7EE7\u7EED\u5411\u4E0A\u67E5\u627E</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">parent</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">parent</span><span style="color:#999999;">.</span><span style="color:#B07D48;">return</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-2-5-4-insertorappendplacementnodeintocontainer" tabindex="-1">5.2.5.4 insertOrAppendPlacementNodeIntoContainer <a class="header-anchor" href="#_5-2-5-4-insertorappendplacementnodeintocontainer" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberCommitWork.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// \u5411\u5BB9\u5668\u4E2D\u8FFD\u52A0 | \u63D2\u5165\u5230\u67D0\u4E00\u4E2A\u8282\u70B9\u7684\u524D\u9762</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">insertOrAppendPlacementNodeIntoContainer</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">node</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">before</span><span style="color:#666666;">: </span><span style="color:#CB7676;">?</span><span style="color:#5DA9A7;">Instance</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">parent</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Container</span></span>
<span class="line"><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">void</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">tag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">node</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C\u5F85\u63D2\u5165\u7684\u8282\u70B9\u662F\u4E00\u4E2A DOM \u5143\u7D20\u6216\u8005\u6587\u672C\u7684\u8BDD</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u6BD4\u5982 \u7EC4\u4EF6fiber =&gt; false div =&gt; true</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">isHost</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">tag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostComponent</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">||</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">tag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HostText</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">isHost</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">||</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">enableFundamentalAPI</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">tag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">FundamentalComponent</span><span style="color:#666666;">))</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u83B7\u53D6 DOM \u8282\u70B9</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">stateNode</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">isHost</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">?</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">node</span><span style="color:#666666;">.</span><span style="color:#BD976A;">stateNode</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">node</span><span style="color:#666666;">.</span><span style="color:#BD976A;">stateNode</span><span style="color:#666666;">.</span><span style="color:#BD976A;">instance</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5982\u679C before \u5B58\u5728</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">before</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u63D2\u5165\u5230 before \u524D\u9762</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#80A665;">insertInContainerBefore</span><span style="color:#666666;">(</span><span style="color:#BD976A;">parent</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">stateNode</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">before</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u8FFD\u52A0\u5230\u7236\u5BB9\u5668\u4E2D</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#80A665;">appendChildToContainer</span><span style="color:#666666;">(</span><span style="color:#BD976A;">parent</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">stateNode</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5982\u679C\u662F\u7EC4\u4EF6\u8282\u70B9, \u6BD4\u5982 ClassComponent, \u5219\u627E\u5B83\u7684\u7B2C\u4E00\u4E2A\u5B50\u8282\u70B9(DOM \u5143\u7D20)</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u8FDB\u884C\u63D2\u5165\u64CD\u4F5C</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">child</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">node</span><span style="color:#666666;">.</span><span style="color:#BD976A;">child</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">child</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5411\u7236\u7EA7\u4E2D\u8FFD\u52A0\u5B50\u8282\u70B9\u6216\u8005\u5C06\u5B50\u8282\u70B9\u63D2\u5165\u5230 before \u7684\u524D\u9762</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#80A665;">insertOrAppendPlacementNodeIntoContainer</span><span style="color:#666666;">(</span><span style="color:#BD976A;">child</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">before</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">parent</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u83B7\u53D6\u4E0B\u4E00\u4E2A\u5144\u5F1F\u8282\u70B9</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">sibling</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">child</span><span style="color:#666666;">.</span><span style="color:#BD976A;">sibling</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5982\u679C\u5144\u5F1F\u8282\u70B9\u5B58\u5728</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">while</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">sibling</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u5411\u7236\u7EA7\u4E2D\u8FFD\u52A0\u5B50\u8282\u70B9\u6216\u8005\u5C06\u5B50\u8282\u70B9\u63D2\u5165\u5230 before \u7684\u524D\u9762</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#80A665;">insertOrAppendPlacementNodeIntoContainer</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">sibling</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">before</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                    </span><span style="color:#BD976A;">parent</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u540C\u6B65\u5144\u5F1F\u8282\u70B9</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">sibling</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">sibling</span><span style="color:#666666;">.</span><span style="color:#BD976A;">sibling</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// \u5411\u5BB9\u5668\u4E2D\u8FFD\u52A0 | \u63D2\u5165\u5230\u67D0\u4E00\u4E2A\u8282\u70B9\u7684\u524D\u9762</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">insertOrAppendPlacementNodeIntoContainer</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">node</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">before</span><span style="color:#999999;">: </span><span style="color:#AB5959;">?</span><span style="color:#2E808F;">Instance</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">parent</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Container</span></span>
<span class="line"><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">void</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">tag</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">node</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C\u5F85\u63D2\u5165\u7684\u8282\u70B9\u662F\u4E00\u4E2A DOM \u5143\u7D20\u6216\u8005\u6587\u672C\u7684\u8BDD</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u6BD4\u5982 \u7EC4\u4EF6fiber =&gt; false div =&gt; true</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">isHost</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">tag</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostComponent</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">||</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">tag</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HostText</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">isHost</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">||</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">enableFundamentalAPI</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">tag</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">FundamentalComponent</span><span style="color:#999999;">))</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u83B7\u53D6 DOM \u8282\u70B9</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">stateNode</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">isHost</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">?</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">node</span><span style="color:#999999;">.</span><span style="color:#B07D48;">stateNode</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">node</span><span style="color:#999999;">.</span><span style="color:#B07D48;">stateNode</span><span style="color:#999999;">.</span><span style="color:#B07D48;">instance</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5982\u679C before \u5B58\u5728</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">before</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u63D2\u5165\u5230 before \u524D\u9762</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#59873A;">insertInContainerBefore</span><span style="color:#999999;">(</span><span style="color:#B07D48;">parent</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">stateNode</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">before</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u8FFD\u52A0\u5230\u7236\u5BB9\u5668\u4E2D</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#59873A;">appendChildToContainer</span><span style="color:#999999;">(</span><span style="color:#B07D48;">parent</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">stateNode</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5982\u679C\u662F\u7EC4\u4EF6\u8282\u70B9, \u6BD4\u5982 ClassComponent, \u5219\u627E\u5B83\u7684\u7B2C\u4E00\u4E2A\u5B50\u8282\u70B9(DOM \u5143\u7D20)</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u8FDB\u884C\u63D2\u5165\u64CD\u4F5C</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">child</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">node</span><span style="color:#999999;">.</span><span style="color:#B07D48;">child</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">child</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5411\u7236\u7EA7\u4E2D\u8FFD\u52A0\u5B50\u8282\u70B9\u6216\u8005\u5C06\u5B50\u8282\u70B9\u63D2\u5165\u5230 before \u7684\u524D\u9762</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#59873A;">insertOrAppendPlacementNodeIntoContainer</span><span style="color:#999999;">(</span><span style="color:#B07D48;">child</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">before</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">parent</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u4E0B\u4E00\u4E2A\u5144\u5F1F\u8282\u70B9</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">sibling</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">child</span><span style="color:#999999;">.</span><span style="color:#B07D48;">sibling</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5982\u679C\u5144\u5F1F\u8282\u70B9\u5B58\u5728</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">while</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">sibling</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u5411\u7236\u7EA7\u4E2D\u8FFD\u52A0\u5B50\u8282\u70B9\u6216\u8005\u5C06\u5B50\u8282\u70B9\u63D2\u5165\u5230 before \u7684\u524D\u9762</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#59873A;">insertOrAppendPlacementNodeIntoContainer</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">sibling</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">before</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                    </span><span style="color:#B07D48;">parent</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u540C\u6B65\u5144\u5F1F\u8282\u70B9</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">sibling</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">sibling</span><span style="color:#999999;">.</span><span style="color:#B07D48;">sibling</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-2-5-5-insertincontainerbefore" tabindex="-1">5.2.5.5 insertInContainerBefore <a class="header-anchor" href="#_5-2-5-5-insertincontainerbefore" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-dom/src/client/ReactDOMHostConfig.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">insertInContainerBefore</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">container</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Container</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">child</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Instance</span><span style="color:#666666;"> | </span><span style="color:#5DA9A7;">TextInstance</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">beforeChild</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Instance</span><span style="color:#666666;"> | </span><span style="color:#5DA9A7;">TextInstance</span><span style="color:#666666;"> | </span><span style="color:#5DA9A7;">SuspenseInstance</span></span>
<span class="line"><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">void</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C\u7236\u5BB9\u5668\u662F\u6CE8\u91CA\u8282\u70B9</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">container</span><span style="color:#666666;">.</span><span style="color:#BD976A;">nodeType</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">COMMENT_NODE</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u627E\u5230\u6CE8\u91CA\u8282\u70B9\u7684\u7236\u7EA7\u8282\u70B9 \u56E0\u4E3A\u6CE8\u91CA\u8282\u70B9\u6CA1\u6CD5\u8C03\u7528 insertBefore</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">(</span><span style="color:#BD976A;">container</span><span style="color:#666666;">.</span><span style="color:#BD976A;">parentNode</span><span style="color:#DBD7CAEE;">: </span><span style="color:#BD976A;">any</span><span style="color:#666666;">).</span><span style="color:#80A665;">insertBefore</span><span style="color:#666666;">(</span><span style="color:#BD976A;">child</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">beforeChild</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5C06 child \u63D2\u5165\u5230 beforeChild \u7684\u524D\u9762</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">container</span><span style="color:#666666;">.</span><span style="color:#80A665;">insertBefore</span><span style="color:#666666;">(</span><span style="color:#BD976A;">child</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">beforeChild</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">insertInContainerBefore</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">container</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Container</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">child</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Instance</span><span style="color:#999999;"> | </span><span style="color:#2E808F;">TextInstance</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">beforeChild</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Instance</span><span style="color:#999999;"> | </span><span style="color:#2E808F;">TextInstance</span><span style="color:#999999;"> | </span><span style="color:#2E808F;">SuspenseInstance</span></span>
<span class="line"><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">void</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C\u7236\u5BB9\u5668\u662F\u6CE8\u91CA\u8282\u70B9</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">container</span><span style="color:#999999;">.</span><span style="color:#B07D48;">nodeType</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">COMMENT_NODE</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u627E\u5230\u6CE8\u91CA\u8282\u70B9\u7684\u7236\u7EA7\u8282\u70B9 \u56E0\u4E3A\u6CE8\u91CA\u8282\u70B9\u6CA1\u6CD5\u8C03\u7528 insertBefore</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">(</span><span style="color:#B07D48;">container</span><span style="color:#999999;">.</span><span style="color:#B07D48;">parentNode</span><span style="color:#393A34;">: </span><span style="color:#B07D48;">any</span><span style="color:#999999;">).</span><span style="color:#59873A;">insertBefore</span><span style="color:#999999;">(</span><span style="color:#B07D48;">child</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">beforeChild</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5C06 child \u63D2\u5165\u5230 beforeChild \u7684\u524D\u9762</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">container</span><span style="color:#999999;">.</span><span style="color:#59873A;">insertBefore</span><span style="color:#999999;">(</span><span style="color:#B07D48;">child</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">beforeChild</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-2-5-6-appendchildtocontainer" tabindex="-1">5.2.5.6 appendChildToContainer <a class="header-anchor" href="#_5-2-5-6-appendchildtocontainer" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-dom/src/client/ReactDOMHostConfig.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">appendChildToContainer</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">container</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Container</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">child</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Instance</span><span style="color:#666666;"> | </span><span style="color:#5DA9A7;">TextInstance</span></span>
<span class="line"><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">void</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u76D1\u6D4B container \u662F\u5426\u6CE8\u91CA\u8282\u70B9</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">container</span><span style="color:#666666;">.</span><span style="color:#BD976A;">nodeType</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">COMMENT_NODE</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u83B7\u53D6\u7236\u7EA7\u7684\u7236\u7EA7</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">parentNode</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">container</span><span style="color:#666666;">.</span><span style="color:#BD976A;">parentNode</span><span style="color:#DBD7CAEE;">: </span><span style="color:#BD976A;">any</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5C06\u5B50\u7EA7\u8282\u70B9\u63D2\u5165\u5230\u6CE8\u91CA\u8282\u70B9\u7684\u524D\u9762</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">parentNode</span><span style="color:#666666;">.</span><span style="color:#80A665;">insertBefore</span><span style="color:#666666;">(</span><span style="color:#BD976A;">child</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">container</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u76F4\u63A5\u5C06 child \u63D2\u5165\u5230\u7236\u7EA7\u4E2D</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">parentNode</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">container</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">parentNode</span><span style="color:#666666;">.</span><span style="color:#80A665;">appendChild</span><span style="color:#666666;">(</span><span style="color:#BD976A;">child</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">appendChildToContainer</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">container</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Container</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">child</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Instance</span><span style="color:#999999;"> | </span><span style="color:#2E808F;">TextInstance</span></span>
<span class="line"><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">void</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u76D1\u6D4B container \u662F\u5426\u6CE8\u91CA\u8282\u70B9</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">container</span><span style="color:#999999;">.</span><span style="color:#B07D48;">nodeType</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">COMMENT_NODE</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u7236\u7EA7\u7684\u7236\u7EA7</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">parentNode</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">container</span><span style="color:#999999;">.</span><span style="color:#B07D48;">parentNode</span><span style="color:#393A34;">: </span><span style="color:#B07D48;">any</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5C06\u5B50\u7EA7\u8282\u70B9\u63D2\u5165\u5230\u6CE8\u91CA\u8282\u70B9\u7684\u524D\u9762</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">parentNode</span><span style="color:#999999;">.</span><span style="color:#59873A;">insertBefore</span><span style="color:#999999;">(</span><span style="color:#B07D48;">child</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">container</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u76F4\u63A5\u5C06 child \u63D2\u5165\u5230\u7236\u7EA7\u4E2D</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">parentNode</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">container</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">parentNode</span><span style="color:#999999;">.</span><span style="color:#59873A;">appendChild</span><span style="color:#999999;">(</span><span style="color:#B07D48;">child</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="_5-2-6-\u7B2C\u4E09\u5B50\u9636\u6BB5" tabindex="-1">5.2.6 \u7B2C\u4E09\u5B50\u9636\u6BB5 <a class="header-anchor" href="#_5-2-6-\u7B2C\u4E09\u5B50\u9636\u6BB5" aria-hidden="true">#</a></h4><h5 id="_5-2-6-1-commitlayouteffects" tabindex="-1">5.2.6.1 commitLayoutEffects <a class="header-anchor" href="#_5-2-6-1-commitlayouteffects" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberWorkLoop.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// commit \u9636\u6BB5\u7684\u7B2C\u4E09\u4E2A\u5B50\u9636\u6BB5</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">commitLayoutEffects</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">root</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">FiberRoot</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">committedExpirationTime</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">ExpirationTime</span></span>
<span class="line"><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">while</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">nextEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u6B64\u65F6 effectTag \u5DF2\u7ECF\u88AB\u91CD\u7F6E\u4E3A 1, \u8868\u793A DOM \u64CD\u4F5C\u5DF2\u7ECF\u5B8C\u6210</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">effectTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">effectTag</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u8C03\u7528\u751F\u547D\u5468\u671F\u51FD\u6570\u548C\u94A9\u5B50\u51FD\u6570</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u524D\u63D0\u662F\u7C7B\u7EC4\u4EF6\u4E2D\u8C03\u7528\u4E86\u751F\u547D\u5468\u671F\u51FD\u6570 \u6216\u8005\u51FD\u6570\u7EC4\u4EF6\u4E2D\u8C03\u7528\u4E86 useEffect</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">effectTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">Update</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Callback</span><span style="color:#666666;">))</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u7C7B\u7EC4\u4EF6\u5904\u7406\u751F\u547D\u5468\u671F\u51FD\u6570</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u51FD\u6570\u7EC4\u4EF6\u5904\u7406\u94A9\u5B50\u51FD\u6570</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#80A665;">commitLayoutEffectOnFiber</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">root</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">current</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">committedExpirationTime</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u66F4\u65B0\u5FAA\u73AF\u6761\u4EF6</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">nextEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">nextEffect</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// commit \u9636\u6BB5\u7684\u7B2C\u4E09\u4E2A\u5B50\u9636\u6BB5</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">commitLayoutEffects</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">root</span><span style="color:#999999;">: </span><span style="color:#2E808F;">FiberRoot</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">committedExpirationTime</span><span style="color:#999999;">: </span><span style="color:#2E808F;">ExpirationTime</span></span>
<span class="line"><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">while</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">nextEffect</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u6B64\u65F6 effectTag \u5DF2\u7ECF\u88AB\u91CD\u7F6E\u4E3A 1, \u8868\u793A DOM \u64CD\u4F5C\u5DF2\u7ECF\u5B8C\u6210</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">effectTag</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">effectTag</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u8C03\u7528\u751F\u547D\u5468\u671F\u51FD\u6570\u548C\u94A9\u5B50\u51FD\u6570</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u524D\u63D0\u662F\u7C7B\u7EC4\u4EF6\u4E2D\u8C03\u7528\u4E86\u751F\u547D\u5468\u671F\u51FD\u6570 \u6216\u8005\u51FD\u6570\u7EC4\u4EF6\u4E2D\u8C03\u7528\u4E86 useEffect</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">effectTag</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">Update</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Callback</span><span style="color:#999999;">))</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u7C7B\u7EC4\u4EF6\u5904\u7406\u751F\u547D\u5468\u671F\u51FD\u6570</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u51FD\u6570\u7EC4\u4EF6\u5904\u7406\u94A9\u5B50\u51FD\u6570</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#59873A;">commitLayoutEffectOnFiber</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">root</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">current</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">committedExpirationTime</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u66F4\u65B0\u5FAA\u73AF\u6761\u4EF6</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">nextEffect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">nextEffect</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-2-6-2-commitlifecycles" tabindex="-1">5.2.6.2 commitLifeCycles <a class="header-anchor" href="#_5-2-6-2-commitlifecycles" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberCommitWork.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">commitLifeCycles</span><span style="color:#666666;">(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">finishedRoot</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">FiberRoot</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">current</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;"> | </span><span style="color:#CB7676;">null</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">committedExpirationTime</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">ExpirationTime</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">void</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">switch</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">.</span><span style="color:#BD976A;">tag</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">FunctionComponent</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">      </span><span style="color:#758575DD;">// \u5904\u7406\u94A9\u5B50\u51FD\u6570</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#80A665;">commitHookEffectListMount</span><span style="color:#666666;">(</span><span style="color:#BD976A;">HookLayout</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">HookHasEffect</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ClassComponent</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">      </span><span style="color:#758575DD;">// \u83B7\u53D6\u7C7B\u7EC4\u4EF6\u5B9E\u4F8B\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">instance</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">.</span><span style="color:#BD976A;">stateNode</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">      </span><span style="color:#758575DD;">// \u5982\u679C\u5728\u7C7B\u7EC4\u4EF6\u4E2D\u5B58\u5728\u751F\u547D\u5468\u671F\u51FD\u6570\u5224\u65AD\u6761\u4EF6\u5C31\u4F1A\u6210\u7ACB</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">.</span><span style="color:#BD976A;">effectTag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Update</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u521D\u59CB\u6E32\u67D3\u9636\u6BB5</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">current</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">          </span><span style="color:#758575DD;">// \u8C03\u7528 componentDidMount \u751F\u547D\u5468\u671F\u51FD\u6570</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#BD976A;">instance</span><span style="color:#666666;">.</span><span style="color:#80A665;">componentDidMount</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">else</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">          </span><span style="color:#758575DD;">// \u66F4\u65B0\u9636\u6BB5</span></span>
<span class="line"><span style="color:#666666;">          </span><span style="color:#758575DD;">// \u83B7\u53D6\u65E7\u7684 props</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">prevProps</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">.</span><span style="color:#BD976A;">elementType</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">.</span><span style="color:#BD976A;">type</span></span>
<span class="line"><span style="color:#DBD7CAEE;">              </span><span style="color:#CB7676;">?</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">memoizedProps</span></span>
<span class="line"><span style="color:#DBD7CAEE;">              </span><span style="color:#CB7676;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">resolveDefaultProps</span><span style="color:#666666;">(</span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">.</span><span style="color:#BD976A;">type</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">memoizedProps</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">          </span><span style="color:#758575DD;">// \u83B7\u53D6\u65E7\u7684 state</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">prevState</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">current</span><span style="color:#666666;">.</span><span style="color:#BD976A;">memoizedState</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">          </span><span style="color:#758575DD;">// \u8C03\u7528 componentDidUpdate \u751F\u547D\u5468\u671F\u51FD\u6570</span></span>
<span class="line"><span style="color:#666666;">          </span><span style="color:#758575DD;">// instance.__reactInternalSnapshotBeforeUpdate \u5FEB\u7167 getSnapShotBeforeUpdate \u65B9\u6CD5\u7684\u8FD4\u56DE\u503C</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#BD976A;">instance</span><span style="color:#666666;">.</span><span style="color:#80A665;">componentDidUpdate</span><span style="color:#666666;">(</span><span style="color:#BD976A;">prevProps</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">prevState</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">instance</span><span style="color:#666666;">.</span><span style="color:#BD976A;">__reactInternalSnapshotBeforeUpdate</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">      </span><span style="color:#758575DD;">// \u83B7\u53D6\u4EFB\u52A1\u961F\u5217</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">updateQueue</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">.</span><span style="color:#BD976A;">updateQueue</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">      </span><span style="color:#758575DD;">// \u5982\u679C\u4EFB\u52A1\u961F\u5217\u5B58\u5728</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">updateQueue</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;">         * \u8C03\u7528 ReactElement \u6E32\u67D3\u5B8C\u6210\u4E4B\u540E\u7684\u56DE\u8C03\u51FD\u6570</span></span>
<span class="line"><span style="color:#758575DD;">         * \u5373 render \u65B9\u6CD5\u7684\u7B2C\u4E09\u4E2A\u53C2\u6570</span></span>
<span class="line"><span style="color:#758575DD;">         */</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#80A665;">commitUpdateQueue</span><span style="color:#666666;">(</span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">updateQueue</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">instance</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">commitLifeCycles</span><span style="color:#999999;">(</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">finishedRoot</span><span style="color:#999999;">: </span><span style="color:#2E808F;">FiberRoot</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">current</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;"> | </span><span style="color:#AB5959;">null</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">committedExpirationTime</span><span style="color:#999999;">: </span><span style="color:#2E808F;">ExpirationTime</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">void</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">switch</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">.</span><span style="color:#B07D48;">tag</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">FunctionComponent</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">      </span><span style="color:#A0ADA0;">// \u5904\u7406\u94A9\u5B50\u51FD\u6570</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#59873A;">commitHookEffectListMount</span><span style="color:#999999;">(</span><span style="color:#B07D48;">HookLayout</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">HookHasEffect</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">case</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ClassComponent</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">      </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u7C7B\u7EC4\u4EF6\u5B9E\u4F8B\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">instance</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">.</span><span style="color:#B07D48;">stateNode</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">      </span><span style="color:#A0ADA0;">// \u5982\u679C\u5728\u7C7B\u7EC4\u4EF6\u4E2D\u5B58\u5728\u751F\u547D\u5468\u671F\u51FD\u6570\u5224\u65AD\u6761\u4EF6\u5C31\u4F1A\u6210\u7ACB</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">.</span><span style="color:#B07D48;">effectTag</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Update</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u521D\u59CB\u6E32\u67D3\u9636\u6BB5</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">current</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">          </span><span style="color:#A0ADA0;">// \u8C03\u7528 componentDidMount \u751F\u547D\u5468\u671F\u51FD\u6570</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#B07D48;">instance</span><span style="color:#999999;">.</span><span style="color:#59873A;">componentDidMount</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">else</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">          </span><span style="color:#A0ADA0;">// \u66F4\u65B0\u9636\u6BB5</span></span>
<span class="line"><span style="color:#999999;">          </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u65E7\u7684 props</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">prevProps</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">.</span><span style="color:#B07D48;">elementType</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">.</span><span style="color:#B07D48;">type</span></span>
<span class="line"><span style="color:#393A34;">              </span><span style="color:#AB5959;">?</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">memoizedProps</span></span>
<span class="line"><span style="color:#393A34;">              </span><span style="color:#AB5959;">:</span><span style="color:#393A34;"> </span><span style="color:#59873A;">resolveDefaultProps</span><span style="color:#999999;">(</span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">.</span><span style="color:#B07D48;">type</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">memoizedProps</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">          </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u65E7\u7684 state</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">prevState</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">current</span><span style="color:#999999;">.</span><span style="color:#B07D48;">memoizedState</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">          </span><span style="color:#A0ADA0;">// \u8C03\u7528 componentDidUpdate \u751F\u547D\u5468\u671F\u51FD\u6570</span></span>
<span class="line"><span style="color:#999999;">          </span><span style="color:#A0ADA0;">// instance.__reactInternalSnapshotBeforeUpdate \u5FEB\u7167 getSnapShotBeforeUpdate \u65B9\u6CD5\u7684\u8FD4\u56DE\u503C</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#B07D48;">instance</span><span style="color:#999999;">.</span><span style="color:#59873A;">componentDidUpdate</span><span style="color:#999999;">(</span><span style="color:#B07D48;">prevProps</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">prevState</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">instance</span><span style="color:#999999;">.</span><span style="color:#B07D48;">__reactInternalSnapshotBeforeUpdate</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">      </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u4EFB\u52A1\u961F\u5217</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">updateQueue</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">.</span><span style="color:#B07D48;">updateQueue</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">      </span><span style="color:#A0ADA0;">// \u5982\u679C\u4EFB\u52A1\u961F\u5217\u5B58\u5728</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">updateQueue</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;">         * \u8C03\u7528 ReactElement \u6E32\u67D3\u5B8C\u6210\u4E4B\u540E\u7684\u56DE\u8C03\u51FD\u6570</span></span>
<span class="line"><span style="color:#A0ADA0;">         * \u5373 render \u65B9\u6CD5\u7684\u7B2C\u4E09\u4E2A\u53C2\u6570</span></span>
<span class="line"><span style="color:#A0ADA0;">         */</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#59873A;">commitUpdateQueue</span><span style="color:#999999;">(</span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">updateQueue</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">instance</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-2-6-3-commitupdatequeue" tabindex="-1">5.2.6.3 commitUpdateQueue <a class="header-anchor" href="#_5-2-6-3-commitupdatequeue" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactUpdateQueue.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * \u6267\u884C\u6E32\u67D3\u5B8C\u6210\u4E4B\u540E\u7684\u56DE\u8C03\u51FD\u6570</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#4D9375;">export</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">commitUpdateQueue</span><span style="color:#666666;">&lt;</span><span style="color:#5DA9A7;">State</span><span style="color:#666666;">&gt;(</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">finishedQueue</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">UpdateQueue</span><span style="color:#666666;">&lt;</span><span style="color:#5DA9A7;">State</span><span style="color:#666666;">&gt;,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">instance</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">any</span></span>
<span class="line"><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">void</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// effects \u4E3A\u6570\u7EC4, \u5B58\u50A8\u4EFB\u52A1\u5BF9\u8C61 (Update \u5BF9\u8C61)</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u4F46\u524D\u63D0\u662F\u5728\u8C03\u7528 render \u65B9\u6CD5\u65F6\u4F20\u9012\u4E86\u56DE\u8C03\u51FD\u6570, \u5C31\u662F render \u65B9\u6CD5\u7684\u7B2C\u4E09\u4E2A\u53C2\u6570</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">effects</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">finishedQueue</span><span style="color:#666666;">.</span><span style="color:#BD976A;">effects</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u91CD\u7F6E finishedQueue.effects \u6570\u7EC4</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">finishedQueue</span><span style="color:#666666;">.</span><span style="color:#BD976A;">effects</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C\u4F20\u9012\u4E86 render \u65B9\u6CD5\u7684\u7B2C\u4E09\u4E2A\u53C2\u6570, effect \u6570\u7EC4\u5C31\u4E0D\u4F1A\u4E3A null</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">effects</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u904D\u5386 effect \u6570\u7EC4</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">for</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">i</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">0</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">i</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">effects</span><span style="color:#666666;">.</span><span style="color:#B8A965;">length</span><span style="color:#666666;">;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">i</span><span style="color:#CB7676;">++</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u83B7\u53D6\u6570\u7EC4\u4E2D\u7684\u7B2C i \u4E2A\u9700\u8981\u6267\u884C\u7684 effect</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">effect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">effects</span><span style="color:#666666;">[</span><span style="color:#BD976A;">i</span><span style="color:#666666;">];</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u83B7\u53D6 callback \u56DE\u8C03\u51FD\u6570</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">callback</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">effect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">callback</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u5982\u679C\u56DE\u8C03\u51FD\u6570\u4E0D\u4E3A null</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">callback</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u6E05\u7A7A effect \u4E2D\u7684 callback</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">effect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">callback</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u6267\u884C\u56DE\u8C03\u51FD\u6570</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#80A665;">callCallback</span><span style="color:#666666;">(</span><span style="color:#BD976A;">callback</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">instance</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * \u6267\u884C\u6E32\u67D3\u5B8C\u6210\u4E4B\u540E\u7684\u56DE\u8C03\u51FD\u6570</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#1E754F;">export</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">commitUpdateQueue</span><span style="color:#999999;">&lt;</span><span style="color:#2E808F;">State</span><span style="color:#999999;">&gt;(</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">finishedQueue</span><span style="color:#999999;">: </span><span style="color:#2E808F;">UpdateQueue</span><span style="color:#999999;">&lt;</span><span style="color:#2E808F;">State</span><span style="color:#999999;">&gt;,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">instance</span><span style="color:#999999;">: </span><span style="color:#2E808F;">any</span></span>
<span class="line"><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">void</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// effects \u4E3A\u6570\u7EC4, \u5B58\u50A8\u4EFB\u52A1\u5BF9\u8C61 (Update \u5BF9\u8C61)</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u4F46\u524D\u63D0\u662F\u5728\u8C03\u7528 render \u65B9\u6CD5\u65F6\u4F20\u9012\u4E86\u56DE\u8C03\u51FD\u6570, \u5C31\u662F render \u65B9\u6CD5\u7684\u7B2C\u4E09\u4E2A\u53C2\u6570</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">effects</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">finishedQueue</span><span style="color:#999999;">.</span><span style="color:#B07D48;">effects</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u91CD\u7F6E finishedQueue.effects \u6570\u7EC4</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">finishedQueue</span><span style="color:#999999;">.</span><span style="color:#B07D48;">effects</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C\u4F20\u9012\u4E86 render \u65B9\u6CD5\u7684\u7B2C\u4E09\u4E2A\u53C2\u6570, effect \u6570\u7EC4\u5C31\u4E0D\u4F1A\u4E3A null</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">effects</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u904D\u5386 effect \u6570\u7EC4</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">for</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">i</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">i</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">effects</span><span style="color:#999999;">.</span><span style="color:#998418;">length</span><span style="color:#999999;">;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">i</span><span style="color:#AB5959;">++</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u6570\u7EC4\u4E2D\u7684\u7B2C i \u4E2A\u9700\u8981\u6267\u884C\u7684 effect</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">effect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">effects</span><span style="color:#999999;">[</span><span style="color:#B07D48;">i</span><span style="color:#999999;">];</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u83B7\u53D6 callback \u56DE\u8C03\u51FD\u6570</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">callback</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">effect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">callback</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u5982\u679C\u56DE\u8C03\u51FD\u6570\u4E0D\u4E3A null</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">callback</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u6E05\u7A7A effect \u4E2D\u7684 callback</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">effect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">callback</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u6267\u884C\u56DE\u8C03\u51FD\u6570</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#59873A;">callCallback</span><span style="color:#999999;">(</span><span style="color:#B07D48;">callback</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">instance</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="_5-2-6-4-commithookeffectlistmount" tabindex="-1">5.2.6.4 commitHookEffectListMount <a class="header-anchor" href="#_5-2-6-4-commithookeffectlistmount" aria-hidden="true">#</a></h5><p><code>\u6587\u4EF6\u4F4D\u7F6E: packages/react-reconciler/src/ReactFiberCommitWork.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">/**</span></span>
<span class="line"><span style="color:#758575DD;"> * useEffect \u56DE\u8C03\u51FD\u6570\u8C03\u7528</span></span>
<span class="line"><span style="color:#758575DD;"> */</span></span>
<span class="line"><span style="color:#CB7676;">function</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">commitHookEffectListMount</span><span style="color:#666666;">(</span><span style="color:#BD976A;">tag</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">number</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">Fiber</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6\u4EFB\u52A1\u961F\u5217</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">updateQueue</span><span style="color:#666666;">: </span><span style="color:#5DA9A7;">FunctionComponentUpdateQueue</span><span style="color:#666666;"> | </span><span style="color:#CB7676;">null</span><span style="color:#666666;"> =</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">(</span><span style="color:#BD976A;">finishedWork</span><span style="color:#666666;">.</span><span style="color:#BD976A;">updateQueue</span><span style="color:#DBD7CAEE;">: </span><span style="color:#BD976A;">any</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u83B7\u53D6 lastEffect</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">lastEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">updateQueue</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">?</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">updateQueue</span><span style="color:#666666;">.</span><span style="color:#BD976A;">lastEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// \u5982\u679C lastEffect \u4E0D\u4E3A null</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">lastEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">null</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u83B7\u53D6\u8981\u6267\u884C\u7684\u526F\u4F5C\u7528</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">firstEffect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">lastEffect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">next</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#CB7676;">let</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">effect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">firstEffect</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u901A\u8FC7\u904D\u5386\u7684\u65B9\u5F0F\u8C03\u7528 useEffect \u4E2D\u7684\u56DE\u8C03\u51FD\u6570</span></span>
<span class="line"><span style="color:#666666;">        </span><span style="color:#758575DD;">// \u5728\u7EC4\u4EF6\u4E2D\u5B9A\u4E49\u4E86\u8C03\u7528\u4E86\u51E0\u6B21 useEffect \u904D\u5386\u5C31\u4F1A\u6267\u884C\u51E0\u6B21</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">do</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">((</span><span style="color:#BD976A;">effect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">tag</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">&amp;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">tag</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">tag</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// Mount</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">create</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">effect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">create</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// create \u5C31\u662F useEffect \u65B9\u6CD5\u7684\u7B2C\u4E00\u4E2A\u53C2\u6570</span></span>
<span class="line"><span style="color:#666666;">                </span><span style="color:#758575DD;">// \u8FD4\u56DE\u503C\u5C31\u662F\u6E05\u7406\u51FD\u6570</span></span>
<span class="line"><span style="color:#DBD7CAEE;">                </span><span style="color:#BD976A;">effect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">destroy</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">create</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">            </span><span style="color:#758575DD;">// \u66F4\u65B0\u5FAA\u73AF\u6761\u4EF6</span></span>
<span class="line"><span style="color:#DBD7CAEE;">            </span><span style="color:#BD976A;">effect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">effect</span><span style="color:#666666;">.</span><span style="color:#BD976A;">next</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">while</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">effect</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">firstEffect</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">/**</span></span>
<span class="line"><span style="color:#A0ADA0;"> * useEffect \u56DE\u8C03\u51FD\u6570\u8C03\u7528</span></span>
<span class="line"><span style="color:#A0ADA0;"> */</span></span>
<span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">commitHookEffectListMount</span><span style="color:#999999;">(</span><span style="color:#B07D48;">tag</span><span style="color:#999999;">: </span><span style="color:#2E808F;">number</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">: </span><span style="color:#2E808F;">Fiber</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u4EFB\u52A1\u961F\u5217</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">updateQueue</span><span style="color:#999999;">: </span><span style="color:#2E808F;">FunctionComponentUpdateQueue</span><span style="color:#999999;"> | </span><span style="color:#AB5959;">null</span><span style="color:#999999;"> =</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">(</span><span style="color:#B07D48;">finishedWork</span><span style="color:#999999;">.</span><span style="color:#B07D48;">updateQueue</span><span style="color:#393A34;">: </span><span style="color:#B07D48;">any</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u83B7\u53D6 lastEffect</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">lastEffect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">updateQueue</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">?</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">updateQueue</span><span style="color:#999999;">.</span><span style="color:#B07D48;">lastEffect</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// \u5982\u679C lastEffect \u4E0D\u4E3A null</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">lastEffect</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">null</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u83B7\u53D6\u8981\u6267\u884C\u7684\u526F\u4F5C\u7528</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">firstEffect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">lastEffect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">next</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">effect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">firstEffect</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u901A\u8FC7\u904D\u5386\u7684\u65B9\u5F0F\u8C03\u7528 useEffect \u4E2D\u7684\u56DE\u8C03\u51FD\u6570</span></span>
<span class="line"><span style="color:#999999;">        </span><span style="color:#A0ADA0;">// \u5728\u7EC4\u4EF6\u4E2D\u5B9A\u4E49\u4E86\u8C03\u7528\u4E86\u51E0\u6B21 useEffect \u904D\u5386\u5C31\u4F1A\u6267\u884C\u51E0\u6B21</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">do</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">((</span><span style="color:#B07D48;">effect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">tag</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">tag</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">tag</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// Mount</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">create</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">effect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">create</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// create \u5C31\u662F useEffect \u65B9\u6CD5\u7684\u7B2C\u4E00\u4E2A\u53C2\u6570</span></span>
<span class="line"><span style="color:#999999;">                </span><span style="color:#A0ADA0;">// \u8FD4\u56DE\u503C\u5C31\u662F\u6E05\u7406\u51FD\u6570</span></span>
<span class="line"><span style="color:#393A34;">                </span><span style="color:#B07D48;">effect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">destroy</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">create</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">            </span><span style="color:#A0ADA0;">// \u66F4\u65B0\u5FAA\u73AF\u6761\u4EF6</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B07D48;">effect</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">effect</span><span style="color:#999999;">.</span><span style="color:#B07D48;">next</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">while</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">effect</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">firstEffect</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div>`,226),i=[A];function B(E,C,d,u,f,g){return a(),n("div",null,i)}const F=s(D,[["render",B]]);export{b as __pageData,F as default};
