import{_ as s,c as n,o as a,a as l}from"./app.8a7326df.js";const p="/assets/9.4708101c.png",o="/assets/10.ce13f13e.png",e="/assets/11.257f9925.png",r="/assets/12.f91c5366.png",c="/assets/13.0b61b04f.png",t="/assets/14.bb8324d8.png",y="/assets/15.8bc71c9d.png",b=JSON.parse('{"title":"Apollo GraphQL","description":"","frontmatter":{"outline":"deep"},"headers":[{"level":2,"title":"\u57FA\u672C\u7528\u6CD5","slug":"\u57FA\u672C\u7528\u6CD5","link":"#\u57FA\u672C\u7528\u6CD5","children":[]},{"level":2,"title":"\u4E0E Node.js \u4E2D\u95F4\u4EF6\u96C6\u6210","slug":"\u4E0E-node-js-\u4E2D\u95F4\u4EF6\u96C6\u6210","link":"#\u4E0E-node-js-\u4E2D\u95F4\u4EF6\u96C6\u6210","children":[]},{"level":2,"title":"\u89E3\u6790\u5668","slug":"\u89E3\u6790\u5668","link":"#\u89E3\u6790\u5668","children":[]},{"level":2,"title":"\u8FDE\u63A5\u5230\u6570\u636E\u6E90","slug":"\u8FDE\u63A5\u5230\u6570\u636E\u6E90","link":"#\u8FDE\u63A5\u5230\u6570\u636E\u6E90","children":[]},{"level":2,"title":"\u9519\u8BEF\u5904\u7406","slug":"\u9519\u8BEF\u5904\u7406","link":"#\u9519\u8BEF\u5904\u7406","children":[]},{"level":2,"title":"\u6743\u9650\u8BA4\u8BC1","slug":"\u6743\u9650\u8BA4\u8BC1","link":"#\u6743\u9650\u8BA4\u8BC1","children":[]},{"level":2,"title":"Apollo Client","slug":"apollo-client","link":"#apollo-client","children":[]},{"level":2,"title":"GraphQL \u7EFC\u5408\u6848\u4F8B","slug":"graphql-\u7EFC\u5408\u6848\u4F8B","link":"#graphql-\u7EFC\u5408\u6848\u4F8B","children":[]},{"level":2,"title":"\u5176\u5B83\u5DE5\u5177\u5E93","slug":"\u5176\u5B83\u5DE5\u5177\u5E93","link":"#\u5176\u5B83\u5DE5\u5177\u5E93","children":[]}],"relativePath":"FullStack/GraphQL/Apollo.md"}'),A={name:"FullStack/GraphQL/Apollo.md"},i=l('<h1 id="apollo-graphql" tabindex="-1">Apollo GraphQL <a class="header-anchor" href="#apollo-graphql" aria-hidden="true">#</a></h1><p>Apollo \u662F\u4E00\u4E2A\u5F00\u6E90\u7684 GraphQL \u5F00\u53D1\u5E73\u53F0\uFF0C \u63D0\u4F9B\u4E86\u7B26\u5408 GraphQL \u89C4\u8303\u7684\u670D\u52A1\u7AEF\u548C\u5BA2\u6237\u7AEF\u5B9E\u73B0\u3002\u4F7F\u7528 Apollo \u53EF\u4EE5\u5E2E\u52A9\u6211\u4EEC\u66F4\u65B9\u4FBF\u5FEB\u6377\u7684\u5F00\u53D1\u4F7F\u7528 GraphQL\u3002</p><p><img src="'+p+`" alt="img"></p><ul><li>\u5B98\u7F51\uFF1A<a href="https://www.apollographql.com/" target="_blank" rel="noreferrer">https://www.apollographql.com/</a></li><li>GitHub \u76F8\u5173\u5F00\u6E90\u4ED3\u5E93\uFF1A<a href="https://github.com/apollographql" target="_blank" rel="noreferrer">https://github.com/apollographql</a></li></ul><h2 id="\u57FA\u672C\u7528\u6CD5" tabindex="-1">\u57FA\u672C\u7528\u6CD5 <a class="header-anchor" href="#\u57FA\u672C\u7528\u6CD5" aria-hidden="true">#</a></h2><p>1\u3001\u51C6\u5907</p><div class="language-Shell"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;"># \u521B\u5EFA\u9879\u76EE\u76EE\u5F55</span></span>
<span class="line"><span style="color:#DBD7CAEE;">mkdir graphql-server-example</span></span>
<span class="line"><span style="color:#B8A965;">cd</span><span style="color:#DBD7CAEE;"> graphql-server-example</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;"># \u521D\u59CB\u5316 package.json \u6587\u4EF6</span></span>
<span class="line"><span style="color:#DBD7CAEE;">npm init -y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;"># \u5B89\u88C5\u4F9D\u8D56</span></span>
<span class="line"><span style="color:#DBD7CAEE;">npm install apollo-server graphql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;"># \u521B\u5EFA index.js</span></span>
<span class="line"><span style="color:#DBD7CAEE;">touch index.js</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># \u521B\u5EFA\u9879\u76EE\u76EE\u5F55</span></span>
<span class="line"><span style="color:#393A34;">mkdir graphql-server-example</span></span>
<span class="line"><span style="color:#998418;">cd</span><span style="color:#393A34;"> graphql-server-example</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># \u521D\u59CB\u5316 package.json \u6587\u4EF6</span></span>
<span class="line"><span style="color:#393A34;">npm init -y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># \u5B89\u88C5\u4F9D\u8D56</span></span>
<span class="line"><span style="color:#393A34;">npm install apollo-server graphql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># \u521B\u5EFA index.js</span></span>
<span class="line"><span style="color:#393A34;">touch index.js</span></span>
<span class="line"></span></code></pre></div><p>2\u3001index.js</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ApolloServer</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">gql</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">require</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">apollo-server</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">typeDefs</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">gql</span><span style="color:#C98A7DAA;">\`</span></span>
<span class="line"><span style="color:#C98A7D;">  # Comments in GraphQL strings (such as this one) start with the hash (#) symbol.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C98A7D;">  # This &quot;Book&quot; type defines the queryable fields for every book in our data source.</span></span>
<span class="line"><span style="color:#C98A7D;">  type Book {</span></span>
<span class="line"><span style="color:#C98A7D;">    title: String</span></span>
<span class="line"><span style="color:#C98A7D;">    author: String</span></span>
<span class="line"><span style="color:#C98A7D;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C98A7D;">  # The &quot;Query&quot; type is special: it lists all of the available queries that</span></span>
<span class="line"><span style="color:#C98A7D;">  # clients can execute, along with the return type for each. In this</span></span>
<span class="line"><span style="color:#C98A7D;">  # case, the &quot;books&quot; query returns an array of zero or more Books (defined above).</span></span>
<span class="line"><span style="color:#C98A7D;">  type Query {</span></span>
<span class="line"><span style="color:#C98A7D;">    books: [Book]</span></span>
<span class="line"><span style="color:#C98A7D;">  }</span></span>
<span class="line"><span style="color:#C98A7DAA;">\`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">books</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">title</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">The Awakening</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">author</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Kate Chopin</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">title</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">City of Glass</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">author</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Paul Auster</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">resolvers</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">Query</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">books</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">books</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// The ApolloServer constructor requires two parameters: your schema</span></span>
<span class="line"><span style="color:#758575DD;">// definition and your set of resolvers.</span></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">server</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">ApolloServer</span><span style="color:#666666;">({</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">typeDefs</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">resolvers</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// The \`listen\` method launches a web server.</span></span>
<span class="line"><span style="color:#BD976A;">server</span><span style="color:#666666;">.</span><span style="color:#80A665;">listen</span><span style="color:#666666;">().</span><span style="color:#80A665;">then</span><span style="color:#666666;">(({</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">url</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">})</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">\`</span><span style="color:#C98A7D;">\u{1F680}  Server ready at </span><span style="color:#666666;">\${</span><span style="color:#C98A7D;">url</span><span style="color:#666666;">}</span><span style="color:#C98A7DAA;">\`</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ApolloServer</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">gql</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">require</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">apollo-server</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">typeDefs</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">gql</span><span style="color:#B56959AA;">\`</span></span>
<span class="line"><span style="color:#B56959;">  # Comments in GraphQL strings (such as this one) start with the hash (#) symbol.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B56959;">  # This &quot;Book&quot; type defines the queryable fields for every book in our data source.</span></span>
<span class="line"><span style="color:#B56959;">  type Book {</span></span>
<span class="line"><span style="color:#B56959;">    title: String</span></span>
<span class="line"><span style="color:#B56959;">    author: String</span></span>
<span class="line"><span style="color:#B56959;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B56959;">  # The &quot;Query&quot; type is special: it lists all of the available queries that</span></span>
<span class="line"><span style="color:#B56959;">  # clients can execute, along with the return type for each. In this</span></span>
<span class="line"><span style="color:#B56959;">  # case, the &quot;books&quot; query returns an array of zero or more Books (defined above).</span></span>
<span class="line"><span style="color:#B56959;">  type Query {</span></span>
<span class="line"><span style="color:#B56959;">    books: [Book]</span></span>
<span class="line"><span style="color:#B56959;">  }</span></span>
<span class="line"><span style="color:#B56959AA;">\`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">books</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">title</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">The Awakening</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">author</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Kate Chopin</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">title</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">City of Glass</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">author</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Paul Auster</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">resolvers</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">Query</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">books</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">books</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// The ApolloServer constructor requires two parameters: your schema</span></span>
<span class="line"><span style="color:#A0ADA0;">// definition and your set of resolvers.</span></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">server</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">ApolloServer</span><span style="color:#999999;">({</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">typeDefs</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">resolvers</span><span style="color:#393A34;"> </span><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// The \`listen\` method launches a web server.</span></span>
<span class="line"><span style="color:#B07D48;">server</span><span style="color:#999999;">.</span><span style="color:#59873A;">listen</span><span style="color:#999999;">().</span><span style="color:#59873A;">then</span><span style="color:#999999;">(({</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">url</span><span style="color:#393A34;"> </span><span style="color:#999999;">})</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">\`</span><span style="color:#B56959;">\u{1F680}  Server ready at </span><span style="color:#999999;">\${</span><span style="color:#B56959;">url</span><span style="color:#999999;">}</span><span style="color:#B56959AA;">\`</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>3\u3001\u5173\u4E8E gql \u6807\u7B7E\u6A21\u677F</p><ul><li>gql \u6807\u7B7E\u6A21\u677F\u5C06\u67E5\u8BE2\u5B57\u7B26\u4E32\u89E3\u6790\u4E3A AST\uFF0C\u7528\u4E8E\u4F7F\u7528 Prettier \u7A81\u51FA\u663E\u793A\u7F16\u8F91\u5668\u8BED\u6CD5\u548C\u81EA\u52A8\u683C\u5F0F\u5316\u3002</li><li>\u5C06\u6765\uFF0C\u6211\u4EEC\u5C06\u4F7F\u7528\u5B83\u6765\u9759\u6001\u5206\u6790 GraphQL \u67E5\u8BE2\uFF0C\u56E0\u6B64 Apollo Server \u9700\u8981\u4F7F\u7528 gql \u5305\u88C5\u60A8\u7684 schema\u3002</li><li>gql \u4E5F\u53EF\u4EE5\u7528\u4F5C\u5C06\u5B57\u7B26\u4E32\u8F6C\u6362\u4E3AAST\u7684\u5E38\u89C4\u51FD\u6570</li></ul><h2 id="\u4E0E-node-js-\u4E2D\u95F4\u4EF6\u96C6\u6210" tabindex="-1">\u4E0E Node.js \u4E2D\u95F4\u4EF6\u96C6\u6210 <a class="header-anchor" href="#\u4E0E-node-js-\u4E2D\u95F4\u4EF6\u96C6\u6210" aria-hidden="true">#</a></h2><p>Apollo Server \u53EF\u4EE5\u8F7B\u677E\u5730\u4E0E\u51E0\u4E2A\u6D41\u884C\u7684 Node.js \u4E2D\u95F4\u4EF6\u5E93\u96C6\u6210\u3002\u8981\u96C6\u6210\uFF0C\u8BF7\u9996\u5148\u4ECE\u4E0B\u8868\u4E2D\u5B89\u88C5\u9002\u5F53\u7684\u8F6F\u4EF6\u5305\uFF0C\u800C\u4E0D\u662F\u6838\u5FC3 apollo-server \u8F6F\u4EF6\u5305\u3002</p><h4 id="\u517C\u5BB9\u7684\u8F6F\u4EF6\u5305" tabindex="-1">\u517C\u5BB9\u7684\u8F6F\u4EF6\u5305 <a class="header-anchor" href="#\u517C\u5BB9\u7684\u8F6F\u4EF6\u5305" aria-hidden="true">#</a></h4><table><thead><tr><th>\u4E2D\u95F4\u4EF6</th><th>npm\u5305</th></tr></thead><tbody><tr><td>Express</td><td>apollo-server-express</td></tr><tr><td>AWS Lambda</td><td>apollo-server-lambda</td></tr><tr><td>Koa</td><td>apollo-server-koa</td></tr><tr><td>hapi</td><td>apollo-server-hapi</td></tr><tr><td>Micro</td><td>apollo-server-micro</td></tr><tr><td>Fastify</td><td>apollo-server-fastify</td></tr><tr><td>Google Cloud Functions</td><td>apollo-server-cloud-functions</td></tr><tr><td>Azure Functions</td><td>apollo-server-azure-functions</td></tr><tr><td>Cloudflare</td><td>apollo-server-cloudflare</td></tr><tr><td>\u5982\u679C\u60A8\u5DF2\u7ECF\u5B89\u88C5\u4E86\u6838\u5FC3 apollo-server \u8F6F\u4EF6\u5305\uFF0C\u5219\u53EF\u4EE5\u5728\u5B89\u88C5\u96C6\u6210\u8F6F\u4EF6\u5305\u540E npm \u5378\u8F7D\u5B83\u3002</td><td></td></tr></tbody></table><h4 id="\u5E94\u7528\u4E2D\u95F4\u4EF6" tabindex="-1">\u5E94\u7528\u4E2D\u95F4\u4EF6 <a class="header-anchor" href="#\u5E94\u7528\u4E2D\u95F4\u4EF6" aria-hidden="true">#</a></h4><p>\u4E0E\u4E2D\u95F4\u4EF6\u96C6\u6210\u65F6\uFF0C\u9996\u5148\u50CF\u5F80\u5E38\u4E00\u6837\u521D\u59CB\u5316 Apollo Server\uFF0C\u7136\u540E\u8C03\u7528 applyMiddleware\u3002</p><p>\u8FD9\u662F\u4E3A Hello \u670D\u52A1\u7684\u57FA\u672C Express \u793A\u4F8B\u3002\u4ECE /graphql \u4EE5\u5916\u7684\u6BCF\u4E2A\u8DEF\u5F84\u8BBF\u95EE\uFF0C\u8BE5\u8DEF\u5F84\u4E0E Apollo Server \u4E00\u8D77\u63D0\u4F9BGraphQL\u7AEF\u70B9\uFF1A</p><div class="language-JavaScript"><button title="Copy Code" class="copy"></button><span class="lang">JavaScript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">express</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">require</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">express</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ApolloServer</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">require</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">apollo-server-express</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">typeDefs</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">resolvers</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">require</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">./schema</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">app</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">express</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">server</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">ApolloServer</span><span style="color:#666666;">({</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">typeDefs</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">resolvers</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">server</span><span style="color:#666666;">.</span><span style="color:#80A665;">applyMiddleware</span><span style="color:#666666;">({</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">app</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">app</span><span style="color:#666666;">.</span><span style="color:#80A665;">use</span><span style="color:#666666;">((</span><span style="color:#BD976A;">req</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">res</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">res</span><span style="color:#666666;">.</span><span style="color:#80A665;">status</span><span style="color:#666666;">(</span><span style="color:#4C9A91;">200</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">res</span><span style="color:#666666;">.</span><span style="color:#80A665;">send</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Hello!</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">res</span><span style="color:#666666;">.</span><span style="color:#80A665;">end</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#666666;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">app</span><span style="color:#666666;">.</span><span style="color:#80A665;">listen</span><span style="color:#666666;">({</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">port</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">4000</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">},</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">\`</span><span style="color:#C98A7D;">\u{1F680} Server ready at http://localhost:4000</span><span style="color:#666666;">\${</span><span style="color:#C98A7D;">server</span><span style="color:#666666;">.</span><span style="color:#C98A7D;">graphqlPath</span><span style="color:#666666;">}</span><span style="color:#C98A7DAA;">\`</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">)</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">express</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">require</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">express</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ApolloServer</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">require</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">apollo-server-express</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">typeDefs</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">resolvers</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">require</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">./schema</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">app</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">express</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">server</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">ApolloServer</span><span style="color:#999999;">({</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">typeDefs</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">resolvers</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">server</span><span style="color:#999999;">.</span><span style="color:#59873A;">applyMiddleware</span><span style="color:#999999;">({</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">app</span><span style="color:#393A34;"> </span><span style="color:#999999;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">app</span><span style="color:#999999;">.</span><span style="color:#59873A;">use</span><span style="color:#999999;">((</span><span style="color:#B07D48;">req</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">res</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">res</span><span style="color:#999999;">.</span><span style="color:#59873A;">status</span><span style="color:#999999;">(</span><span style="color:#2F798A;">200</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">res</span><span style="color:#999999;">.</span><span style="color:#59873A;">send</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Hello!</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">res</span><span style="color:#999999;">.</span><span style="color:#59873A;">end</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#999999;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">app</span><span style="color:#999999;">.</span><span style="color:#59873A;">listen</span><span style="color:#999999;">({</span><span style="color:#393A34;"> </span><span style="color:#998418;">port</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">4000</span><span style="color:#393A34;"> </span><span style="color:#999999;">},</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">\`</span><span style="color:#B56959;">\u{1F680} Server ready at http://localhost:4000</span><span style="color:#999999;">\${</span><span style="color:#B56959;">server</span><span style="color:#999999;">.</span><span style="color:#B56959;">graphqlPath</span><span style="color:#999999;">}</span><span style="color:#B56959AA;">\`</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">)</span></span>
<span class="line"></span></code></pre></div><p>\u60A8\u63D0\u4F9B\u7ED9 applyMiddleware \u7684\u53C2\u6570\u662F\u4E2D\u95F4\u4EF6\u5BF9\u5E94\u7528\u7A0B\u5E8F\u7684\u9876\u7EA7\u8868\u793A\u3002\u5728 Express \u5E94\u7528\u7A0B\u5E8F\u4E2D\uFF0C\u6B64\u53D8\u91CF\u901A\u5E38\u79F0\u4E3Aapp\u3002</p><p>\u5F53\u60A8\u5C06\u5E94\u7528\u7A0B\u5E8F\u4F20\u9012\u7ED9 applyMiddleware \u65F6\uFF0CApollo Server \u4F1A\u81EA\u52A8\u914D\u7F6E\u5404\u79CD\u4E2D\u95F4\u4EF6\uFF08\u5305\u62EC\u8BF7\u6C42\u4F53\u89E3\u6790\uFF0CGraphQL Playground \u524D\u7AEF\u548C CORS \u652F\u6301\uFF09\uFF0C\u56E0\u6B64\u60A8\u4E0D\u9700\u8981\u901A\u8FC7\u8BF8\u5982 app.use \u4E4B\u7C7B\u7684\u673A\u5236\u6765\u5E94\u7528\u5B83\u4EEC\u3002</p><h2 id="\u89E3\u6790\u5668" tabindex="-1">\u89E3\u6790\u5668 <a class="header-anchor" href="#\u89E3\u6790\u5668" aria-hidden="true">#</a></h2><h4 id="\u57FA\u672C\u7528\u6CD5-1" tabindex="-1">\u57FA\u672C\u7528\u6CD5 <a class="header-anchor" href="#\u57FA\u672C\u7528\u6CD5-1" aria-hidden="true">#</a></h4><p>schema\uFF1A</p><div class="language-GraphQL"><button title="Copy Code" class="copy"></button><span class="lang">GraphQL</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">type</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">Query</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">numberSix</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">Int!</span><span style="color:#666666;"> </span><span style="color:#758575DD;"># Should always return the number 6 when queried</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">numberSeven</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">Int!</span><span style="color:#666666;"> </span><span style="color:#758575DD;"># Should always return 7</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">type</span><span style="color:#393A34;"> </span><span style="color:#998418;">Query</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">numberSix</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">Int!</span><span style="color:#999999;"> </span><span style="color:#A0ADA0;"># Should always return the number 6 when queried</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">numberSeven</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">Int!</span><span style="color:#999999;"> </span><span style="color:#A0ADA0;"># Should always return 7</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><p>resolver\uFF1A</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">resolvers</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">Query</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">numberSix</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">6</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">numberSeven</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4C9A91;">7</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">};</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">resolvers</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">Query</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">numberSix</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">6</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">numberSeven</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">7</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">};</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h4 id="\u5904\u7406\u53C2\u6570" tabindex="-1">\u5904\u7406\u53C2\u6570 <a class="header-anchor" href="#\u5904\u7406\u53C2\u6570" aria-hidden="true">#</a></h4><p>schema\uFF1A</p><div class="language-GraphQL"><button title="Copy Code" class="copy"></button><span class="lang">GraphQL</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">type</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">User</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">id</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">ID!</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">name</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">String</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">type</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">Query</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">user</span><span style="color:#666666;">(</span><span style="color:#BD976A;">id</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">ID!</span><span style="color:#666666;">):</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">User</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">type</span><span style="color:#393A34;"> </span><span style="color:#998418;">User</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">id</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">ID!</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">name</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">String</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;">type</span><span style="color:#393A34;"> </span><span style="color:#998418;">Query</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">user</span><span style="color:#999999;">(</span><span style="color:#B07D48;">id</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">ID!</span><span style="color:#999999;">):</span><span style="color:#393A34;"> </span><span style="color:#998418;">User</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><p>resolver\uFF1A</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">users</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">id</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">1</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">name</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Elizabeth Bennet</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">id</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">2</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">name</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Fitzwilliam Darcy</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">resolvers</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">Query</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">user</span><span style="color:#666666;">(</span><span style="color:#BD976A;">parent</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">args</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">context</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">info</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">users</span><span style="color:#666666;">.</span><span style="color:#80A665;">find</span><span style="color:#666666;">(</span><span style="color:#BD976A;">user</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">user</span><span style="color:#666666;">.</span><span style="color:#BD976A;">id</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">args</span><span style="color:#666666;">.</span><span style="color:#BD976A;">id</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">users</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">id</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">1</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">name</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Elizabeth Bennet</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">id</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">2</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">name</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Fitzwilliam Darcy</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">resolvers</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">Query</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">user</span><span style="color:#999999;">(</span><span style="color:#B07D48;">parent</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">args</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">context</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">info</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">users</span><span style="color:#999999;">.</span><span style="color:#59873A;">find</span><span style="color:#999999;">(</span><span style="color:#B07D48;">user</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">user</span><span style="color:#999999;">.</span><span style="color:#B07D48;">id</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">args</span><span style="color:#999999;">.</span><span style="color:#B07D48;">id</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h4 id="\u89E3\u6790\u5668\u94FE" tabindex="-1">\u89E3\u6790\u5668\u94FE <a class="header-anchor" href="#\u89E3\u6790\u5668\u94FE" aria-hidden="true">#</a></h4><p>schema\uFF1A</p><div class="language-GraphQL"><button title="Copy Code" class="copy"></button><span class="lang">GraphQL</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;"># A library has a branch and books</span></span>
<span class="line"><span style="color:#4D9375;">type</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">Library</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">branch</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">String!</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">books</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span><span style="color:#B8A965;">Book</span><span style="color:#CB7676;">!</span><span style="color:#666666;">]</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;"># A book has a title and author</span></span>
<span class="line"><span style="color:#4D9375;">type</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">Book</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">title</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">String!</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">author</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">Author</span><span style="color:#CB7676;">!</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;"># An author has a name</span></span>
<span class="line"><span style="color:#4D9375;">type</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">Author</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">name</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">String!</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">type</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">Query</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">libraries</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span><span style="color:#B8A965;">Library</span><span style="color:#666666;">]</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># A library has a branch and books</span></span>
<span class="line"><span style="color:#1E754F;">type</span><span style="color:#393A34;"> </span><span style="color:#998418;">Library</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">branch</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">String!</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">books</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span><span style="color:#998418;">Book</span><span style="color:#AB5959;">!</span><span style="color:#999999;">]</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># A book has a title and author</span></span>
<span class="line"><span style="color:#1E754F;">type</span><span style="color:#393A34;"> </span><span style="color:#998418;">Book</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">title</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">String!</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">author</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#998418;">Author</span><span style="color:#AB5959;">!</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># An author has a name</span></span>
<span class="line"><span style="color:#1E754F;">type</span><span style="color:#393A34;"> </span><span style="color:#998418;">Author</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">name</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">String!</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;">type</span><span style="color:#393A34;"> </span><span style="color:#998418;">Query</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">libraries</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span><span style="color:#998418;">Library</span><span style="color:#999999;">]</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>\u6709\u6548\u7684\u67E5\u8BE2\u8BED\u6CD5\uFF1A</p><div class="language-GraphQL"><button title="Copy Code" class="copy"></button><span class="lang">GraphQL</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">query</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">GetBooksByLibrary</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">libraries</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">books</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#BD976A;">author</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">name</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">query</span><span style="color:#393A34;"> </span><span style="color:#59873A;">GetBooksByLibrary</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">libraries</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">books</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B07D48;">author</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">name</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><p>\u6B64\u67E5\u8BE2\u7684\u7ED3\u679C\u89E3\u6790\u5668\u94FE\u4E0E\u67E5\u8BE2\u672C\u8EAB\u7684\u5C42\u6B21\u7ED3\u6784\u5339\u914D\uFF1A <img src="`+o+`" alt="img"></p><p>\u8FD9\u4E9B\u89E3\u6790\u5668\u6309\u4E0A\u8FF0\u987A\u5E8F\u6267\u884C\uFF0C\u5E76\u5C06\u5176\u8FD4\u56DE\u503C\u901A\u8FC7\u7236\u53C2\u6570\u4F20\u9012\u7ED9\u94FE\u4E2D\u7684\u4E0B\u4E00\u4E2A\u89E3\u6790\u5668\u3002 resolver \u5904\u7406\u5982\u4E0B\uFF1A</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ApolloServer</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">gql</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">require</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">apollo-server</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">libraries</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">branch</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">downtown</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">branch</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">riverside</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#666666;">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// The branch field of a book indicates which library has it in stock</span></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">books</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">title</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">The Awakening</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">author</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Kate Chopin</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">branch</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">riverside</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">title</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">City of Glass</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">author</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Paul Auster</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">branch</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">downtown</span><span style="color:#C98A7DAA;">&#39;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#666666;">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// Schema definition</span></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">typeDefs</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">gql</span><span style="color:#C98A7DAA;">\`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C98A7D;"># A library has a branch and books</span></span>
<span class="line"><span style="color:#C98A7D;">  type Library {</span></span>
<span class="line"><span style="color:#C98A7D;">    branch: String!</span></span>
<span class="line"><span style="color:#C98A7D;">    books: [Book!]</span></span>
<span class="line"><span style="color:#C98A7D;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C98A7D;">  # A book has a title and author</span></span>
<span class="line"><span style="color:#C98A7D;">  type Book {</span></span>
<span class="line"><span style="color:#C98A7D;">    title: String!</span></span>
<span class="line"><span style="color:#C98A7D;">    author: Author!</span></span>
<span class="line"><span style="color:#C98A7D;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C98A7D;">  # An author has a name</span></span>
<span class="line"><span style="color:#C98A7D;">  type Author {</span></span>
<span class="line"><span style="color:#C98A7D;">    name: String!</span></span>
<span class="line"><span style="color:#C98A7D;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C98A7D;">  # Queries can fetch a list of libraries</span></span>
<span class="line"><span style="color:#C98A7D;">  type Query {</span></span>
<span class="line"><span style="color:#C98A7D;">    libraries: [Library]</span></span>
<span class="line"><span style="color:#C98A7D;">  }</span></span>
<span class="line"><span style="color:#C98A7DAA;">\`</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// Resolver map</span></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">resolvers</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">Query</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">libraries</span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">      </span><span style="color:#758575DD;">// Return our hardcoded array of libraries</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">libraries</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">Library</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">books</span><span style="color:#666666;">(</span><span style="color:#BD976A;">parent</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">      </span><span style="color:#758575DD;">// Filter the hardcoded array of books to only include</span></span>
<span class="line"><span style="color:#666666;">      </span><span style="color:#758575DD;">// books that are located at the correct branch</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">books</span><span style="color:#666666;">.</span><span style="color:#80A665;">filter</span><span style="color:#666666;">(</span><span style="color:#BD976A;">book</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">book</span><span style="color:#666666;">.</span><span style="color:#BD976A;">branch</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">===</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">parent</span><span style="color:#666666;">.</span><span style="color:#BD976A;">branch</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">Book</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// The parent resolver (Library.books) returns an object with the</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// author&#39;s name in the &quot;author&quot; field. Return a JSON object containing</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// the name, because this field expects an object.</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">author</span><span style="color:#666666;">(</span><span style="color:#BD976A;">parent</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#B8A965;">name</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">parent</span><span style="color:#666666;">.</span><span style="color:#BD976A;">author</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">};</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// Because Book.author returns an object with a &quot;name&quot; field,</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// Apollo Server&#39;s default resolver for Author.name will work.</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// We don&#39;t need to define one.</span></span>
<span class="line"><span style="color:#666666;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// Pass schema definition and resolvers to the</span></span>
<span class="line"><span style="color:#758575DD;">// ApolloServer constructor</span></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">server</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">ApolloServer</span><span style="color:#666666;">({</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">typeDefs</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">resolvers</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// Launch the server</span></span>
<span class="line"><span style="color:#BD976A;">server</span><span style="color:#666666;">.</span><span style="color:#80A665;">listen</span><span style="color:#666666;">().</span><span style="color:#80A665;">then</span><span style="color:#666666;">(({</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">url</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">})</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">\`</span><span style="color:#C98A7D;">\u{1F680}  Server ready at </span><span style="color:#666666;">\${</span><span style="color:#C98A7D;">url</span><span style="color:#666666;">}</span><span style="color:#C98A7DAA;">\`</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">});</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ApolloServer</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">gql</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">require</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">apollo-server</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">libraries</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">branch</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">downtown</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">branch</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">riverside</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#999999;">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// The branch field of a book indicates which library has it in stock</span></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">books</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">title</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">The Awakening</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">author</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Kate Chopin</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">branch</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">riverside</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">title</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">City of Glass</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">author</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Paul Auster</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">branch</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">downtown</span><span style="color:#B56959AA;">&#39;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#999999;">];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// Schema definition</span></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">typeDefs</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">gql</span><span style="color:#B56959AA;">\`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B56959;"># A library has a branch and books</span></span>
<span class="line"><span style="color:#B56959;">  type Library {</span></span>
<span class="line"><span style="color:#B56959;">    branch: String!</span></span>
<span class="line"><span style="color:#B56959;">    books: [Book!]</span></span>
<span class="line"><span style="color:#B56959;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B56959;">  # A book has a title and author</span></span>
<span class="line"><span style="color:#B56959;">  type Book {</span></span>
<span class="line"><span style="color:#B56959;">    title: String!</span></span>
<span class="line"><span style="color:#B56959;">    author: Author!</span></span>
<span class="line"><span style="color:#B56959;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B56959;">  # An author has a name</span></span>
<span class="line"><span style="color:#B56959;">  type Author {</span></span>
<span class="line"><span style="color:#B56959;">    name: String!</span></span>
<span class="line"><span style="color:#B56959;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B56959;">  # Queries can fetch a list of libraries</span></span>
<span class="line"><span style="color:#B56959;">  type Query {</span></span>
<span class="line"><span style="color:#B56959;">    libraries: [Library]</span></span>
<span class="line"><span style="color:#B56959;">  }</span></span>
<span class="line"><span style="color:#B56959AA;">\`</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// Resolver map</span></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">resolvers</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">Query</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">libraries</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">      </span><span style="color:#A0ADA0;">// Return our hardcoded array of libraries</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">libraries</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">Library</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">books</span><span style="color:#999999;">(</span><span style="color:#B07D48;">parent</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">      </span><span style="color:#A0ADA0;">// Filter the hardcoded array of books to only include</span></span>
<span class="line"><span style="color:#999999;">      </span><span style="color:#A0ADA0;">// books that are located at the correct branch</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">books</span><span style="color:#999999;">.</span><span style="color:#59873A;">filter</span><span style="color:#999999;">(</span><span style="color:#B07D48;">book</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">book</span><span style="color:#999999;">.</span><span style="color:#B07D48;">branch</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">===</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">parent</span><span style="color:#999999;">.</span><span style="color:#B07D48;">branch</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">Book</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// The parent resolver (Library.books) returns an object with the</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// author&#39;s name in the &quot;author&quot; field. Return a JSON object containing</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// the name, because this field expects an object.</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">author</span><span style="color:#999999;">(</span><span style="color:#B07D48;">parent</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#998418;">name</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">parent</span><span style="color:#999999;">.</span><span style="color:#B07D48;">author</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">};</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// Because Book.author returns an object with a &quot;name&quot; field,</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// Apollo Server&#39;s default resolver for Author.name will work.</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// We don&#39;t need to define one.</span></span>
<span class="line"><span style="color:#999999;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// Pass schema definition and resolvers to the</span></span>
<span class="line"><span style="color:#A0ADA0;">// ApolloServer constructor</span></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">server</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">ApolloServer</span><span style="color:#999999;">({</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">typeDefs</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">resolvers</span><span style="color:#393A34;"> </span><span style="color:#999999;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// Launch the server</span></span>
<span class="line"><span style="color:#B07D48;">server</span><span style="color:#999999;">.</span><span style="color:#59873A;">listen</span><span style="color:#999999;">().</span><span style="color:#59873A;">then</span><span style="color:#999999;">(({</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">url</span><span style="color:#393A34;"> </span><span style="color:#999999;">})</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">\`</span><span style="color:#B56959;">\u{1F680}  Server ready at </span><span style="color:#999999;">\${</span><span style="color:#B56959;">url</span><span style="color:#999999;">}</span><span style="color:#B56959AA;">\`</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">});</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>\u5982\u679C\u73B0\u5728\u6211\u4EEC\u66F4\u65B0\u67E5\u8BE2\u4EE5\u540C\u65F6\u8BE2\u95EE\u6BCF\u672C\u4E66\u7684\u6807\u9898\uFF1A</p><div class="language-GraphQL"><button title="Copy Code" class="copy"></button><span class="lang">GraphQL</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">query</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">GetBooksByLibrary</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">libraries</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#BD976A;">books</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#BD976A;">title</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#BD976A;">author</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#BD976A;">name</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">query</span><span style="color:#393A34;"> </span><span style="color:#59873A;">GetBooksByLibrary</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">libraries</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">books</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B07D48;">title</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B07D48;">author</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">name</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\uFF0C\u89E3\u6790\u5668\u94FE\u5982\u4E0B\u6240\u793A\uFF1A <img src="`+e+`" alt="img"></p><p>\u5F53\u4E00\u6761\u94FE\u50CF\u8FD9\u6837\u201C\u53D1\u6563\u201D\u65F6\uFF0C\u6BCF\u4E2A\u5B50\u94FE\u5E76\u884C\u6267\u884C\u3002</p><h4 id="\u89E3\u6790\u5668\u53C2\u6570" tabindex="-1">\u89E3\u6790\u5668\u53C2\u6570 <a class="header-anchor" href="#\u89E3\u6790\u5668\u53C2\u6570" aria-hidden="true">#</a></h4><p>\u89E3\u6790\u7A0B\u5E8F\u51FD\u6570\u6309\u987A\u5E8F\u63A5\u53D7\u4EE5\u4E0B\u4F4D\u7F6E\u53C2\u6570\uFF1A</p><table><thead><tr><th>\u8BBA\u70B9</th><th>\u63CF\u8FF0</th></tr></thead><tbody><tr><td>parent</td><td>\u6B64\u5B57\u6BB5\u7684\u7236\u9879\uFF08\u5373\uFF0C\u89E3\u6790\u7A0B\u5E8F\u94FE\u4E2D\u7684\u524D\u4E00\u4E2A\u89E3\u6790\u7A0B\u5E8F\uFF09\u7684\u89E3\u6790\u7A0B\u5E8F\u7684\u8FD4\u56DE\u503C\u3002</td></tr><tr><td>\u5BF9\u4E8E\u6CA1\u6709\u7236\u7EA7\u7684\u9876\u7EA7\u5B57\u6BB5\u7684\u89E3\u6790\u5668\uFF08\u4F8B\u5982Query\u7684\u5B57\u6BB5\uFF09\uFF0C\u6B64\u503C\u662F\u4ECE\u4F20\u9012\u7ED9Apollo Server\u6784\u9020\u51FD\u6570\u7684rootValue\u51FD\u6570\u83B7\u5F97\u7684\u3002</td><td></td></tr><tr><td>args</td><td>\u5305\u542B\u4E3A\u6B64\u5B57\u6BB5\u63D0\u4F9B\u7684\u6240\u6709GraphQL\u53C2\u6570\u7684\u5BF9\u8C61\u3002</td></tr><tr><td>\u4F8B\u5982\uFF0C\u5F53\u6267\u884C\u67E5\u8BE2 { user(id: &quot;4&quot;) } \u65F6\uFF0C\u4F20\u9012\u7ED9\u7528\u6237\u89E3\u6790\u5668\u7684args\u5BF9\u8C61\u662F { &quot;id&quot;: &quot;4&quot; }\u3002</td><td></td></tr><tr><td>context</td><td>\u5728\u4E3A\u7279\u5B9A\u64CD\u4F5C\u800C\u6267\u884C\u7684\u6240\u6709\u89E3\u6790\u5668\u4E4B\u95F4\u5171\u4EAB\u7684\u5BF9\u8C61\u3002\u4F7F\u7528\u5B83\u53EF\u4EE5\u5171\u4EAB\u6BCF\u4E2A\u64CD\u4F5C\u7684\u72B6\u6001\uFF0C\u5305\u62EC\u8EAB\u4EFD\u9A8C\u8BC1\u4FE1\u606F\uFF0C\u6570\u636E\u52A0\u8F7D\u5668\u5B9E\u4F8B\u4EE5\u53CA\u5728\u89E3\u6790\u5668\u4E4B\u95F4\u8FDB\u884C\u8DDF\u8E2A\u7684\u5176\u4ED6\u4EFB\u4F55\u5185\u5BB9\u3002</td></tr><tr><td>info</td><td>\u5305\u542B\u6709\u5173\u64CD\u4F5C\u6267\u884C\u72B6\u6001\u7684\u4FE1\u606F\uFF0C\u5305\u62EC\u5B57\u6BB5\u540D\u79F0\uFF0C\u4ECE\u6839\u5230\u5B57\u6BB5\u7684\u8DEF\u5F84\u7B49\u3002</td></tr><tr><td>GraphQL.js\u6E90\u4EE3\u7801\u4E2D\u5217\u51FA\u4E86\u5B83\u7684\u6838\u5FC3\u5B57\u6BB5\uFF0C\u5E76\u4E14\u5176\u4ED6\u6A21\u5757\uFF08\u4F8B\u5982apollo-cache-control\uFF09\u901A\u8FC7\u9644\u52A0\u529F\u80FD\u5BF9\u5176\u8FDB\u884C\u4E86\u6269\u5C55\u3002</td><td></td></tr></tbody></table><h4 id="context-\u53C2\u6570" tabindex="-1">context \u53C2\u6570 <a class="header-anchor" href="#context-\u53C2\u6570" aria-hidden="true">#</a></h4><p>context \u53C2\u6570\u5BF9\u4E8E\u4F20\u9012\u4EFB\u4F55\u89E3\u6790\u5668\u53EF\u80FD\u9700\u8981\u7684\u4E1C\u897F\u5F88\u6709\u7528\uFF0C\u4F8B\u5982\u8EAB\u4EFD\u9A8C\u8BC1\u8303\u56F4\uFF0C\u6570\u636E\u5E93\u8FDE\u63A5\u548C\u81EA\u5B9A\u4E49\u83B7\u53D6\u51FD\u6570\u3002\u5982\u679C\u60A8\u6B63\u5728\u4F7F\u7528\u6570\u636E\u52A0\u8F7D\u5668\u8DE8\u89E3\u6790\u5668\u6279\u5904\u7406\u8BF7\u6C42\uFF0C\u5219\u4E5F\u53EF\u4EE5\u5C06\u5B83\u4EEC\u9644\u52A0\u5230\u4E0A\u4E0B\u6587\u3002</p><p>\u89E3\u6790\u5668\u51B3\u4E0D\u5E94\u7834\u574F\u6027\u5730\u4FEE\u6539\u4E0A\u4E0B\u6587\u53C2\u6570\u3002\u8FD9\u6837\u53EF\u4EE5\u786E\u4FDD\u6240\u6709\u89E3\u6790\u7A0B\u5E8F\u7684\u4E00\u81F4\u6027\uFF0C\u5E76\u9632\u6B62\u610F\u5916\u9519\u8BEF\u3002</p><p>\u8981\u4E3A\u60A8\u7684\u89E3\u6790\u5668\u63D0\u4F9B\u4E0A\u4E0B\u6587\uFF0C\u8BF7\u5411 ApolloServer \u6784\u9020\u51FD\u6570\u6DFB\u52A0\u4E0A\u4E0B\u6587\u521D\u59CB\u5316\u51FD\u6570\u3002\u6BCF\u4E2A\u8BF7\u6C42\u90FD\u4F1A\u8C03\u7528\u6B64\u51FD\u6570\uFF0C\u56E0\u6B64\u60A8\u53EF\u4EE5\u6839\u636E\u8BF7\u6C42\u7684\u8BE6\u7EC6\u4FE1\u606F\uFF08\u4F8B\u5982HTTP\u6807\u5934\uFF09\u8BBE\u7F6E\u4E0A\u4E0B\u6587\u3002</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"></span>
<span class="line"><span style="color:#758575DD;">// Constructor</span></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">server</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">ApolloServer</span><span style="color:#666666;">({</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">typeDefs</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">resolvers</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">context</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">req</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">({</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#B8A965;">authScope</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">getScope</span><span style="color:#666666;">(</span><span style="color:#BD976A;">req</span><span style="color:#666666;">.</span><span style="color:#BD976A;">headers</span><span style="color:#666666;">.</span><span style="color:#BD976A;">authorization</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">})</span></span>
<span class="line"><span style="color:#666666;">})</span><span style="color:#DBD7CAEE;">)</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// Example resolver</span></span>
<span class="line"><span style="color:#666666;">(</span><span style="color:#BD976A;">parent</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">args</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">context</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">info</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">if</span><span style="color:#666666;">(</span><span style="color:#BD976A;">context</span><span style="color:#666666;">.</span><span style="color:#BD976A;">authScope</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ADMIN</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">throw</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">AuthenticationError</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">not admin</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">  </span><span style="color:#758575DD;">// Proceed</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// Constructor</span></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">server</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">ApolloServer</span><span style="color:#999999;">({</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">typeDefs</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">resolvers</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">context</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">req</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">({</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#998418;">authScope</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#59873A;">getScope</span><span style="color:#999999;">(</span><span style="color:#B07D48;">req</span><span style="color:#999999;">.</span><span style="color:#B07D48;">headers</span><span style="color:#999999;">.</span><span style="color:#B07D48;">authorization</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">})</span></span>
<span class="line"><span style="color:#999999;">})</span><span style="color:#393A34;">)</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// Example resolver</span></span>
<span class="line"><span style="color:#999999;">(</span><span style="color:#B07D48;">parent</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">args</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">context</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">info</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">if</span><span style="color:#999999;">(</span><span style="color:#B07D48;">context</span><span style="color:#999999;">.</span><span style="color:#B07D48;">authScope</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ADMIN</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">throw</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">AuthenticationError</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">not admin</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// Proceed</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><blockquote><p>\u5982\u679C\u60A8\u4F7F\u7528\u7684\u662F Express \u4EE5\u5916\u7684\u4E2D\u95F4\u4EF6\uFF0C\u5219\u4F20\u9012\u7ED9\u4E0A\u4E0B\u6587\u51FD\u6570\u7684\u5BF9\u8C61\u7684\u5B57\u6BB5\u4F1A\u6709\u6240\u4E0D\u540C\u3002\u6709\u5173\u8BE6\u7EC6\u4FE1\u606F\uFF0C\u8BF7\u53C2\u89C1API\u53C2\u8003\u3002</p></blockquote><p>\u4E0A\u4E0B\u6587\u521D\u59CB\u5316\u53EF\u4EE5\u662F\u5F02\u6B65\u7684\uFF0C\u4ECE\u800C\u53EF\u4EE5\u5B8C\u6210\u6570\u636E\u5E93\u8FDE\u63A5\u548C\u5176\u4ED6\u64CD\u4F5C\uFF1A</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#80A665;">context</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">async</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">({</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">db</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">await</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">client</span><span style="color:#666666;">.</span><span style="color:#80A665;">connect</span><span style="color:#666666;">(),</span></span>
<span class="line"><span style="color:#666666;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575DD;">// Resolver</span></span>
<span class="line"><span style="color:#666666;">(</span><span style="color:#BD976A;">parent</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">args</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">context</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">info</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">context</span><span style="color:#666666;">.</span><span style="color:#BD976A;">db</span><span style="color:#666666;">.</span><span style="color:#80A665;">query</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">SELECT * FROM table_name</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#59873A;">context</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">async</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">({</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">db</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">await</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">client</span><span style="color:#999999;">.</span><span style="color:#59873A;">connect</span><span style="color:#999999;">(),</span></span>
<span class="line"><span style="color:#999999;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// Resolver</span></span>
<span class="line"><span style="color:#999999;">(</span><span style="color:#B07D48;">parent</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">args</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">context</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">info</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">context</span><span style="color:#999999;">.</span><span style="color:#B07D48;">db</span><span style="color:#999999;">.</span><span style="color:#59873A;">query</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">SELECT * FROM table_name</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h4 id="\u8FD4\u56DE\u503C" tabindex="-1">\u8FD4\u56DE\u503C <a class="header-anchor" href="#\u8FD4\u56DE\u503C" aria-hidden="true">#</a></h4><p>Apollo Server\u6839\u636E\u5176\u7C7B\u578B\u5BF9\u89E3\u6790\u5668\u51FD\u6570\u7684\u8FD4\u56DE\u503C\u8FDB\u884C\u4E0D\u540C\u7684\u5904\u7406\uFF1A</p><table><thead><tr><th>\u7C7B\u578B</th><th>\u8BE6\u60C5</th></tr></thead><tbody><tr><td>Scalar / object</td><td>\u89E3\u6790\u7A0B\u5E8F\u53EF\u4EE5\u8FD4\u56DE\u5355\u4E2A\u503C\u6216\u5BF9\u8C61\uFF0C\u5982\u5B9A\u4E49\u89E3\u6790\u7A0B\u5E8F\u4E2D\u6240\u793A\u3002\u8BE5\u8FD4\u56DE\u503C\u901A\u8FC7\u7236\u53C2\u6570\u4F20\u9012\u7ED9\u4EFB\u4F55\u5D4C\u5957\u7684\u89E3\u6790\u5668\u3002</td></tr><tr><td>Array</td><td>\u5F53\u4E14\u4EC5\u5F53\u60A8\u7684\u6A21\u5F0F\u6307\u793A\u89E3\u6790\u5668\u7684\u5173\u8054\u5B57\u6BB5\u5305\u542B\u5217\u8868\u65F6\uFF0C\u624D\u8FD4\u56DE\u4E00\u4E2A\u6570\u7EC4\u3002</td></tr><tr><td>\u8FD4\u56DE\u6570\u7EC4\u540E\uFF0CApollo Server\u4E3A\u6570\u7EC4\u4E2D\u7684\u6BCF\u4E2A\u9879\u76EE\u6267\u884C\u5D4C\u5957\u7684\u89E3\u6790\u5668\u3002</td><td></td></tr><tr><td>null / undefined</td><td>\u8868\u793A\u627E\u4E0D\u5230\u8BE5\u5B57\u6BB5\u7684\u503C\u3002</td></tr><tr><td>\u5982\u679C\u60A8\u7684\u6A21\u5F0F\u6307\u793A\u6B64\u89E3\u6790\u5668\u7684\u5B57\u6BB5\u53EF\u4E3A\u7A7A\uFF0C\u5219\u64CD\u4F5C\u7ED3\u679C\u5728\u8BE5\u5B57\u6BB5\u7684\u4F4D\u7F6E\u5177\u6709\u7A7A\u503C\u3002</td><td></td></tr><tr><td>\u5982\u679C\u6B64\u89E3\u6790\u5668\u7684\u5B57\u6BB5\u4E0D\u53EF\u4E3A\u7A7A\uFF0C\u5219Apollo Server\u4F1A\u5C06\u5B57\u6BB5\u7684\u7236\u7EA7\u8BBE\u7F6E\u4E3Anull\u3002\u5982\u6709\u5FC5\u8981\uFF0C\u6B64\u8FC7\u7A0B\u5C06\u7EE7\u7EED\u6CBF\u89E3\u6790\u7A0B\u5E8F\u94FE\u5411\u4E0A\u79FB\u52A8\uFF0C\u76F4\u81F3\u5230\u8FBE\u53EF\u4E3A\u7A7A\u7684\u5B57\u6BB5\u3002\u8FD9\u6837\u53EF\u4EE5\u786E\u4FDD\u54CD\u5E94\u6C38\u8FDC\u4E0D\u4F1A\u4E3A\u4E0D\u53EF\u4E3A\u7A7A\u7684\u5B57\u6BB5\u5305\u542B\u7A7A\u503C\u3002</td><td></td></tr><tr><td>Promise</td><td>\u89E3\u6790\u7A0B\u5E8F\u901A\u5E38\u6267\u884C\u5F02\u6B65\u64CD\u4F5C\uFF0C\u4F8B\u5982\u4ECE\u6570\u636E\u5E93\u6216\u540E\u7AEFAPI\u63D0\u53D6\u3002\u4E3A\u4E86\u652F\u6301\u8FD9\u4E00\u70B9\uFF0C\u89E3\u6790\u5668\u53EF\u4EE5\u8FD4\u56DE\u53EF\u89E3\u6790\u4E3A\u5176\u4ED6\u4EFB\u4F55\u53D7\u652F\u6301\u7684\u8FD4\u56DE\u7C7B\u578B\u7684promise\u3002</td></tr></tbody></table><h4 id="\u9ED8\u8BA4\u89E3\u6790\u5668" tabindex="-1">\u9ED8\u8BA4\u89E3\u6790\u5668 <a class="header-anchor" href="#\u9ED8\u8BA4\u89E3\u6790\u5668" aria-hidden="true">#</a></h4><p>\u5982\u679C\u60A8\u6CA1\u6709\u4E3A\u7279\u5B9A\u7684\u67B6\u6784\u5B57\u6BB5\u5B9A\u4E49\u89E3\u6790\u5668\uFF0C\u5219Apollo Server\u4F1A\u4E3A\u5176\u5B9A\u4E49\u9ED8\u8BA4\u89E3\u6790\u5668\uFF08\u8BF7\u53C2\u9605\u6E90\u4EE3\u7801\uFF09\u3002</p><p>\u9ED8\u8BA4\u7684\u89E3\u6790\u5668\u529F\u80FD\u4F7F\u7528\u4EE5\u4E0B\u903B\u8F91\uFF1A <img src="`+r+`" alt="img"></p><p>\u4F8B\u5982\uFF0C\u8BF7\u8003\u8651\u4EE5\u4E0B schema\uFF1A</p><div class="language-GraphQL"><button title="Copy Code" class="copy"></button><span class="lang">GraphQL</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#4D9375;">type</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">Book</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">title</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">String</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">type</span><span style="color:#DBD7CAEE;"> </span><span style="color:#B8A965;">Author</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">books</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">[</span><span style="color:#B8A965;">Book</span><span style="color:#666666;">]</span></span>
<span class="line"><span style="color:#666666;">}</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#1E754F;">type</span><span style="color:#393A34;"> </span><span style="color:#998418;">Book</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">title</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">String</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;">type</span><span style="color:#393A34;"> </span><span style="color:#998418;">Author</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">books</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span><span style="color:#998418;">Book</span><span style="color:#999999;">]</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5982\u679C books \u5B57\u6BB5\u7684\u89E3\u6790\u7A0B\u5E8F\u8FD4\u56DE\u4E00\u4E2A\u5BF9\u8C61\u6570\u7EC4\uFF0C\u6BCF\u4E2A\u5BF9\u8C61\u5305\u542B\u4E00\u4E2A title \u5B57\u6BB5\uFF0C\u5219\u53EF\u4EE5\u4E3A title \u5B57\u6BB5\u4F7F\u7528\u9ED8\u8BA4\u7684\u89E3\u6790\u7A0B\u5E8F\u3002\u9ED8\u8BA4\u89E3\u6790\u5668\u5C06\u6B63\u786E\u8FD4\u56DE parent.title\u3002</p><h4 id="\u76D1\u63A7\u89E3\u6790\u5668\u6027\u80FD" tabindex="-1">\u76D1\u63A7\u89E3\u6790\u5668\u6027\u80FD <a class="header-anchor" href="#\u76D1\u63A7\u89E3\u6790\u5668\u6027\u80FD" aria-hidden="true">#</a></h4><p>\u4E0E\u6240\u6709\u4EE3\u7801\u4E00\u6837\uFF0C\u89E3\u6790\u5668\u7684\u6027\u80FD\u53D6\u51B3\u4E8E\u5176\u903B\u8F91\u3002\u91CD\u8981\u7684\u662F\u8981\u4E86\u89E3\u6A21\u5F0F\u4E2D\u7684\u54EA\u4E9B\u5B57\u6BB5\u5728\u8BA1\u7B97\u4E0A\u662F\u6602\u8D35\u7684\u6216\u96BE\u4EE5\u89E3\u51B3\u7684\uFF0C\u4EE5\u4FBF\u60A8\u53EF\u4EE5\u63D0\u9AD8\u5176\u6027\u80FD\u6216\u786E\u4FDD\u4EC5\u5728\u5FC5\u8981\u65F6\u67E5\u8BE2\u5B83\u4EEC\u3002</p><p>Apollo Studio \u76F4\u63A5\u4E0E Apollo Server \u96C6\u6210\u5728\u4E00\u8D77\uFF0C\u4EE5\u63D0\u4F9B\u5B57\u6BB5\u7EA7\u6307\u6807\uFF0C\u4EE5\u5E2E\u52A9\u60A8\u4E86\u89E3\u4E00\u6BB5\u65F6\u95F4\u5185\u6570\u636E\u56FE\u7684\u6027\u80FD\u3002\u6709\u5173\u66F4\u591A\u4FE1\u606F\uFF0C\u8BF7\u53C2\u9605\u5206\u6790\u6027\u80FD\u3002</p><p>\u5728\u672C\u5730\u8FDB\u884C\u5F00\u53D1\u65F6\uFF0C\u60A8\u53EF\u4EE5\u4E3A ApolloServer \u6784\u9020\u51FD\u6570\u63D0\u4F9B tracing: true\uFF0C\u4EE5\u542F\u7528\u8DDF\u8E2A\u9762\u677F\uFF1A</p><div class="language-JavaScript"><button title="Copy Code" class="copy"></button><span class="lang">JavaScript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">server</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">ApolloServer</span><span style="color:#666666;">({</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">typeDefs</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">resolvers</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">tracing</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#4D9375;">true</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">});</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">server</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">ApolloServer</span><span style="color:#999999;">({</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">typeDefs</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">resolvers</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">tracing</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#1E754F;">true</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">});</span></span>
<span class="line"></span></code></pre></div><h2 id="\u8FDE\u63A5\u5230\u6570\u636E\u6E90" tabindex="-1">\u8FDE\u63A5\u5230\u6570\u636E\u6E90 <a class="header-anchor" href="#\u8FDE\u63A5\u5230\u6570\u636E\u6E90" aria-hidden="true">#</a></h2><p>Apollo Server \u53EF\u4EE5\u4ECE\u591A\u7ED9\u4F4D\u7F6E\u83B7\u53D6\u6570\u636E\u3002</p><p>Apollo\u63D0\u4F9B\u4E86\u4E00\u4E2A DataSource \u7C7B\uFF0C\u6211\u4EEC\u53EF\u4EE5\u6269\u5C55\u8BE5\u7C7B\u4EE5\u5904\u7406\u7279\u5B9A\u7C7B\u578B\u7684\u6570\u636E\u6E90\u7684\u4EA4\u4E92\u903B\u8F91\u3002</p><h4 id="\u8FDE\u63A5\u5230-rest-api" tabindex="-1">\u8FDE\u63A5\u5230 REST API <a class="header-anchor" href="#\u8FDE\u63A5\u5230-rest-api" aria-hidden="true">#</a></h4><h4 id="\u8FDE\u63A5\u5230\u6570\u636E\u5E93" tabindex="-1">\u8FDE\u63A5\u5230\u6570\u636E\u5E93 <a class="header-anchor" href="#\u8FDE\u63A5\u5230\u6570\u636E\u5E93" aria-hidden="true">#</a></h4><p>SQLDataSource from datasource-sql MongoDataSource from apollo-datasource-mongodb</p><h4 id="\u4ECE\u89E3\u6790\u5668\u8BBF\u95EE\u6570\u636E" tabindex="-1">\u4ECE\u89E3\u6790\u5668\u8BBF\u95EE\u6570\u636E <a class="header-anchor" href="#\u4ECE\u89E3\u6790\u5668\u8BBF\u95EE\u6570\u636E" aria-hidden="true">#</a></h4><p>\u4E3A\u4E86\u4F7F\u89E3\u6790\u5668\u80FD\u591F\u8BBF\u95EE\u6570\u636E\u6E90\uFF0C\u53EF\u4EE5\u5C06\u5B83\u4EEC\u4F5C\u4E3A\u9009\u9879\u4F20\u9012\u7ED9 ApolloServer \u6784\u9020\u51FD\u6570\uFF1A</p><div class="language-JavaScript"><button title="Copy Code" class="copy"></button><span class="lang">JavaScript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">server</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">ApolloServer</span><span style="color:#666666;">({</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">typeDefs</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">resolvers</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">dataSources</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#B8A965;">moviesAPI</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">MoviesAPI</span><span style="color:#666666;">(),</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#B8A965;">personalizationAPI</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">PersonalizationAPI</span><span style="color:#666666;">(),</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">};</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">context</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">()</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#B8A965;">token</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">foo</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">};</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#666666;">});</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">server</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">ApolloServer</span><span style="color:#999999;">({</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">typeDefs</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">resolvers</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">dataSources</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#998418;">moviesAPI</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">MoviesAPI</span><span style="color:#999999;">(),</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#998418;">personalizationAPI</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">PersonalizationAPI</span><span style="color:#999999;">(),</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">};</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">context</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#998418;">token</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">foo</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">};</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#999999;">});</span></span>
<span class="line"></span></code></pre></div><p>Apollo Server \u4F1A\u5C06\u6BCF\u4E2A\u8BF7\u6C42\u7684\u6570\u636E\u6E90\u653E\u5728\u4E0A\u4E0B\u6587\u4E2D\uFF0C\u56E0\u6B64\u60A8\u53EF\u4EE5\u4ECE\u89E3\u6790\u5668\u8BBF\u95EE\u5B83\u4EEC\u3002\u5B83\u8FD8\u5C06\u4F7F\u60A8\u7684\u6570\u636E\u6E90\u53EF\u4EE5\u8BBF\u95EE\u4E0A\u4E0B\u6587\u3002 \uFF08\u4E4B\u6240\u4EE5\u6CA1\u6709\u8BA9\u7528\u6237\u76F4\u63A5\u5C06\u6570\u636E\u6E90\u653E\u5728\u4E0A\u4E0B\u6587\u4E2D\uFF0C\u662F\u56E0\u4E3A\u8FD9\u4F1A\u5BFC\u81F4\u5FAA\u73AF\u4F9D\u8D56\u3002\uFF09 \u4ECE\u89E3\u6790\u5668\u4E2D\uFF0C\u6211\u4EEC\u53EF\u4EE5\u8BBF\u95EE\u6570\u636E\u6E90\u5E76\u8FD4\u56DE\u7ED3\u679C\uFF1A</p><div class="language-JavaScript"><button title="Copy Code" class="copy"></button><span class="lang">JavaScript</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">Query</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">movie</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">async</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">_source</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">id</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">},</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">dataSources</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">})</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">dataSources</span><span style="color:#666666;">.</span><span style="color:#BD976A;">moviesAPI</span><span style="color:#666666;">.</span><span style="color:#80A665;">getMovie</span><span style="color:#666666;">(</span><span style="color:#BD976A;">id</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">mostViewedMovies</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">async</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">_source</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">_args</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">dataSources</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">})</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">dataSources</span><span style="color:#666666;">.</span><span style="color:#BD976A;">moviesAPI</span><span style="color:#666666;">.</span><span style="color:#80A665;">getMostViewedMovies</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">favorites</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">async</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">_source</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">_args</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">dataSources</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">})</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">dataSources</span><span style="color:#666666;">.</span><span style="color:#BD976A;">personalizationAPI</span><span style="color:#666666;">.</span><span style="color:#80A665;">getFavorites</span><span style="color:#666666;">();</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">},</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#393A34;"> </span><span style="color:#59873A;">Query</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">movie</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">async</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">_source</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">id</span><span style="color:#393A34;"> </span><span style="color:#999999;">},</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">dataSources</span><span style="color:#393A34;"> </span><span style="color:#999999;">})</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">dataSources</span><span style="color:#999999;">.</span><span style="color:#B07D48;">moviesAPI</span><span style="color:#999999;">.</span><span style="color:#59873A;">getMovie</span><span style="color:#999999;">(</span><span style="color:#B07D48;">id</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">mostViewedMovies</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">async</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">_source</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">_args</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">dataSources</span><span style="color:#393A34;"> </span><span style="color:#999999;">})</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">dataSources</span><span style="color:#999999;">.</span><span style="color:#B07D48;">moviesAPI</span><span style="color:#999999;">.</span><span style="color:#59873A;">getMostViewedMovies</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">favorites</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">async</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">_source</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">_args</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">dataSources</span><span style="color:#393A34;"> </span><span style="color:#999999;">})</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">dataSources</span><span style="color:#999999;">.</span><span style="color:#B07D48;">personalizationAPI</span><span style="color:#999999;">.</span><span style="color:#59873A;">getFavorites</span><span style="color:#999999;">();</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span></span>
<span class="line"></span></code></pre></div><h4 id="\u5173\u4E8E-dataloader" tabindex="-1">\u5173\u4E8E DataLoader <a class="header-anchor" href="#\u5173\u4E8E-dataloader" aria-hidden="true">#</a></h4><h4 id="\u4F7F\u7528-memcached-redis-\u7F13\u5B58\u540E\u7AEF\u6570\u636E" tabindex="-1">\u4F7F\u7528 Memcached/Redis \u7F13\u5B58\u540E\u7AEF\u6570\u636E <a class="header-anchor" href="#\u4F7F\u7528-memcached-redis-\u7F13\u5B58\u540E\u7AEF\u6570\u636E" aria-hidden="true">#</a></h4><h4 id="\u5B9E\u73B0\u81EA\u5DF1\u7684\u7F13\u5B58\u540E\u7AEF" tabindex="-1">\u5B9E\u73B0\u81EA\u5DF1\u7684\u7F13\u5B58\u540E\u7AEF <a class="header-anchor" href="#\u5B9E\u73B0\u81EA\u5DF1\u7684\u7F13\u5B58\u540E\u7AEF" aria-hidden="true">#</a></h4><h2 id="\u9519\u8BEF\u5904\u7406" tabindex="-1">\u9519\u8BEF\u5904\u7406 <a class="header-anchor" href="#\u9519\u8BEF\u5904\u7406" aria-hidden="true">#</a></h2><p>Apollo \u670D\u52A1\u5668\u63D0\u4F9B\u4E86\u4E00\u7EC4\u9884\u5B9A\u4E49\u7684\u9519\u8BEF\uFF0C\u5305\u62EC AuthenticationError\uFF0CForbiddenError\uFF0CUserInputError \u548C\u5E38\u89C4 ApolloError\u3002\u8FD9\u4E9B\u9519\u8BEF\u65E8\u5728\u589E\u5F3A GraphQL \u6267\u884C\u4E4B\u524D\u548C\u6267\u884C\u8FC7\u7A0B\u4E2D\u5F15\u53D1\u7684\u9519\u8BEF\uFF0C\u4ECE\u800C\u4F7F\u8C03\u8BD5 Apollo Server \u96C6\u6210\u66F4\u52A0\u5BB9\u6613\uFF0C\u5E76\u4F7F\u5BA2\u6237\u7AEF\u80FD\u591F\u57FA\u4E8E\u9519\u8BEF\u91C7\u53D6\u7279\u5B9A\u7684\u63AA\u65BD\u3002</p><p>\u5F53\u89E3\u6790\u5668\u5185\u90E8\u548C\u5916\u90E8\u7684 Apollo Server \u4E2D\u90FD\u53D1\u751F\u9519\u8BEF\u65F6\uFF0Cerrors \u6570\u7EC4\u5185\u90E8\u7684\u6BCF\u4E2A\u9519\u8BEF\u90FD\u5305\u542B\u4E00\u4E2A\u6269\u5C55\u5BF9\u8C61\uFF0C\u8BE5\u5BF9\u8C61\u5305\u542B\u7531 Apollo Server \u6DFB\u52A0\u7684\u4FE1\u606F\u3002</p><h4 id="\u9ED8\u8BA4\u4FE1\u606F" tabindex="-1">\u9ED8\u8BA4\u4FE1\u606F <a class="header-anchor" href="#\u9ED8\u8BA4\u4FE1\u606F" aria-hidden="true">#</a></h4><p>\u6539\u5584\u670D\u52A1\u5668\u53EF\u7528\u6027\u7684\u7B2C\u4E00\u6B65\u662F\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u63D0\u4F9B\u9519\u8BEF\u5806\u6808\u8DDF\u8E2A\u3002\u4E0B\u9762\u7684\u793A\u4F8B\u6F14\u793A\u4E86\u4ECEApollo Server\u8FD4\u56DE\u7684\u54CD\u5E94\uFF0C\u8BE5\u54CD\u5E94\u5E26\u6709\u5F15\u53D1\u8282\u70B9 SystemError \u7684\u89E3\u6790\u5668\u3002</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">ApolloServer</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">gql</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">require</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">apollo-server</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">typeDefs</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">gql</span><span style="color:#C98A7DAA;">\`</span></span>
<span class="line"><span style="color:#C98A7D;">  type Query {</span></span>
<span class="line"><span style="color:#C98A7D;">    readError: String</span></span>
<span class="line"><span style="color:#C98A7D;">  }</span></span>
<span class="line"><span style="color:#C98A7DAA;">\`</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">resolvers</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">Query</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">readError</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">parent</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">args</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">context</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#BD976A;">fs</span><span style="color:#666666;">.</span><span style="color:#80A665;">readFileSync</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">/does/not/exist</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#666666;">};</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">ApolloServer</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">gql</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">require</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">apollo-server</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">typeDefs</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">gql</span><span style="color:#B56959AA;">\`</span></span>
<span class="line"><span style="color:#B56959;">  type Query {</span></span>
<span class="line"><span style="color:#B56959;">    readError: String</span></span>
<span class="line"><span style="color:#B56959;">  }</span></span>
<span class="line"><span style="color:#B56959AA;">\`</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">resolvers</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">Query</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">readError</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">parent</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">args</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">context</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B07D48;">fs</span><span style="color:#999999;">.</span><span style="color:#59873A;">readFileSync</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">/does/not/exist</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#999999;">};</span></span>
<span class="line"></span></code></pre></div><p>\u54CD\u5E94\u7ED3\u679C\u5982\u4E0B\uFF1A <img src="`+c+`" alt="img"></p><p>\u8981\u4E3A\u751F\u4EA7\u7981\u7528\u5806\u6808\u8DDF\u8E2A\uFF0C\u8BF7\u5C06 debug: false \u4F20\u9012\u7ED9 Apollo Server \u6784\u9020\u51FD\u6570\uFF0C\u6216\u8005\u5C06 NODE_ENV \u73AF\u5883\u53D8\u91CF\u8BBE\u7F6E\u4E3A &#39;production&#39; \u6216 &#39;test&#39;\u3002\u8BF7\u6CE8\u610F\uFF0C\u8FD9\u4F1A\u4F7F stacktrace \u5BF9\u60A8\u7684\u5E94\u7528\u7A0B\u5E8F\u4E0D\u53EF\u7528\u3002\u5982\u679C\u8981\u8BB0\u5F55\u5806\u6808\u8DDF\u8E2A\u4FE1\u606F\uFF0C\u4F46\u4E0D\u5C06\u5176\u53D1\u9001\u7ED9\u5BA2\u6237\u7AEF\uFF0C\u8BF7\u53C2\u9605\u4E0B\u9762\u7684\u5C4F\u853D\u548C\u8BB0\u5F55\u9519\u8BEF\u3002</p><h4 id="\u9519\u8BEF\u4EE3\u53F7" tabindex="-1">\u9519\u8BEF\u4EE3\u53F7 <a class="header-anchor" href="#\u9519\u8BEF\u4EE3\u53F7" aria-hidden="true">#</a></h4><p>\u9664\u4E86\u5806\u6808\u8DDF\u8E2A\u5916\uFF0CApollo Server \u5BFC\u51FA\u7684\u9519\u8BEF\u8FD8\u5728\u6269\u5C55\u7684\u4EE3\u7801\u5B57\u6BB5\u4E2D\u6307\u5B9A\u4E86\u4EBA\u7C7B\u53EF\u8BFB\u7684\u5B57\u7B26\u4E32\uFF0C\u8BE5\u5B57\u7B26\u4E32\u4F7F\u5BA2\u6237\u7AEF\u80FD\u591F\u6267\u884C\u7EA0\u6B63\u63AA\u65BD\u3002\u9664\u4E86\u6539\u5584\u5BA2\u6237\u4F53\u9A8C\u4E4B\u5916\uFF0C\u4EE3\u7801\u5B57\u6BB5\u8FD8\u5141\u8BB8\u670D\u52A1\u5668\u5BF9\u9519\u8BEF\u8FDB\u884C\u5206\u7C7B\u3002\u4F8B\u5982\uFF0CAuthenticationError \u5C06\u4EE3\u7801\u8BBE\u7F6E\u4E3A UNAUTHENTICATED\uFF0C\u8FD9\u4F7F\u5BA2\u6237\u7AEF\u53EF\u4EE5\u91CD\u65B0\u8FDB\u884C\u8EAB\u4EFD\u9A8C\u8BC1\uFF0C\u901A\u5E38\u4F1A\u88AB\u89C6\u4E3A\u670D\u52A1\u5668\u5F02\u5E38\u800C\u88AB\u5FFD\u7565\u3002</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">ApolloServer</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">gql</span><span style="color:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">AuthenticationError</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">require</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">apollo-server</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">typeDefs</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">gql</span><span style="color:#C98A7DAA;">\`</span></span>
<span class="line"><span style="color:#C98A7D;">  type Query {</span></span>
<span class="line"><span style="color:#C98A7D;">    authenticationError: String</span></span>
<span class="line"><span style="color:#C98A7D;">  }</span></span>
<span class="line"><span style="color:#C98A7DAA;">\`</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">resolvers</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">Query</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">authenticationError</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">parent</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">args</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">context</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">throw</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">AuthenticationError</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">must authenticate</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#666666;">};</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">ApolloServer</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">gql</span><span style="color:#999999;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">AuthenticationError</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">require</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">apollo-server</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">typeDefs</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">gql</span><span style="color:#B56959AA;">\`</span></span>
<span class="line"><span style="color:#B56959;">  type Query {</span></span>
<span class="line"><span style="color:#B56959;">    authenticationError: String</span></span>
<span class="line"><span style="color:#B56959;">  }</span></span>
<span class="line"><span style="color:#B56959AA;">\`</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">resolvers</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">Query</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">authenticationError</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">parent</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">args</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">context</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">throw</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">AuthenticationError</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">must authenticate</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#999999;">};</span></span>
<span class="line"></span></code></pre></div><p>\u54CD\u5E94\u7ED3\u679C\u5982\u4E0B\uFF1A <img src="`+t+`" alt="img"></p><h4 id="\u6269\u5927\u9519\u8BEF\u7684\u8BE6\u7EC6\u4FE1\u606F" tabindex="-1">\u6269\u5927\u9519\u8BEF\u7684\u8BE6\u7EC6\u4FE1\u606F <a class="header-anchor" href="#\u6269\u5927\u9519\u8BEF\u7684\u8BE6\u7EC6\u4FE1\u606F" aria-hidden="true">#</a></h4><p>\u5F53\u5BA2\u6237\u7AEF\u63D0\u4F9B\u9519\u8BEF\u7684\u8F93\u5165\u65F6\uFF0C\u60A8\u53EF\u80FD\u5E0C\u671B\u9488\u5BF9\u65E0\u6548\u7684\u6BCF\u4E2A\u5B57\u6BB5\u6216\u53C2\u6570\u8FD4\u56DE\u5176\u4ED6\u4FE1\u606F\uFF0C\u4F8B\u5982\u672C\u5730\u5316\u6D88\u606F\u3002\u4E0B\u9762\u7684\u793A\u4F8B\u6F14\u793A\u5982\u4F55\u4F7F\u7528 UserInputError \u6765\u6DFB\u52A0\u66F4\u591A\u8BE6\u7EC6\u4FE1\u606F\u6765\u589E\u52A0\u9519\u8BEF\u6D88\u606F\u3002</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">ApolloServer</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">UserInputError</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">gql</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">require</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">apollo-server</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">typeDefs</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">gql</span><span style="color:#C98A7DAA;">\`</span></span>
<span class="line"><span style="color:#C98A7D;">  type Mutation {</span></span>
<span class="line"><span style="color:#C98A7D;">    userInputError(input: String): String</span></span>
<span class="line"><span style="color:#C98A7D;">  }</span></span>
<span class="line"><span style="color:#C98A7DAA;">\`</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">resolvers</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#B8A965;">Mutation</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#80A665;">userInputError</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">parent</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">args</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">context</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">info</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">args</span><span style="color:#666666;">.</span><span style="color:#BD976A;">input</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">!==</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">expected</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#4D9375;">throw</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">UserInputError</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Form Arguments invalid</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">          </span><span style="color:#B8A965;">invalidArgs</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">Object</span><span style="color:#666666;">.</span><span style="color:#80A665;">keys</span><span style="color:#666666;">(</span><span style="color:#BD976A;">args</span><span style="color:#666666;">),</span></span>
<span class="line"><span style="color:#DBD7CAEE;">        </span><span style="color:#666666;">});</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#666666;">};</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">ApolloServer</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">UserInputError</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">gql</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">require</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">apollo-server</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">typeDefs</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">gql</span><span style="color:#B56959AA;">\`</span></span>
<span class="line"><span style="color:#B56959;">  type Mutation {</span></span>
<span class="line"><span style="color:#B56959;">    userInputError(input: String): String</span></span>
<span class="line"><span style="color:#B56959;">  }</span></span>
<span class="line"><span style="color:#B56959AA;">\`</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">resolvers</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#998418;">Mutation</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">userInputError</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">parent</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">args</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">context</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">info</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">args</span><span style="color:#999999;">.</span><span style="color:#B07D48;">input</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!==</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">expected</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">throw</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">UserInputError</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Form Arguments invalid</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#998418;">invalidArgs</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">Object</span><span style="color:#999999;">.</span><span style="color:#59873A;">keys</span><span style="color:#999999;">(</span><span style="color:#B07D48;">args</span><span style="color:#999999;">),</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#999999;">});</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#999999;">};</span></span>
<span class="line"></span></code></pre></div><p>\u54CD\u5E94\u5C06\u8FD4\u56DE\uFF1A <img src="`+y+`" alt="img"></p><h4 id="\u5176\u5B83\u9519\u8BEF" tabindex="-1">\u5176\u5B83\u9519\u8BEF <a class="header-anchor" href="#\u5176\u5B83\u9519\u8BEF" aria-hidden="true">#</a></h4><p>\u5982\u679C\u9700\u8981\u5B9A\u4E49\u7279\u5B9A\u4E8E\u60A8\u7684\u5E94\u7528\u7A0B\u5E8F\u7684\u5176\u4ED6\u9519\u8BEF\u4EE3\u7801\uFF0C\u5219\u53EF\u4EE5\u4F7F\u7528 ApolloError \u57FA\u7C7B\u3002</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">ApolloError</span><span style="color:#666666;">(</span><span style="color:#BD976A;">message</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">code</span><span style="color:#666666;">,</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">additionalProperties</span><span style="color:#666666;">);</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">ApolloError</span><span style="color:#999999;">(</span><span style="color:#B07D48;">message</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">code</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">additionalProperties</span><span style="color:#999999;">);</span></span>
<span class="line"></span></code></pre></div><h4 id="\u63A9\u76D6\u548C\u8BB0\u5F55\u9519\u8BEF" tabindex="-1">\u63A9\u76D6\u548C\u8BB0\u5F55\u9519\u8BEF <a class="header-anchor" href="#\u63A9\u76D6\u548C\u8BB0\u5F55\u9519\u8BEF" aria-hidden="true">#</a></h4><p>\u5BF9\u4E8E\u5BA2\u6237\u7AEF\u54CD\u5E94 Apollo Server \u6784\u9020\u51FD\u6570\u63A5\u53D7\u4E00\u4E2A formatError \u51FD\u6570\uFF0C\u8BE5\u51FD\u6570\u5728\u4F20\u9012\u56DE\u5BA2\u6237\u7AEF\u7684\u6BCF\u4E2A\u9519\u8BEF\u4E0A\u8FD0\u884C\u3002\u8FD9\u53EF\u7528\u4E8E\u63A9\u76D6\u9519\u8BEF\u4EE5\u53CA\u8BB0\u5F55\u65E5\u5FD7\u3002</p><blockquote><p>\u8BF7\u6CE8\u610F\uFF0C\u867D\u7136\u8FD9\u4F1A\u66F4\u6539\u53D1\u9001\u5230\u5BA2\u6237\u7AEF\u7684\u9519\u8BEF\uFF0C\u4F46\u4E0D\u4F1A\u66F4\u6539\u53D1\u9001\u5230 Apollo Studio \u7684\u9519\u8BEF\u3002\u5982\u679C\u9700\u8981\u6B64\u884C\u4E3A\uFF0C\u8BF7\u53C2\u89C1\u4E0B\u9762\u7684 For Apollo Studio \u62A5\u544A\u4E2D\u7684 rewriteError \u51FD\u6570\u3002</p></blockquote><p>\u6B64\u793A\u4F8B\u6F14\u793A\u5F53\u9519\u8BEF\u6D88\u606F\u4EE5 Database Error: \u5F00\u5934\u65F6\u629B\u51FA\u53E6\u4E00\u4E2A\u9519\u8BEF\uFF1A</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">server</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">ApolloServer</span><span style="color:#666666;">({</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">typeDefs</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">resolvers</span><span style="color:#666666;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">formatError</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">err</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// Don&#39;t give the specific errors to the client.</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">err</span><span style="color:#666666;">.</span><span style="color:#BD976A;">message</span><span style="color:#666666;">.</span><span style="color:#80A665;">startsWith</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#C98A7D;">Database Error: </span><span style="color:#C98A7DAA;">&quot;</span><span style="color:#666666;">))</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">Error</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Internal server error</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// Otherwise return the original error.  The error can also</span></span>
<span class="line"><span style="color:#666666;">    </span><span style="color:#758575DD;">// be manipulated in other ways, so long as it&#39;s returned.</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">err</span><span style="color:#666666;">;</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#666666;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">server</span><span style="color:#666666;">.</span><span style="color:#80A665;">listen</span><span style="color:#666666;">().</span><span style="color:#80A665;">then</span><span style="color:#666666;">(({</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">url</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">})</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">\`</span><span style="color:#C98A7D;">\u{1F680} Server ready at </span><span style="color:#666666;">\${</span><span style="color:#C98A7D;">url</span><span style="color:#666666;">}</span><span style="color:#C98A7DAA;">\`</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#666666;">});</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">server</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">ApolloServer</span><span style="color:#999999;">({</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">typeDefs</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">resolvers</span><span style="color:#999999;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">formatError</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">err</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// Don&#39;t give the specific errors to the client.</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">err</span><span style="color:#999999;">.</span><span style="color:#B07D48;">message</span><span style="color:#999999;">.</span><span style="color:#59873A;">startsWith</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&quot;</span><span style="color:#B56959;">Database Error: </span><span style="color:#B56959AA;">&quot;</span><span style="color:#999999;">))</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">Error</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Internal server error</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// Otherwise return the original error.  The error can also</span></span>
<span class="line"><span style="color:#999999;">    </span><span style="color:#A0ADA0;">// be manipulated in other ways, so long as it&#39;s returned.</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">err</span><span style="color:#999999;">;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#999999;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">server</span><span style="color:#999999;">.</span><span style="color:#59873A;">listen</span><span style="color:#999999;">().</span><span style="color:#59873A;">then</span><span style="color:#999999;">(({</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">url</span><span style="color:#393A34;"> </span><span style="color:#999999;">})</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">\`</span><span style="color:#B56959;">\u{1F680} Server ready at </span><span style="color:#999999;">\${</span><span style="color:#B56959;">url</span><span style="color:#999999;">}</span><span style="color:#B56959AA;">\`</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#999999;">});</span></span>
<span class="line"></span></code></pre></div><p>formatError\uFF08\u4E00\u4E2AGraphQLError\uFF09\u63A5\u6536\u5230\u7684\u9519\u8BEF\u5B9E\u4F8B\u5305\u542B\u4E00\u4E2A originalError \u5C5E\u6027\uFF0C\u8BE5\u5C5E\u6027\u8868\u793A\u5728\u89E3\u6790\u5668\u4E2D\u5F15\u53D1\u7684\u539F\u59CB\u9519\u8BEF\u3002\u8FD9\u53EF\u4EE5\u7528\u4E8E instanceof \u68C0\u67E5\u7279\u5B9A\u7684\u9519\u8BEF\u7C7B\uFF0C\u4F8B\u5982 AuthenticationError\uFF0CValidationError \u7B49\uFF1A</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#758575DD;">/* ... */</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#80A665;">formatError</span><span style="color:#666666;">(</span><span style="color:#BD976A;">err</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">(</span><span style="color:#BD976A;">err</span><span style="color:#666666;">.</span><span style="color:#BD976A;">originalError</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">instanceof</span><span style="color:#DBD7CAEE;"> </span><span style="color:#5DA9A7;">AuthenticationError</span><span style="color:#666666;">)</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;">      </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">Error</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">Different authentication error message!</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"><span style="color:#DBD7CAEE;">    </span><span style="color:#666666;">}</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#DBD7CAEE;">  </span><span style="color:#758575DD;">/* ... */</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#393A34;">  </span><span style="color:#A0ADA0;">/* ... */</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">formatError</span><span style="color:#999999;">(</span><span style="color:#B07D48;">err</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">err</span><span style="color:#999999;">.</span><span style="color:#B07D48;">originalError</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">instanceof</span><span style="color:#393A34;"> </span><span style="color:#2E808F;">AuthenticationError</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">Error</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">Different authentication error message!</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#A0ADA0;">/* ... */</span></span>
<span class="line"></span></code></pre></div><blockquote><p>\u8981\u9488\u5BF9 formatError \u63A5\u6536\u5230\u7684\u9519\u8BEF\u8FDB\u884C\u7279\u5B9A\u4E8E\u4E0A\u4E0B\u6587\u7684\u8C03\u6574\uFF08\u4F8B\u5982\uFF0C\u672C\u5730\u5316\u6216\u4E2A\u6027\u5316\u8BBE\u7F6E\uFF09\uFF0C\u8BF7\u8003\u8651\u4F7F\u7528 didEncounterErrors \u751F\u547D\u5468\u671F\u6302\u94A9\u5C06\u5176\u4ED6\u5C5E\u6027\u9644\u52A0\u5230\u9519\u8BEF\uFF0C\u53EF\u4EE5\u5728 formatError \u4E2D\u8BBF\u95EE\u548C\u5229\u7528\u9644\u52A0\u5C5E\u6027\u3002</p></blockquote><h4 id="\u5BF9\u4E8E-apollo-studio-\u62A5\u544A" tabindex="-1">\u5BF9\u4E8E Apollo Studio \u62A5\u544A <a class="header-anchor" href="#\u5BF9\u4E8E-apollo-studio-\u62A5\u544A" aria-hidden="true">#</a></h4><h2 id="\u6743\u9650\u8BA4\u8BC1" tabindex="-1">\u6743\u9650\u8BA4\u8BC1 <a class="header-anchor" href="#\u6743\u9650\u8BA4\u8BC1" aria-hidden="true">#</a></h2><p>\u5982\u4F55\u5728 GraphQL API \u4E2D\u6388\u6743\u7528\u6237\u548C\u6743\u9650\u63A7\u5236\u3002</p><p>\u5728\u6784\u5EFAGraphQL\u7AEF\u70B9\u65F6\u7684\u67D0\u4E2A\u65F6\u95F4\u70B9\uFF08\u53EF\u80FD\u5F88\u65E9\uFF09\uFF0C\u60A8\u53EF\u80FD\u4E0D\u5F97\u4E0D\u9762\u5BF9\u4E00\u4E2A\u95EE\u9898\uFF0C\u5373\u5982\u4F55\u63A7\u5236\u8C01\u53EF\u4EE5\u770B\u5230\u60A8\u7684API\u4E2D\u7684\u6570\u636E\u5E76\u4E0E\u4E4B\u4EA4\u4E92\u3002</p><p>\u8EAB\u4EFD\u9A8C\u8BC1\u662F\u786E\u5B9A\u7528\u6237\u662F\u5426\u5DF2\u767B\u5F55\uFF0C\u7136\u540E\u786E\u5B9A\u67D0\u4EBA\u662F\u54EA\u4E2A\u7528\u6237\u3002\u7136\u540E\uFF0C\u6388\u6743\u5C06\u51B3\u5B9A\u7528\u6237\u6709\u6743\u6267\u884C\u6216\u67E5\u770B\u7684\u5185\u5BB9\u3002</p><p>\u4E00\u65E6\u77E5\u9053\u7528\u6237\u5C1D\u8BD5\u53D1\u51FA\u8BF7\u6C42\uFF0C\u672C\u6587\u5C06\u4E3B\u8981\u4FA7\u91CD\u4E8E\u5982\u4F55\u4E3A\u60A8\u7684 schema \u8BBE\u7F6E\u6388\u6743\uFF0C\u4F46\u662F\u6211\u4EEC\u5C06\u901A\u8FC7\u4E00\u4E2A\u8EAB\u4EFD\u9A8C\u8BC1\u793A\u4F8B\u6765\u4E86\u89E3\u6211\u4EEC\u6B63\u5728\u505A\u7684\u4E8B\u60C5\u7684\u80CC\u666F\u3002</p><h4 id="\u5C06\u7528\u6237\u4FE1\u606F\u653E\u5230-context-\u4E2D" tabindex="-1">\u5C06\u7528\u6237\u4FE1\u606F\u653E\u5230 context \u4E2D <a class="header-anchor" href="#\u5C06\u7528\u6237\u4FE1\u606F\u653E\u5230-context-\u4E2D" aria-hidden="true">#</a></h4><p>\u5728\u5F04\u6E05\u695A\u7528\u6237\u6743\u9650\u4E4B\u524D\uFF0C\u6211\u4EEC\u5FC5\u987B\u5148\u5F04\u6E05\u695A\u5982\u4F55\u8BC6\u522B\u7528\u6237\u3002\u4ECE HTTP \u6807\u5934\u5230 JSON Web Token\uFF0C\u6709\u591A\u79CD\u65B9\u6CD5\u53EF\u4EE5\u5904\u7406\u7528\u6237\u8EAB\u4EFD\u9A8C\u8BC1\uFF0C\u4F46\u662F\u4E00\u65E6\u62E5\u6709\u7528\u6237\uFF0C\u63A7\u5236\u8BBF\u95EE\u5C31\u975E\u5E38\u76F8\u4F3C\u3002</p><p>\u6211\u4EEC\u5C06\u4EE5 HTTP \u6388\u6743\u6807\u5934\u4E2D\u7684\u767B\u5F55\u4EE4\u724C\u4E3A\u4F8B\u3002</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki vp-code-dark"><code><span class="line"><span style="color:#758575DD;">// using apollo-server 2.x</span></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">ApolloServer</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">}</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">require</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#C98A7D;">apollo-server</span><span style="color:#C98A7DAA;">&#39;</span><span style="color:#666666;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">server</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">new</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">ApolloServer</span><span style="color:#666666;">({</span></span>
<span class="line"><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">typeDefs</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">resolvers</span><span style="color:#666666;">,</span></span>
<span class="line"><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">context</span><span style="color:#666666;">:</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">({</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">req</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">})</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#666666;">   </span><span style="color:#758575DD;">// Note! This example uses the \`req\` object to access headers,</span></span>
<span class="line"><span style="color:#666666;">   </span><span style="color:#758575DD;">// but the arguments received by \`context\` vary by integration.</span></span>
<span class="line"><span style="color:#666666;">   </span><span style="color:#758575DD;">// This means they will vary for Express, Koa, Lambda, etc.!</span></span>
<span class="line"><span style="color:#666666;">   </span><span style="color:#758575DD;">//</span></span>
<span class="line"><span style="color:#666666;">   </span><span style="color:#758575DD;">// To find out the correct arguments for a specific integration,</span></span>
<span class="line"><span style="color:#666666;">   </span><span style="color:#758575DD;">// see the \`context\` option in the API reference for \`apollo-server\`:</span></span>
<span class="line"><span style="color:#666666;">   </span><span style="color:#758575DD;">// https://www.apollographql.com/docs/apollo-server/api/apollo-server/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">   </span><span style="color:#758575DD;">// Get the user token from the headers.</span></span>
<span class="line"><span style="color:#DBD7CAEE;">   </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">token</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">req</span><span style="color:#666666;">.</span><span style="color:#BD976A;">headers</span><span style="color:#666666;">.</span><span style="color:#BD976A;">authorization</span><span style="color:#DBD7CAEE;"> </span><span style="color:#CB7676;">||</span><span style="color:#DBD7CAEE;"> </span><span style="color:#C98A7DAA;">&#39;&#39;</span><span style="color:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">   </span><span style="color:#758575DD;">// try to retrieve a user with the token</span></span>
<span class="line"><span style="color:#DBD7CAEE;">   </span><span style="color:#CB7676;">const</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">user</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=</span><span style="color:#DBD7CAEE;"> </span><span style="color:#80A665;">getUser</span><span style="color:#666666;">(</span><span style="color:#BD976A;">token</span><span style="color:#666666;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#666666;">   </span><span style="color:#758575DD;">// add the user to the context</span></span>
<span class="line"><span style="color:#DBD7CAEE;">   </span><span style="color:#4D9375;">return</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">user</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">};</span></span>
<span class="line"><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">},</span></span>
<span class="line"><span style="color:#666666;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BD976A;">server</span><span style="color:#666666;">.</span><span style="color:#80A665;">listen</span><span style="color:#666666;">().</span><span style="color:#80A665;">then</span><span style="color:#666666;">(({</span><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">url</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">})</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">=&gt;</span><span style="color:#DBD7CAEE;"> </span><span style="color:#666666;">{</span></span>
<span class="line"><span style="color:#DBD7CAEE;"> </span><span style="color:#BD976A;">console</span><span style="color:#666666;">.</span><span style="color:#80A665;">log</span><span style="color:#666666;">(</span><span style="color:#C98A7DAA;">\`</span><span style="color:#C98A7D;">\u{1F680} Server ready at </span><span style="color:#666666;">\${</span><span style="color:#C98A7D;">url</span><span style="color:#666666;">}</span><span style="color:#C98A7DAA;">\`</span><span style="color:#666666;">)</span></span>
<span class="line"><span style="color:#666666;">});</span></span>
<span class="line"></span></code></pre><pre class="shiki vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// using apollo-server 2.x</span></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">ApolloServer</span><span style="color:#393A34;"> </span><span style="color:#999999;">}</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">require</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">&#39;</span><span style="color:#B56959;">apollo-server</span><span style="color:#B56959AA;">&#39;</span><span style="color:#999999;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">server</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">new</span><span style="color:#393A34;"> </span><span style="color:#59873A;">ApolloServer</span><span style="color:#999999;">({</span></span>
<span class="line"><span style="color:#393A34;"> </span><span style="color:#B07D48;">typeDefs</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;"> </span><span style="color:#B07D48;">resolvers</span><span style="color:#999999;">,</span></span>
<span class="line"><span style="color:#393A34;"> </span><span style="color:#59873A;">context</span><span style="color:#999999;">:</span><span style="color:#393A34;"> </span><span style="color:#999999;">({</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">req</span><span style="color:#393A34;"> </span><span style="color:#999999;">})</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">   </span><span style="color:#A0ADA0;">// Note! This example uses the \`req\` object to access headers,</span></span>
<span class="line"><span style="color:#999999;">   </span><span style="color:#A0ADA0;">// but the arguments received by \`context\` vary by integration.</span></span>
<span class="line"><span style="color:#999999;">   </span><span style="color:#A0ADA0;">// This means they will vary for Express, Koa, Lambda, etc.!</span></span>
<span class="line"><span style="color:#999999;">   </span><span style="color:#A0ADA0;">//</span></span>
<span class="line"><span style="color:#999999;">   </span><span style="color:#A0ADA0;">// To find out the correct arguments for a specific integration,</span></span>
<span class="line"><span style="color:#999999;">   </span><span style="color:#A0ADA0;">// see the \`context\` option in the API reference for \`apollo-server\`:</span></span>
<span class="line"><span style="color:#999999;">   </span><span style="color:#A0ADA0;">// https://www.apollographql.com/docs/apollo-server/api/apollo-server/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">   </span><span style="color:#A0ADA0;">// Get the user token from the headers.</span></span>
<span class="line"><span style="color:#393A34;">   </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">token</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">req</span><span style="color:#999999;">.</span><span style="color:#B07D48;">headers</span><span style="color:#999999;">.</span><span style="color:#B07D48;">authorization</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">||</span><span style="color:#393A34;"> </span><span style="color:#B56959AA;">&#39;&#39;</span><span style="color:#999999;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">   </span><span style="color:#A0ADA0;">// try to retrieve a user with the token</span></span>
<span class="line"><span style="color:#393A34;">   </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">user</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">getUser</span><span style="color:#999999;">(</span><span style="color:#B07D48;">token</span><span style="color:#999999;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">   </span><span style="color:#A0ADA0;">// add the user to the context</span></span>
<span class="line"><span style="color:#393A34;">   </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">user</span><span style="color:#393A34;"> </span><span style="color:#999999;">};</span></span>
<span class="line"><span style="color:#393A34;"> </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#999999;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">server</span><span style="color:#999999;">.</span><span style="color:#59873A;">listen</span><span style="color:#999999;">().</span><span style="color:#59873A;">then</span><span style="color:#999999;">(({</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">url</span><span style="color:#393A34;"> </span><span style="color:#999999;">})</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;"> </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B56959AA;">\`</span><span style="color:#B56959;">\u{1F680} Server ready at </span><span style="color:#999999;">\${</span><span style="color:#B56959;">url</span><span style="color:#999999;">}</span><span style="color:#B56959AA;">\`</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#999999;">});</span></span>
<span class="line"></span></code></pre></div><p>\u90A3\u4E48\uFF0C\u8FD9\u91CC\u5230\u5E95\u53D1\u751F\u4E86\u4EC0\u4E48\uFF1F\u6B64\u4EE3\u7801\u5757\u4F7F\u7528 Apollo Server 2.0 \u8BBE\u7F6E\u65B0\u7684 GraphQL \u670D\u52A1\u5668\u3002\u65B0\u7248\u672C\u7684 Apollo Server \u7B80\u5316\u4E86\u7528\u4E8E\u521B\u5EFA\u65B0\u670D\u52A1\u5668\u7684 API\uFF0C\u5E76\u5177\u6709\u4E00\u4E9B\u66F4\u667A\u80FD\u7684\u9ED8\u8BA4\u503C\u3002\u4F60\u53EF\u4EE5\u5728\u8FD9\u91CC\u8BFB\u66F4\u591A\u5173\u4E8E\u5B83\u7684\u5185\u5BB9\uFF01</p><p>\u5728\u6B64\u6784\u9020\u51FD\u6570\u4E2D\uFF0C\u6211\u4EEC\u5C06\u7C7B\u578B\u5B9A\u4E49\u548C\u89E3\u6790\u5668\u4F20\u9012\u7ED9\u6784\u9020\u51FD\u6570\u4EE5\u53CA\u7528\u4E8E\u6784\u5EFA\u4E0A\u4E0B\u6587\u5BF9\u8C61\u7684\u51FD\u6570\u3002\u4E0A\u4E0B\u6587\u5BF9\u8C61\u662F\u4F20\u9012\u7ED9\u6BCF\u4E2A\u7EA7\u522B\u7684\u6BCF\u4E2A\u89E3\u6790\u5668\u7684\u5BF9\u8C61\uFF0C\u56E0\u6B64\u6211\u4EEC\u53EF\u4EE5\u5728 schema \u4EE3\u7801\u4E2D\u7684\u4EFB\u4F55\u4F4D\u7F6E\u8BBF\u95EE\u5B83\u3002\u5728\u8FD9\u91CC\u6211\u4EEC\u53EF\u4EE5\u5B58\u50A8\u6570\u636E\u63D0\u53D6\u7A0B\u5E8F\uFF0C\u6570\u636E\u5E93\u8FDE\u63A5\u4EE5\u53CA\uFF08\u65B9\u4FBF\u5730\uFF09\u6709\u5173\u53D1\u51FA\u8BF7\u6C42\u7684\u7528\u6237\u7684\u4FE1\u606F\u3002</p><p>\u7531\u4E8E\u6BCF\u6B21\u65B0\u8BF7\u6C42\u90FD\u4F1A\u91CD\u65B0\u751F\u6210\u4E0A\u4E0B\u6587\uFF0C\u56E0\u6B64\u6211\u4EEC\u4E0D\u5FC5\u62C5\u5FC3\u5728\u6267\u884C\u7ED3\u675F\u65F6\u6E05\u7406\u7528\u6237\u6570\u636E\u3002</p><p>\u8FD9\u91CC\u7684\u4E0A\u4E0B\u6587\u51FD\u6570\u67E5\u770B\u8BF7\u6C42\u6807\u5934\uFF0C\u63D0\u53D6\u540D\u4E3A authorization \u7684\u6807\u5934\uFF0C\u5E76\u5C06\u5176\u5B58\u50A8\u5230\u53D8\u91CF\u4E2D\u3002\u7136\u540E\uFF0C\u5B83\u5C06\u4F7F\u7528\u8BE5\u4EE4\u724C\u8C03\u7528 getUser \u51FD\u6570\uFF0C\u5E76\u671F\u671B\u5728\u4EE4\u724C\u6709\u6548\u7684\u60C5\u51B5\u4E0B\u8FD4\u56DE\u7528\u6237\u3002\u4E4B\u540E\uFF0C\u5B83\u8FD4\u56DE\u4E00\u4E2A\u5305\u542B\uFF08\u6F5C\u5728\uFF09\u7528\u6237\u7684\u4E0A\u4E0B\u6587\u5BF9\u8C61\uFF0C\u4F9B\u6211\u4EEC\u6240\u6709\u7684\u89E3\u6790\u5668\u4F7F\u7528\u3002</p><p>\u5BF9\u4E8E\u6BCF\u79CD\u8EAB\u4EFD\u9A8C\u8BC1\u65B9\u6CD5\uFF0C\u68C0\u7D22\u7528\u6237\u7684\u7EC6\u8282\u5C06\u6709\u6240\u4E0D\u540C\uFF0C\u4F46\u662F\u6700\u7EC8\u90E8\u5206\u6BCF\u6B21\u90FD\u4F1A\u770B\u8D77\u6765\u76F8\u540C\u3002\u60A8\u7684 schema \u9700\u8981\u7684\u6388\u6743\u53EF\u80FD\u8981\u6C42\u60A8\u4EC5\u5728\u4E0A\u4E0B\u6587\u4E2D\u6DFB\u52A0 <code>{ loggingIn: true }</code>\uFF0C\u4F46\u53EF\u80FD\u8FD8\u9700\u8981 ID \u6216\u89D2\u8272\uFF0C\u4F8B\u5982 <code>{user: {id: 12345\uFF0Crole: [&#39;user&#39;, &#39;admin&#39; ]}}</code>\u3002</p><p>\u5728\u4E0B\u4E00\u8282\u4E2D\uFF0C\u6211\u4EEC\u5C06\u63A2\u8BA8\u4F7F\u7528\u73B0\u5728\u9700\u8981\u4FDD\u62A4\u7528\u6237\u4FE1\u606F\u7684\u7528\u6237\u4FE1\u606F\u7684\u65B9\u6CD5\u3002</p><h4 id="schema-\u6388\u6743" tabindex="-1">Schema \u6388\u6743 <a class="header-anchor" href="#schema-\u6388\u6743" aria-hidden="true">#</a></h4><h4 id="\u89E3\u6790\u5668\u4E2D\u7684\u6388\u6743" tabindex="-1">\u89E3\u6790\u5668\u4E2D\u7684\u6388\u6743 <a class="header-anchor" href="#\u89E3\u6790\u5668\u4E2D\u7684\u6388\u6743" aria-hidden="true">#</a></h4><h4 id="\u6570\u636E\u6A21\u578B\u4E2D\u7684\u6388\u6743" tabindex="-1">\u6570\u636E\u6A21\u578B\u4E2D\u7684\u6388\u6743 <a class="header-anchor" href="#\u6570\u636E\u6A21\u578B\u4E2D\u7684\u6388\u6743" aria-hidden="true">#</a></h4><h4 id="\u901A\u8FC7\u81EA\u5B9A\u4E49\u6307\u4EE4\u6388\u6743" tabindex="-1">\u901A\u8FC7\u81EA\u5B9A\u4E49\u6307\u4EE4\u6388\u6743 <a class="header-anchor" href="#\u901A\u8FC7\u81EA\u5B9A\u4E49\u6307\u4EE4\u6388\u6743" aria-hidden="true">#</a></h4><h4 id="graphql-\u4E4B\u5916\u7684\u6388\u6743" tabindex="-1">GraphQL \u4E4B\u5916\u7684\u6388\u6743 <a class="header-anchor" href="#graphql-\u4E4B\u5916\u7684\u6388\u6743" aria-hidden="true">#</a></h4><h2 id="apollo-client" tabindex="-1">Apollo Client <a class="header-anchor" href="#apollo-client" aria-hidden="true">#</a></h2><ul><li><a href="https://www.apollographql.com/docs/react/integrations/integrations/" target="_blank" rel="noreferrer">https://www.apollographql.com/docs/react/integrations/integrations/</a></li><li><a href="https://github.com/vuejs/vue-apollo" target="_blank" rel="noreferrer">https://github.com/vuejs/vue-apollo</a></li><li><a href="http://apollo.vuejs.org/" target="_blank" rel="noreferrer">http://apollo.vuejs.org/</a></li></ul><h2 id="graphql-\u7EFC\u5408\u6848\u4F8B" tabindex="-1">GraphQL \u7EFC\u5408\u6848\u4F8B <a class="header-anchor" href="#graphql-\u7EFC\u5408\u6848\u4F8B" aria-hidden="true">#</a></h2><ul><li><a href="https://github.com/attraction11/realworld-graphql" target="_blank" rel="noreferrer">https://github.com/attraction11/realworld-graphql</a></li></ul><h2 id="\u5176\u5B83\u5DE5\u5177\u5E93" tabindex="-1">\u5176\u5B83\u5DE5\u5177\u5E93 <a class="header-anchor" href="#\u5176\u5B83\u5DE5\u5177\u5E93" aria-hidden="true">#</a></h2><ul><li><a href="https://github.com/MichalLytek/type-graphql" target="_blank" rel="noreferrer">TypeGraphQL</a> \u4F7F\u7528\u7C7B\u548C\u88C5\u9970\u5668\uFF0C\u4F7F\u7528TypeScript\u521B\u5EFAGraphQL\u6A21\u5F0F\u548C\u89E3\u6790\u5668\uFF01</li><li><a href="https://github.com/tipeio/tipe" target="_blank" rel="noreferrer">Tipe</a> \u9762\u5411\u5F00\u53D1\u4EBA\u5458\u7684\u4E0B\u4E00\u4EE3 API \u4F18\u5148 CMS\u3002\u4F7F\u7528\u8131\u673A\u539F\u578B\u548C\u5185\u8054\u7F16\u8F91\u5668\u4ECE GraphQL schema \u751F\u6210 API \u4F18\u5148\u7684 CMS\u3002</li></ul><p>graphql-tools</p><ul><li>graphql-tools \u662F\u4E00\u4E2A\u7528\u4E8E\u66F4\u5FEB\u5730\u5F00\u53D1 GraphQL schema \u7684\u5B9E\u7528\u5DE5\u5177\u5E93\u3002 <ul><li>\u5B98\u65B9\u7F51\u7AD9\uFF1A<a href="https://www.graphql-tools.com/" target="_blank" rel="noreferrer">https://www.graphql-tools.com/</a></li><li>GitHub \u4ED3\u5E93\uFF1A<a href="https://github.com/ardatan/graphql-tools" target="_blank" rel="noreferrer">https://github.com/ardatan/graphql-tools</a></li></ul></li><li>GraphQL \u4F18\u5148 <ul><li>\u4F7F\u7528 GraphQL schema \u8BED\u8A00\u6765\u751F\u6210\u5B8C\u5168\u652F\u6301\u89E3\u6790\u5668\u3001\u63A5\u53E3\u3001\u8054\u5408\u7C7B\u578B\u548C\u81EA\u5B9A\u4E49\u6807\u91CF\u7684 schema</li><li>\u751F\u6210\u7684 schema \u4E0E GraphQL.js \u5B8C\u5168\u517C\u5BB9</li></ul></li><li>\u6A21\u62DF GraphQL API <ul><li>\u5B83\u4E0D\u4EC5\u5BF9\u6784\u5EFA\u670D\u52A1\u5668\u6709\u7528\uFF0C\u5B83\u4E5F\u53EF\u4EE5\u5728\u6D4F\u89C8\u5668\u4E2D\u4F7F\u7528\uFF0C\u4F8B\u5982\u5728\u5F00\u53D1\u6216\u6D4B\u8BD5\u671F\u95F4\u6A21\u62DF\u540E\u7AEF</li><li>\u501F\u52A9 GraphQL \u5DE5\u5177\uFF0C\u60A8\u53EF\u4EE5\u4F7F\u7528\u7EC6\u7C92\u5EA6\u7684\u6BCF\u4E2A\u7C7B\u578B\u7684\u6A21\u62DF\u6765\u6A21\u62DF GraphQL API\uFF0C\u4ECE\u800C\u65E0\u9700\u4EFB\u4F55\u6570\u636E\u6E90\u5373\u53EF\u8FDB\u884C\u5FEB\u901F\u539F\u578B\u5236\u4F5C\u3002</li></ul></li><li>\u62FC\u63A5\u591A\u4E2A GraphQL schema <ul><li>\u4EE5\u7B80\u5355\uFF0C\u5FEB\u901F\u548C\u5F3A\u5927\u7684\u65B9\u5F0F\u5C06\u591A\u4E2A schema \u81EA\u52A8\u7F1D\u5408\u5230\u4E00\u4E2A\u8F83\u5927\u7684 API \u4E2D</li></ul></li><li>\u5B83\u53EF\u4EE5\u4E0E\u4EFB\u4F55\u4E00\u4E2A GraphQL-JS \u67B6\u6784\u4E00\u8D77\u4F7F\u7528\uFF0C\u5E76\u4E14\u6BCF\u4E2A\u5DE5\u5177\u90FD\u53EF\u4EE5\u5355\u72EC\u4F7F\u7528</li></ul>`,139),D=[i];function B(E,C,d,h,u,g){return a(),n("div",null,D)}const f=s(A,[["render",B]]);export{b as __pageData,f as default};
